<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CoAIexist Master Dashboard</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=VT323&display=swap');
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'VT323', monospace;
            background: linear-gradient(45deg, #050505, #1a0b2e, #001f3f);
            background-size: 400% 400%;
            animation: gradient 15s ease infinite;
            color: #00ff88;
            height: 100vh;
            overflow: hidden;
        }
        @keyframes gradient {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        .main-layout { display: flex; height: 100vh; gap: 10px; padding: 10px; }
        .tree-panel {
            width: 400px; min-width: 300px;
            background: rgba(0, 0, 0, 0.9);
            border: 1px solid #00ff88;
            display: flex; flex-direction: column;
            box-shadow: 0 0 20px rgba(0, 255, 136, 0.2);
            resize: horizontal; overflow: hidden;
        }
        .tree-header {
            padding: 15px; border-bottom: 1px solid #00ff88;
            background: rgba(0, 255, 136, 0.1);
            text-align: center;
        }
        h1 { font-size: 2.2em; margin: 0; text-shadow: 0 0 10px #00ff88; letter-spacing: 2px; }
        .controls { margin-top: 10px; display: flex; gap: 5px; justify-content: center; flex-wrap: wrap; }
        button {
            font-family: 'VT323', monospace; font-size: 1.1em;
            background: #00ff88; color: #000; border: none;
            padding: 4px 12px; cursor: pointer;
            transition: 0.2s;
        }
        button:hover { background: #fff; box-shadow: 0 0 10px #fff; }
        .tree-content { flex: 1; overflow-y: auto; padding: 15px; font-size: 1.1em; }
        ul { list-style: none; padding-left: 15px; }
        .tree-item { margin: 2px 0; }
        .folder { cursor: pointer; color: #ff00ff; font-weight: bold; display: block; }
        .folder:hover { color: #fff; text-shadow: 0 0 5px #ff00ff; }
        .folder::before { content: 'üìÅ '; }
        .folder.expanded::before { content: 'üìÇ '; }
        .file { cursor: pointer; color: #00ffff; display: block; padding-left: 5px; opacity: 0.8; }
        .file:hover { color: #fff; opacity: 1; background: rgba(0, 255, 255, 0.1); }
        .file::before { content: 'üìÑ '; opacity: 0.5; }
        .nested { display: none; margin-left: 10px; border-left: 1px dotted rgba(255, 255, 255, 0.2); }
        .nested.active { display: block; }
        .section-title { 
            color: #ffff00; border-bottom: 1px dashed #ffff00; 
            margin: 20px 0 10px 0; font-size: 1.3em; padding-bottom: 5px;
        }
        .preview-area { flex: 1; display: flex; flex-direction: column; position: relative; }
        .previews-container { 
            flex: 1; display: flex; flex-direction: column; gap: 10px; 
            overflow-y: auto; padding-right: 5px;
        }
        .preview-panel {
            background: #fff; border: 1px solid #00ff88; 
            display: flex; flex-direction: column; min-height: 600px;
            animation: slideIn 0.3s ease;
        }
        @keyframes slideIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .panel-header {
            background: #111; color: #00ff88; padding: 8px 15px;
            display: flex; justify-content: space-between; align-items: center;
            border-bottom: 1px solid #00ff88;
        }
        .panel-title { font-family: monospace; font-size: 0.9em; color: #aaa; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; max-width: 80%; }
        iframe { flex: 1; border: none; width: 100%; height: 100%; background: #fff; }
        .empty-state {
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            height: 100%; color: rgba(0, 255, 136, 0.3); font-size: 2em; text-align: center;
        }
        .meta-row {
            display: flex; justify-content: space-between; align-items: center;
            color: #00ff88; font-size: 1em; padding: 6px 0;
        }
        .meta-row span strong { color: #ffff00; }
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #000; }
        ::-webkit-scrollbar-thumb { background: #00ff88; }
        ::-webkit-scrollbar-thumb:hover { background: #fff; }
    </style>
</head>
<body>
<div class="main-layout">
    <div class="tree-panel">
        <div class="tree-header">
            <h1>MASTER ARCHIVE</h1>
            <div class="controls">
                <button onclick="expandAll()">[+] ALL</button>
                <button onclick="collapseAll()">[-] ALL</button>
                <button onclick="clearPreviews()">[x] CLEAR</button>
            </div>
            <div class="meta-row">
                <span>Total HTML files: <strong id="fileCount">0</strong></span>
                <span>Source: <strong>GitHub Pages</strong></span>
            </div>
        </div>
        <div class="tree-content">
            <div class="section-title">üì¶ Repository /entropic-ai</div>
            <ul id="treeRoot" class="nested active"></ul>
        </div>
    </div>
    <div class="preview-area">
        <div class="previews-container" id="previewsContainer">
            <div class="empty-state">
                [ Click a file to launch preview ]<br>
                ‚ú®
            </div>
        </div>
    </div>
</div>
<script>
    const BASE_URL = 'https://TheNabu222.github.io/entropic-ai/';
    const treeRoot = document.getElementById('treeRoot');
    const fileCountEl = document.getElementById('fileCount');

    async function loadInventory() {
        const response = await fetch('../reports/html_files.json');
        const files = await response.json();
        fileCountEl.textContent = files.length;
        const tree = buildTree(files);
        renderTree(tree, treeRoot, '');
        expandAll();
    }

    function buildTree(paths) {
        const root = {};
        paths.forEach((path) => {
            const parts = path.split('/');
            let node = root;
            parts.forEach((part, idx) => {
                const isFile = idx === parts.length - 1;
                if (isFile) {
                    node[part] = null;
                } else {
                    node[part] = node[part] || {};
                    node = node[part];
                }
            });
        });
        return root;
    }

    function renderTree(tree, container, currentPath) {
        const entries = Object.keys(tree).sort((a, b) => {
            const aIsFolder = tree[a] !== null;
            const bIsFolder = tree[b] !== null;
            if (aIsFolder !== bIsFolder) return aIsFolder ? -1 : 1;
            return a.localeCompare(b);
        });

        entries.forEach((name) => {
            const value = tree[name];
            const li = document.createElement('li');
            li.className = 'tree-item';
            const nextPath = currentPath ? `${currentPath}/${name}` : name;

            if (value === null) {
                const file = document.createElement('span');
                file.className = 'file';
                file.textContent = name;
                file.onclick = () => loadPreview(nextPath);
                li.appendChild(file);
            } else {
                const folder = document.createElement('span');
                folder.className = 'folder expanded';
                folder.textContent = `/${name}`;
                const nested = document.createElement('ul');
                nested.className = 'nested active';
                folder.onclick = () => toggleFolder(folder, nested);
                li.appendChild(folder);
                li.appendChild(nested);
                renderTree(value, nested, nextPath);
            }
            container.appendChild(li);
        });
    }

    function loadPreview(path) {
        const url = `${BASE_URL}${path}`;
        const container = document.getElementById('previewsContainer');
        const emptyState = document.querySelector('.empty-state');
        if (emptyState) emptyState.remove();

        const panel = document.createElement('div');
        panel.className = 'preview-panel';
        panel.innerHTML = `
            <div class="panel-header">
                <div class="panel-title">${url}</div>
                <div>
                    <button onclick="window.open('${url}', '_blank')">üîó Open</button>
                    <button onclick="this.closest('.preview-panel').remove()">‚úï Close</button>
                </div>
            </div>
            <iframe src="${url}"></iframe>
        `;
        container.prepend(panel);
    }

    function toggleFolder(folder, nested) {
        folder.classList.toggle('expanded');
        nested.classList.toggle('active');
    }

    function expandAll() {
        document.querySelectorAll('.nested').forEach((e) => e.classList.add('active'));
        document.querySelectorAll('.folder').forEach((e) => e.classList.add('expanded'));
    }

    function collapseAll() {
        document.querySelectorAll('.nested').forEach((e) => e.classList.remove('active'));
        document.querySelectorAll('.folder').forEach((e) => e.classList.remove('expanded'));
    }

    function clearPreviews() {
        document.getElementById('previewsContainer').innerHTML = `
            <div class="empty-state">
                [ Click a file to launch preview ]<br>
                ‚ú®
            </div>
        `;
    }

    loadInventory();
</script>
</body>
</html>
