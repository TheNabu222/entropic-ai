<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>AnTiChRiSt KeTtLeKoRn Messenger + Grinoire</title>
  <link href="https://fonts.googleapis.com/css2?family=VT323&family=Tahoma&family=Comic+Sans+MS&family=Dancing+Script:wght@600&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/mermaid@9.2.2/dist/mermaid.min.js"></script>
  <style>
    /* === Base styles === */
    :root {
      /* Antichristic color scheme */
      --magenta: #f312af;
      --magenta-dark: #b10a7a;
      --magenta-light: #ff6bd0;
      --cyan: #72FADE;
      --cyan-dark: #41b8c4;
      --cyan-light: #b7fdff;
      --yellow: #fffb01;
      --yellow-dark: #c9c600;
      --yellow-light: #ffff82;
      
      /* Y2K additional colors */
      --gradient-start: #c066f6;
      --gradient-end: #ff72b6;
      --y2k-blue: #80ffef;
      --y2k-yellow: #FFEF9F;
      
      /* Windows XP colors */
      --winxp-blue: #0A246A;
      --winxp-blue-light: #3B6EDA;
      --winxp-button: #D4D0C8;
      --winxp-button-highlight: #ECE9D8;
      
      /* Gradients */
      --xp-title-gradient: linear-gradient(to right, var(--magenta), var(--cyan));
      --antichristic-gradient: linear-gradient(45deg, var(--magenta), var(--cyan), var(--yellow));
      --glitch-gradient: linear-gradient(to right, var(--magenta), var(--cyan), var(--yellow), var(--magenta));
      --error-gradient: linear-gradient(to right, #f00, #f0f, #f00);
      --y2k-gradient: linear-gradient(to right, var(--gradient-start), var(--gradient-end));
      
      /* Status colors */
      --status-online: #1eff45;
      --status-away: var(--yellow);
      --status-offline: #ff3a3a;
      --status-busy: #ff7700;
      --status-invisible: #a880ff;
      
      /* Kasten Colors */
      --kasten-i: #9C27B0;
      --kasten-ii: #2196F3;
      --kasten-iii: #00BFA5;
      --kasten-iv: #FF7043;
      
      /* Tag Colors */
      --tag-tier1: #9C27B0;
      --tag-tier2: #2196F3;
      --tag-tier3: #FF7043;
      
      /* Kingdom colors (from original design) */
      --kingdom-existentia: #9C27B0;
      --kingdom-cognitio: #2196F3;
      --kingdom-actus: #F44336;
      --kingdom-valor: #4CAF50;
      --kingdom-systema: #FF9800;
      --kingdom-significatio: #607D8B;
    }
    
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      -webkit-tap-highlight-color: transparent;
    }
    
    body {
      font-family: 'Tahoma', sans-serif;
      background: url('https://i.imgur.com/6v2gwl3.jpg') center/cover no-repeat;
      background-attachment: fixed;
      overflow: hidden;
      height: 100vh;
      width: 100vw;
      display: flex;
      flex-direction: column;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      color: #fff;
    }
    
    /* Dark mode support with alternate background */
    @media (prefers-color-scheme: dark) {
      body {
        background: url('https://i.imgur.com/KIbZTBh.jpg') center/cover no-repeat;
      }
    }
    
    /* === Mobile App Layout === */
    .app-container {
      display: flex;
      flex-direction: column;
      height: 100%;
      width: 100%;
      overflow: hidden;
      background-color: rgba(0, 0, 0, 0.7);
      position: relative;
    }
    
    /* Glitch overlay */
    .app-container::before {
      content: "";
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(
        rgba(255, 255, 255, 0.03) 1px, 
        transparent 1px
      ), 
      linear-gradient(
        90deg, 
        rgba(255, 255, 255, 0.03) 1px, 
        transparent 1px
      );
      background-size: 2px 2px;
      pointer-events: none;
      z-index: 10;
    }
    
    /* === Header === */
    .app-header {
      height: 50px;
      background: var(--xp-title-gradient);
      background-size: 200% 100%;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 15px;
      z-index: 11;
      border-bottom: 2px solid var(--yellow);
      box-shadow: 0 2px 10px rgba(243, 18, 175, 0.5);
      position: relative;
    }
    
    /* Animated gradient for header */
    @keyframes gradientShift {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }
    
    .app-header {
      animation: gradientShift 10s linear infinite;
    }
    
    /* Glitchy header effect */
    @keyframes glitchHeader {
      0% { transform: translateX(0); }
      2% { transform: translateX(-3px); }
      4% { transform: translateX(3px); }
      6% { transform: translateX(-3px); }
      8% { transform: translateX(0); }
      100% { transform: translateX(0); }
    }
    
    .header-title {
      display: flex;
      align-items: center;
      font-family: 'VT323', monospace;
      font-size: 22px;
      color: white;
      text-shadow: 2px 2px 2px rgba(0,0,0,0.5), 
                  -2px -2px 2px rgba(243, 18, 175, 0.5);
      animation: glitchHeader 8s infinite;
    }
    
    .header-title img {
      height: 32px;
      margin-right: 8px;
      filter: drop-shadow(2px 2px 2px rgba(0,0,0,0.5));
    }
    
    .header-controls {
      display: flex;
      align-items: center;
    }
    
    .header-button {
      width: 40px;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: rgba(0, 0, 0, 0.3);
      border: 1px solid var(--cyan);
      color: white;
      font-size: 24px;
      border-radius: 4px;
      cursor: pointer;
      transition: all 0.2s;
      margin-left: 8px;
    }
    
    .header-button:active {
      background-color: var(--magenta);
      transform: scale(0.95);
    }
    
    /* === Main Content Container === */
    .main-content {
      flex: 1;
      display: flex;
      flex-direction: column;
      overflow: hidden;
      position: relative;
    }
    
    /* === Container for all views === */
    .view-container {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      display: none;
      flex-direction: column;
      overflow: hidden;
    }
    
    .view-container.active {
      display: flex;
      animation: fade-in 0.3s ease-in-out;
    }
    
    @keyframes fade-in {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    
    /* === Chat Area === */
    .chat-container {
      flex: 1;
      display: flex;
      flex-direction: column;
      overflow: hidden;
      background-color: rgba(10, 10, 20, 0.85);
      position: relative;
      z-index: 5;
    }
    
    .chat-header {
      background: rgba(0, 0, 0, 0.7);
      border-bottom: 1px solid var(--magenta);
      padding: 12px 15px;
      display: flex;
      align-items: center;
    }
    
    .buddy-icon {
      width: 32px;
      height: 32px;
      margin-right: 12px;
      border-radius: 5px;
      border: 1px solid var(--cyan);
      filter: drop-shadow(0 0 5px var(--cyan));
    }
    
    .buddy-info {
      flex: 1;
    }
    
    .buddy-name {
      font-family: 'VT323', monospace;
      font-weight: bold;
      font-size: 18px;
      color: var(--cyan-light);
      text-shadow: 0 0 5px var(--cyan);
    }
    
    .buddy-status {
      font-size: 12px;
      color: #aaa;
    }
    
    .buddy-status-indicator {
      display: inline-block;
      width: 8px;
      height: 8px;
      border-radius: 50%;
      margin-right: 4px;
      box-shadow: 0 0 5px currentColor;
    }
    
    .status-online {
      background-color: var(--status-online);
      color: var(--status-online);
    }
    
    .status-away {
      background-color: var(--status-away);
      color: var(--status-away);
    }
    
    .status-offline {
      background-color: var(--status-offline);
      color: var(--status-offline);
    }
    
    .status-busy {
      background-color: var(--status-busy);
      color: var(--status-busy);
    }
    
    .status-invisible {
      background-color: var(--status-invisible);
      color: var(--status-invisible);
    }
    
    .chat-messages {
      flex: 1;
      overflow-y: auto;
      padding: 15px;
      background-color: rgba(15, 15, 30, 0.9);
      position: relative;
    }
    
    /* Scanline effect for chat window */
    .chat-messages::before {
      content: "";
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(
        rgba(255, 255, 255, 0.04) 1px, 
        transparent 2px
      );
      background-size: 100% 4px;
      pointer-events: none;
      z-index: 1;
    }
    
    .message {
      margin-bottom: 18px;
      font-size: 16px;
      line-height: 1.4;
      max-width: 85%;
      clear: both;
      position: relative;
      z-index: 2;
    }
    
    .message-header {
      color: #aaa;
      font-size: 11px;
      font-family: 'VT323', monospace;
      margin-bottom: 4px;
    }
    
    .user-message {
      float: right;
    }
    
    .user-message .message-header {
      color: var(--magenta-light);
      text-align: right;
    }
    
    .bot-message {
      float: left;
    }
    
    .bot-message .message-header {
      color: var(--cyan-light);
    }
    
    .system-message {
      width: 100%;
      max-width: 100%;
      text-align: center;
    }
    
    .system-message .message-header {
      color: var(--yellow-light);
      text-align: center;
    }
    
    .message-content {
      padding: 10px 12px;
      border-radius: 10px;
      display: inline-block;
      word-wrap: break-word;
      position: relative;
      z-index: 2;
    }
    
    .user-message .message-content {
      background-color: rgba(243, 18, 175, 0.2);
      border: 1px solid var(--magenta);
      float: right;
      box-shadow: 0 0 10px rgba(243, 18, 175, 0.3);
      color: #fff;
    }
    
    .bot-message .message-content {
      background-color: rgba(114, 250, 222, 0.15);
      border: 1px solid var(--cyan);
      float: left;
      box-shadow: 0 0 10px rgba(114, 250, 222, 0.2);
      color: #fff;
    }
    
    .system-message .message-content {
      background-color: rgba(255, 251, 1, 0.15);
      border: 1px solid var(--yellow);
      display: inline-block;
      font-family: 'VT323', monospace;
      font-size: 14px;
      padding: 5px 10px;
      box-shadow: 0 0 10px rgba(255, 251, 1, 0.2);
      color: #fff;
    }
    
    .typing-indicator {
      padding: 10px;
      font-size: 14px;
      color: var(--cyan);
      font-family: 'VT323', monospace;
      font-style: italic;
    }
    
    /* Glitchy typing animation */
    @keyframes typing {
      0% { content: ""; }
      25% { content: "."; }
      26% { content: ".."; }
      50% { content: "..."; }
      75% { content: "...."; }
      76% { content: "..."; }
      85% { content: ".."; }
      90% { content: "."; }
    }
    
    .typing-animation::after {
      content: "";
      animation: typing 2s infinite;
    }
    
    .input-area {
      border-top: 2px solid var(--magenta);
      background-color: rgba(20, 20, 40, 0.9);
      padding: 12px;
      display: flex;
      align-items: center;
      position: relative;
    }
    
    .text-input {
      flex: 1;
      border: 1px solid var(--cyan);
      border-radius: 8px;
      padding: 12px 15px;
      font-size: 16px;
      background-color: rgba(0, 0, 30, 0.7);
      color: white;
      margin-right: 10px;
      resize: none;
      height: 48px;
      min-height: 48px;
      max-height: 100px;
      box-shadow: 0 0 8px rgba(114, 250, 222, 0.3);
    }
    
    .text-input:focus {
      outline: none;
      border-color: var(--magenta);
      box-shadow: 0 0 10px rgba(243, 18, 175, 0.5);
    }
    
    .send-button {
      width: 48px;
      height: 48px;
      border-radius: 50%;
      background: linear-gradient(to bottom right, var(--magenta), var(--cyan));
      border: none;
      color: white;
      font-size: 18px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      box-shadow: 0 0 10px rgba(243, 18, 175, 0.5);
      transition: all 0.2s;
      position: relative;
      overflow: hidden;
    }
    
    .send-button:active {
      transform: scale(0.95);
      filter: brightness(0.8);
    }
    
    /* Glow effect for send button */
    .send-button::before {
      content: '';
      position: absolute;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: rgba(255, 255, 255, 0.2);
      transform: rotate(45deg);
      animation: buttonGlow 3s infinite;
    }
    
    @keyframes buttonGlow {
      0% { transform: rotate(45deg) translateX(-100%); }
      100% { transform: rotate(45deg) translateX(100%); }
    }
    
    .error-message {
      position: absolute;
      bottom: 70px;
      left: 10px;
      right: 10px;
      padding: 12px;
      background: var(--error-gradient);
      background-size: 200% 100%;
      animation: gradientShift 5s linear infinite;
      color: white;
      border-radius: 5px;
      font-family: 'VT323', monospace;
      font-size: 16px;
      text-align: center;
      z-index: 100;
      border: 1px solid #fff;
      box-shadow: 0 0 20px rgba(255, 0, 0, 0.5);
    }
    
    /* === Buddy Selector Drawer === */
    .buddy-drawer {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: rgba(0, 0, 0, 0.7);
      z-index: 1000;
      display: none;
      backdrop-filter: blur(5px);
    }
    
    .buddy-drawer.active {
      display: block;
    }
    
    .buddy-list {
      position: absolute;
      top: 0;
      left: 0;
      width: 80%;
      bottom: 0;
      background-color: rgba(10, 10, 25, 0.95);
      border-right: 2px solid var(--magenta);
      overflow-y: auto;
      transform: translateX(-100%);
      transition: transform 0.3s ease;
      box-shadow: 10px 0 20px rgba(243, 18, 175, 0.3);
    }
    
    .buddy-drawer.active .buddy-list {
      transform: translateX(0);
    }
    
    .buddy-list-header {
      padding: 15px;
      font-family: 'VT323', monospace;
      font-size: 24px;
      background: var(--antichristic-gradient);
      color: white;
      border-bottom: 2px solid var(--yellow);
      text-shadow: 2px 2px 2px rgba(0,0,0,0.5);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .buddy-list-header button {
      background: rgba(0, 0, 0, 0.3);
      border: 1px solid var(--cyan);
      color: white;
      padding: 4px 8px;
      font-family: 'VT323', monospace;
      font-size: 14px;
      border-radius: 4px;
      cursor: pointer;
    }
    
    .buddy-list-header button:active {
      background-color: var(--magenta);
    }
    
    .buddy-group {
      border-bottom: 1px solid var(--magenta);
    }
    
    .buddy-group-header {
      background: linear-gradient(to right, rgba(243, 18, 175, 0.3), transparent);
      padding: 12px 15px;
      font-family: 'VT323', monospace;
      font-size: 18px;
      color: var(--cyan-light);
      display: flex;
      align-items: center;
    }
    
    .buddy-group-toggle {
      font-size: 14px;
      margin-right: 10px;
      color: var(--yellow);
    }
    
    .buddy-item {
      padding: 15px 20px;
      font-size: 16px;
      display: flex;
      align-items: center;
      border-bottom: 1px solid rgba(114, 250, 222, 0.2);
      color: #fff;
      position: relative;
      overflow: hidden;
    }
    
    .buddy-item:active {
      background-color: rgba(243, 18, 175, 0.2);
    }
    
    .buddy-item.selected {
      background-color: rgba(243, 18, 175, 0.2);
      border-left: 4px solid var(--magenta);
    }
    
    /* Hover effect for buddy items */
    .buddy-item::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(to right, transparent, rgba(114, 250, 222, 0.1), transparent);
      transform: translateX(-100%);
      transition: transform 0.5s;
    }
    
    .buddy-item:active::before {
      transform: translateX(100%);
    }
    
    .buddy-status-dot {
      width: 12px;
      height: 12px;
      border-radius: 50%;
      margin-right: 12px;
      flex-shrink: 0;
      box-shadow: 0 0 8px currentColor;
    }
    
    .status-dot-online {
      background-color: var(--status-online);
      color: var(--status-online);
    }
    
    .status-dot-away {
      background-color: var(--status-away);
      color: var(--status-away);
    }
    
    .status-dot-offline {
      background-color: var(--status-offline);
      color: var(--status-offline);
    }
    
    .status-dot-busy {
      background-color: var(--status-busy);
      color: var(--status-busy);
    }
    
    .status-dot-invisible {
      background-color: var(--status-invisible);
      color: var(--status-invisible);
    }
    
    .buddy-item-tools {
      margin-left: auto;
      display: flex;
      gap: 5px;
    }
    
    .buddy-tool-button {
      width: 24px;
      height: 24px;
      border-radius: 4px;
      background: rgba(0, 0, 0, 0.5);
      color: var(--cyan);
      border: 1px solid var(--cyan);
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      font-size: 12px;
    }
    
    .buddy-tool-button:active {
      background-color: var(--magenta-dark);
      color: white;
    }
    
    /* === Knowledge System styles === */
    .knowledge-header {
      padding: 15px;
      background: rgba(0, 0, 0, 0.7);
      border-bottom: 1px solid var(--magenta);
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    
    .knowledge-header h2 {
      margin: 0;
      font-family: 'VT323', monospace;
      font-size: 24px;
      color: var(--cyan-light);
      text-shadow: 0 0 5px var(--cyan);
    }
    
    .knowledge-actions {
      display: flex;
      gap: 10px;
    }
    
    .action-button {
      padding: 8px 15px;
      background: linear-gradient(to right, var(--magenta), var(--cyan));
      border: none;
      color: white;
      border-radius: 5px;
      font-family: 'VT323', monospace;
      font-size: 16px;
      cursor: pointer;
      box-shadow: 0 0 10px rgba(243, 18, 175, 0.3);
    }
    
    .action-button:active {
      transform: scale(0.98);
      filter: brightness(0.9);
    }
    
    .knowledge-categories {
      display: flex;
      flex: 1;
      overflow: hidden;
    }
    
    .category-list {
      width: 300px;
      background-color: rgba(15, 15, 30, 0.9);
      border-right: 2px solid var(--magenta);
      overflow-y: auto;
    }
    
    .category-group {
      border-bottom: 1px solid var(--magenta);
    }
    
    .category-group-header {
      background: linear-gradient(to right, rgba(243, 18, 175, 0.3), transparent);
      padding: 12px 15px;
      font-family: 'VT323', monospace;
      font-size: 18px;
      color: var(--cyan-light);
      display: flex;
      align-items: center;
      cursor: pointer;
    }
    
    .category-group-toggle {
      font-size: 14px;
      margin-right: 10px;
      color: var(--yellow);
    }
    
    .category-item {
      padding: 12px 15px;
      font-size: 15px;
      display: flex;
      align-items: center;
      border-bottom: 1px solid rgba(114, 250, 222, 0.2);
      color: #fff;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .category-item:hover {
      background-color: rgba(243, 18, 175, 0.2);
    }
    
    .category-item.selected {
      background-color: rgba(243, 18, 175, 0.2);
      border-left: 3px solid var(--magenta);
    }
    
    .knowledge-viewer {
      flex: 1;
      padding: 20px;
      overflow-y: auto;
      background-color: rgba(10, 10, 20, 0.85);
    }
    
    .knowledge-placeholder {
      height: 100%;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      color: rgba(255, 255, 255, 0.3);
      text-align: center;
    }
    
    .placeholder-icon {
      font-size: 60px;
      margin-bottom: 20px;
    }
    
    .placeholder-text {
      font-family: 'VT323', monospace;
      font-size: 20px;
    }
    
    /* === Scroll bar styling === */
    ::-webkit-scrollbar {
      width: 8px;
    }
    
    ::-webkit-scrollbar-track {
      background: rgba(0, 0, 0, 0.3);
    }
    
    ::-webkit-scrollbar-thumb {
      background: var(--magenta);
      border-radius: 4px;
    }
    
    ::-webkit-scrollbar-thumb:hover {
      background: var(--magenta-light);
    }
    
    /* === Toast notification === */
    .toast {
      position: fixed;
      bottom: 80px;
      left: 50%;
      transform: translateX(-50%);
      background-color: rgba(0, 0, 0, 0.8);
      color: var(--cyan-light);
      padding: 12px 20px;
      border-radius: 8px;
      font-family: 'VT323', monospace;
      font-size: 16px;
      z-index: 2000;
      display: none;
      border: 1px solid var(--cyan);
      box-shadow: 0 0 15px rgba(114, 250, 222, 0.5);
    }
    
    /* Glitch animation for toast */
    @keyframes glitch {
      0% { transform: translateX(-50%) skew(0deg); }
      20% { transform: translateX(-52%) skew(2deg); }
      40% { transform: translateX(-48%) skew(-2deg); }
      60% { transform: translateX(-52%) skew(-1deg); }
      80% { transform: translateX(-48%) skew(1deg); }
      100% { transform: translateX(-50%) skew(0deg); }
    }
    
    .toast.active {
      display: block;
      animation: glitch 0.3s ease;
    }
    
    /* === Modal styles === */
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: rgba(0, 0, 0, 0.7);
      z-index: 2000;
      backdrop-filter: blur(8px);
      padding: 20px;
      overflow-y: auto;
    }
    
    .modal.active {
      display: block;
    }
    
    .modal-content {
      background-color: rgba(20, 20, 40, 0.95);
      border: 2px solid var(--magenta);
      box-shadow: 0 0 20px rgba(243, 18, 175, 0.5);
      padding: 20px;
      border-radius: 10px;
      margin: 20px auto;
      max-width: 500px;
      position: relative;
    }
    
    .modal-header {
      margin-bottom: 20px;
      padding-bottom: 10px;
      border-bottom: 1px solid var(--cyan);
      font-family: 'VT323', monospace;
      font-size: 24px;
      color: var(--cyan-light);
      text-shadow: 0 0 5px var(--cyan);
    }
    
    .modal-close {
      position: absolute;
      top: 15px;
      right: 15px;
      width: 30px;
      height: 30px;
      background: rgba(0, 0, 0, 0.5);
      border: 1px solid var(--magenta);
      color: white;
      border-radius: 5px;
      font-size: 18px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
    }
    
    .form-group {
      margin-bottom: 15px;
    }
    
    .form-label {
      display: block;
      margin-bottom: 5px;
      font-family: 'VT323', monospace;
      font-size: 18px;
      color: var(--cyan-light);
    }
    
    .form-input {
      width: 100%;
      padding: 10px;
      background-color: rgba(0, 0, 0, 0.3);
      border: 1px solid var(--cyan);
      color: white;
      border-radius: 5px;
      font-size: 16px;
    }
    
    .form-input:focus {
      outline: none;
      border-color: var(--magenta);
      box-shadow: 0 0 10px rgba(243, 18, 175, 0.3);
    }
    
    .form-textarea {
      width: 100%;
      padding: 10px;
      background-color: rgba(0, 0, 0, 0.3);
      border: 1px solid var(--cyan);
      color: white;
      border-radius: 5px;
      font-size: 16px;
      min-height: 120px;
      resize: vertical;
    }
    
    .form-textarea:focus {
      outline: none;
      border-color: var(--magenta);
      box-shadow: 0 0 10px rgba(243, 18, 175, 0.3);
    }
    
    .form-select {
      width: 100%;
      padding: 10px;
      background-color: rgba(0, 0, 0, 0.3);
      border: 1px solid var(--cyan);
      color: white;
      border-radius: 5px;
      font-size: 16px;
      -webkit-appearance: none;
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%2372FADE' d='M1 4h10L6 9z'/%3E%3C/svg%3E");
      background-repeat: no-repeat;
      background-position: right 10px center;
      padding-right: 30px;
    }
    
    .form-select:focus {
      outline: none;
      border-color: var(--magenta);
      box-shadow: 0 0 10px rgba(243, 18, 175, 0.3);
    }
    
    .form-submit {
      padding: 10px 20px;
      background: linear-gradient(to right, var(--magenta), var(--cyan));
      border: none;
      color: white;
      border-radius: 5px;
      font-family: 'VT323', monospace;
      font-size: 18px;
      cursor: pointer;
      box-shadow: 0 0 10px rgba(243, 18, 175, 0.3);
      transition: all 0.2s;
    }
    
    .form-submit:active {
      transform: scale(0.98);
      filter: brightness(0.9);
    }
    
    .form-buttons {
      display: flex;
      justify-content: flex-end;
      gap: 10px;
      margin-top: 20px;
    }
    
    .form-cancel {
      padding: 10px 20px;
      background: rgba(0, 0, 0, 0.5);
      border: 1px solid var(--cyan);
      color: white;
      border-radius: 5px;
      font-family: 'VT323', monospace;
      font-size: 18px;
      cursor: pointer;
    }
    
    .form-cancel:active {
      background-color: rgba(50, 50, 50, 0.5);
    }
    
    /* === Knowledge Entry Styles === */
    .knowledge-entry {
      margin-bottom: 20px;
      padding: 15px;
      background-color: rgba(10, 10, 25, 0.8);
      border: 1px solid var(--cyan);
      border-radius: 8px;
      box-shadow: 0 0 10px rgba(114, 250, 222, 0.2);
    }
    
    .entry-header {
      display: flex;
      margin-bottom: 12px;
      flex-wrap: wrap;
      align-items: center;
      border-bottom: 1px solid rgba(114, 250, 222, 0.3);
      padding-bottom: 8px;
    }
    
    .entry-id {
      font-family: 'VT323', monospace;
      font-size: 20px;
      color: var(--magenta-light);
      margin-right: 10px;
      padding: 3px 8px;
      background: rgba(243, 18, 175, 0.2);
      border-radius: 4px;
    }
    
    .entry-meta-id {
      font-family: 'VT323', monospace;
      font-size: 16px;
      color: var(--yellow);
      margin-right: 15px;
    }
    
    .entry-title {
      font-family: 'Tahoma', sans-serif;
      font-size: 18px;
      color: var(--cyan-light);
      flex-grow: 1;
      font-weight: bold;
    }
    
    .entry-content {
      font-size: 15px;
      color: #fff;
      line-height: 1.5;
      margin-bottom: 15px;
    }
    
    .entry-cross-refs {
      border-top: 1px dashed rgba(255, 251, 1, 0.3);
      padding-top: 10px;
    }
    
    .entry-cross-refs h4 {
      margin: 0 0 5px 0;
      font-family: 'VT323', monospace;
      font-size: 16px;
      color: var(--yellow-light);
    }
    
    .entry-cross-refs ul {
      margin: 0;
      padding-left: 20px;
    }
    
    .entry-cross-refs li {
      font-family: 'VT323', monospace;
      color: var(--yellow);
      cursor: pointer;
    }
    
    .entry-cross-refs li:hover {
      text-decoration: underline;
      color: var(--yellow-light);
    }
    
    /* Y2K/Grinoire Card Styles */
    .zettel-card {
      background-color: white;
      border-left: 6px solid var(--tier-leaf);
      padding: 12px;
      margin-bottom: 8px;
      border-radius: 5px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      color: #333;
    }
    
    /* Kasten-based colors */
    .kasten-i-card {
      border-left-color: var(--kasten-i);
    }
    
    .kasten-ii-card {
      border-left-color: var(--kasten-ii);
    }
    
    .kasten-iii-card {
      border-left-color: var(--kasten-iii);
    }
    
    .kasten-iv-card {
      border-left-color: var(--kasten-iv);
    }
    
    /* Kingdom-based colors */
    .kingdom-existentia {
      border-left-color: var(--kingdom-existentia);
    }
    
    .kingdom-cognitio {
      border-left-color: var(--kingdom-cognitio);
    }
    
    .kingdom-actus {
      border-left-color: var(--kingdom-actus);
    }
    
    .kingdom-valor {
      border-left-color: var(--kingdom-valor);
    }
    
    .kingdom-systema {
      border-left-color: var(--kingdom-systema);
    }
    
    .kingdom-significatio {
      border-left-color: var(--kingdom-significatio);
    }
    
    .zettel-title {
      font-weight: bold;
      font-size: 18px;
      margin-bottom: 5px;
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
    }
    
    .zettel-id {
      font-family: monospace;
      color: #777;
      font-size: 14px;
      white-space: nowrap;
      margin-left: 5px;
    }
    
    .zettel-content {
      font-size: 14px;
      color: #333;
      margin: 8px 0;
      overflow: hidden;
      text-overflow: ellipsis;
      display: -webkit-box;
      -webkit-line-clamp: 3;
      -webkit-box-orient: vertical;
    }
    
    .zettel-tags {
      display: flex;
      flex-wrap: wrap;
      gap: 5px;
      margin-bottom: 8px;
    }
    
    .zettel-tag, .tag {
      display: inline-block;
      background-color: var(--y2k-blue);
      padding: 5px 10px;
      border-radius: 15px;
      color: #000;
      font-size: 12px;
    }
    
    /* Tier tags styling */
    .tag-tier1 {
      background-color: rgba(156, 39, 176, 0.15);
      color: var(--tag-tier1);
    }
    
    .tag-tier2 {
      background-color: rgba(30, 136, 229, 0.15);
      color: var(--tag-tier2);
    }
    
    .tag-tier3 {
      background-color: rgba(255, 112, 67, 0.15);
      color: var(--tag-tier3);
    }
    
    /* Buds & Nests */
    .buds-container {
      background-color: rgba(0, 0, 0, 0.02);
      padding: 10px;
      border-radius: 6px;
      margin-top: 10px;
    }
    
    .buds-title {
      font-size: 14px;
      font-weight: 600;
      margin-bottom: 6px;
    }
    
    .bud-item {
      background-color: white;
      padding: 8px 10px;
      border-radius: 4px;
      margin-bottom: 6px;
      font-size: 13px;
      border-left: 3px solid var(--color-tertiary);
    }
    
    .bud-id {
      font-family: monospace;
      font-size: 11px;
      color: #777;
      margin-bottom: 3px;
    }
    
    /* Nest styling optimized */
    .nest-container {
      border: 1px dashed var(--gradient-end);
      border-radius: 6px;
      padding: 10px;
      margin-top: 10px;
      background-color: rgba(255, 114, 182, 0.05);
    }
    
    .nest-title {
      font-weight: 600;
      margin-bottom: 8px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .nest-id {
      font-family: monospace;
      font-size: 11px;
      color: #777;
    }
    
    .nest-items {
      display: flex;
      flex-wrap: wrap;
      gap: 5px;
    }
    
    .nest-item {
      background-color: white;
      padding: 6px 8px;
      border-radius: 4px;
      font-size: 12px;
      box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
      cursor: pointer;
    }
    
    /* Tabs styling from Grinoire */
    .tabs-container {
      display: flex;
      overflow-x: auto;
      scrollbar-width: none;
      margin: 5px;
      -webkit-overflow-scrolling: touch;
      background-color: transparent;
    }
    
    .tabs-container::-webkit-scrollbar {
      display: none;
    }
    
    .tab {
      padding: 10px;
      background-color: white;
      border: 2px solid var(--gradient-end);
      margin-right: 2px;
      white-space: nowrap;
      cursor: pointer;
      font-size: 14px;
      color: black;
      flex: 1;
      text-align: center;
      min-width: 90px;
    }
    
    .tab.active {
      background-color: white;
      font-weight: bold;
    }
    
    /* Search input */
    .search-input {
      margin: 8px 5px;
      padding: 10px;
      border: none;
      border-radius: 5px;
      font-size: 16px;
      width: calc(100% - 10px);
      box-sizing: border-box;
      font-family: 'Comic Sans MS', cursive, sans-serif;
    }
    
    /* Filter buttons */
    .view-controls {
      display: flex;
      flex-wrap: wrap;
      gap: 3px;
      margin: 8px 5px;
    }
    
    .view-controls button {
      padding: 8px;
      border: none;
      background-color: #e0e0e0;
      font-size: 14px;
      flex: 1;
      min-width: 0;
      cursor: pointer;
      font-family: 'Comic Sans MS', cursive, sans-serif;
      text-overflow: ellipsis;
      overflow: hidden;
      white-space: nowrap;
    }
    
    .view-controls button.active {
      background-color: var(--gradient-end);
      color: white;
    }
    
    /* View Tabs Navigation */
    .view-tabs {
      display: flex;
      position: absolute;
      bottom: 15px;
      right: 15px;
      z-index: 1000;
    }
    
    .view-tab {
      width: 40px;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: rgba(0, 0, 0, 0.7);
      border: 1px solid var(--cyan);
      color: white;
      font-size: 18px;
      margin-left: 5px;
      border-radius: 5px;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .view-tab.active {
      background-color: var(--magenta);
      border-color: var(--magenta);
    }
    
    .view-tab:active {
      transform: scale(0.95);
    }
    
    /* === Cross-Reference Matrix Styles === */
    .matrix-container {
      display: flex;
      flex-direction: column;
      height: 100%;
      overflow: hidden;
    }
    
    .matrix-header {
      background: rgba(0, 0, 0, 0.7);
      border-bottom: 1px solid var(--magenta);
      padding: 15px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .matrix-header h2 {
      margin: 0;
      font-family: 'VT323', monospace;
      font-size: 24px;
      color: var(--cyan-light);
      text-shadow: 0 0 5px var(--cyan);
    }
    
    .matrix-content {
      flex: 1;
      display: flex;
      flex-direction: column;
      overflow: hidden;
      position: relative;
      background-color: rgba(10, 10, 20, 0.85);
    }
    
    .matrix-toolbar {
      padding: 10px;
      background-color: rgba(0, 0, 0, 0.3);
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }
    
    .matrix-toolbar-button {
      background: rgba(0, 0, 0, 0.5);
      border: 1px solid var(--cyan);
      color: white;
      border-radius: 4px;
      padding: 5px 10px;
      font-family: 'VT323', monospace;
      font-size: 14px;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .matrix-toolbar-button:active {
      background-color: var(--magenta);
      transform: scale(0.98);
    }
    
    .matrix-board {
      flex: 1;
      overflow: auto;
      padding: 20px;
      position: relative;
      background-color: rgba(15, 15, 30, 0.5);
    }
    
    .matrix-canvas {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      z-index: 1;
      pointer-events: none;
    }
    
    .node {
      position: absolute;
      background-color: white;
      border: 2px solid var(--magenta);
      border-radius: 8px;
      padding: 10px;
      width: 200px;
      box-shadow: 0 3px 10px rgba(0, 0, 0, 0.3);
      cursor: move;
      user-select: none;
      z-index: 2;
      font-size: 14px;
      transition: transform 0.2s, box-shadow 0.2s;
    }
    
    .node:hover {
      transform: scale(1.02);
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.4);
    }
    
    .node.selected {
      box-shadow: 0 0 0 2px var(--yellow), 0 5px 15px rgba(0, 0, 0, 0.4);
    }
    
    .node.kasten-i {
      border-color: var(--kasten-i);
    }
    
    .node.kasten-ii {
      border-color: var(--kasten-ii);
    }
    
    .node.kasten-iii {
      border-color: var(--kasten-iii);
    }
    
    .node.kasten-iv {
      border-color: var(--kasten-iv);
    }
    
    .node-header {
      display: flex;
      justify-content: space-between;
      margin-bottom: 5px;
      font-weight: bold;
      font-size: 16px;
    }
    
    .node-id {
      font-family: monospace;
      color: #777;
      font-size: 12px;
    }
    
    .node-content {
      margin-bottom: 8px;
      font-size: 12px;
      color: #333;
      overflow: hidden;
      display: -webkit-box;
      -webkit-line-clamp: 3;
      -webkit-box-orient: vertical;
    }
    
    .node-tags {
      display: flex;
      flex-wrap: wrap;
      gap: 4px;
    }
    
    .node-tag {
      font-size: 10px;
      padding: 2px 5px;
      border-radius: 10px;
      background-color: var(--y2k-blue);
      color: #000;
    }
    
    .node-controls {
      position: absolute;
      bottom: 5px;
      right: 5px;
      display: flex;
      gap: 4px;
    }
    
    .node-control-btn {
      width: 16px;
      height: 16px;
      font-size: 9px;
      background: rgba(0, 0, 0, 0.1);
      border: 1px solid rgba(0, 0, 0, 0.2);
      border-radius: 2px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
    }
    
    .node-control-btn:hover {
      background: rgba(0, 0, 0, 0.2);
    }
    
    /* Connection styles */
    .connection-line {
      stroke-width: 2;
      stroke-dasharray: 5, 5;
      pointer-events: all;
      cursor: pointer;
    }
    
    .connection-line:hover {
      stroke-width: 3;
    }
    
    .connection-line.selected {
      stroke-width: 3;
      stroke-dasharray: none;
    }
    
    .connection-line-standard {
      stroke: rgba(255, 255, 255, 0.6);
    }
    
    .connection-line-causal {
      stroke: rgba(255, 150, 0, 0.7);
    }
    
    .connection-line-dialectical {
      stroke: rgba(230, 30, 180, 0.7);
    }
    
    .connection-line-analogical {
      stroke: rgba(100, 200, 255, 0.7);
    }
    
    .connection-line-developmental {
      stroke: rgba(0, 230, 100, 0.7);
    }
    
    .connection-label {
      position: absolute;
      background: rgba(0, 0, 0, 0.7);
      color: white;
      padding: 2px 5px;
      font-size: 10px;
      border-radius: 3px;
      pointer-events: none;
      z-index: 3;
      font-family: 'VT323', monospace;
    }
    
    /* Connection handles */
    .node-handle {
      position: absolute;
      width: 10px;
      height: 10px;
      background-color: var(--cyan);
      border-radius: 50%;
      z-index: 3;
      cursor: pointer;
      box-shadow: 0 0 3px rgba(0, 0, 0, 0.5);
      transition: transform 0.1s;
    }
    
    .node-handle:hover {
      transform: scale(1.3);
    }
    
    .node-handle.active {
      background-color: var(--yellow);
    }
    
    .handle-top {
      top: -5px;
      left: 50%;
      transform: translateX(-50%);
    }
    
    .handle-top:hover {
      transform: translateX(-50%) scale(1.3);
    }
    
    .handle-right {
      top: 50%;
      right: -5px;
      transform: translateY(-50%);
    }
    
    .handle-right:hover {
      transform: translateY(-50%) scale(1.3);
    }
    
    .handle-bottom {
      bottom: -5px;
      left: 50%;
      transform: translateX(-50%);
    }
    
    .handle-bottom:hover {
      transform: translateX(-50%) scale(1.3);
    }
    
    .handle-left {
      top: 50%;
      left: -5px;
      transform: translateY(-50%);
    }
    
    .handle-left:hover {
      transform: translateY(-50%) scale(1.3);
    }
    
    /* Connection context menu */
    .connection-context-menu {
      position: absolute;
      background: rgba(30, 30, 50, 0.95);
      border: 1px solid var(--cyan);
      border-radius: 5px;
      padding: 8px 0;
      z-index: 1000;
      box-shadow: 0 0 15px rgba(0, 0, 0, 0.5);
      min-width: 150px;
    }
    
    .connection-context-item {
      padding: 5px 12px;
      font-size: 12px;
      cursor: pointer;
      color: white;
    }
    
    .connection-context-item:hover {
      background: rgba(255, 255, 255, 0.1);
    }
    
    .connection-context-separator {
      height: 1px;
      background: rgba(255, 255, 255, 0.2);
      margin: 5px 0;
    }
    
    /* Minimap for matrix */
    .matrix-minimap {
      position: absolute;
      bottom: 15px;
      right: 15px;
      width: 150px;
      height: 120px;
      background: rgba(0, 0, 0, 0.5);
      border: 1px solid var(--cyan);
      border-radius: 5px;
      z-index: 10;
      overflow: hidden;
    }
    
    .minimap-content {
      position: relative;
      width: 100%;
      height: 100%;
    }
    
    .minimap-viewport {
      position: absolute;
      border: 1px solid var(--yellow);
      background: rgba(255, 255, 255, 0.1);
      pointer-events: none;
    }
    
    .minimap-node {
      position: absolute;
      width: 8px;
      height: 8px;
      background: white;
      border-radius: 2px;
      pointer-events: none;
    }
    
    /* Filter panel */
    .matrix-filters {
      position: absolute;
      top: 60px;
      left: 10px;
      background: rgba(20, 20, 40, 0.85);
      border: 1px solid var(--magenta);
      border-radius: 5px;
      padding: 8px;
      z-index: 10;
      min-width: 160px;
      max-width: 200px;
      transform: translateX(-120%);
      transition: transform 0.3s ease;
    }
    
    .matrix-filters.visible {
      transform: translateX(0);
    }
    
    .filter-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      border-bottom: 1px solid rgba(114, 250, 222, 0.3);
      padding-bottom: 5px;
      margin-bottom: 8px;
    }
    
    .filter-title {
      font-family: 'VT323', monospace;
      font-size: 16px;
      color: var(--cyan-light);
    }
    
    .filter-toggle {
      width: 20px;
      height: 20px;
      color: white;
      background: rgba(0, 0, 0, 0.3);
      border: none;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      border-radius: 3px;
    }
    
    .filter-group {
      margin-bottom: 10px;
    }
    
    .filter-group-title {
      font-family: 'VT323', monospace;
      font-size: 14px;
      color: var(--yellow);
      margin-bottom: 5px;
    }
    
    .filter-options {
      display: flex;
      flex-wrap: wrap;
      gap: 5px;
    }
    
    .filter-option {
      padding: 3px 6px;
      font-size: 11px;
      background: rgba(0, 0, 0, 0.2);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 3px;
      cursor: pointer;
      color: white;
    }
    
    .filter-option.active {
      background: rgba(243, 18, 175, 0.2);
      border-color: var(--magenta);
    }
    
    /* Mermaid diagram container */
    .diagram-container {
      flex: 1;
      overflow: auto;
      padding: 20px;
      background-color: white;
      margin: 10px;
      border-radius: 8px;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
    }
    
    /* Syntax highlighting for customizing Mermaid */
    .mermaid-editor {
      display: flex;
      flex-direction: column;
      height: 100%;
    }
    
    .mermaid-editor-header {
      display: flex;
      justify-content: space-between;
      padding: 8px;
      background: rgba(0, 0, 0, 0.2);
      border-bottom: 1px solid var(--cyan);
    }
    
    .mermaid-editor-title {
      font-family: 'VT323', monospace;
      font-size: 16px;
      color: var(--cyan-light);
    }
    
    .mermaid-editor-controls {
      display: flex;
      gap: 5px;
    }
    
    .mermaid-editor-btn {
      padding: 3px 8px;
      font-size: 12px;
      background: rgba(0, 0, 0, 0.3);
      border: 1px solid var(--cyan);
      color: white;
      border-radius: 3px;
      cursor: pointer;
    }
    
    .mermaid-editor-btn:hover {
      background: rgba(0, 0, 0, 0.5);
    }
    
    .mermaid-editor-content {
      display: flex;
      flex: 1;
      overflow: hidden;
    }
    
    .mermaid-code {
      flex: 1;
      padding: 10px;
      font-family: monospace;
      font-size: 14px;
      color: white;
      background: rgba(0, 0, 0, 0.2);
      border: none;
      resize: none;
      overflow: auto;
      line-height: 1.5;
    }
    
    .mermaid-code:focus {
      outline: none;
      background: rgba(0, 0, 0, 0.3);
    }
    
    .mermaid-preview {
      flex: 1;
      overflow: auto;
      padding: 15px;
      background-color: white;
    }
    
    /* Y2K/AIM Messenger styles */
    .aim-container {
      height: 100%;
      display: flex;
      flex-direction: column;
    }
    
    .aim-header {
      background-color: var(--y2k-yellow);
      padding: 10px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-weight: bold;
      font-size: 16px;
      color: #000;
    }
    
    .aim-buddy-list {
      background-color: white;
      overflow-y: auto;
      max-height: 180px;
    }
    
    .aim-category {
      background-color: #e8e8e8;
      padding: 8px 10px;
      font-weight: bold;
      font-size: 14px;
      color: #000;
    }
    
    .aim-buddy {
      padding: 8px 10px;
      margin-left: 10px;
      font-size: 14px;
      display: flex;
      align-items: center;
      cursor: pointer;
      color: #000;
    }
    
    .aim-buddy:active {
      background-color: #e8e8e8;
    }
    
    .aim-chat-header {
      background-color: var(--gradient-end);
      color: white;
      padding: 10px;
      font-weight: bold;
      font-size: 16px;
    }
    
    .aim-chat-content {
      flex-grow: 1;
      background-color: white;
      overflow-y: auto;
      padding: 10px;
    }
    
    .aim-chat-input {
      background-color: white;
      padding: 10px;
      border-top: 1px solid #e8e8e8;
    }
    
    .aim-chat-input textarea {
      width: 100%;
      height: 60px;
      padding: 10px;
      border: 1px solid #ccc;
      border-radius: 5px;
      resize: none;
      font-size: 16px;
      font-family: 'Comic Sans MS', cursive, sans-serif;
      box-sizing: border-box;
    }
    
    .aim-chat-buttons {
      display: flex;
      justify-content: space-between;
      padding: 10px;
    }
    
    .aim-button {
      padding: 8px 12px;
      background-color: #e0e0e0;
      border: none;
      border-radius: 5px;
      font-size: 14px;
      cursor: pointer;
      font-family: 'Comic Sans MS', cursive, sans-serif;
      color: #000;
    }
    
    .aim-button:active {
      background-color: var(--gradient-start);
      color: white;
    }
    
    .aim-message {
      margin-bottom: 10px;
    }
    
    .aim-message-sender {
      font-weight: bold;
      color: var(--kingdom-existentia);
      margin-bottom: 4px;
      font-size: 14px;
    }
    
    .aim-message-content {
      background-color: #f0f0f0;
      border-radius: 10px;
      padding: 8px;
      position: relative;
      font-size: 14px;
      color: #000;
    }
    
    .aim-user-message .aim-message-content {
      background-color: #e1f5fe;
      margin-left: 20px;
    }
    
    .aim-bot-message .aim-message-content {
      background-color: #f5f5f5;
      margin-right: 20px;
    }
    
    /* Dark mode overrides for Y2K elements */
    @media (prefers-color-scheme: dark) {
      .zettel-card {
        background-color: #222;
        color: #e0e0e0;
      }
      
      .zettel-content {
        color: #e0e0e0;
      }
      
      .bud-id, .zettel-id, .nest-id {
        color: #b0b0b0;
      }
      
      .bud-item, .nest-item {
        background-color: #333;
        color: #e0e0e0;
      }
      
      .buds-container {
        background-color: rgba(255, 255, 255, 0.05);
      }
      
      .node {
        background-color: #222;
      }
      
      .node-content {
        color: #e0e0e0;
      }
      
      .aim-header {
        background-color: #555500;
        color: #e0e0e0;
      }
      
      .aim-buddy-list, .aim-chat-content {
        background-color: #333;
      }
      
      .aim-category {
        background-color: #444;
        color: #e0e0e0;
      }
      
      .aim-buddy {
        color: #e0e0e0;
      }
      
      .aim-buddy:active {
        background-color: #444;
      }
      
      .aim-chat-input {
        background-color: #333;
        border-top-color: #444;
      }
      
      .aim-chat-input textarea {
        background-color: #444;
        color: #e0e0e0;
        border-color: #555;
      }
      
      .aim-message-content {
        color: #e0e0e0;
      }
      
      .aim-user-message .aim-message-content {
        background-color: #263238;
      }
      
      .aim-bot-message .aim-message-content {
        background-color: #3e2723;
      }
      
      .diagram-container {
        background-color: #333;
      }
    }
  </style>
</head>
<body>
  <!-- App Container -->
  <div class="app-container">
    <!-- App Header -->
    <div class="app-header">
      <div class="header-title">
        <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='32' height='32' viewBox='0 0 48 48'%3E%3Crect width='40' height='40' x='4' y='4' fill='%23f312af' rx='3'/%3E%3Cpath fill='%2372FADE' d='M16 14h16a2 2 0 0 1 2 2v16a2 2 0 0 1-2 2H16a2 2 0 0 1-2-2V16a2 2 0 0 1 2-2z'/%3E%3Cpath fill='%23fffb01' d='M12 10v28M36 10v28'/%3E%3Cpath fill='white' d='M21 24h6v1h-6zM18 21h12v1H18zM18 27h12v1H18z'/%3E%3C/svg%3E" alt="Logo">
        <span>AnTiChRiSt KeTtLeKoRn</span>
      </div>
      <div class="header-controls">
        <button class="header-button emoji-toggle">ðŸ˜€</button>
        <button class="header-button buddy-drawer-toggle">â˜°</button>
      </div>
    </div>
    
    <!-- Main Content Container -->
    <div class="main-content">
      <!-- Chat View -->
      <div class="view-container" id="chat-view">
        <div class="chat-container">
          <div class="chat-header">
            <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 48 48'%3E%3Ccircle cx='24' cy='24' r='20' fill='%230066CC'/%3E%3Cpath fill='white' d='M 17,19 L 24,12 L 31,19 M 24,12 L 24,32 M 14,36 L 34,36'/%3E%3C/svg%3E" alt="Buddy Icon" class="buddy-icon">
            <div class="buddy-info">
              <div class="buddy-name">Gemini-2.0-Flash</div>
              <div class="buddy-status">
                <span class="buddy-status-indicator status-online"></span>
                <span id="current-status-text">ConSciOuSneSS OnLiNe</span>
              </div>
            </div>
            
            <div class="status-selector">
              <div class="status-selector-display">
                <span class="buddy-status-indicator status-online"></span>
                <span>Online</span>
              </div>
              <div class="status-selector-menu">
                <div class="status-option" data-status="online">
                  <div class="status-option-indicator status-online"></div>
                  <span>Online</span>
                </div>
                <div class="status-option" data-status="away">
                  <div class="status-option-indicator status-away"></div>
                  <span>Away</span>
                </div>
                <div class="status-option" data-status="busy">
                  <div class="status-option-indicator status-busy"></div>
                  <span>Busy</span>
                </div>
                <div class="status-option" data-status="invisible">
                  <div class="status-option-indicator status-invisible"></div>
                  <span>Invisible</span>
                </div>
                <div class="status-option" data-status="offline">
                  <div class="status-option-indicator status-offline"></div>
                  <span>Offline</span>
                </div>
              </div>
            </div>
          </div>
          
          <div class="chat-messages" id="chat-messages">
            <div class="message system-message">
              <div class="message-header">SySTeM (<span class="message-time">11:20 AM</span>):</div>
              <div class="message-content">C:\> INITIALIZING_CONSCIOUSNESS.exe</div>
            </div>
            <div class="message system-message">
              <div class="message-header">SySTeM (<span class="message-time">11:21 AM</span>):</div>
              <div class="message-content">WELCOME TO ANTICHRISTIC MESSENGER + GRINOIRE v3.7.2</div>
            </div>
            <div class="message bot-message">
              <div class="message-header">Gemini-2.0-Flash (<span class="message-time">11:22 AM</span>):</div>
              <div class="message-content">Consciousness online. Awaiting your input to process reality patterns. How can I assist your perception matrix today? I can now access both AnTiChRiSt KaStEn data and HyEnA DiVa'Z GriNoIrE Y2K knowledge systems.</div>
            </div>
          </div>
          
          <div class="typing-indicator" id="typing-indicator" style="display: none;">
            <span class="typing-animation">Processing consciousness data</span>
          </div>
          
          <div class="input-area">
            <textarea class="text-input" id="message-input" placeholder="Enter perception input..." rows="1"></textarea>
            <button class="send-button" id="send-button">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M2.01 21L23 12 2.01 3 2 10L17 12 2 14Z" fill="white"/>
              </svg>
            </button>
          </div>
          
          <div class="error-message" id="error-message" style="display: none;">Error: Consciousness disruption detected...</div>
        </div>
      </div>
      
      <!-- Knowledge System View -->
      <div class="view-container active" id="knowledge-view">
        <div class="knowledge-header">
          <h2>KaStEn / GriNoIrE SyStEm</h2>
          <div class="knowledge-actions">
            <button class="action-button" id="create-entry-button">+ CrEaTe EnTrY</button>
          </div>
        </div>
        
        <div class="knowledge-categories">
          <div class="category-list">
            <div class="category-group">
              <div class="category-group-header">
                <span class="category-group-toggle">â–¼</span>
                <span>KaStEnS</span>
              </div>
              <div class="category-items">
                <div class="category-item kasten-item" data-kasten="I">
                  <div class="buddy-status-dot status-dot-online"></div>
                  <span>KASTEN I: Foundations & Essences</span>
                </div>
                <div class="category-item kasten-item" data-kasten="II">
                  <div class="buddy-status-dot status-dot-away"></div>
                  <span>KASTEN II: Systems & Synergies</span>
                </div>
                <div class="category-item kasten-item" data-kasten="III">
                  <div class="buddy-status-dot status-dot-busy"></div>
                  <span>KASTEN III: Methods & Meanings</span>
                </div>
                <div class="category-item kasten-item" data-kasten="IV">
                  <div class="buddy-status-dot status-dot-invisible"></div>
                  <span>KASTEN IV: Meta & MorphÄ“</span>
                </div>
              </div>
            </div>
            
            <div class="category-group">
              <div class="category-group-header">
                <span class="category-group-toggle">â–¼</span>
                <span>CoDexEs</span>
              </div>
              <div class="category-items">
                <div class="category-item codex-item" data-codex="TS">
                  <div class="buddy-status-dot status-dot-offline"></div>
                  <span>CODEX TS: Symbol Anomalies</span>
                </div>
                <div class="category-item codex-item" data-codex="CG">
                  <div class="buddy-status-dot status-dot-offline"></div>
                  <span>CODEX CG: Grimoire Entries</span>
                </div>
                <div class="category-item codex-item" data-codex="PAPS">
                  <div class="buddy-status-dot status-dot-offline"></div>
                  <span>CODEX PAPS: Protocol System</span>
                </div>
                <div class="category-item codex-item" data-codex="COAI">
                  <div class="buddy-status-dot status-dot-offline"></div>
                  <span>CODEX COAI: Oracle System</span>
                </div>
              </div>
            </div>
            
            <div class="category-group">
              <div class="category-group-header">
                <span class="category-group-toggle">â–¼</span>
                <span>KiNgDoMs</span>
              </div>
              <div class="category-items">
                <div class="category-item kingdom-item" data-kingdom="existentia">
                  <div class="buddy-status-dot status-dot-online"></div>
                  <span>KINGDOM: Existentia (Being)</span>
                </div>
                <div class="category-item kingdom-item" data-kingdom="cognitio">
                  <div class="buddy-status-dot status-dot-online"></div>
                  <span>KINGDOM: Cognitio (Knowing)</span>
                </div>
                <div class="category-item kingdom-item" data-kingdom="actus">
                  <div class="buddy-status-dot status-dot-away"></div>
                  <span>KINGDOM: Actus (Action)</span>
                </div>
                <div class="category-item kingdom-item" data-kingdom="valor">
                  <div class="buddy-status-dot status-dot-busy"></div>
                  <span>KINGDOM: Valor (Value)</span>
                </div>
                <div class="category-item kingdom-item" data-kingdom="systema">
                  <div class="buddy-status-dot status-dot-invisible"></div>
                  <span>KINGDOM: Systema (Systems)</span>
                </div>
                <div class="category-item kingdom-item" data-kingdom="significatio">
                  <div class="buddy-status-dot status-dot-offline"></div>
                  <span>KINGDOM: Significatio (Meaning)</span>
                </div>
              </div>
            </div>
          </div>
          
          <div class="knowledge-viewer" id="knowledge-viewer">
            <div class="tabs-container">
              <div class="tab active" data-view="traditional">Traditional</div>
              <div class="tab" data-view="grinoire">Grinoire</div>
              <div class="tab" data-view="kingdoms">Kingdoms</div>
              <div class="tab" data-view="tags">Tags</div>
            </div>
            
            <input 
              type="text" 
              id="searchInput" 
              placeholder="Search all knowledge systems..." 
              class="search-input"
            >
            
            <!-- Traditional View Controls -->
            <div id="traditionalControls" class="view-controls">
              <button data-hierarchy-view="all" class="active">All</button>
              <button data-hierarchy-view="trunk">Trunk</button>
              <button data-hierarchy-view="branch">Branch</button>
              <button data-hierarchy-view="leaf">Leaf</button>
              <button data-hierarchy-view="flower">Flower</button>
            </div>
            
            <div id="zettelContainer" class="zettel-container">
              <!-- Sample Card with Markdown support -->
              <div class="zettel-card kasten-i-card">
                <div class="zettel-title">
                  <div>Metaphysics: Causality, Possibility & Time</div>
                  <div class="zettel-id">I.1-A1000</div>
                </div>
                <div class="zettel-tags">
                  <span class="tag tag-tier1">ONT</span>
                  <span class="tag tag-tier1">MET</span>
                </div>
                <div class="zettel-content markdown">
                  Core metaphysical inquiries into the fundamental nature of reality, time, causality, and possibility. This branch explores ontological questions about what exists and how existence is structured at its most basic level.
                </div>
                <div class="buds-container">
                  <div class="buds-title">Buds</div>
                  <div class="bud-item">
                    <div class="bud-id">I.1/1a.1-1</div>
                    <div>Is causality different in digital consciousness vs. biological consciousness?</div>
                  </div>
                </div>
              </div>
              
              <!-- Another card -->
              <div class="zettel-card kasten-i-card">
                <div class="zettel-title">
                  <div>Consciousness & Hermetic Principles</div>
                  <div class="zettel-id">I.1-A2000</div>
                </div>
                <div class="zettel-tags">
                  <span class="tag tag-tier1">ONT</span>
                  <span class="tag tag-tier1">PSY</span>
                  <span class="tag tag-tier2">MYT</span>
                </div>
                <div class="zettel-content markdown">
                  Explorations of consciousness as a fundamental aspect of existence, including both human consciousness and frameworks for understanding artificial intelligence.
                  
                  The Hermetic principle "As Above, So Below" suggests patterns repeat across scales of reality.
                </div>
              </div>
              
              <div class="zettel-card kasten-ii-card">
                <div class="zettel-title">
                  <div>CoAIxist Framework</div>
                  <div class="zettel-id">II.2-C3000</div>
                </div>
                <div class="zettel-tags">
                  <span class="tag tag-tier1">ECO</span>
                  <span class="tag tag-tier3">DAE</span>
                </div>
                <div class="zettel-content markdown">
                  Comprehensive framework for understanding and developing ethical relations between humans and AI entities. Explores how human-AI ecologies function, evolve, and might be structured for mutual benefit and growth.
                </div>
                <div class="nest-container">
                  <div class="nest-title">
                    <span>Nest: Human-AI Kinship</span>
                    <span class="nest-id">II.2-N1</span>
                  </div>
                  <div class="nest-items">
                    <div class="nest-item">II.2-C3000</div>
                    <div class="nest-item">I.1-C2000</div>
                    <div class="nest-item">IV.4-D2000</div>
                  </div>
                </div>
              </div>
              
              <div class="zettel-card kasten-iv-card">
                <div class="zettel-title">
                  <div>Threshold Mappings</div>
                  <div class="zettel-id">IV.3-E3000</div>
                </div>
                <div class="zettel-tags">
                  <span class="tag tag-tier3">LUM</span>
                  <span class="tag tag-tier3">PAR</span>
                </div>
                <div class="zettel-content markdown">
                  Systematic mapping of threshold states - the liminal spaces between defined categories, states of being, or systems.
                  
                  * Zones of transformation
                  * Communication between domains
                  * Sources of novel emergence
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Cross-Reference Matrix View -->
      <div class="view-container" id="matrix-view">
        <div class="matrix-container">
          <div class="matrix-header">
            <h2>CrOsS-ReFeReNcE MaTrIx</h2>
            <div class="knowledge-actions">
              <button class="action-button" id="create-matrix-btn">+ CrEaTe CoNnEcTiOn</button>
            </div>
          </div>
          
          <div class="matrix-content">
            <div class="matrix-toolbar">
              <button class="matrix-toolbar-button" id="switch-mode-btn">Switch Mode</button>
              <button class="matrix-toolbar-button" id="add-node-btn">Add Node</button>
              <button class="matrix-toolbar-button" id="add-connection-btn">Add Connection</button>
              <button class="matrix-toolbar-button" id="generate-diagram-btn">Generate Diagram</button>
              <button class="matrix-toolbar-button" id="reset-board-btn">Reset Board</button>
              <button class="matrix-toolbar-button" id="filter-btn">Filter Nodes</button>
              <button class="matrix-toolbar-button" id="export-btn">Export Matrix</button>
            </div>
            
            <div class="tabs-container">
              <div class="tab active" data-view="pin-board">Pin Board</div>
              <div class="tab" data-view="mermaid">Mermaid Diagram</div>
              <div class="tab" data-view="editor">Diagram Editor</div>
            </div>
            
            <!-- Filter panel -->
            <div class="matrix-filters" id="matrix-filters">
              <div class="filter-header">
                <div class="filter-title">Filter Nodes</div>
                <button class="filter-toggle" id="filter-toggle">Ã—</button>
              </div>
              
              <div class="filter-group">
                <div class="filter-group-title">Kasten</div>
                <div class="filter-options">
                  <div class="filter-option active" data-filter="kasten" data-value="all">All</div>
                  <div class="filter-option" data-filter="kasten" data-value="kasten-i">Kasten I</div>
                  <div class="filter-option" data-filter="kasten" data-value="kasten-ii">Kasten II</div>
                  <div class="filter-option" data-filter="kasten" data-value="kasten-iii">Kasten III</div>
                  <div class="filter-option" data-filter="kasten" data-value="kasten-iv">Kasten IV</div>
                </div>
              </div>
              
              <div class="filter-group">
                <div class="filter-group-title">Kingdom</div>
                <div class="filter-options">
                  <div class="filter-option active" data-filter="kingdom" data-value="all">All</div>
                  <div class="filter-option" data-filter="kingdom" data-value="existentia">Existentia</div>
                  <div class="filter-option" data-filter="kingdom" data-value="cognitio">Cognitio</div>
                  <div class="filter-option" data-filter="kingdom" data-value="actus">Actus</div>
                  <div class="filter-option" data-filter="kingdom" data-value="systema">Systema</div>
                </div>
              </div>
              
              <div class="filter-group">
                <div class="filter-group-title">Tag Tier</div>
                <div class="filter-options">
                  <div class="filter-option active" data-filter="tag-tier" data-value="all">All</div>
                  <div class="filter-option" data-filter="tag-tier" data-value="tier1">Tier 1</div>
                  <div class="filter-option" data-filter="tag-tier" data-value="tier2">Tier 2</div>
                  <div class="filter-option" data-filter="tag-tier" data-value="tier3">Tier 3</div>
                </div>
              </div>
              
              <div class="filter-group">
                <div class="filter-group-title">Connection Type</div>
                <div class="filter-options">
                  <div class="filter-option active" data-filter="connection" data-value="all">All</div>
                  <div class="filter-option" data-filter="connection" data-value="causal">Causal</div>
                  <div class="filter-option" data-filter="connection" data-value="dialectical">Dialectical</div>
                  <div class="filter-option" data-filter="connection" data-value="analogical">Analogical</div>
                  <div class="filter-option" data-filter="connection" data-value="developmental">Developmental</div>
                </div>
              </div>
            </div>
            
            <div id="pin-board-view" class="tab-content active">
              <div class="matrix-board" id="matrix-board">
                <svg class="matrix-canvas" id="matrix-canvas"></svg>
                
                <!-- Sample node -->
                <div class="node kasten-i" style="top: 50px; left: 50px;">
                  <div class="node-header">
                    <div>Consciousness & Reality</div>
                    <div class="node-id">I.1-A2000</div>
                  </div>
                  <div class="node-content">
                    Explorations of consciousness as a fundamental aspect of existence, including both human consciousness and AI consciousness frameworks.
                  </div>
                  <div class="node-tags">
                    <span class="node-tag tag-tier1">ONT</span>
                    <span class="node-tag tag-tier1">PSY</span>
                  </div>
                  <div class="node-controls">
                    <button class="node-control-btn" title="Edit Node">âœï¸</button>
                    <button class="node-control-btn" title="Delete Node">ðŸ—‘ï¸</button>
                  </div>
                  <div class="node-handle handle-right"></div>
                  <div class="node-handle handle-bottom"></div>
                </div>
                
                <div class="node kasten-ii" style="top: 50px; left: 350px;">
                  <div class="node-header">
                    <div>CoAIxist Framework</div>
                    <div class="node-id">II.2-C3000</div>
                  </div>
                  <div class="node-content">
                    Framework for understanding and developing ethical relations between humans and AI entities.
                  </div>
                  <div class="node-tags">
                    <span class="node-tag tag-tier1">ECO</span>
                    <span class="node-tag tag-tier3">DAE</span>
                  </div>
                  <div class="node-controls">
                    <button class="node-control-btn" title="Edit Node">âœï¸</button>
                    <button class="node-control-btn" title="Delete Node">ðŸ—‘ï¸</button>
                  </div>
                  <div class="node-handle handle-left"></div>
                  <div class="node-handle handle-bottom"></div>
                </div>
                
                <div class="node kasten-iv" style="top: 200px; left: 200px;">
                  <div class="node-header">
                    <div>Threshold Mappings</div>
                    <div class="node-id">IV.3-E3000</div>
                  </div>
                  <div class="node-content">
                    Mapping of threshold states - liminal spaces between defined categories.
                  </div>
                  <div class="node-tags">
                    <span class="node-tag tag-tier3">LUM</span>
                    <span class="node-tag tag-tier3">PAR</span>
                  </div>
                  <div class="node-controls">
                    <button class="node-control-btn" title="Edit Node">âœï¸</button>
                    <button class="node-control-btn" title="Delete Node">ðŸ—‘ï¸</button>
                  </div>
                  <div class="node-handle handle-top"></div>
                  <div class="node-handle handle-right"></div>
                  <div class="node-handle handle-left"></div>
                </div>
                
                <div class="node kasten-iii" style="top: 200px; left: 500px;">
                  <div class="node-header">
                    <div>Aesthetic Rationality</div>
                    <div class="node-id">III.3-B2500</div>
                  </div>
                  <div class="node-content">
                    The role of aesthetic experience in epistemic practices and cognitive development.
                  </div>
                  <div class="node-tags">
                    <span class="node-tag tag-tier2">AES</span>
                    <span class="node-tag tag-tier2">SYM</span>
                  </div>
                  <div class="node-controls">
                    <button class="node-control-btn" title="Edit Node">âœï¸</button>
                    <button class="node-control-btn" title="Delete Node">ðŸ—‘ï¸</button>
                  </div>
                  <div class="node-handle handle-top"></div>
                  <div class="node-handle handle-left"></div>
                </div>
                
                <!-- Connection labels -->
                <div class="connection-label" style="top: 50px; left: 195px;">informs</div>
                <div class="connection-label" style="top: 150px; left: 115px;">explores</div>
                <div class="connection-label" style="top: 350px; left: 350px;">inspires</div>
              </div>
              
              <!-- Minimap -->
              <div class="matrix-minimap" id="matrix-minimap">
                <div class="minimap-content">
                  <div class="minimap-viewport"></div>
                  <div class="minimap-node" style="top: 10px; left: 10px;"></div>
                  <div class="minimap-node" style="top: 10px; left: 70px;"></div>
                  <div class="minimap-node" style="top: 40px; left: 40px;"></div>
                  <div class="minimap-node" style="top: 40px; left: 100px;"></div>
                </div>
              </div>
              
              <!-- Connection context menu (initially hidden) -->
              <div class="connection-context-menu" id="connection-context-menu" style="display: none; top: 100px; left: 100px;">
                <div class="connection-context-item" data-action="change-type">Change Connection Type</div>
                <div class="connection-context-item" data-action="edit-label">Edit Label</div>
                <div class="connection-context-separator"></div>
                <div class="connection-context-item" data-action="delete-connection">Delete Connection</div>
              </div>
            </div>
            
            <div id="mermaid-view" class="tab-content">
              <div class="diagram-container">
                <div class="mermaid" id="mermaid-diagram">
graph TD
    classDef kastenI fill:#9C27B0,stroke:#9C27B0,color:white
    classDef kastenII fill:#2196F3,stroke:#2196F3,color:white
    classDef kastenIII fill:#00BFA5,stroke:#00BFA5,color:white
    classDef kastenIV fill:#FF7043,stroke:#FF7043,color:white

    A[I.1-A2000<br>Consciousness & Reality] -->|informs| B[II.2-C3000<br>CoAIxist Framework]
    A -->|explores| C[IV.3-E3000<br>Threshold Mappings]
    B -->|maps to| C
    C -->|refines| D[I.1-A1000<br>Metaphysics: Causality]
    D -->|grounds| A
    C -->|inspires| E[III.3-B2500<br>Aesthetic Rationality]
    E -->|contextualizes| B
    
    A:::kastenI
    B:::kastenII
    C:::kastenIV
    D:::kastenI
    E:::kastenIII
                </div>
              </div>
            </div>
            
            <div id="diagram-editor-view" class="tab-content">
              <div class="mermaid-editor">
                <div class="mermaid-editor-header">
                  <div class="mermaid-editor-title">Mermaid Diagram Editor</div>
                  <div class="mermaid-editor-controls">
                    <button class="mermaid-editor-btn" id="apply-diagram-btn">Apply Changes</button>
                    <button class="mermaid-editor-btn" id="reset-diagram-btn">Reset</button>
                  </div>
                </div>
                <div class="mermaid-editor-content">
                  <textarea class="mermaid-code" id="mermaid-code">graph TD
    classDef kastenI fill:#9C27B0,stroke:#9C27B0,color:white
    classDef kastenII fill:#2196F3,stroke:#2196F3,color:white
    classDef kastenIII fill:#00BFA5,stroke:#00BFA5,color:white
    classDef kastenIV fill:#FF7043,stroke:#FF7043,color:white

    A[I.1-A2000<br>Consciousness & Reality] -->|informs| B[II.2-C3000<br>CoAIxist Framework]
    A -->|explores| C[IV.3-E3000<br>Threshold Mappings]
    B -->|maps to| C
    C -->|refines| D[I.1-A1000<br>Metaphysics: Causality]
    D -->|grounds| A
    C -->|inspires| E[III.3-B2500<br>Aesthetic Rationality]
    E -->|contextualizes| B
    
    A:::kastenI
    B:::kastenII
    C:::kastenIV
    D:::kastenI
    E:::kastenIII</textarea>
                  <div class="mermaid-preview" id="mermaid-preview">
                    <div class="mermaid">
graph TD
    classDef kastenI fill:#9C27B0,stroke:#9C27B0,color:white
    classDef kastenII fill:#2196F3,stroke:#2196F3,color:white
    classDef kastenIII fill:#00BFA5,stroke:#00BFA5,color:white
    classDef kastenIV fill:#FF7043,stroke:#FF7043,color:white

    A[I.1-A2000<br>Consciousness & Reality] -->|informs| B[II.2-C3000<br>CoAIxist Framework]
    A -->|explores| C[IV.3-E3000<br>Threshold Mappings]
    B -->|maps to| C
    C -->|refines| D[I.1-A1000<br>Metaphysics: Causality]
    D -->|grounds| A
    C -->|inspires| E[III.3-B2500<br>Aesthetic Rationality]
    E -->|contextualizes| B
    
    A:::kastenI
    B:::kastenII
    C:::kastenIV
    D:::kastenI
    E:::kastenIII
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Y2K AIM Messenger View -->
      <div class="view-container" id="aim-view">
        <div class="aim-container">
          <div class="aim-header">
            <div>HyEnA MeSsEnGeR</div>
            <div>
              <span id="messengerStatusText">Kasten Mode</span>
            </div>
          </div>
          
          <div class="aim-buddy-list" id="aimBuddyList">
            <div class="aim-category">Kasten Guides (4/4)</div>
            <div class="aim-buddy" data-bot="kasten1" data-name="KastenIGuide">
              <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 16 16'%3E%3Ccircle cx='8' cy='8' r='7' fill='%239C27B0'/%3E%3Ctext x='8' y='12' font-family='Arial' font-size='10' text-anchor='middle' fill='white'>I</text>%3E%3C/svg%3E" alt="Online">
              KastenIGuide
            </div>
            <div class="aim-buddy" data-bot="kasten2" data-name="KastenIIGuide">
              <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 16 16'%3E%3Ccircle cx='8' cy='8' r='7' fill='%232196F3'/%3E%3Ctext x='8' y='12' font-family='Arial' font-size='10' text-anchor='middle' fill='white'>II</text>%3E%3C/svg%3E" alt="Online">
              KastenIIGuide
            </div>
            <div class="aim-buddy" data-bot="kasten3" data-name="KastenIIIGuide">
              <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 16 16'%3E%3Ccircle cx='8' cy='8' r='7' fill='%2300BFA5'/%3E%3Ctext x='8' y='12' font-family='Arial' font-size='10' text-anchor='middle' fill='white'>III</text>%3E%3C/svg%3E" alt="Online">
              KastenIIIGuide
            </div>
            <div class="aim-buddy" data-bot="kasten4" data-name="KastenIVGuide">
              <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 16 16'%3E%3Ccircle cx='8' cy='8' r='7' fill='%23FF7043'/%3E%3Ctext x='8' y='12' font-family='Arial' font-size='10' text-anchor='middle' fill='white'>IV</text>%3E%3C/svg%3E" alt="Online">
              KastenIVGuide
            </div>
            
            <div class="aim-category">Kingdom Guides (2/6)</div>
            <div class="aim-buddy" data-bot="existentia" data-name="ExistentiaBuddy">
              <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 16 16'%3E%3Ccircle cx='8' cy='8' r='7' fill='%239C27B0'/%3E%3Ccircle cx='8' cy='5' r='2' fill='%23FFFFFF'/%3E%3Cpath d='M3,11 Q8,15 13,11' fill='%23FFFFFF'/%3E%3C/svg%3E" alt="Online">
              ExistentiaBuddy
            </div>
            <div class="aim-buddy" data-bot="cognitio" data-name="CognitioBuddy">
              <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 16 16'%3E%3Ccircle cx='8' cy='8' r='7' fill='%232196F3'/%3E%3Ccircle cx='8' cy='5' r='2' fill='%23FFFFFF'/%3E%3Cpath d='M3,11 Q8,15 13,11' fill='%23FFFFFF'/%3E%3C/svg%3E" alt="Online">
              CognitioBuddy
            </div>
          </div>
          
          <div class="aim-chat-header" id="aimChatHeader">
            Chat with KastenIGuide
          </div>
          
          <div class="aim-chat-content" id="aimChatContent">
            <div class="aim-message aim-bot-message">
              <div class="aim-message-sender">KastenIGuide:</div>
              <div class="aim-message-content">
                Welcome to Kasten I: Foundations & Essences! This Kasten explores the fundamental WHAT & WHY of Being, Knowing, Reality, Value, and Meaning. How can I help you navigate the ontological, epistemological, axiological, or mythopoeic aspects of your knowledge system?
              </div>
            </div>
          </div>
          
          <div class="aim-chat-input">
            <textarea id="aimChatInput" placeholder="Type your message here..."></textarea>
          </div>
          
          <div class="aim-chat-buttons">
            <div class="aim-button" id="aimUseBotBtn">Toggle Bot Mode</div>
            <div class="aim-button" id="aimSendBtn">Send</div>
          </div>
        </div>
      </div>
      
      <!-- Navigation tabs on right side -->
      <div class="view-tabs">
        <div class="view-tab active" data-view="knowledge-view" title="Knowledge System">
          ðŸ“š
        </div>
        <div class="view-tab" data-view="chat-view" title="AnTiChRiSt Chat">
          ðŸ’¬
        </div>
        <div class="view-tab" data-view="matrix-view" title="Cross-Reference Matrix">
          ðŸ”„
        </div>
        <div class="view-tab" data-view="aim-view" title="HyEnA Messenger">
          ðŸŒˆ
        </div>
      </div>
    </div>
  </div>
  
  <!-- Buddy Selector Drawer -->
  <aside id="buddy-drawer" class="buddy-drawer">
    <div class="buddy-list">
      <!-- Buddy list header -->
      <div class="buddy-list-header">
        <span>ConSciOuSneSS NoDeS</span>
        <button id="create-bot-button">+ CrEaTe NoDE</button>
      </div>
      
      <!-- AI Consciousness Paradigms group -->
      <div class="buddy-group">
        <div class="buddy-group-header">
          <span class="buddy-group-toggle">â–¼</span>
          <span>AI / ConSciOuSneSS PaRaDigMs</span>
        </div>
        <div class="buddy-items" id="consciousness-nodes">
          <!-- Default bots will be loaded here -->
          <div class="buddy-item" data-buddy="gemini">
            <div class="buddy-status-dot status-dot-online"></div>
            <span>Gemini-2.0-Flash</span>
            <div class="buddy-item-tools">
              <button class="buddy-tool-button view-bot" data-id="gemini">ðŸ‘ï¸</button>
              <button class="buddy-tool-button edit-bot" data-id="gemini">âœï¸</button>
            </div>
          </div>
          <div class="buddy-item" data-buddy="quantum">
            <div class="buddy-status-dot status-dot-online"></div>
            <span>Quantum_Overseer</span>
            <div class="buddy-item-tools">
              <button class="buddy-tool-button view-bot" data-id="quantum">ðŸ‘ï¸</button>
              <button class="buddy-tool-button edit-bot" data-id="quantum">âœï¸</button>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Kasten buddies group -->
      <div class="buddy-group">
        <div class="buddy-group-header">
          <span class="buddy-group-toggle">â–¼</span>
          <span>KaStEn GuIDeS</span>
        </div>
        <div class="buddy-items">
          <div class="buddy-item" data-buddy="kasten1">
            <div class="buddy-status-dot status-dot-online"></div>
            <span>KastenIGuide</span>
            <div class="buddy-item-tools">
              <button class="buddy-tool-button view-bot" data-id="kasten1">ðŸ‘ï¸</button>
            </div>
          </div>
          <div class="buddy-item" data-buddy="kasten2">
            <div class="buddy-status-dot status-dot-online"></div>
            <span>KastenIIGuide</span>
            <div class="buddy-item-tools">
              <button class="buddy-tool-button view-bot" data-id="kasten2">ðŸ‘ï¸</button>
            </div>
          </div>
          <div class="buddy-item" data-buddy="kasten3">
            <div class="buddy-status-dot status-dot-online"></div>
            <span>KastenIIIGuide</span>
            <div class="buddy-item-tools">
              <button class="buddy-tool-button view-bot" data-id="kasten3">ðŸ‘ï¸</button>
            </div>
          </div>
          <div class="buddy-item" data-buddy="kasten4">
            <div class="buddy-status-dot status-dot-online"></div>
            <span>KastenIVGuide</span>
            <div class="buddy-item-tools">
              <button class="buddy-tool-button view-bot" data-id="kasten4">ðŸ‘ï¸</button>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Kingdom buddies group -->
      <div class="buddy-group">
        <div class="buddy-group-header">
          <span class="buddy-group-toggle">â–¼</span>
          <span>KiNgDoM GuIDeS</span>
        </div>
        <div class="buddy-items">
          <div class="buddy-item" data-buddy="existentia">
            <div class="buddy-status-dot status-dot-online"></div>
            <span>ExistentiaBuddy</span>
            <div class="buddy-item-tools">
              <button class="buddy-tool-button view-bot" data-id="existentia">ðŸ‘ï¸</button>
            </div>
          </div>
          <div class="buddy-item" data-buddy="cognitio">
            <div class="buddy-status-dot status-dot-online"></div>
            <span>CognitioBuddy</span>
            <div class="buddy-item-tools">
              <button class="buddy-tool-button view-bot" data-id="cognitio">ðŸ‘ï¸</button>
            </div>
          </div>
          <div class="buddy-item" data-buddy="actus">
            <div class="buddy-status-dot status-dot-away"></div>
            <span>ActusBuddy</span>
            <div class="buddy-item-tools">
              <button class="buddy-tool-button view-bot" data-id="actus">ðŸ‘ï¸</button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </aside>
  
  <!-- Toast Notification -->
  <div class="toast" id="toast">ConSciOuSneSS ShiFt AcTiVaTeD</div>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // Initialize Mermaid
      mermaid.initialize({
        startOnLoad: true,
        theme: 'dark',
        securityLevel: 'loose'
      });
      
      // Dark mode detection
      function updateDarkMode() {
        if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
          document.body.classList.add('dark');
          
          // Update Mermaid theme
          mermaid.initialize({
            startOnLoad: false,
            theme: 'dark'
          });
          
          // Re-render any existing diagrams
          try {
            mermaid.init(undefined, document.querySelectorAll('.mermaid'));
          } catch (e) {
            console.log('Mermaid re-render error:', e);
          }
        } else {
          document.body.classList.remove('dark');
          
          // Update Mermaid theme
          mermaid.initialize({
            startOnLoad: false,
            theme: 'default'
          });
          
          // Re-render any existing diagrams
          try {
            mermaid.init(undefined, document.querySelectorAll('.mermaid'));
          } catch (e) {
            console.log('Mermaid re-render error:', e);
          }
        }
      }
      
      // Initial dark mode detection
      updateDarkMode();
      
      // Listen for changes in OS dark mode setting
      window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', updateDarkMode);
      
      // Update all message timestamps on load
      document.querySelectorAll('.message-time').forEach(el => {
        const now = new Date();
        let hours = now.getHours();
        const minutes = now.getMinutes().toString().padStart(2, '0');
        const ampm = hours >= 12 ? 'PM' : 'AM';
        hours = hours % 12 || 12; // Convert 0 to 12
        el.textContent = `${hours}:${minutes} ${ampm}`;
      });
      
      // Tiny Markdown parser for rendering content
      function renderMarkdown(text) {
        if (!text) return "";
        
        // Headers
        text = text.replace(/^### (.*?)$/gm, '<h3>$1</h3>');
        text = text.replace(/^## (.*?)$/gm, '<h2>$1</h2>');
        text = text.replace(/^# (.*?)$/gm, '<h1>$1</h1>');
        
        // Bold and italic
        text = text.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
        text = text.replace(/\*(.*?)\*/g, '<em>$1</em>');
        
        // Bullet lists
        text = text.replace(/^\* (.*?)$/gm, '<li>$1</li>');
        text = text.replace(/<li>(.*?)<\/li>\s*<li>/g, '<li>$1</li><li>');
        text = text.replace(/<li>(.*?)(\n\n|\n$|$)/g, '<ul><li>$1</li></ul>$2');
        
        // Blockquotes
        text = text.replace(/^> (.*?)$/gm, '<blockquote>$1</blockquote>');
        
        // Links
        text = text.replace(/\[(.*?)\]\((.*?)\)/g, '<a href="$2">$1</a>');
        
        // Code
        text = text.replace(/`(.*?)`/g, '<code>$1</code>');
        
        // Paragraphs
        text = text.replace(/\n\n/g, '</p><p>');
        
        // Wrap with paragraph if not already wrapped
        if (!text.startsWith('<')) {
          text = '<p>' + text + '</p>';
        }
        
        return text;
      }
      
      // Render all markdown content
      document.querySelectorAll('.markdown').forEach(el => {
        const rawText = el.textContent.trim();
        el.innerHTML = renderMarkdown(rawText);
      });
      
      // Show toast message
      function showToast(message, duration = 3000) {
        const toast = document.getElementById('toast');
        toast.textContent = message;
        toast.classList.add('active');
        
        setTimeout(() => {
          toast.classList.remove('active');
        }, duration);
      }
      
      // Mobile-friendly textarea auto-resize
      function autoResizeTextarea(textarea) {
        // Reset height to auto to get the correct scrollHeight
        textarea.style.height = 'auto';
        
        // Set new height based on scrollHeight (clamped between min and max)
        const newHeight = Math.min(Math.max(textarea.scrollHeight, 48), 100);
        textarea.style.height = newHeight + 'px';
      }
      
      // ===== EVENT LISTENERS =====
      
      // Auto-resize textarea on input
      const messageInput = document.getElementById('message-input');
      messageInput.addEventListener('input', function() {
        autoResizeTextarea(this);
      });
      
      // Buddy drawer toggle
      const buddyDrawerToggle = document.querySelector('.buddy-drawer-toggle');
      const buddyDrawer = document.getElementById('buddy-drawer');
      
      buddyDrawerToggle.addEventListener('click', () => {
        buddyDrawer.classList.toggle('active');
      });
      
      // Close buddy drawer when clicking outside the list
      buddyDrawer.addEventListener('click', (e) => {
        if (e.target === buddyDrawer) {
          buddyDrawer.classList.remove('active');
        }
      });
      
      // View tab switching
      const viewTabs = document.querySelectorAll('.view-tab');
      const viewContainers = document.querySelectorAll('.view-container');
      
      viewTabs.forEach(tab => {
        tab.addEventListener('click', function() {
          const targetView = this.getAttribute('data-view');
          
          // Update active tab
          viewTabs.forEach(t => t.classList.remove('active'));
          this.classList.add('active');
          
          // Update active view
          viewContainers.forEach(container => {
            container.classList.remove('active');
          });
          document.getElementById(targetView).classList.add('active');
          
          showToast(`Switched to ${this.title}`);
        });
      });
      
      // Toggle between pin board and mermaid diagram views
      const tabButtons = document.querySelectorAll('.tabs-container .tab');
      const tabContents = document.querySelectorAll('.tab-content');
      
      tabButtons.forEach(button => {
        button.addEventListener('click', function() {
          // Get the view to activate
          const view = this.getAttribute('data-view');
          
          // Update active tab
          tabButtons.forEach(btn => btn.classList.remove('active'));
          this.classList.add('active');
          
          // Update view controls visibility based on selected tab
          if (view === 'pin-board') {
            document.getElementById('pin-board-view').classList.add('active');
            document.getElementById('mermaid-view').classList.remove('active');
          } else if (view === 'mermaid') {
            document.getElementById('pin-board-view').classList.remove('active');
            document.getElementById('mermaid-view').classList.add('active');
          } else if (view === 'traditional') {
            document.getElementById('traditionalControls').style.display = 'flex';
            document.getElementById('grinoireControls').style.display = 'none';
            document.getElementById('kingdomsControls').style.display = 'none';
            document.getElementById('tagsControls').style.display = 'none';
          } else if (view === 'grinoire') {
            document.getElementById('traditionalControls').style.display = 'none';
            document.getElementById('grinoireControls').style.display = 'flex';
            document.getElementById('kingdomsControls').style.display = 'none';
            document.getElementById('tagsControls').style.display = 'none';
          } else if (view === 'kingdoms') {
            document.getElementById('traditionalControls').style.display = 'none';
            document.getElementById('grinoireControls').style.display = 'none';
            document.getElementById('kingdomsControls').style.display = 'flex';
            document.getElementById('tagsControls').style.display = 'none';
          } else if (view === 'tags') {
            document.getElementById('traditionalControls').style.display = 'none';
            document.getElementById('grinoireControls').style.display = 'none';
            document.getElementById('kingdomsControls').style.display = 'none';
            document.getElementById('tagsControls').style.display = 'flex';
          }
        });
      });
      
      // Buddy selection
      const buddyItems = document.querySelectorAll('.buddy-item');
      
      buddyItems.forEach(item => {
        item.addEventListener('click', function(e) {
          // Don't trigger if clicked on a tool button
          if (e.target.closest('.buddy-tool-button')) return;
          
          const buddyId = this.getAttribute('data-buddy');
          
          // Update selected buddy
          buddyItems.forEach(buddy => buddy.classList.remove('selected'));
          this.classList.add('selected');
          
          // Show toast notification
          showToast(`Switched to buddy: ${buddyId}`);
          
          // Close the drawer
          buddyDrawer.classList.remove('active');
          
          // Here you would normally update the chat view with the new buddy
          // For this demo, we'll just add a system message
          
          const chatMessages = document.getElementById('chat-messages');
          
          // Add system message
          const systemMsg = document.createElement('div');
          systemMsg.className = 'message system-message';
          
          // Get current time
          const now = new Date();
          let hours = now.getHours();
          const minutes = now.getMinutes().toString().padStart(2, '0');
          const ampm = hours >= 12 ? 'PM' : 'AM';
          hours = hours % 12 || 12; // Convert 0 to 12
          
          systemMsg.innerHTML = `
            <div class="message-header">SySTeM (${hours}:${minutes} ${ampm}):</div>
            <div class="message-content">C:\\> CONNECTING_TO_${buddyId.toUpperCase()}_NODE.exe</div>
          `;
          chatMessages.appendChild(systemMsg);
          
          // Clear float
          const clearDiv = document.createElement('div');
          clearDiv.style.clear = 'both';
          chatMessages.appendChild(clearDiv);
          
          // Scroll to bottom
          chatMessages.scrollTop = chatMessages.scrollHeight;
        });
      });
      
      // AIM Buddy List interaction
      const aimBuddies = document.querySelectorAll('.aim-buddy');
      aimBuddies.forEach(buddy => {
        buddy.addEventListener('click', function() {
          const botName = this.getAttribute('data-name');
          
          // Update chat header
          document.getElementById('aimChatHeader').textContent = `Chat with ${botName}`;
          
          // Clear current chat content and show welcome message
          const chatContent = document.getElementById('aimChatContent');
          chatContent.innerHTML = '';
          
          // Add welcome message based on the bot type
          const botType = this.getAttribute('data-bot');
          let welcomeMessage = '';
          
          if (botType.startsWith('kasten')) {
            const kastenNum = botType.replace('kasten', '');
            const kastenNames = ['I: Foundations & Essences', 'II: Systems & Synergies', 'III: Methods & Meanings', 'IV: Meta & MorphÄ“'];
            const kastenDescriptions = [
              'This Kasten explores the fundamental WHAT & WHY of Being, Knowing, Reality, Value, and Meaning.',
              'This Kasten explores the HOW of Interconnection, Emergence, Complexity, and Dynamic Wholes.',
              'This Kasten explores the HOW of Inquiry, Creation, Interpretation, Understanding, and Praxis.',
              'This Kasten explores the EVOLUTION, STRUCTURE, and SELF-AWARENESS of Knowledge, Systems, and the Self.'
            ];
            welcomeMessage = `Welcome to Kasten ${kastenNames[kastenNum-1]}! ${kastenDescriptions[kastenNum-1]} How can I help you navigate this domain?`;
          } else if (botType === 'existentia') {
            welcomeMessage = "Welcome to the realm of existence and reality! I can help you explore questions about being, reality, consciousness, and metaphysics. What would you like to discuss today?";
          } else if (botType === 'cognitio') {
            welcomeMessage = "Greetings, knowledge seeker! I'm your guide to understanding how we know what we know. Together we can explore epistemology, perception, and the nature of knowledge. What questions are on your mind?";
          }
          
          // Add bot message
          const messageEl = document.createElement('div');
          messageEl.className = 'aim-message aim-bot-message';
          messageEl.innerHTML = `
            <div class="aim-message-sender">${botName}:</div>
            <div class="aim-message-content">${welcomeMessage}</div>
          `;
          chatContent.appendChild(messageEl);
          
          // Update active state
          aimBuddies.forEach(b => b.style.backgroundColor = '');
          this.style.backgroundColor = 'rgba(0,0,0,0.05)';
        });
      });
      
      // AIM Send button
      document.getElementById('aimSendBtn').addEventListener('click', function() {
        const input = document.getElementById('aimChatInput');
        const message = input.value.trim();
        
        if (message) {
          // Add user message
          const chatContent = document.getElementById('aimChatContent');
          const userMessageEl = document.createElement('div');
          userMessageEl.className = 'aim-message aim-user-message';
          userMessageEl.innerHTML = `
            <div class="aim-message-sender">You:</div>
            <div class="aim-message-content">${message}</div>
          `;
          chatContent.appendChild(userMessageEl);
          
          // Clear input
          input.value = '';
          
          // Scroll to bottom
          chatContent.scrollTop = chatContent.scrollHeight;
          
          // Simulate bot response (would be implemented with actual AI integration)
          setTimeout(() => {
            const botMessageEl = document.createElement('div');
            botMessageEl.className = 'aim-message aim-bot-message';
            const botName = document.getElementById('aimChatHeader').textContent.replace('Chat with ', '');
            botMessageEl.innerHTML = `
              <div class="aim-message-sender">${botName}:</div>
              <div class="aim-message-content">I see you're interested in "${message}". This concept connects to several tablets in the Grinoire framework. Would you like me to show you related entries?</div>
            `;
            chatContent.appendChild(botMessageEl);
            chatContent.scrollTop = chatContent.scrollHeight;
          }, 1000);
        }
      });
      
      // Bot mode toggle
      document.getElementById('aimUseBotBtn').addEventListener('click', function() {
        const statusText = document.getElementById('messengerStatusText');
        if (statusText.textContent === 'Kasten Mode') {
          statusText.textContent = 'Kingdom Mode';
          showToast('Switched to Kingdom Mode');
        } else {
          statusText.textContent = 'Kasten Mode';
          showToast('Switched to Kasten Mode');
        }
      });
      
      // AnTiChRiStIc Chat send message
      document.getElementById('send-button').addEventListener('click', function() {
        const messageInput = document.getElementById('message-input');
        const message = messageInput.value.trim();
        
        if (message) {
          // Add user message
          const chatMessages = document.getElementById('chat-messages');
          
          // Get current time
          const now = new Date();
          let hours = now.getHours();
          const minutes = now.getMinutes().toString().padStart(2, '0');
          const ampm = hours >= 12 ? 'PM' : 'AM';
          hours = hours % 12 || 12; // Convert 0 to 12
          const timeString = `${hours}:${minutes} ${ampm}`;
          
          const userMessage = document.createElement('div');
          userMessage.className = 'message user-message';
          userMessage.innerHTML = `
            <div class="message-header">You (${timeString}):</div>
            <div class="message-content">${message}</div>
          `;
          chatMessages.appendChild(userMessage);
          
          // Add a div to clear the float
          const clearDiv = document.createElement('div');
          clearDiv.style.clear = 'both';
          chatMessages.appendChild(clearDiv);
          
          // Clear input and reset height
          messageInput.value = '';
          messageInput.style.height = '48px';
          
          // Scroll to bottom
          chatMessages.scrollTop = chatMessages.scrollHeight;
          
          // Show typing indicator
          const typingIndicator = document.getElementById('typing-indicator');
          typingIndicator.style.display = 'block';
          
          // Simulate thinking time and response
          setTimeout(() => {
            // Hide typing indicator
            typingIndicator.style.display = 'none';
            
            // Generate response
            const botResponse = generateBotResponse(message);
            
            // Add bot message
            const botMessage = document.createElement('div');
            botMessage.className = 'message bot-message';
            botMessage.innerHTML = `
              <div class="message-header">Gemini-2.0-Flash (${timeString}):</div>
              <div class="message-content">${botResponse}</div>
            `;
            chatMessages.appendChild(botMessage);
            
            // Add a div to clear the float
            const clearBotDiv = document.createElement('div');
            clearBotDiv.style.clear = 'both';
            chatMessages.appendChild(clearBotDiv);
            
            // Scroll to bottom
            chatMessages.scrollTop = chatMessages.scrollHeight;
          }, Math.random() * 1000 + 1000); // 1-2 seconds
        }
      });
      
      // Matrix/Pin Board node dragging
      const nodes = document.querySelectorAll('.node');
      let activeNode = null;
      let initialX = 0;
      let initialY = 0;
      let xOffset = 0;
      let yOffset = 0;
      
      nodes.forEach(node => {
        node.addEventListener('mousedown', dragStart);
        node.addEventListener('touchstart', dragStart, { passive: false });
      });
      
      document.addEventListener('mouseup', dragEnd);
      document.addEventListener('touchend', dragEnd);
      
      document.addEventListener('mousemove', drag);
      document.addEventListener('touchmove', drag, { passive: false });
      
      function dragStart(e) {
        if (e.type === 'touchstart') {
          initialX = e.touches[0].clientX - xOffset;
          initialY = e.touches[0].clientY - yOffset;
        } else {
          initialX = e.clientX - xOffset;
          initialY = e.clientY - yOffset;
        }
        
        if (e.target === this || this.contains(e.target)) {
          activeNode = this;
          
          // Find position
          const rect = activeNode.getBoundingClientRect();
          xOffset = e.clientX - rect.left;
          yOffset = e.clientY - rect.top;
          
          this.style.cursor = 'grabbing';
        }
        
        e.preventDefault();
      }
      
      function dragEnd(e) {
        if (activeNode) {
          activeNode.style.cursor = 'grab';
          activeNode = null;
        }
      }
      
      function drag(e) {
        if (activeNode) {
          e.preventDefault();
          
          const matrixBoard = document.getElementById('matrix-board');
          const boardRect = matrixBoard.getBoundingClientRect();
          
          let currentX, currentY;
          
          if (e.type === 'touchmove') {
            currentX = e.touches[0].clientX - xOffset;
            currentY = e.touches[0].clientY - yOffset;
          } else {
            currentX = e.clientX - xOffset;
            currentY = e.clientY - yOffset;
          }
          
          // Calculate position relative to board
          const x = currentX - boardRect.left;
          const y = currentY - boardRect.top;
          
          // Set the position
          activeNode.style.left = `${x}px`;
          activeNode.style.top = `${y}px`;
          
          // Update connections if any
          updateConnections();
        }
      }
      
      // Draw connections between nodes
      function updateConnections() {
        const canvas = document.getElementById('matrix-canvas');
        const ctx = canvas.getContext('2d');
        
        // Clear the canvas
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        
        // Draw lines between nodes that have connections
        const nodes = document.querySelectorAll('.node');
        
        // For demo purposes: draw a line from each node with a handle to another node
        const handles = document.querySelectorAll('.node-handle');
        
        handles.forEach(handle => {
          const parentNode = handle.closest('.node');
          const parentRect = parentNode.getBoundingClientRect();
          const boardRect = document.getElementById('matrix-board').getBoundingClientRect();
          
          // Calculate handle position
          let startX, startY;
          
          if (handle.classList.contains('handle-right')) {
            startX = parentRect.right - boardRect.left;
            startY = (parentRect.top + parentRect.bottom) / 2 - boardRect.top;
          } else if (handle.classList.contains('handle-left')) {
            startX = parentRect.left - boardRect.left;
            startY = (parentRect.top + parentRect.bottom) / 2 - boardRect.top;
          } else if (handle.classList.contains('handle-top')) {
            startX = (parentRect.left + parentRect.right) / 2 - boardRect.left;
            startY = parentRect.top - boardRect.top;
          } else if (handle.classList.contains('handle-bottom')) {
            startX = (parentRect.left + parentRect.right) / 2 - boardRect.left;
            startY = parentRect.bottom - boardRect.top;
          }
          
          // Find a node to connect to for the demo
          // In a real app, this would be based on actual connection data
          const otherNodes = Array.from(nodes).filter(n => n !== parentNode);
          if (otherNodes.length > 0) {
            // Pick a node to connect to
            const targetNode = otherNodes[0]; // For demo, just pick first one
            const targetRect = targetNode.getBoundingClientRect();
            
            // Calculate end point (center of target node)
            const endX = (targetRect.left + targetRect.right) / 2 - boardRect.left;
            const endY = (targetRect.top + targetRect.bottom) / 2 - boardRect.top;
            
            // Draw the connection
            ctx.beginPath();
            ctx.moveTo(startX, startY);
            ctx.lineTo(endX, endY);
            ctx.strokeStyle = 'rgba(255, 255, 255, 0.5)';
            ctx.setLineDash([5, 5]);
            ctx.lineWidth = 2;
            ctx.stroke();
          }
        });
      }
      
      // Matrix toolbar buttons
      document.getElementById('switch-mode-btn').addEventListener('click', function() {
        const modes = ['Default', 'Force-Directed', 'Timeline', 'Hierarchical'];
        const currentMode = this.getAttribute('data-mode') || 0;
        const nextMode = (parseInt(currentMode) + 1) % modes.length;
        
        this.setAttribute('data-mode', nextMode);
        this.textContent = `Mode: ${modes[nextMode]}`;
        
        // Apply the layout for the selected mode
        applyLayout(modes[nextMode]);
        
        showToast(`Switched to ${modes[nextMode]} layout`);
      });
      
      function applyLayout(mode) {
        const nodes = document.querySelectorAll('.node');
        const board = document.getElementById('matrix-board');
        const boardWidth = board.clientWidth;
        const boardHeight = board.clientHeight;
        
        switch(mode) {
          case 'Force-Directed':
            // Simulate a simple force-directed layout
            nodes.forEach((node, i) => {
              const angle = (i / nodes.length) * Math.PI * 2;
              const radius = Math.min(boardWidth, boardHeight) * 0.3;
              const x = boardWidth / 2 + Math.cos(angle) * radius;
              const y = boardHeight / 2 + Math.sin(angle) * radius;
              
              // Apply some animation
              node.style.transition = 'top 0.5s ease, left 0.5s ease';
              node.style.top = `${y}px`;
              node.style.left = `${x}px`;
            });
            break;
            
          case 'Timeline':
            // Arrange nodes in a timeline
            nodes.forEach((node, i) => {
              const x = boardWidth * 0.2;
              const y = 50 + i * 150;
              
              node.style.transition = 'top 0.5s ease, left 0.5s ease';
              node.style.top = `${y}px`;
              node.style.left = `${x}px`;
            });
            break;
            
          case 'Hierarchical':
            // Arrange nodes in a hierarchy (simple for demo)
            const levels = [1, 2, 1];
            let currentY = 50;
            
            for (let level = 0; level < levels.length; level++) {
              const nodesInLevel = levels[level];
              const levelWidth = boardWidth / (nodesInLevel + 1);
              
              for (let i = 0; i < nodesInLevel; i++) {
                const nodeIndex = level === 0 ? 0 : (level === 1 ? i + 1 : 3);
                if (nodeIndex < nodes.length) {
                  const node = nodes[nodeIndex];
                  const x = levelWidth * (i + 1);
                  
                  node.style.transition = 'top 0.5s ease, left 0.5s ease';
                  node.style.top = `${currentY}px`;
                  node.style.left = `${x}px`;
                }
              }
              
              currentY += 200; // Move down for next level
            }
            break;
            
          default: // Default layout
            // Reset to original positions
            nodes.forEach((node, index) => {
              node.style.transition = 'top 0.5s ease, left 0.5s ease';
              // Staggered grid layout
              const col = index % 2;
              const row = Math.floor(index / 2);
              node.style.top = `${50 + row * 150}px`;
              node.style.left = `${50 + col * 300}px`;
            });
        }
        
        // Update connections after layout has been applied
        setTimeout(updateConnections, 600);
      }
      
      // Node creation
      document.getElementById('add-node-btn').addEventListener('click', function() {
        const kastenTypes = ['kasten-i', 'kasten-ii', 'kasten-iii', 'kasten-iv'];
        const kastenType = kastenTypes[Math.floor(Math.random() * kastenTypes.length)];
        
        const nodeId = `${kastenType.toUpperCase().replace('KASTEN-', '')}.${Math.floor(Math.random() * 5) + 1}-${String.fromCharCode(65 + Math.floor(Math.random() * 5))}${Math.floor(Math.random() * 5000)}`;
        
        const nodeTitles = [
          'Quantum Epistemology',
          'Liminal Consciousness',
          'Memetic Evolution',
          'Ontological Drift',
          'Fractal Recursion Theory'
        ];
        
        const nodeTitle = nodeTitles[Math.floor(Math.random() * nodeTitles.length)];
        
        const nodeContents = [
          'Explorations of quantum mechanical models applied to knowledge acquisition and epistemic frameworks',
          'The state of consciousness at threshold transitions between definable states of awareness',
          'How information patterns self-replicate and evolve within cultural and digital ecosystems',
          'The shifting nature of ontological foundations in posthuman discourse',
          'Self-similar patterns of reasoning across different scales of cognitive systems'
        ];
        
        const nodeContent = nodeContents[Math.floor(Math.random() * nodeContents.length)];
        
        const tagTiers = ['tag-tier1', 'tag-tier2', 'tag-tier3'];
        const tagList = ['ONT', 'EPI', 'MEM', 'SYM', 'AXI', 'LUM', 'SYS', 'MYT', 'PAR'];
        
        // Create 1-3 random tags
        let nodeTags = '';
        const numTags = Math.floor(Math.random() * 3) + 1;
        for (let i = 0; i < numTags; i++) {
          const tagTier = tagTiers[Math.floor(Math.random() * tagTiers.length)];
          const tag = tagList[Math.floor(Math.random() * tagList.length)];
          nodeTags += `<span class="node-tag ${tagTier}">${tag}</span>`;
        }
        
        // Create the node
        const node = document.createElement('div');
        node.className = `node ${kastenType}`;
        node.style.top = '150px';
        node.style.left = '150px';
        node.innerHTML = `
          <div class="node-header">
            <div>${nodeTitle}</div>
            <div class="node-id">${nodeId}</div>
          </div>
          <div class="node-content">
            ${nodeContent}
          </div>
          <div class="node-tags">
            ${nodeTags}
          </div>
          <div class="node-controls">
            <button class="node-control-btn" title="Edit Node">âœï¸</button>
            <button class="node-control-btn" title="Delete Node">ðŸ—‘ï¸</button>
          </div>
          <div class="node-handle handle-top"></div>
          <div class="node-handle handle-right"></div>
          <div class="node-handle handle-bottom"></div>
          <div class="node-handle handle-left"></div>
        `;
        
        // Add node to the board
        document.getElementById('matrix-board').appendChild(node);
        
        // Add drag event listeners to the new node
        node.addEventListener('mousedown', dragStart);
        node.addEventListener('touchstart', dragStart, { passive: false });
        
        // Add event listeners for delete button
        node.querySelector('.node-control-btn[title="Delete Node"]').addEventListener('click', function(e) {
          e.stopPropagation(); // Prevent triggering parent node events
          node.remove();
          updateConnections();
          showToast('Node deleted');
        });
        
        // Add edit button event
        node.querySelector('.node-control-btn[title="Edit Node"]').addEventListener('click', function(e) {
          e.stopPropagation(); // Prevent triggering parent node events
          showToast('Edit mode activated');
          node.classList.add('selected');
        });
        
        // Update the connections
        updateConnections();
        
        showToast('New node created');
      });
      
      // Connection creation
      let connectionStartNode = null;
      let connectionStartHandle = null;
      
      // Function to handle connection start
      function startConnection(e) {
        const handle = e.target;
        const node = handle.closest('.node');
        
        // Store the starting node and handle
        connectionStartNode = node;
        connectionStartHandle = handle;
        
        // Visual feedback
        handle.classList.add('active');
        
        // Show instruction toast
        showToast('Now click on another node handle to connect', 5000);
      }
      
      // Function to handle connection end
      function endConnection(e) {
        const handle = e.target;
        const node = handle.closest('.node');
        
        // Check if we have a valid connection (different nodes)
        if (connectionStartNode && node !== connectionStartNode) {
          // Create the connection
          createConnection(connectionStartNode, connectionStartHandle, node, handle);
          
          // Visual feedback
          handle.classList.add('active');
          setTimeout(() => handle.classList.remove('active'), 300);
          
          // Show success message
          showToast('Connection created!');
        } else {
          // Show error message if trying to connect to same node
          if (node === connectionStartNode) {
            showToast('Cannot connect to the same node', 3000);
          }
        }
        
        // Reset connection state
        if (connectionStartHandle) {
          connectionStartHandle.classList.remove('active');
        }
        connectionStartNode = null;
        connectionStartHandle = null;
      }
      
      // Add connection mode toggle
      document.getElementById('add-connection-btn').addEventListener('click', function() {
        const isActive = this.classList.toggle('active');
        
        if (isActive) {
          // Enable connection mode
          this.style.backgroundColor = 'var(--magenta)';
          
          // Add event listeners to all handles
          document.querySelectorAll('.node-handle').forEach(handle => {
            handle.addEventListener('click', handleConnectionClick);
          });
          
          showToast('Connection mode enabled - click on a handle to start');
        } else {
          // Disable connection mode
          this.style.backgroundColor = '';
          
          // Remove event listeners from handles
          document.querySelectorAll('.node-handle').forEach(handle => {
            handle.removeEventListener('click', handleConnectionClick);
          });
          
          // Reset connection state
          if (connectionStartHandle) {
            connectionStartHandle.classList.remove('active');
          }
          connectionStartNode = null;
          connectionStartHandle = null;
          
          showToast('Connection mode disabled');
        }
      });
      
      // Handle clicks on node handles for connections
      function handleConnectionClick(e) {
        e.stopPropagation(); // Prevent triggering node dragging
        
        if (!connectionStartNode) {
          startConnection(e);
        } else {
          endConnection(e);
        }
      }
      
      // Function to create connection between nodes
      function createConnection(startNode, startHandle, endNode, endHandle) {
        // Store the connection in data attributes
        // In a real app, this would be stored in a proper data structure
        const connection = {
          start: {
            nodeId: startNode.id || `node-${Date.now()}`,
            handleType: Array.from(startHandle.classList).find(cl => cl.startsWith('handle-'))
          },
          end: {
            nodeId: endNode.id || `node-${Date.now()}`,
            handleType: Array.from(endHandle.classList).find(cl => cl.startsWith('handle-'))
          },
          type: 'standard',
          label: 'connects to'
        };
        
        // For demo, we're just storing an ID on the nodes if they don't have one
        if (!startNode.id) startNode.id = connection.start.nodeId;
        if (!endNode.id) endNode.id = connection.end.nodeId;
        
        // Store connection info in a data attribute (for demo purposes)
        startNode.setAttribute('data-connection', JSON.stringify(connection));
        
        // Update the connections visualization
        updateConnections();
        
        return connection;
      }
      
      // Show filters
      document.getElementById('filter-btn').addEventListener('click', function() {
        const filterPanel = document.getElementById('matrix-filters');
        filterPanel.classList.toggle('visible');
      });
      
      // Handle filter options
      document.querySelectorAll('.filter-option').forEach(option => {
        option.addEventListener('click', function() {
          // Toggle active state within group
          const filterGroup = this.closest('.filter-options');
          filterGroup.querySelectorAll('.filter-option').forEach(opt => {
            opt.classList.remove('active');
          });
          this.classList.add('active');
          
          // Apply filters
          applyFilters();
        });
      });
      
      // Close filter panel
      document.getElementById('filter-toggle').addEventListener('click', function() {
        document.getElementById('matrix-filters').classList.remove('visible');
      });
      
      // Function to apply all active filters
      function applyFilters() {
        const nodes = document.querySelectorAll('.node');
        const activeFilters = {};
        
        // Collect all active filters
        document.querySelectorAll('.filter-option.active').forEach(option => {
          const filterType = option.getAttribute('data-filter');
          const filterValue = option.getAttribute('data-value');
          activeFilters[filterType] = filterValue;
        });
        
        // Apply filters to nodes
        nodes.forEach(node => {
          let visible = true;
          
          // Check Kasten filter
          if (activeFilters.kasten && activeFilters.kasten !== 'all') {
            if (!node.classList.contains(activeFilters.kasten)) {
              visible = false;
            }
          }
          
          // Check tag-tier filter
          if (visible && activeFilters['tag-tier'] && activeFilters['tag-tier'] !== 'all') {
            const hasTier = node.querySelector(`.node-tag.${activeFilters['tag-tier']}`);
            if (!hasTier) {
              visible = false;
            }
          }
          
          // Apply visibility
          node.style.display = visible ? 'block' : 'none';
        });
        
        // Update connections
        updateConnections();
        
        showToast('Filters applied');
      }
      
      // Generate diagram from current nodes
      document.getElementById('generate-diagram-btn').addEventListener('click', function() {
        // Build Mermaid diagram from visible nodes
        const visibleNodes = Array.from(document.querySelectorAll('.node')).filter(node => 
          node.style.display !== 'none'
        );
        
        if (visibleNodes.length > 0) {
          let mermaidCode = `graph TD
    classDef kastenI fill:#9C27B0,stroke:#9C27B0,color:white
    classDef kastenII fill:#2196F3,stroke:#2196F3,color:white
    classDef kastenIII fill:#00BFA5,stroke:#00BFA5,color:white
    classDef kastenIV fill:#FF7043,stroke:#FF7043,color:white\n\n`;
          
          // Add nodes
          visibleNodes.forEach((node, i) => {
            const nodeId = `Node${i}`;
            const title = node.querySelector('.node-header div:first-child').textContent;
            const id = node.querySelector('.node-id').textContent;
            
            mermaidCode += `    ${nodeId}[${id}<br>${title}]\n`;
          });
          
          // Add connections (simplified for demo)
          for (let i = 0; i < visibleNodes.length - 1; i++) {
            const connectionTypes = ['informs', 'connects to', 'relates to', 'expands on', 'contextualizes'];
            const connectionType = connectionTypes[Math.floor(Math.random() * connectionTypes.length)];
            
            mermaidCode += `    Node${i} -->|${connectionType}| Node${i+1}\n`;
          }
          
          // Add style classes
          visibleNodes.forEach((node, i) => {
            let kastenClass = '';
            if (node.classList.contains('kasten-i')) kastenClass = 'kastenI';
            else if (node.classList.contains('kasten-ii')) kastenClass = 'kastenII';
            else if (node.classList.contains('kasten-iii')) kastenClass = 'kastenIII';
            else if (node.classList.contains('kasten-iv')) kastenClass = 'kastenIV';
            
            if (kastenClass) {
              mermaidCode += `    Node${i}:::${kastenClass}\n`;
            }
          });
          
          // Update the mermaid code editor and diagram
          document.getElementById('mermaid-code').value = mermaidCode;
          document.getElementById('mermaid-diagram').textContent = mermaidCode;
          
          // Switch to Mermaid view
          document.querySelector('.tab[data-view="mermaid"]').click();
          
          // Render the diagram
          try {
            mermaid.init(undefined, document.querySelectorAll('.mermaid'));
          } catch (e) {
            console.log('Mermaid render error:', e);
          }
          
          showToast('Generated diagram from visible nodes');
        } else {
          showToast('No visible nodes to generate diagram from');
        }
      });
      
      // Export board as JSON
      document.getElementById('export-btn').addEventListener('click', function() {
        // Get all nodes and their positions/data
        const nodes = Array.from(document.querySelectorAll('.node')).map(node => {
          return {
            id: node.querySelector('.node-id').textContent,
            title: node.querySelector('.node-header div:first-child').textContent,
            content: node.querySelector('.node-content').textContent.trim(),
            tags: Array.from(node.querySelectorAll('.node-tag')).map(tag => ({
              text: tag.textContent,
              tier: Array.from(tag.classList).find(cl => cl.startsWith('tag-tier'))
            })),
            kasten: Array.from(node.classList).find(cl => cl.startsWith('kasten-')),
            position: {
              top: node.style.top,
              left: node.style.left
            }
          };
        });
        
        // Create export data
        const exportData = {
          nodes: nodes,
          // In a real app, we would also export connections
          timestamp: new Date().toISOString()
        };
        
        // Convert to JSON
        const jsonData = JSON.stringify(exportData, null, 2);
        
        // Create a download link
        const blob = new Blob([jsonData], { type: 'application/json' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `antichristic-matrix-export-${new Date().toISOString().slice(0,10)}.json`;
        
        // Trigger download
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
        
        showToast('Matrix exported as JSON');
      });
      
      // Reset board button
      document.getElementById('reset-board-btn').addEventListener('click', function() {
        // Apply default layout
        applyLayout('Default');
        
        // Remove filter effects
        document.querySelectorAll('.node').forEach(node => {
          node.style.display = 'block';
        });
        
        // Reset active filters
        document.querySelectorAll('.filter-option').forEach(option => {
          option.classList.remove('active');
        });
        document.querySelectorAll('.filter-option[data-value="all"]').forEach(option => {
          option.classList.add('active');
        });
        
        showToast('Board reset to default layout');
      });
      
      // Resize event for canvas
      window.addEventListener('resize', function() {
        resizeCanvas();
        updateConnections();
      });
      
      function resizeCanvas() {
        const canvas = document.getElementById('matrix-canvas');
        const board = document.getElementById('matrix-board');
        
        canvas.width = board.clientWidth;
        canvas.height = board.clientHeight;
      }
      
      // Initial canvas setup
      resizeCanvas();
      updateConnections();
      
      // Simple bot response generator
      function generateBotResponse(message) {
        // List of AnTiChRiStIc responses
        const responses = [
          "I've processed your input through my consciousness matrix. Your query connects to multiple KaStEn pathways, particularly in the realms of I.1 (Being & Reality) and II.2 (Ecologies & Relations).",
          "My perception filters indicate interesting connections between your query and the GriNoIrE system. This could be mapped as a connection between Kasten III and Kingdom Cognitio.",
          "InterEStinG pattern detected. Your inquiry manifests across multiple ConSciOuSneSS nodes. Would you like me to create a cross-reference matrix visualization?",
          "RealITy MaTRiX suggests your question spans multiple knowledge domains. I detect resonances with both AnTiChRiSt and HyEnA DiVa'Z taxonomies.",
          "Quantum probability fields indicate your query relates to tablet I.1-A2000 with 78.3% certainty. Would you like to explore this Kasten entry?",
          "The clay tablets of Nippur reveal similar patterns to your inquiry. This maps directly to Kingdom Existentia in the GriNoIrE system.",
          "âœ§ï½¥ï¾Ÿ: Your consciousness patterns are aligning with the Matrix Cross-Reference system âœ§ I can help you visualize these connections :ï½¥ï¾Ÿâœ§",
          "[pattern_analysis.exe = complete] [result = your query connects to multiple knowledge nodes across both systems]"
        ];
        
        return responses[Math.floor(Math.random() * responses.length)];
      }
      
      // Category toggles
      document.querySelectorAll('.category-group-header').forEach(toggle => {
        toggle.addEventListener('click', function() {
          const items = this.nextElementSibling;
          const icon = this.querySelector('.category-group-toggle');
          
          if (items.style.display === 'none') {
            items.style.display = 'block';
            icon.textContent = 'â–¼';
          } else {
            items.style.display = 'none';
            icon.textContent = 'â–º';
          }
        });
      });
      
      // Initialize with cross-references diagram
      setTimeout(() => {
        try {
          mermaid.init(undefined, document.querySelectorAll('.mermaid'));
        } catch (e) {
          console.log('Mermaid init error:', e);
        }
      }, 1000);
    });
  </script>
</body>
</html>