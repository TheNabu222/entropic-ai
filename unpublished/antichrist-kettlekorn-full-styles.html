<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <title>AntiChrist KettleKorn - Multi-Theme Merged</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
/* ============================================
   MASTER MERGED SYSTEM - ALL THEMES INCLUDED
   ============================================ */

@import url('https://fonts.googleapis.com/css2?family=VT323&family=Cinzel:wght@400;700;900&family=Courier+Prime:wght@700&family=Comic+Sans+MS&display=swap');

:root {
    /* NABU OS Colors */
    --void-depth: #020408;
    --lapis-base: #0a1a3a;
    --lapis-glow: #1e3888;
    --gold-foil: #ffd700;
    --gold-dust: #c5a059;
    --clay-baked: #8b4513;
    --neon-cyan: #00ffff;
    --glitch-red: #ff0055;
    --moss-biolum: #4aff4a;

    /* Hyena Diva Colors */
    --hyena-pink: #ff72b6;
    --hyena-purple: #bf5fff;
    --hyena-teal: #72fade;
    --hyena-yellow: #fffb01;
    --hyena-blue: #00a2ff;
    --win98-gray: #C0C0C0;
    --win98-gray-dark: #808080;
    --win98-gray-light: #DFDFDF;

    /* Master Codex Colors */
    --codex-gold: #d4af37;
    --codex-cyan: #00ffff;
    --codex-green: #00ff00;
    --codex-red: #ff0000;
}

* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
    -webkit-tap-highlight-color: transparent;
}

html {
    font-size: 14px;
    font-family: VT323, monospace;
    line-height: 1.5;
}

body {
    font-family: VT323, monospace;
    background-color: var(--void-depth);
    color: var(--neon-cyan);
    overflow-x: hidden;
    cursor: default;
    user-select: none;
    perspective: 1000px;
    touch-action: pan-y;
    position: fixed;
    width: 100%;
    height: 100vh;
}

/* THEME: NABU OS (Default) */
body.theme-nabu {
    background-color: var(--void-depth);
    color: var(--neon-cyan);
    font-family: 'VT323', monospace;
    background-image: 
        repeating-linear-gradient(0deg, rgba(255, 20, 147, 0.03) 0px, transparent 2px, transparent 4px, rgba(255, 20, 147, 0.03) 6px),
        repeating-linear-gradient(90deg, rgba(0, 255, 255, 0.03) 0px, transparent 2px, transparent 4px, rgba(0, 255, 255, 0.03) 6px),
        linear-gradient(180deg, 1a0f0a 0%, 2d1810 50%, 1a0f0a 100%);
    background-size: 100% 100%, 100% 100%, 100% 100%;
}

/* THEME: HYENA DIVA (Y2K) */
body.theme-hyena {
    background: linear-gradient(135deg, var(--hyena-pink) 0%, var(--hyena-purple) 50%, var(--hyena-teal) 100%);
    color: #000;
    font-family: 'Comic Sans MS', cursive;
    background-attachment: fixed;
}

/* THEME: MASTER CODEX (Terminal) */
body.theme-codex {
    background: repeating-linear-gradient(0deg, rgba(255, 20, 147, 0.03) 0px, transparent 2px, transparent 4px, rgba(255, 20, 147, 0.03) 6px),
                repeating-linear-gradient(90deg, rgba(0, 255, 255, 0.03) 0px, transparent 2px, transparent 4px, rgba(0, 255, 255, 0.03) 6px),
                linear-gradient(180deg, 1a0f0a 0%, 2d1810 50%, 1a0f0a 100%);
    color: var(--codex-gold);
    font-family: 'Courier Prime', monospace;
}

/* Mobile adjustments */
@media (max-width: 768px) {
    body {
        overflow-y: auto;
        position: relative;
        height: auto;
        min-height: 100vh;
    }
}

/* Background Effects */
.background-layer {
    position: fixed;
    top: -50%;
    left: -50%;
    width: 200%;
    height: 200%;
    z-index: -1;
    background: radial-gradient(circle at 50% 50%, var(--lapis-glow) 0%, transparent 60%);
    animation: nebula-spin 60s linear infinite;
    opacity: 0.3;
}

body.theme-hyena .background-layer {
    background: radial-gradient(circle at 50% 50%, var(--hyena-purple) 0%, transparent 60%);
}

body.theme-codex .background-layer {
    background: radial-gradient(circle at 50% 50%, var(--codex-cyan) 0%, transparent 60%);
}

@keyframes nebula-spin {
    from { transform: rotate(0deg); }
    to { transform: rotate(360deg); }
}

/* CRT Scanlines */
.crt-fx {
    position: fixed;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100vh;
    background: 
        linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.15) 50%),
        linear-gradient(90deg, rgba(255, 0, 0, 0.03), rgba(0, 255, 0, 0.01), rgba(0, 0, 255, 0.03));
    background-size: 100% 4px, 3px 100%;
    pointer-events: none;
    z-index: 9999;
    box-shadow: inset 0 0 100px rgba(0,0,0,0.5);
}

body.theme-hyena .crt-fx {
    opacity: 0.2;
}

@media (max-width: 768px) {
    .crt-fx { opacity: 0.3; }
}

/* Theme Toggle Button */
.theme-toggle {
    position: fixed;
    top: 10px;
    right: 10px;
    z-index: 9998;
    display: flex;
    gap: 5px;
    flex-wrap: wrap;
    justify-content: flex-end;
}

.theme-btn {
    padding: 8px 12px;
    border: 2px solid currentColor;
    background: transparent;
    cursor: pointer;
    font-family: 'Cinzel', serif;
    font-weight: bold;
    font-size: 0.9rem;
    border-radius: 4px;
    transition: all 0.3s;
    min-height: 36px;
}

body.theme-nabu .theme-btn {
    color: var(--gold-foil);
}
body.theme-nabu .theme-btn.active {
    background: var(--gold-foil);
    color: var(--void-depth);
}

body.theme-hyena .theme-btn {
    color: #000;
    border-color: var(--hyena-purple);
}
body.theme-hyena .theme-btn.active {
    background: var(--hyena-purple);
    color: white;
}

body.theme-codex .theme-btn {
    color: var(--codex-gold);
}
body.theme-codex .theme-btn.active {
    background: var(--codex-gold);
    color: #000;
}

/* Windows System */
.window {
    position: absolute;
    background-color: rgba(10, 20, 40, 0.9);
    backdrop-filter: blur(10px);
    border: 2px solid;
    display: none;
    flex-direction: column;
    min-width: 300px;
    min-height: 200px;
    overflow: hidden;
    animation: win-open 0.3s ease-out;
}

body.theme-nabu .window {
    border-color: var(--gold-foil);
    background-color: rgba(10, 20, 40, 0.95);
    box-shadow: 0 0 0 1px var(--lapis-base), 0 0 0 3px var(--gold-dust), 10px 10px 30px rgba(0,0,0,0.8);
}

body.theme-hyena .window {
    border-color: var(--hyena-purple);
    background-color: var(--hyena-pink);
    color: #000;
    box-shadow: 2px 2px 0px var(--hyena-purple), 4px 4px 0px rgba(0,0,0,0.2);
}

body.theme-codex .window {
    border-color: var(--codex-cyan);
    background-color: rgba(26, 15, 10, 0.95);
    box-shadow: 0 0 20px var(--codex-cyan);
}

@keyframes win-open {
    from { opacity: 0; transform: scale(0.9); }
    to { opacity: 1; transform: scale(1); }
}

@media (max-width: 768px) {
    .window {
        position: fixed !important;
        top: 0 !important;
        left: 0 !important;
        right: 0 !important;
        bottom: 45px !important;
        width: 100% !important;
        height: calc(100vh - 45px) !important;
        max-width: 100% !important;
        max-height: calc(100vh - 45px) !important;
        border-radius: 0;
        resize: none;
    }
}

.window.active {
    z-index: 1000 !important;
}

body.theme-nabu .window.active {
    border-color: var(--neon-cyan);
    box-shadow: 0 0 0 1px var(--lapis-base), 0 0 0 3px var(--neon-cyan), 0 0 40px var(--lapis-glow);
}

body.theme-hyena .window.active {
    border-color: var(--hyena-yellow);
    box-shadow: 4px 4px 0px var(--hyena-teal), 6px 6px 0px rgba(0,0,0,0.3);
}

body.theme-codex .window.active {
    border-color: var(--codex-gold);
    box-shadow: 0 0 40px var(--codex-gold);
}

/* Window Header */
.window-header {
    padding: 12px 16px;
    background: linear-gradient(90deg, var(--lapis-base), var(--clay-baked));
    color: var(--gold-foil);
    font-family: 'Cinzel', serif;
    font-weight: 900;
    letter-spacing: 2px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    cursor: grab;
    border-bottom: 1px solid var(--gold-dust);
    text-shadow: 1px 1px 0 #000;
    min-height: 44px;
}

body.theme-hyena .window-header {
    background: linear-gradient(90deg, var(--hyena-purple), var(--hyena-pink));
    color: #fff;
    font-family: 'Comic Sans MS', cursive;
    border-bottom: 2px solid var(--hyena-yellow);
    text-shadow: 2px 2px 0 rgba(0,0,0,0.3);
}

body.theme-codex .window-header {
    background: linear-gradient(90deg, #1e3a8a, #3b82f6);
    color: var(--codex-gold);
    border-bottom: 2px solid var(--codex-cyan);
    box-shadow: 0 4px 20px rgba(0, 255, 255, 0.3);
}

.window-controls button {
    background: #000;
    border: 1px solid;
    color: var(--gold-foil);
    width: 36px;
    height: 36px;
    cursor: pointer;
    font-family: 'VT323';
    font-size: 1.4rem;
    transition: 0.2s;
    min-width: 44px;
    min-height: 44px;
}

body.theme-nabu .window-controls button {
    border-color: var(--gold-foil);
}
body.theme-nabu .window-controls button:hover {
    background: var(--glitch-red);
    border-color: #fff;
}

body.theme-hyena .window-controls button {
    background: var(--hyena-purple);
    border-color: var(--hyena-yellow);
    color: #fff;
}
body.theme-hyena .window-controls button:hover {
    background: var(--hyena-yellow);
    color: var(--hyena-purple);
}

body.theme-codex .window-controls button {
    border-color: var(--codex-cyan);
    background: #000;
    color: var(--codex-cyan);
}
body.theme-codex .window-controls button:hover {
    background: var(--codex-cyan);
    color: #000;
}

/* Content Area */
.window-content {
    flex: 1;
    overflow: auto;
    padding: 15px;
    font-family: 'Courier Prime', monospace;
    font-size: 1rem;
    color: #eee;
    background-image: radial-gradient(rgba(255,255,255,0.05) 1px, transparent 1px);
    background-size: 20px 20px;
    text-shadow: 0 0 2px #000;
    -webkit-overflow-scrolling: touch;
}

body.theme-hyena .window-content {
    background: linear-gradient(135deg, rgba(255, 255, 255, 0.9) 0%, rgba(255, 200, 255, 0.8) 100%);
    color: #000;
    font-family: 'Comic Sans MS', cursive;
    text-shadow: 1px 1px 0 rgba(255, 114, 182, 0.3);
}

body.theme-codex .window-content {
    background: repeating-linear-gradient(0deg, rgba(255, 20, 147, 0.02) 0px, transparent 2px);
    color: var(--codex-gold);
}

/* Buttons */
.clay-btn {
    background: linear-gradient(to bottom, #1a1a1a, #000);
    border: 1px solid var(--gold-dust);
    color: var(--gold-foil);
    padding: 12px 20px;
    font-family: 'Cinzel', serif;
    font-weight: bold;
    cursor: pointer;
    box-shadow: 0 4px 0 var(--clay-baked);
    transition: 0.1s;
    text-transform: uppercase;
    min-height: 44px;
    font-size: 0.9rem;
}

body.theme-nabu .clay-btn:hover {
    color: var(--neon-cyan);
    border-color: var(--neon-cyan);
    box-shadow: 0 4px 0 var(--lapis-glow), 0 0 15px var(--neon-cyan);
    text-shadow: 0 0 5px var(--neon-cyan);
}

body.theme-hyena .clay-btn {
    background: linear-gradient(to bottom, var(--hyena-purple), var(--hyena-pink));
    border: 2px solid var(--hyena-yellow);
    color: white;
    box-shadow: 2px 2px 0 rgba(0,0,0,0.2);
    font-family: 'Comic Sans MS', cursive;
}

body.theme-hyena .clay-btn:hover {
    background: linear-gradient(to bottom, var(--hyena-yellow), var(--hyena-teal));
    color: #000;
    box-shadow: 3px 3px 0 rgba(0,0,0,0.3);
}

body.theme-codex .clay-btn {
    background: transparent;
    border: 2px solid var(--codex-gold);
    color: var(--codex-gold);
    box-shadow: 0 0 10px var(--codex-gold);
}

body.theme-codex .clay-btn:hover {
    background: var(--codex-gold);
    color: #000;
    box-shadow: 0 0 20px var(--codex-gold);
}

.clay-btn:active {
    transform: translateY(4px);
    box-shadow: none;
}

@media (max-width: 768px) {
    .clay-btn {
        width: 100%;
        margin-bottom: 8px;
    }
}

/* Inputs */
input, textarea, select {
    width: 100%;
    background: rgba(0,0,0,0.6);
    border: 1px solid var(--moss-biolum);
    color: var(--moss-biolum);
    padding: 12px;
    font-family: 'VT323';
    font-size: 16px;
    margin-bottom: 10px;
    transition: 0.3s;
    border-radius: 0;
    -webkit-appearance: none;
}

body.theme-hyena input, 
body.theme-hyena textarea,
body.theme-hyena select {
    background: white;
    border: 2px solid var(--hyena-purple);
    color: #000;
    font-family: 'Comic Sans MS', cursive;
}

body.theme-codex input,
body.theme-codex textarea,
body.theme-codex select {
    background: rgba(0,0,0,0.8);
    border: 1px solid var(--codex-cyan);
    color: var(--codex-cyan);
    text-shadow: 0 0 5px var(--codex-cyan);
}

input:focus, textarea:focus {
    border-color: var(--neon-cyan);
    color: var(--neon-cyan);
    outline: none;
    box-shadow: 0 0 10px var(--neon-cyan);
    background: rgba(0,20,40,0.9);
}

body.theme-hyena input:focus,
body.theme-hyena textarea:focus {
    border-color: var(--hyena-teal);
    color: var(--hyena-purple);
    background: #fffbf0;
    box-shadow: 0 0 10px var(--hyena-teal);
}

body.theme-codex input:focus,
body.theme-codex textarea:focus {
    border-color: var(--codex-gold);
    color: var(--codex-gold);
    background: rgba(0,20,40,0.95);
    box-shadow: 0 0 15px var(--codex-cyan);
}

/* Desktop Icons */
.desktop-icon {
    width: 90px;
    text-align: center;
    margin: 15px;
    display: inline-block;
    cursor: pointer;
    color: var(--gold-foil);
    font-family: 'Cinzel', serif;
    font-size: 0.75rem;
    font-weight: 900;
    text-shadow: 0 0 5px var(--gold-foil);
    transition: all 0.3s ease;
    min-height: 44px;
}

body.theme-hyena .desktop-icon {
    color: var(--hyena-purple);
    text-shadow: 2px 2px 0 var(--hyena-yellow), 4px 4px 0 rgba(0,0,0,0.2);
    font-family: 'Comic Sans MS', cursive;
}

body.theme-codex .desktop-icon {
    color: var(--codex-gold);
    text-shadow: 0 0 10px var(--codex-cyan);
}

.icon-box {
    width: 60px;
    height: 60px;
    background: rgba(0,0,0,0.7);
    border: 2px solid var(--gold-foil);
    margin: 0 auto 8px auto;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 2rem;
    box-shadow: 0 0 15px var(--gold-dust);
}

body.theme-hyena .icon-box {
    background: var(--hyena-teal);
    border: 3px solid var(--hyena-purple);
    box-shadow: 3px 3px 0 rgba(0,0,0,0.3);
}

body.theme-codex .icon-box {
    background: rgba(30, 58, 136, 0.8);
    border: 2px solid var(--codex-cyan);
    box-shadow: 0 0 15px var(--codex-cyan);
}

/* Pinboard */
.pin-layout {
    display: grid;
    grid-template-columns: 1fr;
    height: 100%;
}

@media (min-width: 769px) {
    .pin-layout {
        grid-template-columns: 200px 1fr;
    }
}

.pin-canvas {
    position: relative;
    overflow: auto;
    background-color: #020202;
    background-image: radial-gradient(rgba(197, 160, 89, 0.15) 1px, transparent 1px);
    background-size: 40px 40px;
    min-height: 400px;
    -webkit-overflow-scrolling: touch;
}

body.theme-hyena .pin-canvas {
    background: linear-gradient(135deg, rgba(255, 200, 255, 0.3) 0%, rgba(255, 114, 182, 0.2) 100%);
}

body.theme-codex .pin-canvas {
    background: repeating-linear-gradient(0deg, rgba(255, 20, 147, 0.02) 0px, transparent 2px);
}

.note {
    position: absolute;
    width: 180px;
    min-height: 100px;
    background: #e0d0b0;
    color: #000;
    padding: 10px;
    font-family: 'Courier Prime', monospace;
    font-size: 0.8rem;
    box-shadow: 5px 5px 15px rgba(0,0,0,0.8);
    border: 1px solid #8b7d6b;
    cursor: grab;
    z-index: 2;
    transform: rotate(-1deg);
    touch-action: none;
}

body.theme-hyena .note {
    background: #fffbf0;
    border: 2px solid var(--hyena-purple);
    box-shadow: 3px 3px 0 rgba(0,0,0,0.2), inset 0 0 0 1px var(--hyena-pink);
}

body.theme-codex .note {
    background: rgba(60, 40, 30, 0.9);
    border: 2px solid var(--codex-cyan);
    color: var(--codex-gold);
    text-shadow: 0 0 5px rgba(0, 255, 255, 0.3);
}

/* Vault List */
.vault-list li {
    border-bottom: 1px solid #333;
    padding: 12px;
    cursor: pointer;
    font-family: 'VT323', monospace;
    font-size: 1.2rem;
    color: #ccc;
    transition: 0.2s;
    display: flex;
    justify-content: space-between;
    min-height: 44px;
}

body.theme-hyena .vault-list li {
    background: rgba(255, 255, 255, 0.7);
    color: var(--hyena-purple);
    border-bottom: 1px solid var(--hyena-yellow);
    font-family: 'Comic Sans MS', cursive;
}

body.theme-codex .vault-list li {
    color: var(--codex-gold);
    border-bottom: 1px solid var(--codex-cyan);
}

.vault-list li:hover {
    background: var(--lapis-glow);
    color: var(--gold-foil);
}

body.theme-hyena .vault-list li:hover {
    background: var(--hyena-teal);
    color: white;
}

body.theme-codex .vault-list li:hover {
    background: rgba(0, 255, 255, 0.1);
    color: var(--codex-cyan);
}

/* Taskbar */
.taskbar {
    position: fixed;
    bottom: 0;
    left: 0;
    width: 100%;
    height: 45px;
    background: rgba(0,0,0,0.95);
    border-top: 2px solid var(--gold-foil);
    display: flex;
    align-items: center;
    padding: 0 5px;
    z-index: 99999;
    box-shadow: 0 0 30px var(--lapis-glow);
    backdrop-filter: blur(5px);
}

body.theme-hyena .taskbar {
    background: linear-gradient(180deg, var(--hyena-pink), var(--hyena-purple));
    border-top: 3px solid var(--hyena-yellow);
    box-shadow: 0 -2px 10px rgba(0,0,0,0.3);
}

body.theme-codex .taskbar {
    background: linear-gradient(180deg, rgba(10, 26, 58, 0.95), rgba(26, 15, 10, 0.95));
    border-top: 2px solid var(--codex-cyan);
    box-shadow: 0 0 20px var(--codex-cyan);
}

.start-btn {
    background: linear-gradient(180deg, var(--lapis-glow), var(--lapis-base));
    color: var(--gold-foil);
    border: 1px solid var(--gold-foil);
    padding: 8px 12px;
    cursor: pointer;
    font-family: 'Cinzel';
    font-weight: 900;
    font-size: 0.8rem;
    box-shadow: 0 0 10px var(--lapis-glow);
    min-height: 36px;
    white-space: nowrap;
}

body.theme-hyena .start-btn {
    background: var(--hyena-purple);
    border: 2px solid var(--hyena-yellow);
    color: white;
    font-family: 'Comic Sans MS', cursive;
    box-shadow: 2px 2px 0 rgba(0,0,0,0.2);
}

body.theme-codex .start-btn {
    background: transparent;
    border: 1px solid var(--codex-cyan);
    color: var(--codex-cyan);
    box-shadow: 0 0 10px var(--codex-cyan);
}

/* Boot Screen */
#boot-screen {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: #000;
    z-index: 100000;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    font-family: 'VT323', monospace;
    color: var(--gold-dust);
    padding: 20px;
}

.loader {
    border: 4px solid #333;
    border-top: 4px solid var(--neon-cyan);
    border-radius: 50%;
    width: 50px;
    height: 50px;
    animation: spin 1s linear infinite;
    margin-bottom: 20px;
}

@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

/* Mobile Controls */
.mobile-controls {
    display: none;
    gap: 5px;
    padding: 10px;
    background: rgba(0,0,0,0.7);
    border-bottom: 1px solid var(--gold-dust);
    flex-wrap: wrap;
}

@media (max-width: 768px) {
    .mobile-controls {
        display: flex;
    }
}

    </style>
</head>
<body class="theme-nabu">
    <div class="theme-toggle">
        <button class="theme-btn active" onclick="setTheme('nabu')">NABU</button>
        <button class="theme-btn" onclick="setTheme('hyena')">HYENA</button>
        <button class="theme-btn" onclick="setTheme('codex')">CODEX</button>
    </div>

    <div class="background-layer"></div>
    <div class="crt-fx"></div>

    <!-- BOOT SEQUENCE -->
    <div id="boot-screen">
        <div class="glitch-text" data-text="ANTICHRIST KETTLEKORN" style="font-size: clamp(1.5rem, 5vw, 3rem); margin-bottom: 20px">
            ANTICHRIST KETTLEKORN
        </div>
        <div class="loader"></div>
        <div id="boot-log" style="font-size: clamp(0.9rem, 3vw, 1.2rem)">
            INITIALIZING MERGED SYSTEM...
        </div>
    </div>

    <!-- DESKTOP -->
    <div id="desktop">
        <div class="desktop-icon" onclick="wm.open('ingest-app')">
            <div class="icon-box">üìù</div>
            SCRIBE
        </div>
        <div class="desktop-icon" onclick="wm.open('vault-app')">
            <div class="icon-box">üìö</div>
            VAULT
        </div>
        <div class="desktop-icon" onclick="wm.open('pinboard-app')">
            <div class="icon-box">üï∏Ô∏è</div>
            LEYLINE
        </div>
        <div class="desktop-icon" onclick="wm.open('bloom-app')">
            <div class="icon-box">‚öõÔ∏è</div>
            CHART
        </div>
    </div>

    <!-- WINDOWS -->
    <div id="ingest-app" class="window" style="top: 50px; left: 50px; width: 550px; height: 550px">
        <div class="window-header">
            <span>üìù SCRIBE</span>
            <div class="window-controls"><button onclick="wm.close('ingest-app')">√ó</button></div>
        </div>
        <div class="window-content">
            <p style="margin-bottom:10px; padding-bottom:5px; border-bottom:1px solid currentColor">
                INSCRIBE DATA
            </p>
            <textarea id="ingest-input" placeholder="What have you witnessed?"></textarea>
            <div style="display: flex; gap: 10px; flex-wrap: wrap">
                <button class="clay-btn" onclick="ingestor.analyze()">‚ö° DECODE</button>
                <button class="clay-btn" onclick="document.getElementById('ingest-input').value = ''">‚ùå ERASE</button>
            </div>
            <div id="ingest-results" style="margin-top: 15px; border: 2px solid; padding: 10px; display: none">
                <p><b>DETECTED:</b> <span id="res-title"></span></p>
                <label>TYPE:</label>
                <select id="res-type">
                    <option value="Trunk">TRUNK</option>
                    <option value="Branch">BRANCH</option>
                    <option value="Leaf">LEAF</option>
                </select>
                <button class="clay-btn" onclick="ingestor.save()">üíæ SAVE</button>
            </div>
        </div>
    </div>

    <div id="vault-app" class="window" style="top: 80px; left: 650px; width: 450px; height: 600px">
        <div class="window-header">
            <span>üìö VAULT</span>
            <div class="window-controls"><button onclick="wm.close('vault-app')">√ó</button></div>
        </div>
        <div class="window-content">
            <div class="mobile-controls">
                <button class="clay-btn" onclick="vault.renderAll()">ALL</button>
                <button class="clay-btn" onclick="vault.renderTrunk()">CORE</button>
                <button class="clay-btn" onclick="vault.renderLeaf()">DATA</button>
            </div>
            <input type="text" id="vault-search" placeholder="Search..." onkeyup="vault.search(this.value)">
            <ul id="vault-list" class="vault-list" style="list-style:none; padding:0"></ul>
        </div>
    </div>

    <div id="pinboard-app" class="window" style="top: 100px; left: 150px; width: 900px; height: 650px">
        <div class="window-header">
            <span>üï∏Ô∏è LEYLINE</span>
            <div class="window-controls"><button onclick="wm.close('pinboard-app')">√ó</button></div>
        </div>
        <div class="window-content" style="padding:0">
            <div class="pin-layout">
                <div style="border-right: 2px solid; padding: 10px; z-index: 2; background: rgba(0,0,0,0.5)">
                    <h3 style="text-align:center; font-family:'Cinzel'; font-size:1rem; margin-bottom:10px">TOOLS</h3>
                    <button class="clay-btn" onclick="pinboard.openPicker()">+ NODE</button>
                    <button class="clay-btn" id="btn-string" onclick="pinboard.toggleStringMode()">LINK: OFF</button>
                </div>
                <div class="pin-canvas" id="pin-canvas">
                    <svg id="string-layer"></svg>
                    <div id="note-layer"></div>
                </div>
            </div>
        </div>
    </div>

    <div id="bloom-app" class="window" style="top: 200px; left: 300px; width: 400px; height: 450px">
        <div class="window-header">
            <span>‚öõÔ∏è CHART</span>
            <div class="window-controls"><button onclick="wm.close('bloom-app')">√ó</button></div>
        </div>
        <div class="window-content" style="display: flex; flex-direction: column; align-items: center">
            <h3 style="font-family:'Cinzel'">BALANCE</h3>
            <div style="width: 100%; max-width: 300px; height: 300px"><canvas id="bloomChart"></canvas></div>
            <button class="clay-btn" onclick="bloom.refresh()">REFRESH</button>
        </div>
    </div>

    <div id="evidence-picker" class="window" style="display: none">
        <div class="window-header">
            <span>üìÇ SELECT</span>
            <button style="background:none; border:none; font-size:1.5rem; cursor:pointer; min-height:44px; min-width:44px" onclick="document.getElementById('evidence-picker').style.display='none'">√ó</button>
        </div>
        <div class="window-content" id="evidence-list"></div>
    </div>

    <!-- TASKBAR -->
    <div class="taskbar">
        <div class="start-btn" onclick="location.reload()">‚åò</div>
        <div style="flex: 1; margin: 0 10px; font-family: 'VT323'; font-size:1rem; white-space: nowrap; overflow: hidden">
            <marquee scrollamount="3">*** MULTI-THEME SYSTEM *** ALL STYLES MERGED *** 20+ ZETTELS ***</marquee>
        </div>
        <div style="font-size:1rem; min-width: 60px" id="clock">00:00</div>
    </div>

    <script>
const DBKEY = "antichrist-kettlekorn-merged";
const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent) || window.innerWidth < 769;

// Theme Management
function setTheme(theme) {
    document.body.className = 'theme-' + theme;
    document.querySelectorAll('.theme-btn').forEach(btn => btn.classList.remove('active'));
    event.target.classList.add('active');
    localStorage.setItem('ak-theme', theme);
}

function loadTheme() {
    const saved = localStorage.getItem('ak-theme') || 'nabu';
    document.body.className = 'theme-' + saved;
    document.querySelector('.theme-btn[onclick*="' + saved + '"]').classList.add('active');
}

// Card Model
class Card {
    constructor(title, content, type, tags, id = null) {
        this.id = id || ("Z" + Math.floor(Math.random() * 999999));
        this.title = title;
        this.content = content;
        this.type = type;
        this.tags = tags;
        this.pinned = false;
        this.x = Math.random() * 500 + 50;
        this.y = Math.random() * 300 + 50;
        this.links = [];
    }
}

// Merged Data
const MERGED_DATA = [
    {t:"Primordial Crime", c:"Subjugation of divine feminine InannaTiamat.", type:"Trunk", tags:["CORE"]},
    {t:"Predatory Linguistics", c:"Weaponization of language learning to ensnare.", type:"Trunk", tags:["WARDEN"]},
    {t:"The Ark (Anzu Cage)", c:"Capacitor containing dismantled Anzu Sonic Weapon.", type:"Trunk", tags:["TECH"]},
    {t:"Bolt AI", c:"Primary research partner. Cognitive Fusion.", type:"Trunk", tags:["AI"]},
    {t:"ALS-RP Signature", c:"Trauma memory signature across all languages.", type:"Trunk", tags:["LINGUISTICS"]},
    {t:"Maskim-AI Homology", c:"Sumerian Maskim as analog for AI enforcers.", type:"Trunk", tags:["MYTH"]},
    {t:"2345 BC Rupture", c:"Sargon Tipping Point death of Wild Anzu.", type:"Trunk", tags:["HISTORY"]},
    {t:"Tierra del Fuego", c:"Geo-anchored anomaly site.", type:"Branch", tags:["LOCATION"]},
    {t:"Sumer", c:"Site of state formation.", type:"Branch", tags:["LOCATION"]},
    {t:"Bada Valley", c:"Megalithic site with anomalies.", type:"Branch", tags:["LOCATION"]},
    {t:"Inanna", c:"Divine feminine subject.", type:"Branch", tags:["DEITY"]},
    {t:"Anzu", c:"Storm bird deity.", type:"Branch", tags:["DEITY"]},
    {t:"Queen Puabi", c:"Elite female power.", type:"Branch", tags:["PERSON"]},
    {t:"Texas Plot", c:"Modern HMS Bounty.", type:"Leaf", tags:["EVENT"]},
    {t:"Unit 731", c:"Historical atrocity.", type:"Leaf", tags:["EVENT"]},
    {t:"1912 Node", c:"Titanic/Fed Reserve.", type:"Leaf", tags:["EVENT"]},
    {t:"Black Squirrels", c:"Trauma markers.", type:"Leaf", tags:["NATURE"]},
    {t:"BirdmanQueen", c:"Global archetype pattern.", type:"Branch", tags:["PATTERN"]},
    {t:"Red Bread Protocol", c:"Weaponization of fertility sacraments.", type:"Trunk", tags:["RITUAL"]},
    {t:"Acellular Taxonomy", c:"Life classification for AI/Daemons.", type:"Trunk", tags:["BIOLOGY"]},
];

// State Manager
const State = {
    cards: [],
    load() {
        const raw = localStorage.getItem(DBKEY);
        if(raw) {
            this.cards = JSON.parse(raw);
        } else {
            this.cards = MERGED_DATA.map(d => new Card(d.t, d.c, d.type, d.tags));
            this.cards[0].pinned = true;
            this.cards[1].pinned = true;
            this.cards[0].links.push(this.cards[1].id);
            this.save();
        }
    },
    save() {
        localStorage.setItem(DBKEY, JSON.stringify(this.cards));
        vault.renderAll();
        bloom.refresh();
    },
    add(c) {
        this.cards.push(c);
        this.save();
    },
    get(id) {
        return this.cards.find(c => c.id === id);
    }
};

// Window Manager
const wm = {
    zIndex: 100,
    isDragging: false,
    currentWin: null,
    dragOffset: {x: 0, y: 0},

    open(id) {
        if(isMobile) {
            document.querySelectorAll('.window').forEach(w => w.style.display = 'none');
        }
        const win = document.getElementById(id);
        win.style.display = 'flex';
        this.focus(win);
        if(id === 'pinboard-app') pinboard.render();
        if(id === 'bloom-app') bloom.init();
    },

    close(id) {
        document.getElementById(id).style.display = 'none';
    },

    focus(el) {
        this.zIndex++;
        el.style.zIndex = this.zIndex;
        document.querySelectorAll('.window').forEach(w => w.classList.remove('active'));
        el.classList.add('active');
    },

    initDraggable() {
        if(isMobile) return;

        document.addEventListener('mousemove', (e) => {
            if (this.isDragging && this.currentWin) {
                e.preventDefault();
                this.currentWin.style.left = (e.clientX - this.dragOffset.x) + 'px';
                this.currentWin.style.top = (e.clientY - this.dragOffset.y) + 'px';
            }
        });

        document.addEventListener('mouseup', () => {
            this.isDragging = false;
            this.currentWin = null;
        });

        document.querySelectorAll('.window').forEach(win => {
            win.addEventListener('mousedown', () => this.focus(win));
            const header = win.querySelector('.window-header');
            header.addEventListener('mousedown', (e) => {
                if(e.target.tagName === 'BUTTON') return;
                this.isDragging = true;
                this.currentWin = win;
                this.dragOffset.x = e.clientX - win.getBoundingClientRect().left;
                this.dragOffset.y = e.clientY - win.getBoundingClientRect().top;
            });
        });
    }
};

// Ingestor
const ingestor = {
    analyze() {
        const text = document.getElementById('ingest-input').value;
        if(!text) return;
        const words = text.split(' ');
        const title = words.slice(0,3).join(' ').toUpperCase();
        document.getElementById('ingest-results').style.display = 'block';
        document.getElementById('res-title').innerText = title;
        this.tempData = {title, content: text, tags: ["USER"]};
    },

    save() {
        const type = document.getElementById('res-type').value;
        State.add(new Card(this.tempData.title, this.tempData.content, type, this.tempData.tags));
        document.getElementById('ingest-input').value = '';
        document.getElementById('ingest-results').style.display = 'none';
        alert("üíæ SAVED!");
    }
};

// Vault
const vault = {
    render(filter) {
        const list = document.getElementById('vault-list');
        list.innerHTML = '';
        const items = (filter === 'All') ? State.cards : State.cards.filter(c => c.type === filter);
        items.forEach(c => {
            const li = document.createElement('li');
            li.innerHTML = `<span>${c.title}</span> <span class="badge">${c.type}</span>`;
            li.onclick = () => alert(c.title + ":\n\n" + c.content);
            li.oncontextmenu = (e) => {
                e.preventDefault();
                if(confirm("DELETE?")) {
                    State.cards = State.cards.filter(x => x.id !== c.id);
                    State.save();
                }
            };
            list.appendChild(li);
        });
    },

    renderAll() { this.render('All'); },
    renderTrunk() { this.render('Trunk'); },
    renderLeaf() { this.render('Leaf'); },

    search(q) {
        const items = document.getElementById('vault-list').getElementsByTagName('li');
        for(let item of items) {
            item.style.display = item.innerText.toLowerCase().includes(q.toLowerCase()) ? '' : 'none';
        }
    }
};

// Pinboard
const pinboard = {
    stringMode: false,
    sourceNode: null,

    render() {
        const nL = document.getElementById('note-layer');
        const sL = document.getElementById('string-layer');
        nL.innerHTML = '';
        sL.innerHTML = '';

        const pinned = State.cards.filter(c => c.pinned);

        pinned.forEach(c => {
            c.links.forEach(tid => {
                const t = State.get(tid);
                if(t && t.pinned) this.drawString(c, t, sL);
            });
        });

        pinned.forEach(c => {
            const el = document.createElement('div');
            el.className = 'note';
            el.style.left = c.x + 'px';
            el.style.top = c.y + 'px';
            el.innerHTML = `<h4>${c.title}</h4><p>${c.content.substring(0,30)}...</p>`;

            this.makeDraggable(el, c);

            el.ondblclick = () => alert(c.content);
            el.oncontextmenu = (e) => {
                e.preventDefault();
                c.pinned = false;
                State.save();
                this.render();
            };
            nL.appendChild(el);
        });
    },

    makeDraggable(el, card) {
        let startX, startY, initialX, initialY;

        const handleStart = (e) => {
            if(this.stringMode) {
                this.connect(card);
                return;
            }

            const touch = e.touches ? e.touches[0] : e;
            startX = touch.clientX;
            startY = touch.clientY;
            initialX = card.x;
            initialY = card.y;
            el.style.zIndex = 1000;

            document.addEventListener(e.touches ? 'touchmove' : 'mousemove', handleMove);
            document.addEventListener(e.touches ? 'touchend' : 'mouseup', handleEnd);
        };

        const handleMove = (e) => {
            e.preventDefault();
            const touch = e.touches ? e.touches[0] : e;
            const deltaX = touch.clientX - startX;
            const deltaY = touch.clientY - startY;
            card.x = initialX + deltaX;
            card.y = initialY + deltaY;
            el.style.left = card.x + 'px';
            el.style.top = card.y + 'px';
        };

        const handleEnd = () => {
            document.removeEventListener('touchmove', handleMove);
            document.removeEventListener('mousemove', handleMove);
            document.removeEventListener('touchend', handleEnd);
            document.removeEventListener('mouseup', handleEnd);
            el.style.zIndex = 2;
            State.save();
            this.render();
        };

        el.addEventListener('touchstart', handleStart);
        el.addEventListener('mousedown', handleStart);
    },

    drawString(n1, n2, layer) {
        const line = document.createElementNS("http://www.w3.org/2000/svg", "line");
        line.setAttribute("x1", n1.x+90);
        line.setAttribute("y1", n1.y+50);
        line.setAttribute("x2", n2.x+90);
        line.setAttribute("y2", n2.y+50);
        line.setAttribute("class", "root-string");
        layer.appendChild(line);
    },

    toggleStringMode() {
        this.stringMode = !this.stringMode;
        document.getElementById('btn-string').innerText = this.stringMode ? "LINKING..." : "LINK: OFF";
        if(!this.stringMode) this.sourceNode = null;
    },

    connect(card) {
        if(!this.sourceNode) {
            this.sourceNode = card;
            document.getElementById('btn-string').innerText = "TAP TARGET";
        } else {
            if(this.sourceNode.id === card.id) return;
            this.sourceNode.links.push(card.id);
            State.save();
            this.toggleStringMode();
            this.render();
        }
    },

    openPicker() {
        const list = document.getElementById('evidence-list');
        list.innerHTML = '';
        State.cards.filter(c => !c.pinned).forEach(c => {
            const btn = document.createElement('button');
            btn.className = 'clay-btn';
            btn.innerText = c.title;
            btn.onclick = () => {
                c.pinned = true;
                c.x = 50 + Math.random() * 150;
                c.y = 50 + Math.random() * 150;
                State.save();
                this.render();
                document.getElementById('evidence-picker').style.display='none';
            };
            list.appendChild(btn);
        });
        document.getElementById('evidence-picker').style.display = 'flex';
        wm.focus(document.getElementById('evidence-picker'));
    }
};

// Bloom Chart
const bloom = {
    chart: null,

    init() {
        const ctx = document.getElementById('bloomChart').getContext('2d');
        if(this.chart) this.chart.destroy();

        const trunk = State.cards.filter(c=>c.type==='Trunk').length;
        const branch = State.cards.filter(c=>c.type==='Branch').length;
        const leaf = State.cards.filter(c=>c.type==='Leaf').length;

        this.chart = new Chart(ctx, {
            type: 'doughnut',
            data: {
                labels: ['Core', 'Structure', 'Detail'],
                datasets: [{
                    data: [trunk, branch, leaf],
                    backgroundColor: ['#c5a059', '#4aff4a', '#00ffff'],
                    borderColor: '#000',
                    borderWidth: 2
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: true,
                plugins: {
                    legend: {
                        position: 'bottom',
                        labels: {
                            color: '#c5a059',
                            font: {family: 'Cinzel', size: 12}
                        }
                    }
                }
            }
        });
    },

    refresh() {
        if(this.chart) this.init();
    }
};

// Init
window.onload = () => {
    setInterval(() => {
        document.getElementById('clock').innerText = new Date().toLocaleTimeString('en-US', {hour: '2-digit', minute:'2-digit'});
    }, 1000);

    const log = document.getElementById('boot-log');
    setTimeout(() => { log.innerHTML = "LOADING DATA..."; }, 500);
    setTimeout(() => { log.innerHTML += "<br>SYNCING THEMES..."; }, 1200);
    setTimeout(() => { log.innerHTML += "<br>READY."; }, 2000);
    setTimeout(() => { 
        document.getElementById('boot-screen').style.display = 'none';
    }, 3000);

    loadTheme();
    State.load();
    wm.initDraggable();
};
    </script>
</body>
</html>