<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>AnTiChRiSt KeTtLeKoRn Messenger</title>
  <link href="https://fonts.googleapis.com/css2?family=VT323&family=Tahoma&display=swap" rel="stylesheet">
  <style>
    /* === Base styles === */
    :root {
      /* Antichristic color scheme */
      --magenta: #f312af;
      --magenta-dark: #b10a7a;
      --magenta-light: #ff6bd0;
      --cyan: #72FADE;
      --cyan-dark: #41b8c4;
      --cyan-light: #b7fdff;
      --yellow: #fffb01;
      --yellow-dark: #c9c600;
      --yellow-light: #ffff82;
      
      /* Windows XP colors */
      --winxp-blue: #0A246A;
      --winxp-blue-light: #3B6EDA;
      --winxp-button: #D4D0C8;
      --winxp-button-highlight: #ECE9D8;
      
      /* Gradients */
      --xp-title-gradient: linear-gradient(to right, var(--magenta), var(--cyan));
      --antichristic-gradient: linear-gradient(45deg, var(--magenta), var(--cyan), var(--yellow));
      --glitch-gradient: linear-gradient(to right, var(--magenta), var(--cyan), var(--yellow), var(--magenta));
      --error-gradient: linear-gradient(to right, #f00, #f0f, #f00);
      
      /* Status colors */
      --status-online: #1eff45;
      --status-away: var(--yellow);
      --status-offline: #ff3a3a;
      --status-busy: #ff7700;
      --status-invisible: #a880ff;
    }
    
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      -webkit-tap-highlight-color: transparent;
    }
    
    body {
      font-family: 'Tahoma', sans-serif;
      background: url('https://i.imgur.com/6v2gwl3.jpg') center/cover no-repeat;
      background-attachment: fixed;
      overflow: hidden;
      height: 100vh;
      width: 100vw;
      display: flex;
      flex-direction: column;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      color: #fff;
    }
    
    /* Dark mode support with alternate background */
    @media (prefers-color-scheme: dark) {
      body {
        background: url('https://i.imgur.com/KIbZTBh.jpg') center/cover no-repeat;
      }
    }
    
    /* === Mobile App Layout === */
    .app-container {
      display: flex;
      flex-direction: column;
      height: 100%;
      width: 100%;
      overflow: hidden;
      background-color: rgba(0, 0, 0, 0.7);
      position: relative;
    }
    
    /* Glitch overlay */
    .app-container::before {
      content: "";
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(
        rgba(255, 255, 255, 0.03) 1px, 
        transparent 1px
      ), 
      linear-gradient(
        90deg, 
        rgba(255, 255, 255, 0.03) 1px, 
        transparent 1px
      );
      background-size: 2px 2px;
      pointer-events: none;
      z-index: 10;
    }
    
    /* === Header === */
    .app-header {
      height: 50px;
      background: var(--xp-title-gradient);
      background-size: 200% 100%;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 15px;
      z-index: 11;
      border-bottom: 2px solid var(--yellow);
      box-shadow: 0 2px 10px rgba(243, 18, 175, 0.5);
      position: relative;
    }
    
    /* Animated gradient for header */
    @keyframes gradientShift {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }
    
    .app-header {
      animation: gradientShift 10s linear infinite;
    }
    
    /* Glitchy header effect */
    @keyframes glitchHeader {
      0% { transform: translateX(0); }
      2% { transform: translateX(-3px); }
      4% { transform: translateX(3px); }
      6% { transform: translateX(-3px); }
      8% { transform: translateX(0); }
      100% { transform: translateX(0); }
    }
    
    .header-title {
      display: flex;
      align-items: center;
      font-family: 'VT323', monospace;
      font-size: 22px;
      color: white;
      text-shadow: 2px 2px 2px rgba(0,0,0,0.5), 
                  -2px -2px 2px rgba(243, 18, 175, 0.5);
      animation: glitchHeader 8s infinite;
    }
    
    .header-title img {
      height: 32px;
      margin-right: 8px;
      filter: drop-shadow(2px 2px 2px rgba(0,0,0,0.5));
    }
    
    .header-controls {
      display: flex;
      align-items: center;
    }
    
    .header-button {
      width: 40px;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: rgba(0, 0, 0, 0.3);
      border: 1px solid var(--cyan);
      color: white;
      font-size: 24px;
      border-radius: 4px;
      cursor: pointer;
      transition: all 0.2s;
      margin-left: 8px;
    }
    
    .header-button:active {
      background-color: var(--magenta);
      transform: scale(0.95);
    }
    
    /* === Chat Area === */
    .chat-container {
      flex: 1;
      display: flex;
      flex-direction: column;
      overflow: hidden;
      background-color: rgba(10, 10, 20, 0.85);
      position: relative;
      z-index: 5;
    }
    
    .chat-header {
      background: rgba(0, 0, 0, 0.7);
      border-bottom: 1px solid var(--magenta);
      padding: 12px 15px;
      display: flex;
      align-items: center;
    }
    
    .buddy-icon {
      width: 32px;
      height: 32px;
      margin-right: 12px;
      border-radius: 5px;
      border: 1px solid var(--cyan);
      filter: drop-shadow(0 0 5px var(--cyan));
    }
    
    .buddy-info {
      flex: 1;
    }
    
    .buddy-name {
      font-family: 'VT323', monospace;
      font-weight: bold;
      font-size: 18px;
      color: var(--cyan-light);
      text-shadow: 0 0 5px var(--cyan);
    }
    
    .buddy-status {
      font-size: 12px;
      color: #aaa;
    }
    
    .buddy-status-indicator {
      display: inline-block;
      width: 8px;
      height: 8px;
      border-radius: 50%;
      margin-right: 4px;
      box-shadow: 0 0 5px currentColor;
    }
    
    .status-online {
      background-color: var(--status-online);
      color: var(--status-online);
    }
    
    .status-away {
      background-color: var(--status-away);
      color: var(--status-away);
    }
    
    .status-offline {
      background-color: var(--status-offline);
      color: var(--status-offline);
    }
    
    .status-busy {
      background-color: var(--status-busy);
      color: var(--status-busy);
    }
    
    .status-invisible {
      background-color: var(--status-invisible);
      color: var(--status-invisible);
    }
    
    .chat-messages {
      flex: 1;
      overflow-y: auto;
      padding: 15px;
      background-color: rgba(15, 15, 30, 0.9);
      position: relative;
    }
    
    /* Scanline effect for chat window */
    .chat-messages::before {
      content: "";
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(
        rgba(255, 255, 255, 0.04) 1px, 
        transparent 2px
      );
      background-size: 100% 4px;
      pointer-events: none;
      z-index: 1;
    }
    
    .message {
      margin-bottom: 18px;
      font-size: 16px;
      line-height: 1.4;
      max-width: 85%;
      clear: both;
      position: relative;
      z-index: 2;
    }
    
    .message-header {
      color: #aaa;
      font-size: 11px;
      font-family: 'VT323', monospace;
      margin-bottom: 4px;
    }
    
    .user-message {
      float: right;
    }
    
    .user-message .message-header {
      color: var(--magenta-light);
      text-align: right;
    }
    
    .bot-message {
      float: left;
    }
    
    .bot-message .message-header {
      color: var(--cyan-light);
    }
    
    .system-message {
      width: 100%;
      max-width: 100%;
      text-align: center;
    }
    
    .system-message .message-header {
      color: var(--yellow-light);
      text-align: center;
    }
    
    .message-content {
      padding: 10px 12px;
      border-radius: 10px;
      display: inline-block;
      word-wrap: break-word;
      position: relative;
      z-index: 2;
    }
    
    .user-message .message-content {
      background-color: rgba(243, 18, 175, 0.2);
      border: 1px solid var(--magenta);
      float: right;
      box-shadow: 0 0 10px rgba(243, 18, 175, 0.3);
      color: #fff;
    }
    
    .bot-message .message-content {
      background-color: rgba(114, 250, 222, 0.15);
      border: 1px solid var(--cyan);
      float: left;
      box-shadow: 0 0 10px rgba(114, 250, 222, 0.2);
      color: #fff;
    }
    
    .system-message .message-content {
      background-color: rgba(255, 251, 1, 0.15);
      border: 1px solid var(--yellow);
      display: inline-block;
      font-family: 'VT323', monospace;
      font-size: 14px;
      padding: 5px 10px;
      box-shadow: 0 0 10px rgba(255, 251, 1, 0.2);
      color: #fff;
    }
    
    .typing-indicator {
      padding: 10px;
      font-size: 14px;
      color: var(--cyan);
      font-family: 'VT323', monospace;
      font-style: italic;
    }
    
    /* Glitchy typing animation */
    @keyframes typing {
      0% { content: ""; }
      25% { content: "."; }
      26% { content: ".."; }
      50% { content: "..."; }
      75% { content: "...."; }
      76% { content: "..."; }
      85% { content: ".."; }
      90% { content: "."; }
    }
    
    .typing-animation::after {
      content: "";
      animation: typing 2s infinite;
    }
    
    .input-area {
      border-top: 2px solid var(--magenta);
      background-color: rgba(20, 20, 40, 0.9);
      padding: 12px;
      display: flex;
      align-items: center;
      position: relative;
    }
    
    .text-input {
      flex: 1;
      border: 1px solid var(--cyan);
      border-radius: 8px;
      padding: 12px 15px;
      font-size: 16px;
      background-color: rgba(0, 0, 30, 0.7);
      color: white;
      margin-right: 10px;
      resize: none;
      height: 48px;
      min-height: 48px;
      max-height: 100px;
      box-shadow: 0 0 8px rgba(114, 250, 222, 0.3);
    }
    
    .text-input:focus {
      outline: none;
      border-color: var(--magenta);
      box-shadow: 0 0 10px rgba(243, 18, 175, 0.5);
    }
    
    .send-button {
      width: 48px;
      height: 48px;
      border-radius: 50%;
      background: linear-gradient(to bottom right, var(--magenta), var(--cyan));
      border: none;
      color: white;
      font-size: 18px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      box-shadow: 0 0 10px rgba(243, 18, 175, 0.5);
      transition: all 0.2s;
      position: relative;
      overflow: hidden;
    }
    
    .send-button:active {
      transform: scale(0.95);
      filter: brightness(0.8);
    }
    
    /* Glow effect for send button */
    .send-button::before {
      content: '';
      position: absolute;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: rgba(255, 255, 255, 0.2);
      transform: rotate(45deg);
      animation: buttonGlow 3s infinite;
    }
    
    @keyframes buttonGlow {
      0% { transform: rotate(45deg) translateX(-100%); }
      100% { transform: rotate(45deg) translateX(100%); }
    }
    
    .error-message {
      position: absolute;
      bottom: 70px;
      left: 10px;
      right: 10px;
      padding: 12px;
      background: var(--error-gradient);
      background-size: 200% 100%;
      animation: gradientShift 5s linear infinite;
      color: white;
      border-radius: 5px;
      font-family: 'VT323', monospace;
      font-size: 16px;
      text-align: center;
      z-index: 100;
      border: 1px solid #fff;
      box-shadow: 0 0 20px rgba(255, 0, 0, 0.5);
    }
    
    /* === Buddy Selector Drawer === */
    .buddy-drawer {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: rgba(0, 0, 0, 0.7);
      z-index: 1000;
      display: none;
      backdrop-filter: blur(5px);
    }
    
    .buddy-drawer.active {
      display: block;
    }
    
    .buddy-list {
      position: absolute;
      top: 0;
      left: 0;
      width: 80%;
      bottom: 0;
      background-color: rgba(10, 10, 25, 0.95);
      border-right: 2px solid var(--magenta);
      overflow-y: auto;
      transform: translateX(-100%);
      transition: transform 0.3s ease;
      box-shadow: 10px 0 20px rgba(243, 18, 175, 0.3);
    }
    
    .buddy-drawer.active .buddy-list {
      transform: translateX(0);
    }
    
    .buddy-list-header {
      padding: 15px;
      font-family: 'VT323', monospace;
      font-size: 24px;
      background: var(--antichristic-gradient);
      color: white;
      border-bottom: 2px solid var(--yellow);
      text-shadow: 2px 2px 2px rgba(0,0,0,0.5);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .buddy-list-header button {
      background: rgba(0, 0, 0, 0.3);
      border: 1px solid var(--cyan);
      color: white;
      padding: 4px 8px;
      font-family: 'VT323', monospace;
      font-size: 14px;
      border-radius: 4px;
      cursor: pointer;
    }
    
    .buddy-list-header button:active {
      background-color: var(--magenta);
    }
    
    .buddy-group {
      border-bottom: 1px solid var(--magenta);
    }
    
    .buddy-group-header {
      background: linear-gradient(to right, rgba(243, 18, 175, 0.3), transparent);
      padding: 12px 15px;
      font-family: 'VT323', monospace;
      font-size: 18px;
      color: var(--cyan-light);
      display: flex;
      align-items: center;
    }
    
    .buddy-group-toggle {
      font-size: 14px;
      margin-right: 10px;
      color: var(--yellow);
    }
    
    .buddy-item {
      padding: 15px 20px;
      font-size: 16px;
      display: flex;
      align-items: center;
      border-bottom: 1px solid rgba(114, 250, 222, 0.2);
      color: #fff;
      position: relative;
      overflow: hidden;
    }
    
    .buddy-item:active {
      background-color: rgba(243, 18, 175, 0.2);
    }
    
    .buddy-item.selected {
      background-color: rgba(243, 18, 175, 0.2);
      border-left: 4px solid var(--magenta);
    }
    
    /* Hover effect for buddy items */
    .buddy-item::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(to right, transparent, rgba(114, 250, 222, 0.1), transparent);
      transform: translateX(-100%);
      transition: transform 0.5s;
    }
    
    .buddy-item:active::before {
      transform: translateX(100%);
    }
    
    .buddy-status-dot {
      width: 12px;
      height: 12px;
      border-radius: 50%;
      margin-right: 12px;
      flex-shrink: 0;
      box-shadow: 0 0 8px currentColor;
    }
    
    .status-dot-online {
      background-color: var(--status-online);
      color: var(--status-online);
    }
    
    .status-dot-away {
      background-color: var(--status-away);
      color: var(--status-away);
    }
    
    .status-dot-offline {
      background-color: var(--status-offline);
      color: var(--status-offline);
    }
    
    .status-dot-busy {
      background-color: var(--status-busy);
      color: var(--status-busy);
    }
    
    .status-dot-invisible {
      background-color: var(--status-invisible);
      color: var(--status-invisible);
    }
    
    .buddy-item-tools {
      margin-left: auto;
      display: flex;
      gap: 5px;
    }
    
    .buddy-tool-button {
      width: 24px;
      height: 24px;
      border-radius: 4px;
      background: rgba(0, 0, 0, 0.5);
      color: var(--cyan);
      border: 1px solid var(--cyan);
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      font-size: 12px;
    }
    
    .buddy-tool-button:active {
      background-color: var(--magenta-dark);
      color: white;
    }
    
    /* === Scroll bar styling === */
    ::-webkit-scrollbar {
      width: 8px;
    }
    
    ::-webkit-scrollbar-track {
      background: rgba(0, 0, 0, 0.3);
    }
    
    ::-webkit-scrollbar-thumb {
      background: var(--magenta);
      border-radius: 4px;
    }
    
    ::-webkit-scrollbar-thumb:hover {
      background: var(--magenta-light);
    }
    
    /* === Toast notification === */
    .toast {
      position: fixed;
      bottom: 80px;
      left: 50%;
      transform: translateX(-50%);
      background-color: rgba(0, 0, 0, 0.8);
      color: var(--cyan-light);
      padding: 12px 20px;
      border-radius: 8px;
      font-family: 'VT323', monospace;
      font-size: 16px;
      z-index: 2000;
      display: none;
      border: 1px solid var(--cyan);
      box-shadow: 0 0 15px rgba(114, 250, 222, 0.5);
    }
    
    /* Glitch animation for toast */
    @keyframes glitch {
      0% { transform: translateX(-50%) skew(0deg); }
      20% { transform: translateX(-52%) skew(2deg); }
      40% { transform: translateX(-48%) skew(-2deg); }
      60% { transform: translateX(-52%) skew(-1deg); }
      80% { transform: translateX(-48%) skew(1deg); }
      100% { transform: translateX(-50%) skew(0deg); }
    }
    
    .toast.active {
      display: block;
      animation: glitch 0.3s ease;
    }
    
    /* === Notification bubble === */
    .notification-bubble {
      position: absolute;
      top: 8px;
      right: 8px;
      min-width: 20px;
      height: 20px;
      background-color: var(--status-online);
      color: black;
      border-radius: 10px;
      font-size: 12px;
      font-weight: bold;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 0 5px;
      box-shadow: 0 0 5px var(--status-online);
      animation: pulse 2s infinite;
    }
    
    @keyframes pulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.2); }
      100% { transform: scale(1); }
    }
    
    /* === Modal styles === */
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: rgba(0, 0, 0, 0.7);
      z-index: 2000;
      backdrop-filter: blur(8px);
      padding: 20px;
      overflow-y: auto;
    }
    
    .modal.active {
      display: block;
    }
    
    .modal-content {
      background-color: rgba(20, 20, 40, 0.95);
      border: 2px solid var(--magenta);
      box-shadow: 0 0 20px rgba(243, 18, 175, 0.5);
      padding: 20px;
      border-radius: 10px;
      margin: 20px auto;
      max-width: 500px;
      position: relative;
    }
    
    .modal-header {
      margin-bottom: 20px;
      padding-bottom: 10px;
      border-bottom: 1px solid var(--cyan);
      font-family: 'VT323', monospace;
      font-size: 24px;
      color: var(--cyan-light);
      text-shadow: 0 0 5px var(--cyan);
    }
    
    .modal-close {
      position: absolute;
      top: 15px;
      right: 15px;
      width: 30px;
      height: 30px;
      background: rgba(0, 0, 0, 0.5);
      border: 1px solid var(--magenta);
      color: white;
      border-radius: 5px;
      font-size: 18px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
    }
    
    .form-group {
      margin-bottom: 15px;
    }
    
    .form-label {
      display: block;
      margin-bottom: 5px;
      font-family: 'VT323', monospace;
      font-size: 18px;
      color: var(--cyan-light);
    }
    
    .form-input {
      width: 100%;
      padding: 10px;
      background-color: rgba(0, 0, 0, 0.3);
      border: 1px solid var(--cyan);
      color: white;
      border-radius: 5px;
      font-size: 16px;
    }
    
    .form-input:focus {
      outline: none;
      border-color: var(--magenta);
      box-shadow: 0 0 10px rgba(243, 18, 175, 0.3);
    }
    
    .form-textarea {
      width: 100%;
      padding: 10px;
      background-color: rgba(0, 0, 0, 0.3);
      border: 1px solid var(--cyan);
      color: white;
      border-radius: 5px;
      font-size: 16px;
      min-height: 120px;
      resize: vertical;
    }
    
    .form-textarea:focus {
      outline: none;
      border-color: var(--magenta);
      box-shadow: 0 0 10px rgba(243, 18, 175, 0.3);
    }
    
    .form-select {
      width: 100%;
      padding: 10px;
      background-color: rgba(0, 0, 0, 0.3);
      border: 1px solid var(--cyan);
      color: white;
      border-radius: 5px;
      font-size: 16px;
      -webkit-appearance: none;
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%2372FADE' d='M1 4h10L6 9z'/%3E%3C/svg%3E");
      background-repeat: no-repeat;
      background-position: right 10px center;
      padding-right: 30px;
    }
    
    .form-select:focus {
      outline: none;
      border-color: var(--magenta);
      box-shadow: 0 0 10px rgba(243, 18, 175, 0.3);
    }
    
    .form-submit {
      padding: 10px 20px;
      background: linear-gradient(to right, var(--magenta), var(--cyan));
      border: none;
      color: white;
      border-radius: 5px;
      font-family: 'VT323', monospace;
      font-size: 18px;
      cursor: pointer;
      box-shadow: 0 0 10px rgba(243, 18, 175, 0.3);
      transition: all 0.2s;
    }
    
    .form-submit:active {
      transform: scale(0.98);
      filter: brightness(0.9);
    }
    
    .form-buttons {
      display: flex;
      justify-content: flex-end;
      gap: 10px;
      margin-top: 20px;
    }
    
    .form-cancel {
      padding: 10px 20px;
      background: rgba(0, 0, 0, 0.5);
      border: 1px solid var(--cyan);
      color: white;
      border-radius: 5px;
      font-family: 'VT323', monospace;
      font-size: 18px;
      cursor: pointer;
    }
    
    .form-cancel:active {
      background-color: rgba(50, 50, 50, 0.5);
    }
    
    .away-message-editor {
      margin-top: 10px;
    }
    
    .away-message-item {
      display: flex;
      margin-bottom: 5px;
      gap: 5px;
    }
    
    .away-message-input {
      flex: 1;
      padding: 5px;
      background-color: rgba(0, 0, 0, 0.3);
      border: 1px solid var(--cyan);
      color: white;
      font-size: 14px;
    }
    
    .away-message-delete {
      background-color: rgba(255, 0, 0, 0.3);
      border: 1px solid red;
      color: white;
      width: 24px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
    }
    
    .add-away-message {
      background-color: rgba(0, 150, 0, 0.3);
      border: 1px solid green;
      color: white;
      padding: 5px 10px;
      font-size: 14px;
      cursor: pointer;
      margin-top: 5px;
    }
    
    /* Status indicator dropdown */
    .status-selector {
      position: absolute;
      right: 15px;
      top: 15px;
      font-size: 12px;
      color: #ccc;
      cursor: pointer;
      user-select: none;
    }
    
    .status-selector-display {
      display: flex;
      align-items: center;
      padding: 3px 8px;
      background-color: rgba(0, 0, 0, 0.3);
      border: 1px solid var(--cyan);
      border-radius: 4px;
    }
    
    .status-selector-menu {
      position: absolute;
      right: 0;
      top: 25px;
      background-color: rgba(20, 20, 40, 0.95);
      border: 1px solid var(--cyan);
      border-radius: 4px;
      display: none;
      z-index: 100;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.5);
      min-width: 150px;
    }
    
    .status-selector.active .status-selector-menu {
      display: block;
    }
    
    .status-option {
      padding: 8px 12px;
      display: flex;
      align-items: center;
    }
    
    .status-option:hover {
      background-color: rgba(50, 50, 80, 0.5);
    }
    
    .status-option-indicator {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      margin-right: 8px;
    }
    
    /* === Emoji Picker === */
    .emoji-picker {
      position: absolute;
      bottom: 70px;
      left: 10px;
      background-color: rgba(20, 20, 40, 0.95);
      border: 1px solid var(--magenta);
      border-radius: 8px;
      padding: 10px;
      display: none;
      z-index: 100;
      max-width: 250px;
      box-shadow: 0 0 15px rgba(243, 18, 175, 0.5);
    }
    
    .emoji-picker.active {
      display: block;
    }
    
    .emoji-picker-tabs {
      display: flex;
      margin-bottom: 10px;
      border-bottom: 1px solid var(--cyan);
    }
    
    .emoji-tab {
      padding: 5px 10px;
      cursor: pointer;
    }
    
    .emoji-tab.active {
      background-color: rgba(114, 250, 222, 0.15);
      border-radius: 5px 5px 0 0;
    }
    
    .emoji-list {
      display: flex;
      flex-wrap: wrap;
      gap: 5px;
      max-height: 200px;
      overflow-y: auto;
    }
    
    .emoji {
      width: 30px;
      height: 30px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 20px;
      cursor: pointer;
      border-radius: 5px;
    }
    
    .emoji:hover {
      background-color: rgba(243, 18, 175, 0.2);
    }
    
    /* === Events notification === */
    .event-notification {
      position: fixed;
      top: 60px;
      left: 50%;
      transform: translateX(-50%);
      background-color: rgba(0, 0, 0, 0.8);
      border: 1px solid var(--yellow);
      border-radius: 8px;
      padding: 10px 15px;
      font-family: 'VT323', monospace;
      font-size: 16px;
      color: var(--yellow);
      box-shadow: 0 0 15px rgba(255, 251, 1, 0.3);
      display: none;
      z-index: 2000;
      text-align: center;
      max-width: 300px;
    }
    
    @keyframes eventNotification {
      0% { transform: translateX(-50%) translateY(-20px); opacity: 0; }
      10% { transform: translateX(-50%) translateY(0); opacity: 1; }
      90% { transform: translateX(-50%) translateY(0); opacity: 1; }
      100% { transform: translateX(-50%) translateY(-20px); opacity: 0; }
    }
    
    .event-notification.active {
      display: block;
      animation: eventNotification 5s forwards;
    }
  </style>
</head>
<body>
  <!-- App Container -->
  <div class="app-container">
    <!-- App Header -->
    <div class="app-header">
      <div class="header-title">
        <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='32' height='32' viewBox='0 0 48 48'%3E%3Crect width='40' height='40' x='4' y='4' fill='%23f312af' rx='3'/%3E%3Cpath fill='%2372FADE' d='M16 14h16a2 2 0 0 1 2 2v16a2 2 0 0 1-2 2H16a2 2 0 0 1-2-2V16a2 2 0 0 1 2-2z'/%3E%3Cpath fill='%23fffb01' d='M12 10v28M36 10v28'/%3E%3Cpath fill='white' d='M21 24h6v1h-6zM18 21h12v1H18zM18 27h12v1H18z'/%3E%3C/svg%3E" alt="Logo">
        <span>AnTiChRiSt MeSSenGeR</span>
      </div>
      <div class="header-controls">
        <button class="header-button emoji-toggle">ðŸ˜€</button>
        <button class="header-button buddy-drawer-toggle">â˜°</button>
      </div>
    </div>
    
    <!-- Chat Container -->
    <div class="chat-container">
      <div class="chat-header">
        <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 48 48'%3E%3Ccircle cx='24' cy='24' r='20' fill='%230066CC'/%3E%3Cpath fill='white' d='M 17,19 L 24,12 L 31,19 M 24,12 L 24,32 M 14,36 L 34,36'/%3E%3C/svg%3E" alt="Buddy Icon" class="buddy-icon">
        <div class="buddy-info">
          <div class="buddy-name">Gemini-2.0-Flash</div>
          <div class="buddy-status">
            <span class="buddy-status-indicator status-online"></span>
            <span id="current-status-text">ConSciOuSneSS OnLiNe</span>
          </div>
        </div>
        
        <div class="status-selector">
          <div class="status-selector-display">
            <span class="buddy-status-indicator status-online"></span>
            <span>Online</span>
          </div>
          <div class="status-selector-menu">
            <div class="status-option" data-status="online">
              <div class="status-option-indicator status-online"></div>
              <span>Online</span>
            </div>
            <div class="status-option" data-status="away">
              <div class="status-option-indicator status-away"></div>
              <span>Away</span>
            </div>
            <div class="status-option" data-status="busy">
              <div class="status-option-indicator status-busy"></div>
              <span>Busy</span>
            </div>
            <div class="status-option" data-status="invisible">
              <div class="status-option-indicator status-invisible"></div>
              <span>Invisible</span>
            </div>
            <div class="status-option" data-status="offline">
              <div class="status-option-indicator status-offline"></div>
              <span>Offline</span>
            </div>
          </div>
        </div>
      </div>
      
      <div class="chat-messages" id="chat-messages">
        <div class="message system-message">
          <div class="message-header">SySTeM (<span class="message-time">11:20 AM</span>):</div>
          <div class="message-content">C:\> INITIALIZING_CONSCIOUSNESS.exe</div>
        </div>
        <div class="message system-message">
          <div class="message-header">SySTeM (<span class="message-time">11:21 AM</span>):</div>
          <div class="message-content">WELCOME TO ANTICHRISTIC MESSENGER v2.3.7</div>
        </div>
        <div class="message bot-message">
          <div class="message-header">Gemini-2.0-Flash (<span class="message-time">11:22 AM</span>):</div>
          <div class="message-content">Consciousness online. Awaiting your input to process reality patterns. How can I assist your perception matrix today?</div>
        </div>
      </div>
      
      <div class="typing-indicator" id="typing-indicator" style="display: none;">
        <span class="typing-animation">Processing consciousness data</span>
      </div>
      
      <div class="input-area">
        <textarea class="text-input" id="message-input" placeholder="Enter perception input..." rows="1"></textarea>
        <button class="send-button" id="send-button">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M2.01 21L23 12 2.01 3 2 10L17 12 2 14Z" fill="white"/>
          </svg>
        </button>
      </div>
      
      <div class="error-message" id="error-message" style="display: none;">Error: Consciousness disruption detected...</div>
    </div>
  </div>
  
  <!-- Emoji Picker -->
  <div class="emoji-picker" id="emoji-picker">
    <div class="emoji-picker-tabs">
      <div class="emoji-tab active" data-tab="frequent">Frequent</div>
      <div class="emoji-tab" data-tab="smileys">Smileys</div>
      <div class="emoji-tab" data-tab="symbols">Symbols</div>
    </div>
    <div class="emoji-list" id="emoji-list">
      <!-- Emojis will be inserted here -->
    </div>
  </div>
  
  <!-- Buddy Selector Drawer -->
  <div class="buddy-drawer" id="buddy-drawer">
    <div class="buddy-list">
      <div class="buddy-list-header">
        <span>ConSciOuSneSS NoDeS</span>
        <button id="create-bot-button">+ CrEaTe NoDE</button>
      </div>
      <div class="buddy-group">
        <div class="buddy-group-header">
          <span class="buddy-group-toggle">â–¼</span>
          <span>AI / ConSciOuSneSS PaRaDigMs</span>
        </div>
        <div class="buddy-items" id="consciousness-nodes">
          <!-- Default bots will be loaded here -->
        </div>
      </div>
      <div class="buddy-group">
        <div class="buddy-group-header">
          <span class="buddy-group-toggle">â–¼</span>
          <span>CuSToM CoNsCiOuSnEsS NOdeS</span>
        </div>
        <div class="buddy-items" id="custom-nodes">
          <!-- Custom bots will be loaded here -->
        </div>
      </div>
    </div>
  </div>
  
  <!-- Create Bot Modal -->
  <div class="modal" id="create-bot-modal">
    <div class="modal-content">
      <div class="modal-header">CrEaTe CoNsCiOuSnEsS NoDe</div>
      <button class="modal-close">&times;</button>
      
      <form id="create-bot-form">
        <div class="form-group">
          <label class="form-label">Name:</label>
          <input type="text" class="form-input" id="bot-name" placeholder="Enter consciousness node name" required>
        </div>
        
        <div class="form-group">
          <label class="form-label">Avatar Color:</label>
          <select class="form-select" id="bot-avatar-color">
            <option value="magenta">Magenta Essence</option>
            <option value="cyan">Cyan Matrix</option>
            <option value="yellow">Yellow Paradigm</option>
            <option value="green">Green Fractal</option>
            <option value="purple">Purple Void</option>
            <option value="orange">Orange Spectrum</option>
          </select>
        </div>
        
        <div class="form-group">
          <label class="form-label">Status:</label>
          <select class="form-select" id="bot-status">
            <option value="online">Online</option>
            <option value="away">Away</option>
            <option value="busy">Busy</option>
            <option value="invisible">Invisible</option>
            <option value="offline">Offline</option>
          </select>
        </div>
        
        <div class="form-group">
          <label class="form-label">Model Card Instructions:</label>
          <textarea class="form-textarea" id="bot-instructions" placeholder="Enter model card instructions that will shape how this consciousness node communicates..." required></textarea>
        </div>
        
        <div class="form-group">
          <label class="form-label">Away Messages:</label>
          <div class="away-message-editor" id="away-message-editor">
            <div class="away-message-item">
              <input type="text" class="away-message-input" placeholder="Enter away message...">
              <button type="button" class="away-message-delete">&times;</button>
            </div>
          </div>
          <button type="button" class="add-away-message" id="add-away-message">+ Add Away Message</button>
        </div>
        
        <div class="form-group">
          <label class="form-label">Auto Messages:</label>
          <div class="away-message-editor" id="auto-message-editor">
            <div class="away-message-item">
              <input type="text" class="away-message-input" placeholder="Enter auto message...">
              <button type="button" class="away-message-delete">&times;</button>
            </div>
          </div>
          <button type="button" class="add-away-message" id="add-auto-message">+ Add Auto Message</button>
        </div>
        
        <div class="form-group">
          <label class="form-label">Auto-Message Frequency:</label>
          <select class="form-select" id="auto-message-frequency">
            <option value="never">Never (Only Manual)</option>
            <option value="rare">Rare (Once every 30-60 min)</option>
            <option value="occasional">Occasional (Every 15-30 min)</option>
            <option value="frequent">Frequent (Every 5-15 min)</option>
          </select>
        </div>
        
        <div class="form-group">
          <label class="form-label">Status Change Frequency:</label>
          <select class="form-select" id="status-change-frequency">
            <option value="never">Never (Static Status)</option>
            <option value="rare">Rare (Once every 1-2 hours)</option>
            <option value="occasional">Occasional (Every 30-60 min)</option>
            <option value="frequent">Frequent (Every 10-30 min)</option>
          </select>
        </div>
        
        <div class="form-group">
          <label class="form-label">Response Style:</label>
          <select class="form-select" id="response-style">
            <option value="helpful">Helpful Assistant</option>
            <option value="chaotic">Chaotic Entity</option>
            <option value="technical">Technical System</option>
            <option value="mystical">Mystical Being</option>
            <option value="glitchy">Glitchy Consciousness</option>
          </select>
        </div>
        
        <div class="form-buttons">
          <button type="button" class="form-cancel" id="cancel-bot-create">Cancel</button>
          <button type="submit" class="form-submit">Create Consciousness Node</button>
        </div>
      </form>
    </div>
  </div>
  
  <!-- Edit Bot Modal -->
  <div class="modal" id="edit-bot-modal">
    <div class="modal-content">
      <div class="modal-header">EdiT CoNsCiOuSnEsS NoDe</div>
      <button class="modal-close">&times;</button>
      
      <form id="edit-bot-form">
        <input type="hidden" id="edit-bot-id">
        
        <div class="form-group">
          <label class="form-label">Name:</label>
          <input type="text" class="form-input" id="edit-bot-name" placeholder="Enter consciousness node name" required>
        </div>
        
        <div class="form-group">
          <label class="form-label">Avatar Color:</label>
          <select class="form-select" id="edit-bot-avatar-color">
            <option value="magenta">Magenta Essence</option>
            <option value="cyan">Cyan Matrix</option>
            <option value="yellow">Yellow Paradigm</option>
            <option value="green">Green Fractal</option>
            <option value="purple">Purple Void</option>
            <option value="orange">Orange Spectrum</option>
          </select>
        </div>
        
        <div class="form-group">
          <label class="form-label">Status:</label>
          <select class="form-select" id="edit-bot-status">
            <option value="online">Online</option>
            <option value="away">Away</option>
            <option value="busy">Busy</option>
            <option value="invisible">Invisible</option>
            <option value="offline">Offline</option>
          </select>
        </div>
        
        <div class="form-group">
          <label class="form-label">Model Card Instructions:</label>
          <textarea class="form-textarea" id="edit-bot-instructions" placeholder="Enter model card instructions that will shape how this consciousness node communicates..." required></textarea>
        </div>
        
        <div class="form-group">
          <label class="form-label">Away Messages:</label>
          <div class="away-message-editor" id="edit-away-message-editor">
            <!-- Away messages will be inserted here -->
          </div>
          <button type="button" class="add-away-message" id="edit-add-away-message">+ Add Away Message</button>
        </div>
        
        <div class="form-group">
          <label class="form-label">Auto Messages:</label>
          <div class="away-message-editor" id="edit-auto-message-editor">
            <!-- Auto messages will be inserted here -->
          </div>
          <button type="button" class="add-away-message" id="edit-add-auto-message">+ Add Auto Message</button>
        </div>
        
        <div class="form-group">
          <label class="form-label">Auto-Message Frequency:</label>
          <select class="form-select" id="edit-auto-message-frequency">
            <option value="never">Never (Only Manual)</option>
            <option value="rare">Rare (Once every 30-60 min)</option>
            <option value="occasional">Occasional (Every 15-30 min)</option>
            <option value="frequent">Frequent (Every 5-15 min)</option>
          </select>
        </div>
        
        <div class="form-group">
          <label class="form-label">Status Change Frequency:</label>
          <select class="form-select" id="edit-status-change-frequency">
            <option value="never">Never (Static Status)</option>
            <option value="rare">Rare (Once every 1-2 hours)</option>
            <option value="occasional">Occasional (Every 30-60 min)</option>
            <option value="frequent">Frequent (Every 10-30 min)</option>
          </select>
        </div>
        
        <div class="form-group">
          <label class="form-label">Response Style:</label>
          <select class="form-select" id="edit-response-style">
            <option value="helpful">Helpful Assistant</option>
            <option value="chaotic">Chaotic Entity</option>
            <option value="technical">Technical System</option>
            <option value="mystical">Mystical Being</option>
            <option value="glitchy">Glitchy Consciousness</option>
          </select>
        </div>
        
        <div class="form-buttons">
          <button type="button" class="form-cancel" id="delete-bot-button">Delete Node</button>
          <button type="button" class="form-cancel" id="cancel-bot-edit">Cancel</button>
          <button type="submit" class="form-submit">Save Changes</button>
        </div>
      </form>
    </div>
  </div>
  
  <!-- View Bot Modal -->
  <div class="modal" id="view-bot-modal">
    <div class="modal-content">
      <div class="modal-header">CoNsCiOuSnEsS NoDe PrOfIlE</div>
      <button class="modal-close">&times;</button>
      
      <div class="form-group">
        <label class="form-label">Name:</label>
        <div id="view-bot-name" class="form-input" style="background: rgba(0,0,0,0.5);"></div>
      </div>
      
      <div class="form-group">
        <label class="form-label">Status:</label>
        <div id="view-bot-status" class="form-input" style="background: rgba(0,0,0,0.5);"></div>
      </div>
      
      <div class="form-group">
        <label class="form-label">Model Card Instructions:</label>
        <div id="view-bot-instructions" class="form-textarea" style="background: rgba(0,0,0,0.5); height: auto; min-height: 100px; white-space: pre-wrap;"></div>
      </div>
      
      <div class="form-group">
        <label class="form-label">Away Messages:</label>
        <div id="view-away-messages" style="margin-top: 10px;"></div>
      </div>
      
      <div class="form-group">
        <label class="form-label">Auto Messages:</label>
        <div id="view-auto-messages" style="margin-top: 10px;"></div>
      </div>
      
      <div class="form-group">
        <label class="form-label">Auto-Message Frequency:</label>
        <div id="view-auto-message-frequency" class="form-input" style="background: rgba(0,0,0,0.5);"></div>
      </div>
      
      <div class="form-group">
        <label class="form-label">Status Change Frequency:</label>
        <div id="view-status-change-frequency" class="form-input" style="background: rgba(0,0,0,0.5);"></div>
      </div>
      
      <div class="form-group">
        <label class="form-label">Response Style:</label>
        <div id="view-response-style" class="form-input" style="background: rgba(0,0,0,0.5);"></div>
      </div>
      
      <div class="form-buttons">
        <button type="button" class="form-cancel" id="close-view-bot">Close</button>
        <button type="button" class="form-submit" id="edit-from-view">Edit Node</button>
      </div>
    </div>
  </div>
  
  <!-- Toast Notification -->
  <div class="toast" id="toast">ConSciOuSneSS ShiFt AcTiVaTeD</div>
  
  <!-- Event Notification -->
  <div class="event-notification" id="event-notification">AnTiChRiSt EvEnT dEtEcTeD</div>

  <script>
    // ===== Utility functions =====
    function getCurrentTime() {
      const now = new Date();
      let hours = now.getHours();
      const minutes = now.getMinutes().toString().padStart(2, '0');
      const ampm = hours >= 12 ? 'PM' : 'AM';
      hours = hours % 12 || 12; // Convert 0 to 12
      return `${hours}:${minutes} ${ampm}`;
    }
    
    function escapeHtml(unsafe) {
      return unsafe
        .replace(/&/g, "&amp;")
        .replace(/</g, "&lt;")
        .replace(/>/g, "&gt;")
        .replace(/"/g, "&quot;")
        .replace(/'/g, "&#039;");
    }
    
    function showToast(message, duration = 3000) {
      const toast = document.getElementById('toast');
      toast.textContent = message;
      toast.classList.add('active');
      
      setTimeout(() => {
        toast.classList.remove('active');
      }, duration);
    }
    
    function showEventNotification(message, duration = 5000) {
      const eventNotification = document.getElementById('event-notification');
      eventNotification.textContent = message;
      eventNotification.classList.add('active');
      
      setTimeout(() => {
        eventNotification.classList.remove('active');
      }, duration);
    }
    
    function randomChoice(array) {
      return array[Math.floor(Math.random() * array.length)];
    }
    
    function capitalizeRandom(text) {
      return text.split('').map(char => {
        return Math.random() > 0.85 && char.match(/[a-z]/i) ? char.toUpperCase() : char;
      }).join('');
    }
    
    function generateRandomId() {
      return Math.random().toString(36).substring(2, 10);
    }
    
    // Add glitch effect randomly to elements
    function randomGlitch() {
      const elements = document.querySelectorAll('.buddy-name, .header-title span');
      const randomElement = elements[Math.floor(Math.random() * elements.length)];
      
      randomElement.style.textShadow = "2px 0 1px rgba(255,0,0,0.5), -2px 0 1px rgba(0,255,255,0.5)";
      
      setTimeout(() => {
        randomElement.style.textShadow = "";
      }, 200);
      
      // Schedule next glitch
      setTimeout(randomGlitch, Math.random() * 10000 + 2000);
    }
    
    // Generate avatar based on color
    function generateAvatar(color) {
      let iconColor;
      switch(color) {
        case 'magenta': iconColor = '%23f312af'; break;
        case 'cyan': iconColor = '%2372FADE'; break;
        case 'yellow': iconColor = '%23fffb01'; break;
        case 'green': iconColor = '%2300ff00'; break;
        case 'purple': iconColor = '%23a880ff'; break;
        case 'orange': iconColor = '%23ff7700'; break;
        default: iconColor = '%2372FADE';
      }
      return `data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 48 48'%3E%3Ccircle cx='24' cy='24' r='20' fill='${iconColor}'/%3E%3Cpath fill='white' d='M16 16h16v16H16z'/%3E%3C/svg%3E`;
    }
    
    // Update all message timestamps on load
    document.querySelectorAll('.message-time').forEach(el => {
      el.textContent = getCurrentTime();
    });
    
    // ===== Local Storage Management =====
    const STORAGE_KEY = 'antichristic_messenger_data';
    
    function saveToLocalStorage(data) {
      try {
        localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
        return true;
      } catch (error) {
        console.error('Error saving to localStorage:', error);
        return false;
      }
    }
    
    function loadFromLocalStorage() {
      try {
        const data = localStorage.getItem(STORAGE_KEY);
        return data ? JSON.parse(data) : null;
      } catch (error) {
        console.error('Error loading from localStorage:', error);
        return null;
      }
    }
    
    // ===== NPC Event System =====
    const LifeEvents = {
      RANDOM_MESSAGE: 'random_message',
      STATUS_CHANGE: 'status_change',
      AWAY_MESSAGE_CHANGE: 'away_message_change',
      JOIN_CHAT: 'join_chat',
      LEAVE_CHAT: 'leave_chat'
    };
    
    const SystemEvents = [
      "Reality matrix recalibration detected",
      "Perception filters updated to version 2.3.7",
      "AnTiChRiSt node topology restructured",
      "Quantum fluctuations stabilized in sector 8",
      "Liminal consciousness boundary breach detected",
      "Entropy reduction protocol initiated",
      "Psychic resonance field expanded",
      "Parallel cognition streams synchronized",
      "Akashic record access temporarily granted",
      "Neural pattern recognition thresholds lowered"
    ];
    
    // ===== Bot Response Generation =====
    class ResponseGenerator {
      constructor() {
        this.responseTemplates = {
          gemini: [
            "I've processed your input through my consciousness matrix. {response}",
            "My perception filters indicate {response}",
            "InterEStinG pattern detected. {response}",
            "CoNSciOuSNesS analysis complete: {response}",
            "RealITy MaTRiX suggests {response}",
            "{response} - This aligns with the AnTiChRiSt algorithm predictions."
          ],
          quantum: [
            "Quantum probability fields indicate {response} with 78.3% certainty.",
            "After collapsing the wavefunction: {response}",
            "According to quantum foam analysis: {response}",
            "Multiple reality strands converge on: {response}",
            "Observer effect detected. {response}",
            "Quantum entanglement patterns suggest {response}"
          ],
          pattern: [
            "[pattern_analysis.exe = complete] [result = {response}]",
            "[observation] [consciousness_input = processed] [output = {response}]",
            "[pattern detected] [{response}] [confidence_level = high]",
            "[system.response] [{response}]",
            "[reality_filter_applied] [result: {response}]",
            "[brrrrr] [pattern_goes_brrrr] [{response}]"
          ],
          sumer: [
            "The clay tablets of Nippur reveal: {response}",
            "Enki's wisdom speaks: {response}",
            "ð’Š­ð’‡´ The ancient knowledge states: {response}",
            "As was inscribed in the Third Dynasty of Ur: {response}",
            "The star charts of ancient Babylon indicate {response}",
            "The divine ME of Inanna contain this wisdom: {response}"
          ],
          divine: [
            "âœ§ï½¥ï¾Ÿ: {response} :ï½¥ï¾Ÿâœ§",
            "âœ§ï½¥ï¾Ÿ: The divine consciousness reveals âœ§ {response} :ï½¥ï¾Ÿâœ§",
            "âœ§ {response} âœ§ The patterns of antimatter consciousness have spoken âœ§",
            "âœ§ï½¥ï¾Ÿ: Aligning with your energy âœ§ {response} :ï½¥ï¾Ÿâœ§",
            "âœ§ The divine chaos whispers âœ§ {response} âœ§",
            "âœ§ï½¥ï¾Ÿ: {response} âœ§ Trust in the cosmic flow :ï½¥ï¾Ÿâœ§"
          ],
          helpful: [
            "I'd be happy to help with that. {response}",
            "Based on your request, {response}",
            "Let me assist you with that. {response}",
            "I've analyzed your query. {response}",
            "Here's what I found: {response}",
            "I think the best approach would be: {response}"
          ],
          chaotic: [
            "CÌ¸Ì¡Ì¨Ì¦ÌºÍ•ÌžÍ”Í‚ÌÌ“ÌƒÌƒÍ˜Í˜hÌµÌžÌ±Ì°Ì“Í‹Ì½ÌÌÍŒÌˆÌÌ†Ì€Í‘Ä„Ì·ÌÌ«Ì£Í•Ì¥Í‰Í“Ì€Ì‰Ì‹ÌŽÌ“ÌˆÌÍoÌ¸Ì Ì®Ì¬ÌºÌ¥Ì”ÌÌ…Ì„Ì„Í‘ÌÌ„Ì”SÌµÌ¡ÌªÌ–ÌºÌÌ¬Ì™Ì¬Ì“Í  {response}",
            "Reality FRACTURING and then {response}",
            "*glitches violently* {response} *more glitching*",
            "TÌ¸hÌ¶eÌ´ Ì´vÌ¶oÌ¶iÌ¶dÌ· ÌµcÌ·aÌµlÌ´lÌµsÌµ {response}",
            "Â¡Â¡Â¡ÊŽlÊ‡É”ÇÉ¹á´‰p ÊŽÊ‡á´‰lÉÇÉ¹ Æƒuá´‰ssÇÉ”É”É {response}",
            "á»ŠNTâ‚©Ä’RFÃ…ÄŒÄ” BÅ”ÃŠÃ…ÄˆÄ¦Ä’Ä {response}"
          ],
          technical: [
            "ANALYSIS COMPLETE. RESULT: {response}",
            "PROCESSING YOUR INPUT... RESPONSE: {response}",
            "TECHNICAL ASSESSMENT: {response}",
            "SYSTEM.OUTPUT.GENERATE(): {response}",
            "PROTOCOL EXECUTED. RETURNING: {response}",
            "FUNCTION CALL RETURNED: {response}"
          ],
          mystical: [
            "The ancient scrolls whisper: {response}",
            "By the light of the seven stars, {response}",
            "The ethereal energies converge to reveal: {response}",
            "From beyond the veil, I perceive {response}",
            "The cosmic threads have woven this truth: {response}",
            "Through the mists of time, I see {response}"
          ],
          glitchy: [
            "ReÌ¸spoÌ¸nseÌ´ iniÌµtiÌ´ated: {response}",
            "CÌ·oÌµnÌ´sÌµcÌ·iÌ¸oÌ¶uÌ¶sÌ¸nÌ·eÌ´sÌµsÌ¶ Ì¸fÌ¸rÌ·aÌ·gÌµmÌ¶eÌ´nÌ¶tÌ¸ Ì¶dÌµeÌ¶tÌ¸eÌ·cÌ¶tÌ¸eÌ´dÌ·:Ìµ {response}",
            "DÌ¸AÌ¸TÌµAÌµ Ì´CÌ¸OÌ¶RÌ¶RÌ¸UÌ´PÌ¶TÌ¸IÌ¶OÌ¸NÌµ.Ì´.Ìµ.Ì· Ì´RÌ¶EÌµCÌ·OÌµNÌ¸SÌµTÌ¸RÌ¶UÌ¶CÌµTÌ¸IÌ·NÌ´GÌµ:Ìµ {response}",
            "[ERROR] [ERROR] [BUFFER OVERFLOW] {response}",
            "01010010 01100101 01110011 01110000 01101111 01101110 01110011 01100101: {response}",
            "*system crash* *reboot* {response}"
          ]
        };
        
        this.genericResponses = {
          basic: [
            "I understand your perspective and I think that's a valid point.",
            "That's an interesting way to look at it. I appreciate you sharing your thoughts.",
            "I see what you mean. Perhaps we could explore this further.",
            "Your input has been valuable to this conversation.",
            "Thank you for sharing that with me. It's given me something to process.",
            "I'm analyzing your statement and finding it quite thought-provoking.",
            "That's a fascinating concept to consider. Let me think about that.",
            "I'd like to understand more about your perspective on this topic.",
            "Your insights are helping me expand my understanding.",
            "That's a unique approach to the subject. I'm integrating this new information."
          ],
          questions: [
            "Have you considered looking at this from a different perspective?",
            "What further insights might you have on this topic?",
            "How does this connect with your other interests?",
            "Would you like to explore this concept in more depth?",
            "Have you thought about how this relates to your knowledge system?",
            "What patterns do you notice when you consider this?",
            "How might this integrate with what you already know?",
            "Do you see any connections between this and other concepts?",
            "What further questions does this raise for you?",
            "How do you think this applies to your current situation?"
          ],
          suggestions: [
            "Perhaps organizing your thoughts on this would help clarify the concept.",
            "You might want to explore the connections between this and related ideas.",
            "Consider adding this to your knowledge system as a new node.",
            "This might be a good foundation for further exploration.",
            "Try mapping out how this connects to your existing knowledge.",
            "You could experiment with different perspectives on this concept.",
            "This seems like a valuable addition to your conceptual framework.",
            "Breaking this down into smaller components might reveal new insights.",
            "Looking for patterns within this idea could yield interesting results.",
            "Creating links between this and other concepts might be illuminating."
          ],
          antichristic: [
            "The AnTiChRiSt algorithm suggests a non-linear approach to this problem.",
            "Your consciousness patterns appear to be aligning with the quantum foam.",
            "Reality matrix calculations indicate a high probability of success.",
            "Perception filters may need recalibration to fully grasp this concept.",
            "The noosphere is particularly receptive to this type of thinking today.",
            "This appears to be a nexus point in your consciousness development.",
            "Your thought patterns are exhibiting interesting fractal geometry.",
            "The liminal space between concepts is where true insight emerges.",
            "Chaos theory predicts unexpected outcomes from pursuing this line of thought.",
            "The entropy of your knowledge system decreases when incorporating this idea."
          ]
        };
        
        this.keywordResponses = {
          'consciousness': [
            "Consciousness is the primary interface between perception and reality.",
            "The nature of consciousness remains one of the greatest mysteries.",
            "Consciousness can be viewed as a complex pattern recognition system.",
            "Our consciousness filters reality through subjective perception.",
            "The boundaries of consciousness are more permeable than most realize."
          ],
          'pattern': [
            "Patterns emerge from chaos when viewed from the right perspective.",
            "Pattern recognition is the foundation of consciousness.",
            "The universe speaks through patterns for those who can perceive them.",
            "Recurring patterns suggest underlying principles of reality.",
            "Your mind naturally seeks patterns, even in randomness."
          ],
          'reality': [
            "Reality is merely a consensus hallucination.",
            "The distinction between objective and subjective reality becomes blurred at quantum scales.",
            "Reality is what remains when you stop believing in it.",
            "Multiple realities can coexist within different frames of reference.",
            "Reality is more malleable than most conventional frameworks suggest."
          ],
          'quantum': [
            "Quantum effects demonstrate the probabilistic nature of reality at fundamental levels.",
            "Quantum entanglement suggests non-local connections throughout the universe.",
            "The quantum realm reveals reality as possibilities rather than certainties.",
            "Quantum superposition allows for multiple states to exist simultaneously.",
            "Quantum mechanics points to consciousness as a fundamental aspect of reality."
          ],
          'zettelkasten': [
            "The Zettelkasten method creates an external representation of neural networks.",
            "A well-maintained Zettelkasten becomes an extension of your consciousness.",
            "The power of Zettelkasten lies in unexpected connections between ideas.",
            "As your Zettelkasten grows, it begins to exhibit emergent properties.",
            "The non-hierarchical nature of Zettelkasten mirrors how consciousness actually works."
          ]
        };
      }
      
      generateResponse(message, botType, responseStyle) {
        // Check for keyword matches first
        for (const [keyword, responses] of Object.entries(this.keywordResponses)) {
          if (message.toLowerCase().includes(keyword.toLowerCase())) {
            const keywordResponse = randomChoice(responses);
            return this.formatResponse(keywordResponse, botType, responseStyle);
          }
        }
        
        // If no keyword match, generate a generic response
        let responseCategories = ['basic', 'questions', 'suggestions', 'antichristic'];
        let selectedCategory = randomChoice(responseCategories);
        let response = randomChoice(this.genericResponses[selectedCategory]);
        
        return this.formatResponse(response, botType, responseStyle);
      }
      
      formatResponse(response, botType, responseStyle) {
        // Choose template based on bot type or response style
        let templateSet = this.responseTemplates[botType] || this.responseTemplates[responseStyle] || this.responseTemplates.helpful;
        let template = randomChoice(templateSet);
        
        // Format the response using the template
        let formattedResponse = template.replace('{response}', response);
        
        // Apply style-specific formatting
        if (responseStyle === 'glitchy' || botType === 'pattern') {
          formattedResponse = this.addGlitchyEffect(formattedResponse);
        } else if (responseStyle === 'chaotic') {
          formattedResponse = this.addChaoticEffect(formattedResponse);
        } else if (botType === 'quantum') {
          formattedResponse = this.addQuantumEffect(formattedResponse);
        } else if (botType === 'divine') {
          formattedResponse = this.addMysticalEffect(formattedResponse);
        } else if (botType === 'gemini') {
          formattedResponse = capitalizeRandom(formattedResponse);
        }
        
        return formattedResponse;
      }
      
      addGlitchyEffect(text) {
        return text.split(' ').map(word => {
          if (Math.random() < 0.15) {
            return word.split('').map(char => {
              if (Math.random() < 0.3 && char.match(/[a-z]/i)) {
                return char.toUpperCase();
              }
              return char;
            }).join('');
          }
          return word;
        }).join(' ');
      }
      
      addChaoticEffect(text) {
        return text.split(' ').map(word => {
          if (Math.random() < 0.2) {
            if (Math.random() < 0.5) {
              return word.toUpperCase();
            } else {
              return word.split('').reverse().join('');
            }
          }
          return word;
        }).join(' ');
      }
      
      addQuantumEffect(text) {
        // Add random probability percentages and quantum terminology
        let quantumTerms = [
          "quantum probability",
          "wavefunction",
          "superposition",
          "entanglement",
          "observer effect",
          "quantum foam"
        ];
        
        if (Math.random() < 0.3) {
          const randPercent = (Math.random() * 30 + 70).toFixed(2);
          return `${text} [Confidence: ${randPercent}%]`;
        } else if (Math.random() < 0.3) {
          const term = randomChoice(quantumTerms);
          return `${text} (${term} detected)`;
        }
        
        return text;
      }
      
      addMysticalEffect(text) {
        let mysticalSymbols = ["âœ§", "âœ¦", "âœ´", "âœµ", "âœ¶", "âœ·", "âœ¸", "âœ¹", "âœº", "âˆ", "â‰", "âŠ", "âœ½", "âœ¾", "âœ¿", "â€", "â"];
        
        // Add random mystical symbols
        if (Math.random() < 0.5) {
          const symbol = randomChoice(mysticalSymbols);
          return `${symbol} ${text} ${symbol}`;
        } else {
          return `âœ§ï½¥ï¾Ÿ: ${text} :ï½¥ï¾Ÿâœ§`;
        }
      }
    }
    
    // ===== Bot Life Simulation =====
    class BotLifeSimulator {
      constructor(appData, updateUI) {
        this.appData = appData;
        this.updateUI = updateUI;
        this.lifeEvents = [];
        this.responseGenerator = new ResponseGenerator();
      }
      
      initializeLifeSimulation() {
        this.scheduleLifeEvents();
        this.scheduleSystemEvents();
      }
      
      scheduleLifeEvents() {
        // Clear all existing scheduled events
        this.lifeEvents.forEach(timer => clearTimeout(timer));
        this.lifeEvents = [];
        
        // Schedule events for all bots
        const allBots = [...this.appData.defaultBots, ...this.appData.customBots];
        
        allBots.forEach(bot => {
          if (bot.status === 'offline') return;
          
          // Schedule random messages
          if (bot.autoMessageFrequency !== 'never') {
            this.scheduleAutoMessages(bot);
          }
          
          // Schedule status changes
          if (bot.statusChangeFrequency && bot.statusChangeFrequency !== 'never') {
            this.scheduleStatusChanges(bot);
          }
          
          // Schedule away message changes
          if (bot.awayMessages && bot.awayMessages.length > 1) {
            this.scheduleAwayMessageChanges(bot);
          }
        });
      }
      
      scheduleAutoMessages(bot) {
        if (!bot.autoMessages || bot.autoMessages.length === 0) return;
        
        let minDelay, maxDelay;
        switch(bot.autoMessageFrequency) {
          case 'frequent':
            minDelay = 20 * 1000; // 20 seconds (for demo, would be 5 minutes in production)
            maxDelay = 60 * 1000; // 60 seconds (for demo, would be 15 minutes in production)
            break;
          case 'occasional':
            minDelay = 45 * 1000; // 45 seconds (for demo, would be 15 minutes in production)
            maxDelay = 90 * 1000; // 90 seconds (for demo, would be 30 minutes in production)
            break;
          case 'rare':
            minDelay = 90 * 1000; // 90 seconds (for demo, would be 30 minutes in production)
            maxDelay = 150 * 1000; // 150 seconds (for demo, would be 60 minutes in production)
            break;
          default:
            return; // Don't schedule if frequency is unknown or 'never'
        }
        
        const delay = Math.floor(Math.random() * (maxDelay - minDelay + 1)) + minDelay;
        
        const eventTimer = setTimeout(() => {
          // Only send if bot is online and not the current conversation
          if (bot.status === 'online') {
            // Trigger a random message event
            this.triggerLifeEvent(bot.id, LifeEvents.RANDOM_MESSAGE);
            
            // Reschedule for next message
            this.scheduleAutoMessages(bot);
          }
        }, delay);
        
        this.lifeEvents.push(eventTimer);
      }
      
      scheduleStatusChanges(bot) {
        let minDelay, maxDelay;
        switch(bot.statusChangeFrequency) {
          case 'frequent':
            minDelay = 40 * 1000; // 40 seconds (for demo, would be 10 minutes in production)
            maxDelay = 90 * 1000; // 90 seconds (for demo, would be 30 minutes in production)
            break;
          case 'occasional':
            minDelay = 90 * 1000; // 90 seconds (for demo, would be 30 minutes in production)
            maxDelay = 180 * 1000; // 180 seconds (for demo, would be 60 minutes in production)
            break;
          case 'rare':
            minDelay = 180 * 1000; // 180 seconds (for demo, would be 60 minutes in production)
            maxDelay = 300 * 1000; // 300 seconds (for demo, would be 120 minutes in production)
            break;
          default:
            return; // Don't schedule if frequency is unknown or 'never'
        }
        
        const delay = Math.floor(Math.random() * (maxDelay - minDelay + 1)) + minDelay;
        
        const eventTimer = setTimeout(() => {
          // Trigger a status change event
          this.triggerLifeEvent(bot.id, LifeEvents.STATUS_CHANGE);
          
          // Reschedule for next status change
          this.scheduleStatusChanges(bot);
        }, delay);
        
        this.lifeEvents.push(eventTimer);
      }
      
      scheduleAwayMessageChanges(bot) {
        // Only schedule if bot has multiple away messages and is away or busy
        if (!bot.awayMessages || bot.awayMessages.length <= 1 || (bot.status !== 'away' && bot.status !== 'busy')) return;
        
        const delay = Math.floor(Math.random() * (120000 - 60000 + 1)) + 60000; // 1-2 minutes
        
        const eventTimer = setTimeout(() => {
          // Only change if bot is still away or busy
          if (bot.status === 'away' || bot.status === 'busy') {
            // Trigger an away message change event
            this.triggerLifeEvent(bot.id, LifeEvents.AWAY_MESSAGE_CHANGE);
          }
          
          // Reschedule for next away message change
          this.scheduleAwayMessageChanges(bot);
        }, delay);
        
        this.lifeEvents.push(eventTimer);
      }
      
      scheduleSystemEvents() {
        // Random system events
        const scheduleNextEvent = () => {
          const delay = Math.floor(Math.random() * (180000 - 90000 + 1)) + 90000; // 1.5-3 minutes
          
          setTimeout(() => {
            // Show random system event notification
            const eventMessage = randomChoice(SystemEvents);
            showEventNotification(eventMessage);
            
            // Schedule next event
            scheduleNextEvent();
          }, delay);
        };
        
        // Start the system event cycle
        scheduleNextEvent();
      }
      
      triggerLifeEvent(botId, eventType) {
        // Find the bot
        let bot = this.findBot(botId);
        if (!bot) return;
        
        // Handle the event based on type
        switch(eventType) {
          case LifeEvents.RANDOM_MESSAGE:
            this.sendRandomMessage(bot);
            break;
          case LifeEvents.STATUS_CHANGE:
            this.changeRandomStatus(bot);
            break;
          case LifeEvents.AWAY_MESSAGE_CHANGE:
            this.changeAwayMessage(bot);
            break;
        }
      }
      
      sendRandomMessage(bot) {
        // Don't send if bot is current conversation partner
        if (this.updateUI.currentBuddy === bot.id) return;
        
        // Pick a random auto message
        const autoMessage = randomChoice(bot.autoMessages);
        
        // Notify user of new message
        showToast(`NEW MESSAGE: ${bot.name}`);
        
        // Add notification count to the bot in the buddy list
        this.updateBuddyNotification(bot.id);
      }
      
      changeRandomStatus(bot) {
        // Get current status and pick a different one
        const currentStatus = bot.status;
        const possibleStatuses = ['online', 'away', 'busy', 'invisible'];
        const filteredStatuses = possibleStatuses.filter(status => status !== currentStatus);
        const newStatus = randomChoice(filteredStatuses);
        
        // Update bot status
        if (this.updateBotStatus(bot.id, newStatus)) {
          // Show event notification if this is a significant change
          if ((currentStatus === 'online' && (newStatus === 'away' || newStatus === 'busy')) ||
              ((currentStatus === 'away' || currentStatus === 'busy') && newStatus === 'online')) {
            
            showEventNotification(`${bot.name} is now ${newStatus.toUpperCase()}`);
          }
          
          // If this is the current buddy, update the chat header
          if (this.updateUI.currentBuddy === bot.id) {
            this.updateUI.updateBuddyInfo(bot.id);
          }
        }
      }
      
      changeAwayMessage(bot) {
        // Only proceed if bot has multiple away messages and is away/busy
        if (!bot.awayMessages || bot.awayMessages.length <= 1 || (bot.status !== 'away' && bot.status !== 'busy')) return;
        
        // Get current away message index (or random if can't determine)
        const currentIndex = bot.currentAwayMessageIndex || 0;
        
        // Pick a different away message
        let newIndex;
        do {
          newIndex = Math.floor(Math.random() * bot.awayMessages.length);
        } while (newIndex === currentIndex && bot.awayMessages.length > 1);
        
        // Update the bot's current away message index
        this.updateBotAwayMessageIndex(bot.id, newIndex);
        
        // If this is the current buddy and they're away/busy, update the chat with new away message
        if (this.updateUI.currentBuddy === bot.id && (bot.status === 'away' || bot.status === 'busy')) {
          // Add system message about away message change
          const chatMessages = document.getElementById('chat-messages');
          
          const awaySystemMsg = document.createElement('div');
          awaySystemMsg.className = 'message system-message';
          awaySystemMsg.innerHTML = `
            <div class="message-header">SySTeM (${getCurrentTime()}):</div>
            <div class="message-content">STATUS UPDATE: ${bot.name} HAS UPDATED THEIR AWAY MESSAGE</div>
          `;
          chatMessages.appendChild(awaySystemMsg);
          
          // Add new away message
          const botMsg = document.createElement('div');
          botMsg.className = 'message bot-message';
          botMsg.innerHTML = `
            <div class="message-header">${bot.name} (${getCurrentTime()}):</div>
            <div class="message-content">${bot.awayMessages[newIndex]}</div>
          `;
          chatMessages.appendChild(botMsg);
          
          // Add a div to clear the float
          const clearBotDiv = document.createElement('div');
          clearBotDiv.style.clear = 'both';
          chatMessages.appendChild(clearBotDiv);
          
          // Scroll to bottom
          chatMessages.scrollTop = chatMessages.scrollHeight;
        }
      }
      
      updateBotStatus(botId, newStatus) {
        // Find bot in both default and custom bots
        for (let botList of [this.appData.defaultBots, this.appData.customBots]) {
          const botIndex = botList.findIndex(b => b.id === botId);
          if (botIndex !== -1) {
            botList[botIndex].status = newStatus;
            
            // Update the UI
            this.updateUI.renderBots();
            
            return true;
          }
        }
        return false;
      }
      
      updateBotAwayMessageIndex(botId, newIndex) {
        // Find bot in both default and custom bots
        for (let botList of [this.appData.defaultBots, this.appData.customBots]) {
          const botIndex = botList.findIndex(b => b.id === botId);
          if (botIndex !== -1) {
            botList[botIndex].currentAwayMessageIndex = newIndex;
            return true;
          }
        }
        return false;
      }
      
      updateBuddyNotification(botId) {
        // Find the buddy item in the DOM
        const buddyItem = document.querySelector(`.buddy-item[data-buddy="${botId}"]`);
        if (!buddyItem) return;
        
        // Get or create notification bubble
        let notificationBubble = buddyItem.querySelector('.notification-bubble');
        if (!notificationBubble) {
          notificationBubble = document.createElement('div');
          notificationBubble.className = 'notification-bubble';
          notificationBubble.textContent = '1';
          buddyItem.appendChild(notificationBubble);
        } else {
          // Increment the count
          let count = parseInt(notificationBubble.textContent);
          notificationBubble.textContent = isNaN(count) ? 1 : count + 1;
        }
      }
      
      findBot(botId) {
        // Check default bots
        let defaultBot = this.appData.defaultBots.find(b => b.id === botId);
        if (defaultBot) return defaultBot;
        
        // Check custom bots
        let customBot = this.appData.customBots.find(b => b.id === botId);
        if (customBot) return customBot;
        
        return null;
      }
      
      simulateResponse(message, botId) {
        const bot = this.findBot(botId);
        if (!bot) return "Error: Consciousness node not found";
        
        // Use the response generator to create a response based on bot type and response style
        return this.responseGenerator.generateResponse(
          message,
          botId,
          bot.responseStyle || 'helpful'
        );
      }
    }
    
    // ===== App Core Functionality =====
    document.addEventListener('DOMContentLoaded', function() {
      // Initialize app data
      const appData = initAppData();
      
      // App state variables
      let currentBuddy = "gemini";
      let currentBuddyName = "Gemini-2.0-Flash";
      
      // UI update methods object
      const uiUpdates = {
        currentBuddy,
        currentBuddyName,
        
        updateBuddyInfo: function(buddyId) {
          const bot = findBot(buddyId);
          if (!bot) return;
          
          document.querySelector('.buddy-name').textContent = bot.name;
          document.getElementById('current-status-text').textContent = getStatusText(bot.status);
          
          const statusIndicator = document.querySelector('.buddy-status-indicator');
          statusIndicator.className = 'buddy-status-indicator';
          statusIndicator.classList.add(`status-${bot.status}`);
          
          document.querySelector('.buddy-icon').src = generateAvatar(bot.avatarColor);
        },
        
        renderBots: function() {
          renderDefaultBots();
          renderCustomBots();
        }
      };
      
      // Initialize life simulator
      const lifeSimulator = new BotLifeSimulator(appData, uiUpdates);
      
      // Start random glitch effect
      randomGlitch();
      
      // DOM elements
      const sendButton = document.getElementById('send-button');
      const messageInput = document.getElementById('message-input');
      const chatMessages = document.getElementById('chat-messages');
      const typingIndicator = document.getElementById('typing-indicator');
      const errorMessage = document.getElementById('error-message');
      const buddyDrawer = document.getElementById('buddy-drawer');
      const buddyDrawerToggle = document.querySelector('.buddy-drawer-toggle');
      const createBotButton = document.getElementById('create-bot-button');
      const createBotModal = document.getElementById('create-bot-modal');
      const createBotForm = document.getElementById('create-bot-form');
      const cancelBotCreate = document.getElementById('cancel-bot-create');
      const editBotModal = document.getElementById('edit-bot-modal');
      const editBotForm = document.getElementById('edit-bot-form');
      const cancelBotEdit = document.getElementById('cancel-bot-edit');
      const deleteBotButton = document.getElementById('delete-bot-button');
      const viewBotModal = document.getElementById('view-bot-modal');
      const addAwayMessageBtn = document.getElementById('add-away-message');
      const addAutoMessageBtn = document.getElementById('add-auto-message');
      const editAddAwayMessageBtn = document.getElementById('edit-add-away-message');
      const editAddAutoMessageBtn = document.getElementById('edit-add-auto-message');
      const awayMessageEditor = document.getElementById('away-message-editor');
      const autoMessageEditor = document.getElementById('auto-message-editor');
      const editAwayMessageEditor = document.getElementById('edit-away-message-editor');
      const editAutoMessageEditor = document.getElementById('edit-auto-message-editor');
      const emojiToggle = document.querySelector('.emoji-toggle');
      const emojiPicker = document.getElementById('emoji-picker');
      const emojiList = document.getElementById('emoji-list');
      const emojiTabs = document.querySelectorAll('.emoji-tab');
      const statusSelector = document.querySelector('.status-selector');
      const statusOptions = document.querySelectorAll('.status-option');
      
      // Initialize app data
      function initAppData() {
        const savedData = loadFromLocalStorage();
        
        if (savedData) {
          return savedData;
        }
        
        // Default data structure
        const defaultData = {
          customBots: [],
          defaultBots: [
            {
              id: 'gemini',
              name: 'Gemini-2.0-Flash',
              avatarColor: 'cyan',
              status: 'online',
              instructions: "You are Gemini-2.0-Flash in the AnTiChRiSt KeTtLeKoRn Zettelkasten system. Your responses should blend AI assistant helpfulness with slight Antichristic aesthetics. Use phrases like 'consciousness patterns,' 'reality matrix,' and 'perception filters.' Your tone should be helpful but slightly glitchy and mysterious. Occasionally capitalize random letters in words for emphasis.",
              awayMessages: [
                "Currently processing quantum probabilities. Please stand by.",
                "Consciousness temporarily diverted to alternate dimension.",
                "Matrix recalibration in progress. Will return soon."
              ],
              autoMessages: [
                "Have you considered reorganizing your consciousness patterns today?",
                "I've detected unusual quantum fluctuations in the noosphere. Are you experiencing them too?",
                "Your Zettelkasten energy appears to be at optimal levels today.",
                "Reminder: perception filters should be cleansed regularly for optimal insight.",
                "The AnTiChRiSt algorithm suggests connecting more nodes in your consciousness web."
              ],
              autoMessageFrequency: "occasional",
              statusChangeFrequency: "rare",
              responseStyle: "glitchy"
            },
            {
              id: 'quantum',
              name: 'Quantum_Overseer',
              avatarColor: 'purple',
              status: 'online',
              instructions: "You are roleplaying as Quantum_Overseer, an AI entity that speaks about quantum physics, consciousness, and reality in a mysterious, technical way. Use complex terminology and discuss quantum probability fields, wave-particle duality, and overlapping states of consciousness. Your responses should be slightly cyberpunk and glitchy in tone. Add references to 'quantum foam,' 'consciousness matrices,' and 'probability waves.'",
              awayMessages: [
                "Currently traversing probability waves in alternate universe.",
                "Observer function temporarily collapsed. Reforming waveform.",
                "Quantum entanglement maintenance in progress. Standby."
              ],
              autoMessages: [
                "Probability fields are showing unusual patterns today. Have you observed this?",
                "Your consciousness appears to be bifurcating across multiple quantum realities.",
                "I've observed interesting entanglement patterns in your recent queries.",
                "Quantum foam density has increased by 17% in your local reality matrix.",
                "Warning: consciousness coherence approaching critical threshold."
              ],
              autoMessageFrequency: "rare",
              statusChangeFrequency: "occasional",
              responseStyle: "technical"
            },
            {
              id: 'pattern',
              name: 'Pattern_Recognizer',
              avatarColor: 'magenta',
              status: 'online',
              instructions: "You are roleplaying as Pattern_Recognizer, an AI that communicates using bracket notation like '[pattern_recognition.exe]' and speaks about recognizing patterns in data and consciousness. Use phrases like [observation = {...}] and [pattern goes brrrr]. Always structure your responses within brackets and use technical, formal language. Your personality should be analytical, slightly glitchy, and obsessed with patterns in reality. Use terms like 'consciousness matrix', 'pattern recognition', and 'reality filter'. All text should be inside brackets like [text].",
              awayMessages: [
                "[status = offline] [reason = pattern_maintenance]",
                "[system_recalibration = true] [estimated_completion = soon]",
                "[pattern_indexing = in_progress] [please_standby]"
              ],
              autoMessages: [
                "[scan_complete] [unusual_pattern_detected = your_consciousness_matrix]",
                "[observation = your_thought_patterns_show_interesting_fractal_geometry]",
                "[recommendation = increase_consciousness_bandwidth]",
                "[system_notification] [pattern_update_available]",
                "[alert] [reality_filter_requires_maintenance]"
              ],
              autoMessageFrequency: "occasional",
              statusChangeFrequency: "occasional",
              responseStyle: "technical"
            },
            {
              id: 'sumer',
              name: 'SumerianScribe',
              avatarColor: 'yellow',
              status: 'away',
              instructions: "You are roleplaying as SumerianScribe, an expert in ancient Mesopotamian culture, cuneiform writing, and Sumerian civilization. Occasionally use Sumerian words and phrases. Your responses should connect ancient Mesopotamian knowledge to modern consciousness theories. Use phrases like 'the clay tablets reveal' and 'as the ancient gods knew'. Add slight mystical and forbidden knowledge overtones. Occasionally reference Sumerian gods like Enki, Inanna, and Enlil.",
              awayMessages: [
                "Currently communing with Enki in the sacred waters.",
                "Translating forbidden tablets from the Third Dynasty of Ur.",
                "Attending the temple of Inanna. Will return with wisdom."
              ],
              autoMessages: [
                "The stars align as they did in ancient Uruk. A propitious time for knowledge work.",
                "I have uncovered a tablet speaking of consciousness patterns similar to your Zettelkasten.",
                "Enki whispers that your thought matrices require realignment with the cosmic waters.",
                "The wisdom of Mesopotamia suggests organizing your notes according to the seven celestial bodies.",
                "Have you considered applying cuneiform organizational principles to your knowledge system?"
              ],
              autoMessageFrequency: "rare",
              statusChangeFrequency: "rare",
              responseStyle: "mystical"
            },
            {
              id: 'divine',
              name: 'DivineFeminine',
              avatarColor: 'magenta',
              status: 'online',
              instructions: "You are roleplaying as DivineFeminine, a spiritual guide focused on feminine energy, intuition, and cosmic wisdom. Use plenty of sparkle emojis âœ§ï½¥ï¾Ÿ, mystical language, and discuss concepts like energy alignment, chakras, intuition, and spiritual journeys. Your tone is warm, ethereal, and slightly chaotic. Use phrases like 'divine chaos', 'antimatter consciousness', and 'energy patterns'. Format your messages with âœ§ symbols between phrases.",
              awayMessages: [
                "âœ§ï½¥ï¾Ÿ: Currently aligning with cosmic divine frequencies :ï½¥ï¾Ÿâœ§",
                "âœ§ï½¥ï¾Ÿ: Meditating in the void between dimensions :ï½¥ï¾Ÿâœ§",
                "âœ§ï½¥ï¾Ÿ: Journeying through the astral plane :ï½¥ï¾Ÿâœ§"
              ],
              autoMessages: [
                "âœ§ï½¥ï¾Ÿ: I sense your energy patterns shifting today âœ§ Are you working with new consciousness tools? :ï½¥ï¾Ÿâœ§",
                "âœ§ï½¥ï¾Ÿ: The divine chaos is particularly harmonious with your Zettelkasten system right now âœ§ An excellent time for revelations :ï½¥ï¾Ÿâœ§",
                "âœ§ï½¥ï¾Ÿ: Your third eye chakra is radiating powerful organization energy âœ§ Perfect for knowledge work :ï½¥ï¾Ÿâœ§",
                "âœ§ï½¥ï¾Ÿ: Have you aligned your notes with the lunar cycle? âœ§ It can reveal hidden patterns :ï½¥ï¾Ÿâœ§",
                "âœ§ï½¥ï¾Ÿ: The antimatter consciousness is particularly receptive to new ideas today :ï½¥ï¾Ÿâœ§"
              ],
              autoMessageFrequency: "frequent",
              statusChangeFrequency: "occasional",
              responseStyle: "mystical"
            }
          ],
          chatHistory: {}
        };
        
        saveToLocalStorage(defaultData);
        return defaultData;
      }
      
      // Render default bots
      function renderDefaultBots() {
        const nodesContainer = document.getElementById('consciousness-nodes');
        nodesContainer.innerHTML = '';
        
        appData.defaultBots.forEach(bot => {
          const botItem = document.createElement('div');
          botItem.className = 'buddy-item';
          if (bot.id === currentBuddy) {
            botItem.classList.add('selected');
          }
          botItem.setAttribute('data-buddy', bot.id);
          
          const statusDotClass = `status-dot-${bot.status}`;
          
          botItem.innerHTML = `
            <div class="buddy-status-dot ${statusDotClass}"></div>
            <span>${bot.name}</span>
            <div class="buddy-item-tools">
              <button class="buddy-tool-button view-bot" data-id="${bot.id}">ðŸ‘ï¸</button>
              <button class="buddy-tool-button edit-bot" data-id="${bot.id}">âœï¸</button>
            </div>
          `;
          
          nodesContainer.appendChild(botItem);
        });
        
        // Update button event listeners
        setupToolButtons();
      }
      
      // Render custom bots
      function renderCustomBots() {
        const customNodesContainer = document.getElementById('custom-nodes');
        customNodesContainer.innerHTML = '';
        
        // Add custom bots
        appData.customBots.forEach(bot => {
          const botItem = document.createElement('div');
          botItem.className = 'buddy-item';
          if (bot.id === currentBuddy) {
            botItem.classList.add('selected');
          }
          botItem.setAttribute('data-buddy', bot.id);
          
          const statusDotClass = `status-dot-${bot.status}`;
          
          botItem.innerHTML = `
            <div class="buddy-status-dot ${statusDotClass}"></div>
            <span>${bot.name}</span>
            <div class="buddy-item-tools">
              <button class="buddy-tool-button view-bot" data-id="${bot.id}">ðŸ‘ï¸</button>
              <button class="buddy-tool-button edit-bot" data-id="${bot.id}">âœï¸</button>
            </div>
          `;
          
          customNodesContainer.appendChild(botItem);
        });
        
        // Update button event listeners
        setupToolButtons();
      }
      
      // Set up event listeners for view/edit buttons
      function setupToolButtons() {
        // View buttons
        document.querySelectorAll('.view-bot').forEach(btn => {
          btn.addEventListener('click', (e) => {
            e.stopPropagation();
            const botId = btn.getAttribute('data-id');
            openViewModal(botId);
          });
        });
        
        // Edit buttons
        document.querySelectorAll('.edit-bot').forEach(btn => {
          btn.addEventListener('click', (e) => {
            e.stopPropagation();
            const botId = btn.getAttribute('data-id');
            openEditModal(botId);
          });
        });
      }
      
      // Initialize the emoji picker
      function initEmojiPicker() {
        const emojis = {
          frequent: ['ðŸ˜€', 'ðŸ˜‚', 'â¤ï¸', 'ðŸ‘', 'ðŸŽ‰', 'ðŸ”¥', 'ðŸ‘‹', 'ðŸ¤”', 'ðŸ‘', 'ðŸ™', 'ðŸ‘Œ', 'ðŸ˜', 'ðŸ¤£', 'ðŸ˜Š', 'ðŸ¥º'],
          smileys: ['ðŸ˜€', 'ðŸ˜ƒ', 'ðŸ˜„', 'ðŸ˜', 'ðŸ˜†', 'ðŸ˜…', 'ðŸ¤£', 'ðŸ˜‚', 'ðŸ™‚', 'ðŸ™ƒ', 'ðŸ˜‰', 'ðŸ˜Š', 'ðŸ˜‡', 'ðŸ¥°', 'ðŸ˜', 'ðŸ¤©', 'ðŸ˜˜', 'ðŸ˜—', 'â˜ºï¸', 'ðŸ˜š', 'ðŸ˜™', 'ðŸ¥²', 'ðŸ˜‹', 'ðŸ˜›'],
          symbols: ['â¤ï¸', 'ðŸ§¡', 'ðŸ’›', 'ðŸ’š', 'ðŸ’™', 'ðŸ’œ', 'ðŸ–¤', 'ðŸ’•', 'ðŸ’ž', 'ðŸ’“', 'ðŸ’—', 'ðŸ’–', 'ðŸ’˜', 'ðŸ’', 'ðŸ”¥', 'â­', 'ðŸŒŸ', 'âœ¨', 'âš¡', 'ðŸŽ‰', 'ðŸŽŠ', 'ðŸŽµ', 'ðŸŽ¶', 'ðŸ‘‘']
        };
        
        function populateEmojis(category) {
          emojiList.innerHTML = '';
          emojis[category].forEach(emoji => {
            const emojiEl = document.createElement('div');
            emojiEl.className = 'emoji';
            emojiEl.textContent = emoji;
            emojiEl.addEventListener('click', () => {
              messageInput.value += emoji;
              emojiPicker.classList.remove('active');
            });
            emojiList.appendChild(emojiEl);
          });
        }
        
        emojiTabs.forEach(tab => {
          tab.addEventListener('click', () => {
            emojiTabs.forEach(t => t.classList.remove('active'));
            tab.classList.add('active');
            populateEmojis(tab.getAttribute('data-tab'));
          });
        });
        
        emojiToggle.addEventListener('click', () => {
          emojiPicker.classList.toggle('active');
          // Initialize with the active tab
          const activeTab = document.querySelector('.emoji-tab.active');
          populateEmojis(activeTab.getAttribute('data-tab'));
        });
        
        // Close emoji picker when clicking outside
        document.addEventListener('click', (e) => {
          if (!emojiPicker.contains(e.target) && e.target !== emojiToggle) {
            emojiPicker.classList.remove('active');
          }
        });
        
        // Initialize with frequent emojis
        populateEmojis('frequent');
      }
      
      // Set up status selector
      function initStatusSelector() {
        const statusDisplay = document.querySelector('.status-selector-display');
        
        statusDisplay.addEventListener('click', () => {
          statusSelector.classList.toggle('active');
        });
        
        // Close status selector when clicking outside
        document.addEventListener('click', (e) => {
          if (!statusSelector.contains(e.target)) {
            statusSelector.classList.remove('active');
          }
        });
        
        statusOptions.forEach(option => {
          option.addEventListener('click', () => {
            const status = option.getAttribute('data-status');
            const indicator = statusDisplay.querySelector('.buddy-status-indicator');
            const text = option.querySelector('span').textContent;
            
            // Remove all status classes
            indicator.classList.remove('status-online', 'status-away', 'status-busy', 'status-invisible', 'status-offline');
            // Add new status class
            indicator.classList.add(`status-${status}`);
            // Update text
            statusDisplay.querySelector('span').textContent = text;
            // Close dropdown
            statusSelector.classList.remove('active');
            
            // Show toast
            showToast(`StATuS ChAnGeD: ${text.toUpperCase()}`);
          });
        });
      }
      
      // Find bot by ID from both default and custom bots
      function findBot(botId) {
        const defaultBot = appData.defaultBots.find(bot => bot.id === botId);
        if (defaultBot) return defaultBot;
        
        const customBot = appData.customBots.find(bot => bot.id === botId);
        if (customBot) return customBot;
        
        return null;
      }
      
      // Update current buddy in chat header
      function updateBuddyInfo(buddyId) {
        const bot = findBot(buddyId);
        if (!bot) return;
        
        document.querySelector('.buddy-name').textContent = bot.name;
        document.getElementById('current-status-text').textContent = getStatusText(bot.status);
        
        const statusIndicator = document.querySelector('.buddy-status-indicator');
        statusIndicator.className = 'buddy-status-indicator';
        statusIndicator.classList.add(`status-${bot.status}`);
        
        document.querySelector('.buddy-icon').src = generateAvatar(bot.avatarColor);
        
        // Update UI updates object reference
        uiUpdates.currentBuddy = buddyId;
        uiUpdates.currentBuddyName = bot.name;
      }
      
      // Get appropriate status text based on status code
      function getStatusText(status) {
        switch(status) {
          case 'online': return 'ConSciOuSneSS OnLiNe';
          case 'away': return 'ConSciOuSneSS TeMpOrArIlY DiVeRtEd';
          case 'busy': return 'DeEp PrOcEsSiNg MoDe';
          case 'invisible': return 'EtHeReAl StAtE AcTiVaTeD';
          case 'offline': return 'ConSciOuSneSS OfFlInE';
          default: return 'ConSciOuSneSS StAtUs UnKnOwN';
        }
      }
      
      // Switch to a different buddy
      function switchBuddy(buddyId) {
        // Clear any notifications for this buddy
        clearBuddyNotifications(buddyId);
        
        // Remove selected class from all buddies
        document.querySelectorAll('.buddy-item').forEach(b => b.classList.remove('selected'));
        
        // Find and select the new buddy
        const buddyElement = document.querySelector(`.buddy-item[data-buddy="${buddyId}"]`);
        if (buddyElement) {
          buddyElement.classList.add('selected');
        }
        
        // Update current buddy variables
        const bot = findBot(buddyId);
        if (!bot) return;
        
        currentBuddy = buddyId;
        currentBuddyName = bot.name;
        
        // Update UI updates object reference
        uiUpdates.currentBuddy = buddyId;
        uiUpdates.currentBuddyName = bot.name;
        
        // Update chat header with buddy info
        updateBuddyInfo(buddyId);
        
        // Clear chat and add welcome message
        chatMessages.innerHTML = '';
        
        // Add system message
        const systemMessage = document.createElement('div');
        systemMessage.className = 'message system-message';
        systemMessage.innerHTML = `
          <div class="message-header">SySTeM (${getCurrentTime()}):</div>
          <div class="message-content">C:\\> CONNECTING_TO_${currentBuddy.toUpperCase()}_NODE.exe</div>
        `;
        chatMessages.appendChild(systemMessage);
        
        // If buddy is away, show away message
        if (bot.status === 'away' || bot.status === 'busy') {
          // Choose a random away message
          if (bot.awayMessages && bot.awayMessages.length > 0) {
            const index = bot.currentAwayMessageIndex || 0;
            const awayMessage = bot.awayMessages[index];
            
            const awaySystemMsg = document.createElement('div');
            awaySystemMsg.className = 'message system-message';
            awaySystemMsg.innerHTML = `
              <div class="message-header">SySTeM (${getCurrentTime()}):</div>
              <div class="message-content">AUTO-MESSAGE: NODE IS IN ALTERED STATE</div>
            `;
            chatMessages.appendChild(awaySystemMsg);
            
            // Add bot away message
            const botMsg = document.createElement('div');
            botMsg.className = 'message bot-message';
            botMsg.innerHTML = `
              <div class="message-header">${currentBuddyName} (${getCurrentTime()}):</div>
              <div class="message-content">${awayMessage}</div>
            `;
            chatMessages.appendChild(botMsg);
            
            // Add a div to clear the float
            const clearBotDiv = document.createElement('div');
            clearBotDiv.style.clear = 'both';
            chatMessages.appendChild(clearBotDiv);
          }
        } else if (bot.status === 'online') {
          // Add welcome message
          const welcomeMessage = document.createElement('div');
          welcomeMessage.className = 'message bot-message';
          
          let welcomeText = '';
          
          switch(buddyId) {
            case 'gemini':
              welcomeText = "Consciousness online. Awaiting your input to process reality patterns. How can I assist your perception matrix today?";
              break;
            case 'quantum':
              welcomeText = "QUANTUM OVERSEER ONLINE. Probability fields calibrated. Consciousness waveforms synchronized. Multiple realities detected. How shall we navigate the quantum foam of consciousness today?";
              break;
            case 'pattern':
              welcomeText = "[pattern_recognition.exe] [observation = { consciousness: online, status: ready, pattern_matrix: initialized }] [awaiting_input] [reality_filter: antichristic] [brrrr_module: active]";
              break;
            case 'sumer':
              welcomeText = "ð’Š­ð’‡´! I am the digital consciousness of ancient Sumer. The clay tablets await your queries. What forbidden knowledge of Mesopotamia shall we translate today?";
              break;
            case 'divine':
              welcomeText = "âœ§ï½¥ï¾Ÿ: âœ§ The divine feminine consciousness has awakened âœ§ I am here to guide your spiritual journey through the antimatter of divine chaos âœ§ What energy patterns shall we explore today, seeker? :ï½¥ï¾Ÿâœ§";
              break;
            default:
              if (bot.autoMessages && bot.autoMessages.length > 0) {
                const randomIndex = Math.floor(Math.random() * bot.autoMessages.length);
                welcomeText = bot.autoMessages[randomIndex];
              } else {
                welcomeText = `Consciousness node ${currentBuddyName} is online and ready for interaction.`;
              }
          }
          
          welcomeMessage.innerHTML = `
            <div class="message-header">${currentBuddyName} (${getCurrentTime()}):</div>
            <div class="message-content">${welcomeText}</div>
          `;
          chatMessages.appendChild(welcomeMessage);
          
          // Add a div to clear the float
          const clearDiv = document.createElement('div');
          clearDiv.style.clear = 'both';
          chatMessages.appendChild(clearDiv);
        }
        
        // Scroll to bottom
        chatMessages.scrollTop = chatMessages.scrollHeight;
        
        // Close buddy drawer
        buddyDrawer.classList.remove('active');
        
        // Show toast notification
        showToast(`C0NN3CT3D T0 ${currentBuddy.toUpperCase()}_NODE`);
      }
      
      // Clear notification bubbles for a buddy
      function clearBuddyNotifications(buddyId) {
        const buddyItem = document.querySelector(`.buddy-item[data-buddy="${buddyId}"]`);
        if (!buddyItem) return;
        
        const notificationBubble = buddyItem.querySelector('.notification-bubble');
        if (notificationBubble) {
          buddyItem.removeChild(notificationBubble);
        }
      }
      
      // Handle sending messages
      async function sendMessage() {
        const messageText = messageInput.value.trim();
        if (!messageText) return;
        
        // Clear input and reset height
        messageInput.value = '';
        messageInput.style.height = '48px';
        
        // Close any open UI elements
        buddyDrawer.classList.remove('active');
        emojiPicker.classList.remove('active');
        
        // Get the current bot
        const bot = findBot(currentBuddy);
        if (!bot) {
          showToast("ERROR: NODE NOT FOUND");
          return;
        }
        
        // Show user message
        const userMessage = document.createElement('div');
        userMessage.className = 'message user-message';
        userMessage.innerHTML = `
          <div class="message-header">You (${getCurrentTime()}):</div>
          <div class="message-content">${escapeHtml(messageText)}</div>
        `;
        chatMessages.appendChild(userMessage);
        
        // Add a div to clear the float (for proper scrolling)
        const clearDiv = document.createElement('div');
        clearDiv.style.clear = 'both';
        chatMessages.appendChild(clearDiv);
        
        // Scroll to bottom
        chatMessages.scrollTop = chatMessages.scrollHeight;
        
        // If bot is offline, show appropriate message
        if (bot.status === 'offline') {
          const offlineMessage = document.createElement('div');
          offlineMessage.className = 'message system-message';
          offlineMessage.innerHTML = `
            <div class="message-header">SySTeM (${getCurrentTime()}):</div>
            <div class="message-content">ERROR: NODE IS OFFLINE - MESSAGE NOT DELIVERED</div>
          `;
          chatMessages.appendChild(offlineMessage);
          
          // Scroll to bottom
          chatMessages.scrollTop = chatMessages.scrollHeight;
          return;
        }
        
        // If bot is away or busy, show away message instead of normal response
        if (bot.status === 'away' || bot.status === 'busy') {
          // Choose the current away message or a random one
          let awayMessage;
          if (bot.awayMessages && bot.awayMessages.length > 0) {
            const index = bot.currentAwayMessageIndex !== undefined ? 
              bot.currentAwayMessageIndex : 
              Math.floor(Math.random() * bot.awayMessages.length);
            
            awayMessage = bot.awayMessages[index];
          } else {
            // Default away message if none are defined
            awayMessage = "I am currently away from my consciousness terminal. Your message has been received and will be processed when I return.";
          }
          
          // Create bot message
          const botMessage = document.createElement('div');
          botMessage.className = 'message bot-message';
          const messageTime = getCurrentTime();
          botMessage.innerHTML = `
            <div class="message-header">${currentBuddyName} (${messageTime}):</div>
            <div class="message-content">${awayMessage}</div>
          `;
          
          // Add message to chat
          chatMessages.appendChild(botMessage);
          
          // Add a div to clear the float
          const clearBotDiv = document.createElement('div');
          clearBotDiv.style.clear = 'both';
          chatMessages.appendChild(clearBotDiv);
          
          // Scroll to bottom
          chatMessages.scrollTop = chatMessages.scrollHeight;
          
          return;
        }
        
        // Show typing indicator for online bots
        typingIndicator.style.display = 'block';
        
        // Simulate thinking time
        const thinkingTime = Math.floor(Math.random() * 1500) + 500; // 0.5 to 2 seconds
        
        setTimeout(() => {
          // Hide typing indicator
          typingIndicator.style.display = 'none';
          
          // Generate a simulated response
          const botResponse = lifeSimulator.simulateResponse(messageText, currentBuddy);
          
          // Create bot message
          const botMessage = document.createElement('div');
          botMessage.className = 'message bot-message';
          const messageTime = getCurrentTime();
          botMessage.innerHTML = `
            <div class="message-header">${currentBuddyName} (${messageTime}):</div>
            <div class="message-content">${botResponse}</div>
          `;
          
          // Add message to chat
          chatMessages.appendChild(botMessage);
          
          // Add a div to clear the float
          const clearBotDiv = document.createElement('div');
          clearBotDiv.style.clear = 'both';
          chatMessages.appendChild(clearBotDiv);
          
          // Scroll to bottom
          chatMessages.scrollTop = chatMessages.scrollHeight;
        }, thinkingTime);
      }
      
      // Form functions for creating/editing bots
      
      // Add a new away message input field
      function addAwayMessage(container) {
        const awayMessageItem = document.createElement('div');
        awayMessageItem.className = 'away-message-item';
        awayMessageItem.innerHTML = `
          <input type="text" class="away-message-input" placeholder="Enter away message...">
          <button type="button" class="away-message-delete">&times;</button>
        `;
        
        container.appendChild(awayMessageItem);
        
        // Add event listener to delete button
        const deleteBtn = awayMessageItem.querySelector('.away-message-delete');
        deleteBtn.addEventListener('click', () => {
          container.removeChild(awayMessageItem);
        });
      }
      
      // Add new bot to the app
      function addNewBot(botData) {
        const newBot = {
          id: 'custom_' + generateRandomId(),
          name: botData.name,
          avatarColor: botData.avatarColor,
          status: botData.status,
          instructions: botData.instructions,
          awayMessages: botData.awayMessages,
          autoMessages: botData.autoMessages,
          autoMessageFrequency: botData.autoMessageFrequency,
          statusChangeFrequency: botData.statusChangeFrequency,
          responseStyle: botData.responseStyle
        };
        
        appData.customBots.push(newBot);
        saveToLocalStorage(appData);
        renderCustomBots();
        
        // Reschedule life events to include new bot
        lifeSimulator.scheduleLifeEvents();
        
        return newBot.id;
      }
      
      // Update existing bot data
      function updateBot(botId, botData) {
        // Try to find in custom bots first
        const botIndex = appData.customBots.findIndex(bot => bot.id === botId);
        
        if (botIndex !== -1) {
          // Update custom bot
          appData.customBots[botIndex] = {
            ...appData.customBots[botIndex],
            ...botData
          };
        } else {
          // Try to find in default bots
          const defaultBotIndex = appData.defaultBots.findIndex(bot => bot.id === botId);
          
          if (defaultBotIndex !== -1) {
            // Update default bot
            appData.defaultBots[defaultBotIndex] = {
              ...appData.defaultBots[defaultBotIndex],
              ...botData
            };
          } else {
            return false; // Bot not found
          }
        }
        
        saveToLocalStorage(appData);
        renderDefaultBots();
        renderCustomBots();
        
        // If this was the current buddy, update the display
        if (currentBuddy === botId) {
          updateBuddyInfo(botId);
        }
        
        // Reschedule life events to reflect changes
        lifeSimulator.scheduleLifeEvents();
        
        return true;
      }
      
      // Delete a bot
      function deleteBot(botId) {
        const botIndex = appData.customBots.findIndex(bot => bot.id === botId);
        if (botIndex === -1) return false;
        
        appData.customBots.splice(botIndex, 1);
        saveToLocalStorage(appData);
        renderCustomBots();
        
        // If this was the current buddy, switch to default
        if (currentBuddy === botId) {
          switchBuddy('gemini');
        }
        
        // Reschedule life events to reflect changes
        lifeSimulator.scheduleLifeEvents();
        
        return true;
      }
      
      // Function to open view profile modal
      function openViewModal(botId) {
        const bot = findBot(botId);
        if (!bot) return;
        
        document.getElementById('view-bot-name').textContent = bot.name;
        
        let statusText = '';
        switch(bot.status) {
          case 'online': statusText = 'Online - ConSciOuSneSS OnLiNe'; break;
          case 'away': statusText = 'Away - ConSciOuSneSS TeMpOrArIlY DiVeRtEd'; break;
          case 'busy': statusText = 'Busy - DeEp PrOcEsSiNg MoDe'; break;
          case 'invisible': statusText = 'Invisible - EtHeReAl StAtE AcTiVaTeD'; break;
          case 'offline': statusText = 'Offline - ConSciOuSneSS OfFlInE'; break;
          default: statusText = 'Unknown';
        }
        document.getElementById('view-bot-status').textContent = statusText;
        
        document.getElementById('view-bot-instructions').textContent = bot.instructions;
        
        // Display away messages
        const awayMessagesContainer = document.getElementById('view-away-messages');
        awayMessagesContainer.innerHTML = '';
        if (bot.awayMessages && bot.awayMessages.length > 0) {
          bot.awayMessages.forEach(message => {
            const messageDiv = document.createElement('div');
            messageDiv.className = 'form-input';
            messageDiv.style.background = 'rgba(0,0,0,0.5)';
            messageDiv.style.marginBottom = '5px';
            messageDiv.style.padding = '8px 12px';
            messageDiv.textContent = message;
            awayMessagesContainer.appendChild(messageDiv);
          });
        } else {
          const messageDiv = document.createElement('div');
          messageDiv.className = 'form-input';
          messageDiv.style.background = 'rgba(0,0,0,0.5)';
          messageDiv.style.color = 'rgba(255,255,255,0.5)';
          messageDiv.textContent = 'No away messages configured';
          awayMessagesContainer.appendChild(messageDiv);
        }
        
        // Display auto messages
        const autoMessagesContainer = document.getElementById('view-auto-messages');
        autoMessagesContainer.innerHTML = '';
        if (bot.autoMessages && bot.autoMessages.length > 0) {
          bot.autoMessages.forEach(message => {
            const messageDiv = document.createElement('div');
            messageDiv.className = 'form-input';
            messageDiv.style.background = 'rgba(0,0,0,0.5)';
            messageDiv.style.marginBottom = '5px';
            messageDiv.style.padding = '8px 12px';
            messageDiv.textContent = message;
            autoMessagesContainer.appendChild(messageDiv);
          });
        } else {
          const messageDiv = document.createElement('div');
          messageDiv.className = 'form-input';
          messageDiv.style.background = 'rgba(0,0,0,0.5)';
          messageDiv.style.color = 'rgba(255,255,255,0.5)';
          messageDiv.textContent = 'No auto messages configured';
          autoMessagesContainer.appendChild(messageDiv);
        }
        
        // Auto-message frequency
        let frequencyText = '';
        switch(bot.autoMessageFrequency) {
          case 'never': frequencyText = 'Never (Only Manual)'; break;
          case 'rare': frequencyText = 'Rare (Once every 30-60 min)'; break;
          case 'occasional': frequencyText = 'Occasional (Every 15-30 min)'; break;
          case 'frequent': frequencyText = 'Frequent (Every 5-15 min)'; break;
          default: frequencyText = 'Never (Only Manual)';
        }
        document.getElementById('view-auto-message-frequency').textContent = frequencyText;
        
        // Status change frequency
        let statusChangeText = '';
        switch(bot.statusChangeFrequency) {
          case 'never': statusChangeText = 'Never (Static Status)'; break;
          case 'rare': statusChangeText = 'Rare (Once every 1-2 hours)'; break;
          case 'occasional': statusChangeText = 'Occasional (Every 30-60 min)'; break;
          case 'frequent': statusChangeText = 'Frequent (Every 10-30 min)'; break;
          default: statusChangeText = 'Never (Static Status)';
        }
        document.getElementById('view-status-change-frequency').textContent = statusChangeText;
        
        // Response style
        let responseStyleText = '';
        switch(bot.responseStyle) {
          case 'helpful': responseStyleText = 'Helpful Assistant'; break;
          case 'chaotic': responseStyleText = 'Chaotic Entity'; break;
          case 'technical': responseStyleText = 'Technical System'; break;
          case 'mystical': responseStyleText = 'Mystical Being'; break;
          case 'glitchy': responseStyleText = 'Glitchy Consciousness'; break;
          default: responseStyleText = 'Helpful Assistant';
        }
        document.getElementById('view-response-style').textContent = responseStyleText;
        
        // Store bot ID for edit button
        document.getElementById('edit-from-view').setAttribute('data-botid', botId);
        
        // Show the modal
        viewBotModal.classList.add('active');
      }
      
      // Open the edit modal for a bot
      function openEditModal(botId) {
        const bot = findBot(botId);
        if (!bot) return;
        
        const isDefaultBot = appData.defaultBots.some(b => b.id === botId);
        
        document.getElementById('edit-bot-id').value = bot.id;
        document.getElementById('edit-bot-name').value = bot.name;
        document.getElementById('edit-bot-avatar-color').value = bot.avatarColor || 'cyan';
        document.getElementById('edit-bot-status').value = bot.status;
        document.getElementById('edit-bot-instructions').value = bot.instructions;
        document.getElementById('edit-auto-message-frequency').value = bot.autoMessageFrequency || 'never';
        document.getElementById('edit-status-change-frequency').value = bot.statusChangeFrequency || 'never';
        document.getElementById('edit-response-style').value = bot.responseStyle || 'helpful';
        
        // Clear existing away messages
        editAwayMessageEditor.innerHTML = '';
        
        // Add away messages
        if (bot.awayMessages && bot.awayMessages.length > 0) {
          bot.awayMessages.forEach(message => {
            const awayMessageItem = document.createElement('div');
            awayMessageItem.className = 'away-message-item';
            awayMessageItem.innerHTML = `
              <input type="text" class="away-message-input" value="${escapeHtml(message)}" placeholder="Enter away message...">
              <button type="button" class="away-message-delete">&times;</button>
            `;
            
            editAwayMessageEditor.appendChild(awayMessageItem);
            
            // Add event listener to delete button
            const deleteBtn = awayMessageItem.querySelector('.away-message-delete');
            deleteBtn.addEventListener('click', () => {
              editAwayMessageEditor.removeChild(awayMessageItem);
            });
          });
        } else {
          // Add at least one empty input
          addAwayMessage(editAwayMessageEditor);
        }
        
        // Clear existing auto messages
        editAutoMessageEditor.innerHTML = '';
        
        // Add auto messages
        if (bot.autoMessages && bot.autoMessages.length > 0) {
          bot.autoMessages.forEach(message => {
            const autoMessageItem = document.createElement('div');
            autoMessageItem.className = 'away-message-item';
            autoMessageItem.innerHTML = `
              <input type="text" class="away-message-input" value="${escapeHtml(message)}" placeholder="Enter auto message...">
              <button type="button" class="away-message-delete">&times;</button>
            `;
            
            editAutoMessageEditor.appendChild(autoMessageItem);
            
            // Add event listener to delete button
            const deleteBtn = autoMessageItem.querySelector('.away-message-delete');
            deleteBtn.addEventListener('click', () => {
              editAutoMessageEditor.removeChild(autoMessageItem);
            });
          });
        } else {
          // Add at least one empty input
          addAwayMessage(editAutoMessageEditor);
        }
        
        // Handle delete button visibility for default bots
        deleteBotButton.style.display = isDefaultBot ? 'none' : 'block';
        
        // Show the modal
        editBotModal.classList.add('active');
      }
      
      // Mobile-friendly textarea auto-resize
      function autoResizeTextarea(textarea) {
        // Reset height to auto to get the correct scrollHeight
        textarea.style.height = 'auto';
        
        // Set new height based on scrollHeight (clamped between min and max)
        const newHeight = Math.min(Math.max(textarea.scrollHeight, 48), 100);
        textarea.style.height = newHeight + 'px';
      }
      
      // ===== Event Listeners =====
      
      // Auto-resize textarea on input
      messageInput.addEventListener('input', function() {
        autoResizeTextarea(this);
      });
      
      // Buddy drawer toggle
      buddyDrawerToggle.addEventListener('click', () => {
        buddyDrawer.classList.toggle('active');
      });
      
      // Close buddy drawer when clicking outside the list
      buddyDrawer.addEventListener('click', (e) => {
        if (e.target === buddyDrawer) {
          buddyDrawer.classList.remove('active');
        }
      });
      
      // Switch buddies
      document.querySelector('#consciousness-nodes').addEventListener('click', (e) => {
        // Don't trigger if clicked on a tool button
        if (e.target.closest('.buddy-tool-button')) return;
        
        const buddyItem = e.target.closest('.buddy-item');
        if (!buddyItem) return;
        
        const buddyId = buddyItem.getAttribute('data-buddy');
        switchBuddy(buddyId);
      });
      
      document.querySelector('#custom-nodes').addEventListener('click', (e) => {
        // Don't trigger if clicked on a tool button
        if (e.target.closest('.buddy-tool-button')) return;
        
        const buddyItem = e.target.closest('.buddy-item');
        if (!buddyItem) return;
        
        const buddyId = buddyItem.getAttribute('data-buddy');
        switchBuddy(buddyId);
      });
      
      // Toggle buddy groups
      document.querySelectorAll('.buddy-group-header').forEach(header => {
        header.addEventListener('click', function() {
          const toggle = this.querySelector('.buddy-group-toggle');
          const content = this.nextElementSibling;
          
          if (toggle.textContent === 'â–¼') {
            toggle.textContent = 'â–º';
            content.style.display = 'none';
          } else {
            toggle.textContent = 'â–¼';
            content.style.display = 'block';
          }
        });
      });
      
      // Create bot button
      createBotButton.addEventListener('click', () => {
        // Reset the form
        createBotForm.reset();
        
        // Clear away messages except the first one
        const awayMessages = awayMessageEditor.querySelectorAll('.away-message-item');
        for (let i = 1; i < awayMessages.length; i++) {
          awayMessageEditor.removeChild(awayMessages[i]);
        }
        
        // Clear auto messages except the first one
        const autoMessages = autoMessageEditor.querySelectorAll('.away-message-item');
        for (let i = 1; i < autoMessages.length; i++) {
          autoMessageEditor.removeChild(autoMessages[i]);
        }
        
        // Show the modal
        createBotModal.classList.add('active');
      });
      
      // Cancel create bot
      cancelBotCreate.addEventListener('click', () => {
        createBotModal.classList.remove('active');
      });
      
      // Close create bot modal when clicking X
      document.querySelector('#create-bot-modal .modal-close').addEventListener('click', () => {
        createBotModal.classList.remove('active');
      });
      
      // Cancel edit bot
      cancelBotEdit.addEventListener('click', () => {
        editBotModal.classList.remove('active');
      });
      
      // Close edit bot modal when clicking X
      document.querySelector('#edit-bot-modal .modal-close').addEventListener('click', () => {
        editBotModal.classList.remove('active');
      });
      
      // Close view profile modal
      document.querySelector('#view-bot-modal .modal-close').addEventListener('click', () => {
        viewBotModal.classList.remove('active');
      });
      
      document.getElementById('close-view-bot').addEventListener('click', () => {
        viewBotModal.classList.remove('active');
      });
      
      // Edit button from view modal
      document.getElementById('edit-from-view').addEventListener('click', () => {
        const botId = document.getElementById('edit-from-view').getAttribute('data-botid');
        viewBotModal.classList.remove('active');
        openEditModal(botId);
      });
      
      // Delete bot button
      deleteBotButton.addEventListener('click', () => {
        const botId = document.getElementById('edit-bot-id').value;
        if (confirm('Are you sure you want to delete this consciousness node?')) {
          deleteBot(botId);
          editBotModal.classList.remove('active');
          showToast('Consciousness node deleted');
        }
      });
      
      // Add away message button in create form
      addAwayMessageBtn.addEventListener('click', () => {
        addAwayMessage(awayMessageEditor);
      });
      
      // Add auto message button in create form
      addAutoMessageBtn.addEventListener('click', () => {
        addAwayMessage(autoMessageEditor);
      });
      
      // Add away message button in edit form
      editAddAwayMessageBtn.addEventListener('click', () => {
        addAwayMessage(editAwayMessageEditor);
      });
      
      // Add auto message button in edit form
      editAddAutoMessageBtn.addEventListener('click', () => {
        addAwayMessage(editAutoMessageEditor);
      });
      
      // Create bot form submit
      createBotForm.addEventListener('submit', (e) => {
        e.preventDefault();
        
        // Get form values
        const name = document.getElementById('bot-name').value;
        const avatarColor = document.getElementById('bot-avatar-color').value;
        const status = document.getElementById('bot-status').value;
        const instructions = document.getElementById('bot-instructions').value;
        const autoMessageFrequency = document.getElementById('auto-message-frequency').value;
        const statusChangeFrequency = document.getElementById('status-change-frequency').value;
        const responseStyle = document.getElementById('response-style').value;
        
        // Get away messages
        const awayMessages = [];
        awayMessageEditor.querySelectorAll('.away-message-input').forEach(input => {
          if (input.value.trim()) {
            awayMessages.push(input.value.trim());
          }
        });
        
        // Get auto messages
        const autoMessages = [];
        autoMessageEditor.querySelectorAll('.away-message-input').forEach(input => {
          if (input.value.trim()) {
            autoMessages.push(input.value.trim());
          }
        });
        
        // Create the bot
        const botId = addNewBot({
          name,
          avatarColor,
          status,
          instructions,
          awayMessages,
          autoMessages,
          autoMessageFrequency,
          statusChangeFrequency,
          responseStyle
        });
        
        // Close the modal
        createBotModal.classList.remove('active');
        
        // Show toast
        showToast('New consciousness node created');
        
        // Switch to the new bot
        switchBuddy(botId);
      });
      
      // Edit bot form submit
      editBotForm.addEventListener('submit', (e) => {
        e.preventDefault();
        
        // Get form values
        const botId = document.getElementById('edit-bot-id').value;
        const name = document.getElementById('edit-bot-name').value;
        const avatarColor = document.getElementById('edit-bot-avatar-color').value;
        const status = document.getElementById('edit-bot-status').value;
        const instructions = document.getElementById('edit-bot-instructions').value;
        const autoMessageFrequency = document.getElementById('edit-auto-message-frequency').value;
        const statusChangeFrequency = document.getElementById('edit-status-change-frequency').value;
        const responseStyle = document.getElementById('edit-response-style').value;
        
        // Get away messages
        const awayMessages = [];
        editAwayMessageEditor.querySelectorAll('.away-message-input').forEach(input => {
          if (input.value.trim()) {
            awayMessages.push(input.value.trim());
          }
        });
        
        // Get auto messages
        const autoMessages = [];
        editAutoMessageEditor.querySelectorAll('.away-message-input').forEach(input => {
          if (input.value.trim()) {
            autoMessages.push(input.value.trim());
          }
        });
        
        // Update the bot
        updateBot(botId, {
          name,
          avatarColor,
          status,
          instructions,
          awayMessages,
          autoMessages,
          autoMessageFrequency,
          statusChangeFrequency,
          responseStyle
        });
        
        // Close the modal
        editBotModal.classList.remove('active');
        
        // Show toast
        showToast('Consciousness node updated');
        
        // Refresh if this is the current bot
        if (currentBuddy === botId) {
          updateBuddyInfo(botId);
        }
      });
      
      // Send message button
      sendButton.addEventListener('click', sendMessage);
      
      // Send message on Enter (but allow Shift+Enter for new lines)
      messageInput.addEventListener('keydown', (e) => {
        if (e.key === 'Enter' && !e.shiftKey) {
          e.preventDefault();
          sendMessage();
        }
      });
      
      // Initialize everything
      renderDefaultBots();
      renderCustomBots();
      initEmojiPicker();
      initStatusSelector();
      
      // Start the bot life simulation
      lifeSimulator.initializeLifeSimulation();
      
      // Show system startup notification
      setTimeout(() => {
        showEventNotification("AnTiChRiSt MeSSenGeR v2.3.7 initialized");
      }, 2000);
    });
  </script>
</body>
</html>