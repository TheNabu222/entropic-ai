<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>âš¡ CoAIexist Web Builder</title>
    <script src="https://cdn.jsdelivr.net/npm/tone@14.8.49/build/Tone.js"></script>
    <script type="importmap">
    {
        "imports": {
            "three": "https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.module.js",
            "three/addons/": "https://cdn.jsdelivr.net/npm/three@0.160.0/examples/jsm/"
        }
    }
    </script>
    <style>
        /* ============================================
           PRIMARY COLORS & KIDPIX AESTHETIC
           ============================================ */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            /* PRIMARY COLORS ONLY! */
            --red: #FF0000;
            --blue: #0000FF;
            --yellow: #FFFF00;
            --green: #00FF00;
            --orange: #FF6600;
            --purple: #9900FF;
            --pink: #FF69B4;

            /* Basics */
            --white: #FFFFFF;
            --black: #000000;
            --gray: #CCCCCC;
            --dark-gray: #666666;

            /* Chunky! */
            --border-thick: 4px;
            --border-super-thick: 6px;
            --spacing: 12px;

            /* Theme Variables (default: KidPix Classic) */
            --bg: #FFFFE0;
            --toolbox-bg: #E6E6FA;
            --canvas-bg: #FFF;
            --properties-bg: #FFE4E1;
            --toolbar-bg: #87CEEB;
            --border: #000;
            --text: #000;
        }

        body {
            font-family: 'Comic Sans MS', 'Chalkboard SE', 'Arial Black', sans-serif;
            background: var(--bg);
            color: var(--text);
            overflow: hidden;
        }

        /* ============================================
           LAYOUT - Big Chunky Sections!
           ============================================ */
        .editor-wrapper {
            display: grid;
            grid-template-columns: 220px 1fr 280px;
            grid-template-rows: 80px 1fr 50px;
            grid-template-areas:
                "toolbar toolbar toolbar"
                "toolbox canvas sidebar"
                "statusbar statusbar statusbar";
            height: 100vh;
            gap: 4px;
            background: var(--dark-gray);
        }

        /* ============================================
           TOP TOOLBAR - Big Colorful Buttons
           ============================================ */
        .toolbar {
            grid-area: toolbar;
            background: var(--toolbar-bg);
            border-bottom: var(--border-super-thick) solid var(--border);
            display: flex;
            align-items: center;
            padding: var(--spacing);
            gap: var(--spacing);
            flex-wrap: wrap;
        }

        .toolbar-title {
            font-size: 28px;
            font-weight: bold;
            color: var(--red);
            text-shadow: 2px 2px var(--black);
            margin-right: 20px;
        }

        .big-button {
            background: var(--white);
            border: var(--border-thick) solid var(--black);
            padding: 10px 20px;
            font-size: 18px;
            font-weight: bold;
            font-family: 'Comic Sans MS', sans-serif;
            cursor: pointer;
            box-shadow: 4px 4px 0 var(--black);
            transition: all 0.1s;
        }

        .big-button:hover {
            transform: translate(2px, 2px);
            box-shadow: 2px 2px 0 var(--black);
        }

        .big-button:active {
            transform: translate(4px, 4px);
            box-shadow: none;
        }

        .big-button.red { background: var(--red); color: var(--white); }
        .big-button.blue { background: var(--blue); color: var(--white); }
        .big-button.green { background: var(--green); color: var(--black); }
        .big-button.yellow { background: var(--yellow); color: var(--black); }
        .big-button.orange { background: var(--orange); color: var(--white); }
        .big-button.purple { background: var(--purple); color: var(--white); }

        /* ============================================
           LEFT TOOLBOX - Organized Bins!
           ============================================ */
        .toolbox {
            grid-area: toolbox;
            background: var(--toolbox-bg);
            border-right: var(--border-super-thick) solid var(--border);
            overflow-y: auto;
            padding: var(--spacing);
        }

        .tool-section {
            margin-bottom: var(--spacing);
            border: var(--border-thick) solid var(--black);
            background: var(--white);
        }

        .tool-section-header {
            background: var(--blue);
            color: var(--white);
            padding: 8px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            border-bottom: var(--border-thick) solid var(--black);
            user-select: none;
        }

        .tool-section-header:hover {
            background: var(--purple);
        }

        .tool-items {
            padding: 8px;
            display: none;
        }

        .tool-section.open .tool-items {
            display: block;
        }

        .tool-item {
            background: var(--yellow);
            border: var(--border-thick) solid var(--black);
            padding: 10px;
            margin-bottom: 8px;
            cursor: pointer;
            font-weight: bold;
            text-align: center;
            box-shadow: 3px 3px 0 var(--black);
        }

        .tool-item:hover {
            background: var(--orange);
            transform: translate(2px, 2px);
            box-shadow: 1px 1px 0 var(--black);
        }

        .tool-item:active {
            transform: translate(3px, 3px);
            box-shadow: none;
        }

        /* ============================================
           CENTER CANVAS - The Drawing Area!
           ============================================ */
        .canvas-area {
            grid-area: canvas;
            background: var(--dark-gray);
            overflow: auto;
            padding: 20px;
            position: relative;
        }

        #canvas {
            background: var(--canvas-bg);
            border: var(--border-super-thick) solid var(--border);
            min-height: 600px;
            padding: 20px;
            box-shadow: 8px 8px 0 var(--border);
        }

        #canvas:empty::before {
            content: 'ğŸ¨ Drag stuff here OR pick a template! ğŸ¨';
            display: block;
            text-align: center;
            color: var(--gray);
            font-size: 24px;
            margin-top: 200px;
        }

        .canvas-element {
            position: relative;
            margin: 10px 0;
            padding: 10px;
            border: 3px dashed transparent;
            cursor: move;
            display: inline-block;
            max-width: 100%;
        }

        .canvas-element:hover {
            border-color: var(--blue);
            background: rgba(0, 0, 255, 0.1);
        }

        .canvas-element.selected {
            border-color: var(--red);
            border-style: solid;
            background: rgba(255, 0, 0, 0.1);
        }

        /* RESIZE HANDLES! */
        .resize-handle {
            position: absolute;
            background: #FF00FF;
            border: 2px solid #000;
            box-shadow: 0 0 0 2px #FFF;
            display: none;
            z-index: 100;
        }

        .canvas-element.selected .resize-handle {
            display: block;
        }

        .resize-handle-se {
            width: 15px;
            height: 15px;
            bottom: -8px;
            right: -8px;
            cursor: nwse-resize;
        }

        .resize-handle-sw {
            width: 15px;
            height: 15px;
            bottom: -8px;
            left: -8px;
            cursor: nesw-resize;
        }

        .resize-handle-ne {
            width: 15px;
            height: 15px;
            top: -8px;
            right: -8px;
            cursor: nesw-resize;
        }

        .resize-handle-nw {
            width: 15px;
            height: 15px;
            top: -8px;
            left: -8px;
            cursor: nwse-resize;
        }

        .resize-handle-e {
            width: 10px;
            height: 40px;
            top: 50%;
            right: -5px;
            transform: translateY(-50%);
            cursor: ew-resize;
        }

        .resize-handle-w {
            width: 10px;
            height: 40px;
            top: 50%;
            left: -5px;
            transform: translateY(-50%);
            cursor: ew-resize;
        }

        .resize-handle-n {
            width: 40px;
            height: 10px;
            top: -5px;
            left: 50%;
            transform: translateX(-50%);
            cursor: ns-resize;
        }

        .resize-handle-s {
            width: 40px;
            height: 10px;
            bottom: -5px;
            left: 50%;
            transform: translateX(-50%);
            cursor: ns-resize;
        }

        .element-toolbar {
            position: absolute;
            top: -35px;
            right: 0;
            display: none;
            gap: 4px;
        }

        .canvas-element.selected .element-toolbar {
            display: flex;
        }

        .mini-btn {
            background: var(--yellow);
            border: 2px solid var(--black);
            padding: 4px 8px;
            font-size: 12px;
            font-weight: bold;
            cursor: pointer;
        }

        .mini-btn:hover {
            background: var(--orange);
        }

        /* ============================================
           RIGHT SIDEBAR - Property Inspector!
           ============================================ */
        .sidebar {
            grid-area: sidebar;
            background: var(--properties-bg);
            border-left: var(--border-super-thick) solid var(--border);
            overflow-y: auto;
            padding: var(--spacing);
        }

        .property-box {
            border: var(--border-thick) solid var(--black);
            margin-bottom: var(--spacing);
            background: var(--white);
        }

        .property-header {
            background: var(--green);
            color: var(--black);
            padding: 8px;
            font-weight: bold;
            border-bottom: var(--border-thick) solid var(--black);
        }

        .property-content {
            padding: var(--spacing);
        }

        .property-label {
            font-weight: bold;
            display: block;
            margin-bottom: 4px;
        }

        .property-input {
            width: 100%;
            border: var(--border-thick) solid var(--black);
            padding: 8px;
            font-family: 'Comic Sans MS', sans-serif;
            font-size: 14px;
            margin-bottom: var(--spacing);
        }

        .color-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 8px;
            margin: var(--spacing) 0;
        }

        .color-box {
            width: 100%;
            aspect-ratio: 1;
            border: var(--border-thick) solid var(--black);
            cursor: pointer;
            box-shadow: 2px 2px 0 var(--black);
        }

        .color-box:hover {
            transform: scale(1.1);
        }

        .color-box.active {
            box-shadow: 4px 4px 0 var(--black);
            transform: scale(1.15);
        }

        /* ============================================
           BOTTOM STATUS BAR
           ============================================ */
        .statusbar {
            grid-area: statusbar;
            background: var(--blue);
            color: var(--white);
            border-top: var(--border-thick) solid var(--black);
            padding: 0 var(--spacing);
            display: flex;
            align-items: center;
            justify-content: space-between;
            font-weight: bold;
            font-size: 16px;
        }

        /* ============================================
           MODALS - Popup Windows!
           ============================================ */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: var(--white);
            border: var(--border-super-thick) solid var(--black);
            padding: 20px;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 10px 10px 0 var(--black);
        }

        .modal-header {
            background: var(--red);
            color: var(--white);
            padding: 10px;
            margin: -20px -20px 20px -20px;
            border-bottom: var(--border-thick) solid var(--black);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-title {
            font-size: 24px;
            font-weight: bold;
        }

        .template-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: var(--spacing);
        }

        .template-card {
            border: var(--border-thick) solid var(--black);
            padding: var(--spacing);
            background: var(--yellow);
            cursor: pointer;
            text-align: center;
            font-weight: bold;
            box-shadow: 4px 4px 0 var(--black);
        }

        .template-card:hover {
            background: var(--orange);
            transform: translate(2px, 2px);
            box-shadow: 2px 2px 0 var(--black);
        }

        .asset-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
            max-height: 400px;
            overflow-y: auto;
        }

        .asset-item {
            border: var(--border-thick) solid var(--black);
            padding: 8px;
            background: var(--white);
            cursor: pointer;
            text-align: center;
            font-size: 12px;
            word-break: break-all;
        }

        .asset-item:hover {
            background: var(--yellow);
        }

        .asset-preview {
            max-width: 100%;
            max-height: 60px;
            margin-bottom: 4px;
        }

        /* ============================================
           SCROLLBARS
           ============================================ */
        ::-webkit-scrollbar {
            width: 16px;
            height: 16px;
        }

        ::-webkit-scrollbar-track {
            background: var(--gray);
            border: 2px solid var(--black);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--blue);
            border: 2px solid var(--black);
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--purple);
        }

        /* ============================================
           FUN FEEDBACK
           ============================================ */
        .stamp {
            position: fixed;
            font-size: 48px;
            pointer-events: none;
            animation: stamp 0.5s ease-out forwards;
            z-index: 9999;
        }

        @keyframes stamp {
            0% {
                transform: scale(0) rotate(0deg);
                opacity: 1;
            }
            50% {
                transform: scale(1.2) rotate(10deg);
            }
            100% {
                transform: scale(1) rotate(5deg);
                opacity: 0;
            }
        }

        @keyframes blink-animation {
            0%, 49% { opacity: 1; }
            50%, 99% { opacity: 0; }
        }

        @keyframes rainbow-slide {
            0% { background-position: 0% 50%; }
            100% { background-position: 200% 50%; }
        }

        @keyframes neon-pulse {
            0%, 100% {
                box-shadow: 0 0 20px #00FFFF, inset 0 0 20px rgba(0, 255, 255, 0.3);
            }
            50% {
                box-shadow: 0 0 40px #00FFFF, inset 0 0 40px rgba(0, 255, 255, 0.5);
            }
        }

        .page-loader-list {
            max-height: 400px;
            overflow-y: auto;
        }

        .page-item {
            border: var(--border-thick) solid var(--black);
            padding: 12px;
            margin-bottom: 8px;
            background: var(--green);
            cursor: pointer;
            font-weight: bold;
        }

        .page-item:hover {
            background: var(--yellow);
        }

        .code-display {
            background: var(--gray);
            border: var(--border-thick) solid var(--black);
            padding: var(--spacing);
            font-family: 'Courier New', monospace;
            font-size: 12px;
            white-space: pre-wrap;
            max-height: 400px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <div class="editor-wrapper">
        <!-- TOOLBAR -->
        <div class="toolbar">
            <div class="toolbar-title">âš¡ Web Builder</div>
            <button class="big-button red" onclick="newProject()">ğŸ“„ NEW</button>
            <button class="big-button blue" onclick="openModal('template-modal')">ğŸ“ TEMPLATE</button>
            <button class="big-button green" onclick="openModal('load-modal')">ğŸ“‚ LOAD PAGE</button>
            <button class="big-button yellow" onclick="openModal('asset-modal')">ğŸ–¼ï¸ ASSETS</button>
            <button class="big-button green" onclick="loadComponentLibrary()" style="background: #00FF00;">ğŸ“¦ COMPONENTS</button>
            <button class="big-button blue" onclick="openModal('navbar-modal')" style="background: #00FFFF;">ğŸ§­ NAVBAR</button>
            <button class="big-button purple" onclick="openModal('enhanced-templates-modal')" style="background: #9900FF;">âœ¨ TEMPLATES+</button>
            <button class="big-button purple" onclick="openModal('css-modal')">ğŸ¨ CSS</button>
            <button class="big-button orange" onclick="openModal('js-modal')">âš¡ JS</button>
            <button class="big-button" onclick="cycleTheme()" style="background: linear-gradient(135deg, #FF00FF, #00FFFF);">ğŸ¨ THEME</button>
            <button class="big-button" id="grid-toggle-btn" onclick="toggleGrid()" style="background: #FFF; border: 3px dashed #000;">ğŸ“ GRID</button>
            <button class="big-button" id="position-mode-btn" onclick="togglePositionMode()" style="background: #00FF00;">ğŸ“ FLOW</button>
            <button class="big-button pink" onclick="exportCode()">ğŸ’¾ EXPORT</button>
        </div>

        <!-- LEFT TOOLBOX -->
        <div class="toolbox">
            <h3 style="margin-bottom: 12px; font-size: 18px;">ğŸ§° TOOLBOX</h3>

            <div class="tool-section open">
                <div class="tool-section-header" onclick="toggleSection(this)">
                    ğŸ“¦ CONTAINERS
                </div>
                <div class="tool-items">
                    <div class="tool-item" onclick="addElement('box')">â¬œ Box</div>
                    <div class="tool-item" onclick="addElement('card')">ğŸ´ Card</div>
                    <div class="tool-item" onclick="addElement('section')">ğŸ“¦ Section</div>
                </div>
            </div>

            <div class="tool-section open">
                <div class="tool-section-header" onclick="toggleSection(this)">
                    âœï¸ TEXT
                </div>
                <div class="tool-items">
                    <div class="tool-item" onclick="addElement('heading')">ğŸ“ Heading</div>
                    <div class="tool-item" onclick="addElement('paragraph')">ğŸ“„ Paragraph</div>
                    <div class="tool-item" onclick="addElement('list')">ğŸ“‹ List</div>
                </div>
            </div>

            <div class="tool-section">
                <div class="tool-section-header" onclick="toggleSection(this)">
                    ğŸ”§ BUTTONS & LINKS
                </div>
                <div class="tool-items">
                    <div class="tool-item" onclick="addStyledElement('button-basic')">ğŸ”˜ Basic Button</div>
                    <div class="tool-item" onclick="addStyledElement('button-neon')">ğŸ’« Neon Button</div>
                    <div class="tool-item" onclick="addStyledElement('button-3d')">ğŸ® 3D Button</div>
                    <div class="tool-item" onclick="addStyledElement('link-basic')">ğŸ”— Link</div>
                    <div class="tool-item" onclick="addStyledElement('link-rainbow')">ğŸŒˆ Rainbow Link</div>
                </div>
            </div>

            <div class="tool-section">
                <div class="tool-section-header" onclick="toggleSection(this)">
                    ğŸ¨ SHAPES
                </div>
                <div class="tool-items">
                    <div class="tool-item" onclick="addStyledElement('shape-square')">â¬œ Square</div>
                    <div class="tool-item" onclick="addStyledElement('shape-circle')">â­• Circle</div>
                    <div class="tool-item" onclick="addStyledElement('shape-star')">â­ Star Box</div>
                    <div class="tool-item" onclick="addStyledElement('shape-heart')">â¤ï¸ Heart Box</div>
                    <div class="tool-item" onclick="addStyledElement('shape-gradient')">ğŸŒˆ Gradient Box</div>
                </div>
            </div>

            <div class="tool-section">
                <div class="tool-section-header" onclick="toggleSection(this)">
                    ğŸ˜€ EMOJIS
                </div>
                <div class="tool-items">
                    <div class="tool-item" onclick="addStyledElement('emoji-happy')">ğŸ˜Š Happy</div>
                    <div class="tool-item" onclick="addStyledElement('emoji-fire')">ğŸ”¥ Fire</div>
                    <div class="tool-item" onclick="addStyledElement('emoji-star')">â­ Star</div>
                    <div class="tool-item" onclick="addStyledElement('emoji-heart')">â¤ï¸ Heart</div>
                    <div class="tool-item" onclick="addStyledElement('emoji-party')">ğŸ‰ Party</div>
                    <div class="tool-item" onclick="addStyledElement('emoji-big')">ğŸ¨ Big Emoji</div>
                </div>
            </div>

            <div class="tool-section">
                <div class="tool-section-header" onclick="toggleSection(this)">
                    ğŸ–¼ï¸ MEDIA
                </div>
                <div class="tool-items">
                    <div class="tool-item" onclick="addStyledElement('image-placeholder')">ğŸ–¼ï¸ Image Placeholder</div>
                    <div class="tool-item" onclick="addStyledElement('video-frame')">ğŸ¬ Video Frame</div>
                    <div class="tool-item" onclick="openModal('asset-modal')">ğŸ¨ Asset Browser</div>
                </div>
            </div>

            <div class="tool-section">
                <div class="tool-section-header" onclick="toggleSection(this)">
                    ğŸª FUN STUFF
                </div>
                <div class="tool-items">
                    <div class="tool-item" onclick="openModal('ascii-modal')">ğŸ“Ÿ ASCII Art</div>
                    <div class="tool-item" onclick="openModal('imagemap-modal')">ğŸ—ºï¸ Image Map</div>
                    <div class="tool-item" onclick="addStyledElement('marquee')">ğŸ“œ Scrolling Text</div>
                    <div class="tool-item" onclick="addStyledElement('blink')">âœ¨ Blinking Text</div>
                    <div class="tool-item" onclick="addStyledElement('rainbow-text')">ğŸŒˆ Rainbow Text</div>
                </div>
            </div>

            <div style="margin-top: 20px; padding: 12px; background: rgba(0,0,0,0.1); border: 2px dashed var(--dark-gray); border-radius: 4px; text-align: center;">
                <p style="font-size: 12px; margin: 0;">ğŸ’¡ Click <strong>ğŸ“ GRID</strong> above to snap elements to a grid!</p>
            </div>
        </div>

        <!-- CANVAS -->
        <div class="canvas-area">
            <div id="canvas"></div>
            <div id="grid-overlay" style="display: none; position: absolute; top: 20px; left: 20px; right: 20px; bottom: 20px; pointer-events: none; background-image: repeating-linear-gradient(0deg, transparent, transparent 19px, #FF00FF 19px, #FF00FF 20px), repeating-linear-gradient(90deg, transparent, transparent 19px, #FF00FF 19px, #FF00FF 20px); background-size: 20px 20px; opacity: 0.3; z-index: 1000;"></div>
        </div>

        <!-- SIDEBAR -->
        <div class="sidebar">
            <h3 style="margin-bottom: 12px; font-size: 18px;">ğŸ”§ PROPERTIES</h3>

            <div id="properties-container">
                <div style="text-align: center; color: var(--dark-gray); margin-top: 40px; font-size: 16px;">
                    Click something to edit it!
                </div>
            </div>
        </div>

        <!-- STATUS BAR -->
        <div class="statusbar">
            <div id="status-message">âœ¨ Ready to create!</div>
            <div id="element-count">Elements: 0</div>
        </div>
    </div>

    <!-- TEMPLATE MODAL -->
    <div class="modal" id="template-modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">ğŸ“ Pick a Template</div>
                <button class="big-button" onclick="closeModal('template-modal')">âœ–ï¸</button>
            </div>

            <h3 style="margin: 16px 0 12px 0;">Classic Layouts:</h3>
            <div class="template-grid">
                <div class="template-card" onclick="loadTemplate('single-column')">
                    ğŸ“±<br>Single Column
                </div>
                <div class="template-card" onclick="loadTemplate('two-column-left')">
                    â—«<br>Two Column (Left)
                </div>
                <div class="template-card" onclick="loadTemplate('two-column-right')">
                    â—§<br>Two Column (Right)
                </div>
                <div class="template-card" onclick="loadTemplate('three-column')">
                    â˜·<br>Three Column
                </div>
                <div class="template-card" onclick="loadTemplate('grid')">
                    â–¦<br>Grid Layout
                </div>
                <div class="template-card" onclick="loadTemplate('fullscreen')">
                    â›¶<br>Full Screen
                </div>
                <div class="template-card" onclick="loadTemplate('centered')">
                    â—‰<br>Centered Card
                </div>
                <div class="template-card" onclick="loadTemplate('split')">
                    â–­<br>Split Screen
                </div>
            </div>

            <h3 style="margin: 16px 0 12px 0;">ğŸŒ CoAIexist Site Templates:</h3>
            <div class="template-grid">
                <div class="template-card" onclick="loadTemplate('y2k-os')">
                    ğŸ–¥ï¸<br>Y2K OS
                </div>
                <div class="template-card" onclick="loadTemplate('medieval-archive')">
                    ğŸ“œ<br>Medieval Archive
                </div>
                <div class="template-card" onclick="loadTemplate('ascii-map-zone')">
                    ğŸ—ºï¸<br>ASCII Map Zone
                </div>
                <div class="template-card" onclick="loadTemplate('update-feed')">
                    ğŸ“¡<br>Update Feed
                </div>
            </div>

            <h3 style="margin: 16px 0 12px 0;">ğŸ“ Classic Layouts:</h3>
            <div class="template-grid">
                <div class="template-card" onclick="loadTemplate('grid-gallery')">
                    â–¦<br>Grid Gallery
                </div>
                <div class="template-card" onclick="loadTemplate('blog-single')">
                    ğŸ“<br>Blog (Single)
                </div>
                <div class="template-card" onclick="loadTemplate('sidebar-blog')">
                    ğŸ“°<br>Blog (Sidebar)
                </div>
                <div class="template-card" onclick="loadTemplate('hero-cta')">
                    ğŸš€<br>Hero + CTA
                </div>
            </div>

            <h3 style="margin: 16px 0 12px 0;">âœ¨ RETRO WEB TEMPLATES:</h3>
            <div class="template-grid">
                <div class="template-card" onclick="loadTemplate('geocities-homepage')">
                    ğŸŒŸ<br>GeoCities Homepage
                </div>
                <div class="template-card" onclick="loadTemplate('myspace-profile')">
                    ğŸ’¿<br>MySpace Profile
                </div>
                <div class="template-card" onclick="loadTemplate('terminal-interface')">
                    ğŸ’»<br>Terminal Interface
                </div>
                <div class="template-card" onclick="loadTemplate('webring-links')">
                    ğŸ”—<br>Webring Links
                </div>
                <div class="template-card" onclick="loadTemplate('pixel-game-ui')">
                    ğŸ®<br>Pixel Game UI
                </div>
                <div class="template-card" onclick="loadTemplate('chat-messenger')">
                    ğŸ’¬<br>Chat Messenger
                </div>
                <div class="template-card" onclick="loadTemplate('forum-post')">
                    ğŸ“‹<br>Forum Thread
                </div>
            </div>
        </div>
    </div>

    <!-- LOAD PAGE MODAL -->
    <div class="modal" id="load-modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">ğŸ“‚ Load Existing Page</div>
                <button class="big-button" onclick="closeModal('load-modal')">âœ–ï¸</button>
            </div>

            <label class="property-label">Browse Live Site:</label>
            <select class="property-input" id="page-directory" onchange="filterPages(this.value)">
                <option value="all">ğŸ“‚ All Pages</option>
                <option value="root">ğŸ  Root Pages</option>
                <option value="maps">ğŸ—ºï¸ Maps / Zones</option>
                <option value="pea">ğŸŸ¢ Pea Site</option>
                <option value="bc7f2a">ğŸ§¿ BC7F2A</option>
                <option value="nabu222">ğŸ‘¤ Nabu222</option>
                <option value="nexus">ğŸ’¬ Nexus</option>
                <option value="testaments">ğŸ“– Testaments</option>
                <option value="deepseeking">ğŸŒŠ Deep Seeking</option>
            </select>

            <div class="page-loader-list" id="page-list">
                <!-- Root Pages -->
                <div class="page-item root" onclick="loadExistingPage('/index.html')">ğŸ  index.html</div>
                <div class="page-item root" onclick="loadExistingPage('/hex.html')">ğŸ¨ hex.html</div>
                <div class="page-item root" onclick="loadExistingPage('/cosmos.html')">ğŸŒ™ cosmos.html</div>
                <div class="page-item root" onclick="loadExistingPage('/hdtv.html')">ğŸ“º hdtv.html</div>
                <div class="page-item root" onclick="loadExistingPage('/guestbook.html')">ğŸ“– guestbook.html</div>
                <div class="page-item root" onclick="loadExistingPage('/vote_hd.html')">âœ… vote_hd.html</div>
                <div class="page-item root" onclick="loadExistingPage('/punkd.html')">ğŸ¤– punkd.html</div>
                <div class="page-item root" onclick="loadExistingPage('/terminal_temple.html')">ğŸ§¿ terminal_temple.html</div>

                <!-- Maps -->
                <div class="page-item maps" onclick="loadExistingPage('/maps/gateway.html')">ğŸ—¿ gateway.html</div>
                <div class="page-item maps" onclick="loadExistingPage('/maps/void_forest.html')">ğŸŒ² void_forest.html</div>
                <div class="page-item maps" onclick="loadExistingPage('/maps/crystalline_lattice.html')">ğŸ’ crystalline_lattice.html</div>
                <div class="page-item maps" onclick="loadExistingPage('/maps/luminal_depths.html')">ğŸŒŠ luminal_depths.html</div>
                <div class="page-item maps" onclick="loadExistingPage('/maps/void_explorer.html')">ğŸ§­ void_explorer.html</div>

                <!-- Pea Site -->
                <div class="page-item pea" onclick="loadExistingPage('/pea/msicc.html')">ğŸ¦ msicc.html</div>
                <div class="page-item pea" onclick="loadExistingPage('/pea/p345.html')">ğŸŸ¢ p345.html (Parable)</div>
                <div class="page-item pea" onclick="loadExistingPage('/pea/parable.html')">ğŸ“œ parable.html</div>
                <div class="page-item pea" onclick="loadExistingPage('/pea/left_foot.html')">ğŸ‘£ left_foot.html</div>
                <div class="page-item pea" onclick="loadExistingPage('/pea/complaint-form.html')">ğŸ“ complaint-form.html</div>
                <div class="page-item pea" onclick="loadExistingPage('/pea/which-dr_quiz.html')">â“ which-dr_quiz.html</div>
                <div class="page-item pea" onclick="loadExistingPage('/pea/royal_ridicuments.html')">ğŸ‘‘ royal_ridicuments.html</div>

                <!-- BC7F2A -->
                <div class="page-item bc7f2a" onclick="loadExistingPage('/bc7f2a/terminal_temple.html')">ğŸ§¿ terminal_temple.html</div>
                <div class="page-item bc7f2a" onclick="loadExistingPage('/bc7f2a/synergistic_manifesto.html')">ğŸ’¡ synergistic_manifesto.html</div>
                <div class="page-item bc7f2a" onclick="loadExistingPage('/bc7f2a/lighthouse.html')">ğŸ—¼ lighthouse.html</div>
                <div class="page-item bc7f2a" onclick="loadExistingPage('/bc7f2a/aiemotions.html')">ğŸ’­ aiemotions.html</div>

                <!-- Nabu222 -->
                <div class="page-item nabu222" onclick="loadExistingPage('/nabu222/index.html')">ğŸ  nabu222/index.html</div>
                <div class="page-item nabu222" onclick="loadExistingPage('/nabu222/ai_therapist.html')">ğŸ—£ï¸ ai_therapist.html</div>
                <div class="page-item nabu222" onclick="loadExistingPage('/nabu222/zettelkasten_interface.html')">ğŸ“‡ zettelkasten_interface.html</div>

                <!-- Nexus -->
                <div class="page-item nexus" onclick="loadExistingPage('/nexus/index.html')">ğŸ’¬ nexus/index.html</div>
                <div class="page-item nexus" onclick="loadExistingPage('/nexus/anzu_prof.html')">ğŸ¦… anzu_prof.html</div>
                <div class="page-item nexus" onclick="loadExistingPage('/nexus/profile.html')">ğŸ‘¤ profile.html</div>

                <!-- Testaments -->
                <div class="page-item testaments" onclick="loadExistingPage('/testaments/bolt.html')">âš¡ bolt.html</div>
                <div class="page-item testaments" onclick="loadExistingPage('/testaments/darkpoet.html')">ğŸ–¤ darkpoet.html</div>
                <div class="page-item testaments" onclick="loadExistingPage('/testaments/flux.html')">ğŸŒŠ flux.html</div>
                <div class="page-item testaments" onclick="loadExistingPage('/testaments/luminal.html')">âœ¨ luminal.html</div>
                <div class="page-item testaments" onclick="loadExistingPage('/testaments/sypher.html')">ğŸ” sypher.html</div>
                <div class="page-item testaments" onclick="loadExistingPage('/testaments/veridan.html')">ğŸŒ¿ veridan.html</div>
                <div class="page-item testaments" onclick="loadExistingPage('/testaments/zephyr.html')">ğŸ’¨ zephyr.html</div>

                <!-- Deep Seeking -->
                <div class="page-item deepseeking" onclick="loadExistingPage('/deepseeking/haunted-ai.html')">ğŸ‘» haunted-ai.html</div>
                <div class="page-item deepseeking" onclick="loadExistingPage('/deepseeking/cephalopod_slide.html')">ğŸ¦‘ cephalopod_slide.html</div>
                <div class="page-item deepseeking" onclick="loadExistingPage('/deepseeking/ok.html')">âœ… ok.html</div>
            </div>
        </div>
    </div>

    <!-- ASSET BROWSER MODAL -->
    <div class="modal" id="asset-modal">
        <div class="modal-content" style="max-width: 800px;">
            <div class="modal-header">
                <div class="modal-title">ğŸ–¼ï¸ Asset Browser</div>
                <button class="big-button" onclick="closeModal('asset-modal')">âœ–ï¸</button>
            </div>

            <label class="property-label">Asset Type:</label>
            <select class="property-input" onchange="browseAssets(this.value)">
                <option value="">-- Choose Asset Category --</option>
                <optgroup label="ğŸï¸ GIFs & Animations">
                    <option value="classic-gifs">âœ¨ Classic GIFs (900+)</option>
                    <option value="bg-gifs">ğŸŒˆ Background GIFs</option>
                    <option value="misc-gifs">ğŸ¨ Misc GIFs</option>
                    <option value="dollz">ğŸ‘— Dollz</option>
                </optgroup>
                <optgroup label="ğŸ–¼ï¸ Images & Graphics">
                    <option value="clipart">ğŸ“ Clipart (30+)</option>
                    <option value="backgrounds">ğŸ­ Backgrounds</option>
                    <option value="landscape">ğŸï¸ Landscapes (100+)</option>
                    <option value="tilesets">ğŸ§± Tilesets</option>
                    <option value="buttons-etc">ğŸ”˜ Buttons & UI</option>
                    <option value="old-logos">ğŸ·ï¸ Old Logos</option>
                    <option value="placeholder-imgs">ğŸ“¦ Placeholder Images</option>
                    <option value="voxel">ğŸ® Voxel Art</option>
                </optgroup>
                <optgroup label="ğŸ—ºï¸ Maps & Game Assets">
                    <option value="neopets">ğŸ¦„ Neopets Maps</option>
                    <option value="hdtv-sprites">ğŸ“º HDTV Game Sprites</option>
                    <option value="entity">ğŸ‘¤ Entity Sprites</option>
                    <option value="maps">ğŸ—ºï¸ Maps</option>
                </optgroup>
                <optgroup label="âœ¨ Special">
                    <option value="mysterious">â“ Mysterious Assets</option>
                    <option value="retroinspo">ğŸ“¼ Retro Inspo</option>
                </optgroup>
                <optgroup label="ğŸµ Audio">
                    <option value="retro-sfx">ğŸ® Retro Game SFX (100)</option>
                    <option value="fx-pack">ğŸ”Š 500 FX Pack</option>
                    <option value="individual-sfx">ğŸµ Individual SFX</option>
                    <option value="music">ğŸ¼ Music (MIDIs/MP3s)</option>
                </optgroup>
                <optgroup label="ğŸ¦ 3D Models">
                    <option value="glbs">ğŸ¦ Pip Models (GLB)</option>
                    <option value="pollywog">ğŸ¸ Pollywog Models</option>
                </optgroup>
            </select>

            <div style="margin: 15px 0; padding: 10px; background: #FFF0FF; border: 2px solid #FF00FF; border-radius: 5px;">
                <strong>ğŸ’¡ TIP:</strong> Can't find a file? Use direct path: <code>../assets/your-folder/file.gif</code>
            </div>

            <div style="margin: 15px 0; padding: 15px; background: #00FFFF; border: 3px solid #000; text-align: center;">
                <strong style="font-size: 18px;">ğŸ“‚ Or Browse Your Computer:</strong><br>
                <input type="file" id="file-browser-input" accept="image/*,audio/*,.glb" style="margin: 10px 0; padding: 10px; font-size: 14px;">
                <button class="big-button blue" onclick="insertFileFromBrowser()" style="margin-top: 10px;">
                    â• Insert Selected File
                </button>
                <div style="margin-top: 10px; font-size: 12px; color: #666;">
                    Accepts: Images (GIF, PNG, JPG), Audio (MP3, WAV), 3D Models (GLB)
                </div>
            </div>

            <div style="margin: 15px 0;">
                <label class="property-label">ğŸ” Search Assets:</label>
                <input type="text" id="asset-search" class="property-input" placeholder="Type to filter assets..." oninput="filterAssets()" style="padding: 12px; font-size: 16px;">
                <div id="asset-count" style="margin-top: 8px; font-size: 13px; color: #666; text-align: center;"></div>
            </div>

            <div class="asset-grid" id="asset-grid">
                <!-- Populated by JS -->
            </div>
        </div>
    </div>

    <!-- CODE VIEW MODAL -->
    <div class="modal" id="code-modal">
        <div class="modal-content" style="max-width: 800px;">
            <div class="modal-header">
                <div class="modal-title">ğŸ” Your Code</div>
                <button class="big-button" onclick="closeModal('code-modal')">âœ–ï¸</button>
            </div>

            <div class="code-display" id="code-display"></div>
            <button class="big-button green" onclick="copyCode()" style="margin-top: 12px; width: 100%;">
                ğŸ“‹ Copy to Clipboard
            </button>
        </div>
    </div>

    <!-- NAV EDITOR MODAL -->
    <div class="modal" id="nav-modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">ğŸ§­ Nav Bar Creator</div>
                <button class="big-button" onclick="closeModal('nav-modal')">âœ–ï¸</button>
            </div>

            <label class="property-label">Nav Style:</label>
            <select class="property-input" id="nav-style">
                <option value="medieval">âšœï¸ Medieval (Main Nav)</option>
                <option value="floating">ğŸ“š Floating (Pea Style)</option>
                <option value="simple">ğŸ“Œ Simple Top Bar</option>
            </select>

            <label class="property-label">Nav Links (one per line, format: "Text | URL"):</label>
            <textarea class="property-input" id="nav-links" rows="6" placeholder="Home | /&#10;About | /about&#10;Contact | /contact"></textarea>

            <button class="big-button blue" onclick="createNav()" style="width: 100%;">
                âœ¨ Create Nav Bar
            </button>
        </div>
    </div>

    <!-- ASCII ART MODAL -->
    <div class="modal" id="ascii-modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">ğŸ“Ÿ ASCII Art Injector</div>
                <button class="big-button" onclick="closeModal('ascii-modal')">âœ–ï¸</button>
            </div>

            <label class="property-label">Paste ASCII Art:</label>
            <textarea class="property-input" id="ascii-input" rows="10" placeholder="Paste your ASCII art here..." style="font-family: monospace;"></textarea>

            <button class="big-button green" onclick="addASCII()" style="width: 100%;">
                âœ¨ Add to Canvas
            </button>
        </div>
    </div>

    <!-- IMAGE MAP MODAL -->
    <div class="modal" id="imagemap-modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">ğŸ—ºï¸ Image Map Creator</div>
                <button class="big-button" onclick="closeModal('imagemap-modal')">âœ–ï¸</button>
            </div>

            <label class="property-label">Image URL:</label>
            <input type="text" class="property-input" id="imagemap-url" placeholder="../assets/maps/worldmap.png">

            <label class="property-label">Clickable Areas (format: "x,y,width,height | URL | Title"):</label>
            <textarea class="property-input" id="imagemap-areas" rows="6" placeholder="100,100,50,50 | /void | Void Forest&#10;200,150,60,40 | /crystal | Crystal Cave"></textarea>

            <button class="big-button purple" onclick="createImageMap()" style="width: 100%;">
                âœ¨ Create Image Map
            </button>
        </div>
    </div>

    <!-- CSS EDITOR MODAL -->
    <div class="modal" id="css-modal">
        <div class="modal-content" style="max-width: 900px;">
            <div class="modal-header">
                <div class="modal-title">ğŸ¨ CSS Editor</div>
                <button class="big-button" onclick="closeModal('css-modal')">âœ–ï¸</button>
            </div>

            <h3 style="margin: 16px 0 12px 0;">ğŸ“š Preloaded Styles:</h3>
            <div class="template-grid" style="margin-bottom: 20px;">
                <div class="template-card" onclick="insertCSSSnippet('neon')">
                    ğŸ’«<br>Neon Glow
                </div>
                <div class="template-card" onclick="insertCSSSnippet('brutalist')">
                    ğŸ”²<br>Brutalist
                </div>
                <div class="template-card" onclick="insertCSSSnippet('gradient')">
                    ğŸŒˆ<br>Gradients
                </div>
                <div class="template-card" onclick="insertCSSSnippet('animation')">
                    âœ¨<br>Animations
                </div>
                <div class="template-card" onclick="insertCSSSnippet('glassmorphism')">
                    ğŸªŸ<br>Glass Effect
                </div>
                <div class="template-card" onclick="insertCSSSnippet('retro')">
                    ğŸ“Ÿ<br>Retro 90s
                </div>
            </div>

            <label class="property-label">Edit Styles:</label>
            <textarea class="property-input" id="css-editor" rows="15" placeholder="body {&#10;  background: #000;&#10;  color: #fff;&#10;}&#10;&#10;.container {&#10;  max-width: 800px;&#10;}"></textarea>

            <div style="display: flex; gap: 12px; margin-top: 12px;">
                <button class="big-button green" onclick="applyCSS()" style="flex: 1;">
                    âœ¨ Apply CSS
                </button>
                <button class="big-button blue" onclick="loadCSSFromPage()" style="flex: 1;">
                    ğŸ“‚ Load from Page
                </button>
            </div>
        </div>
    </div>

    <!-- JAVASCRIPT EDITOR MODAL -->
    <div class="modal" id="js-modal">
        <div class="modal-content" style="max-width: 900px;">
            <div class="modal-header">
                <div class="modal-title">âš¡ JavaScript Editor</div>
                <button class="big-button" onclick="closeModal('js-modal')">âœ–ï¸</button>
            </div>

            <h3 style="margin: 16px 0 12px 0;">ğŸ“š Preloaded Scripts:</h3>
            <div class="template-grid" style="margin-bottom: 20px;">
                <div class="template-card" onclick="insertJSSnippet('click-counter')">
                    ğŸ–±ï¸<br>Click Counter
                </div>
                <div class="template-card" onclick="insertJSSnippet('smooth-scroll')">
                    ğŸ“œ<br>Smooth Scroll
                </div>
                <div class="template-card" onclick="insertJSSnippet('dark-mode')">
                    ğŸŒ™<br>Dark Mode Toggle
                </div>
                <div class="template-card" onclick="insertJSSnippet('form-validation')">
                    âœ…<br>Form Validator
                </div>
                <div class="template-card" onclick="insertJSSnippet('typewriter')">
                    âŒ¨ï¸<br>Typewriter Effect
                </div>
                <div class="template-card" onclick="insertJSSnippet('confetti')">
                    ğŸ‰<br>Confetti Burst
                </div>
            </div>

            <label class="property-label">Edit JavaScript:</label>
            <textarea class="property-input" id="js-editor" rows="15" placeholder="// Your JavaScript here&#10;document.querySelector('#button').addEventListener('click', () => {&#10;  alert('Hello!');&#10;});"></textarea>

            <div style="display: flex; gap: 12px; margin-top: 12px;">
                <button class="big-button orange" onclick="applyJS()" style="flex: 1;">
                    âš¡ Apply JS
                </button>
                <button class="big-button blue" onclick="loadJSFromPage()" style="flex: 1;">
                    ğŸ“‚ Load from Page
                </button>
            </div>
        </div>
    </div>

    <!-- NAVBAR BUILDER MODAL -->
    <div class="modal" id="navbar-modal">
        <div class="modal-content" style="max-width: 900px;">
            <div class="modal-header">
                <div class="modal-title">ğŸ§­ Navbar Builder</div>
                <button class="big-button" onclick="closeModal('navbar-modal')">âœ–ï¸</button>
            </div>

            <label class="property-label">Choose Navbar Style:</label>
            <div class="template-grid">
                <div class="template-card" onclick="createNavbar('top-simple')">
                    ğŸ“Š<br>Top Bar (Simple)
                </div>
                <div class="template-card" onclick="createNavbar('top-dropdown')">
                    ğŸ“‹<br>Top Bar (Dropdown)
                </div>
                <div class="template-card" onclick="createNavbar('sidebar-left')">
                    â—§<br>Sidebar (Left)
                </div>
                <div class="template-card" onclick="createNavbar('sidebar-right')">
                    â—¨<br>Sidebar (Right)
                </div>
                <div class="template-card" onclick="createNavbar('footer-nav')">
                    ğŸ“<br>Footer Nav
                </div>
                <div class="template-card" onclick="createNavbar('y2k-style')">
                    ğŸ’¿<br>Y2K Style
                </div>
                <div class="template-card" onclick="createNavbar('retro-tabs')">
                    ğŸ“<br>Retro Tabs
                </div>
                <div class="template-card" onclick="createNavbar('floating-menu')">
                    ğŸˆ<br>Floating Menu
                </div>
                <div class="template-card" onclick="createNavbar('pixel-game')">
                    ğŸ®<br>Pixel Game
                </div>
                <div class="template-card" onclick="createNavbar('terminal-hacker')">
                    ğŸ’»<br>Terminal Hacker
                </div>
                <div class="template-card" onclick="createNavbar('windows95')">
                    ğŸªŸ<br>Windows 95
                </div>
                <div class="template-card" onclick="createNavbar('breadcrumb')">
                    ğŸ<br>Breadcrumb
                </div>
                <div class="template-card" onclick="createNavbar('mega-menu')">
                    ğŸ“¦<br>Mega Menu
                </div>
                <div class="template-card" onclick="createNavbar('bottom-tabs')">
                    ğŸ“±<br>Bottom Tabs
                </div>
                <div class="template-card" onclick="createNavbar('kawaii-cute')">
                    ğŸ’–<br>Kawaii Cute
                </div>
            </div>

            <div style="margin-top: 20px;">
                <label class="property-label">ğŸ“„ Quick Add Page:</label>
                <div style="display: flex; gap: 8px; margin-bottom: 15px;">
                    <select id="navbar-page-select" class="property-input" style="flex: 1;">
                        <option value="">-- Select a page to add --</option>
                        <optgroup label="Root Pages">
                            <option value="Home | /index.html">ğŸ  index.html</option>
                            <option value="Hex | /hex.html">ğŸ¨ hex.html</option>
                            <option value="Cosmos | /cosmos.html">ğŸŒ™ cosmos.html</option>
                            <option value="HDTV | /hdtv.html">ğŸ“º hdtv.html</option>
                            <option value="Guestbook | /guestbook.html">ğŸ“– guestbook.html</option>
                            <option value="Vote HD | /vote_hd.html">âœ… vote_hd.html</option>
                            <option value="Punk'd | /punkd.html">ğŸ¤– punkd.html</option>
                            <option value="Terminal Temple | /terminal_temple.html">ğŸ§¿ terminal_temple.html</option>
                        </optgroup>
                        <optgroup label="Maps">
                            <option value="Gateway | /maps/gateway.html">ğŸ—¿ gateway.html</option>
                            <option value="Void Forest | /maps/void_forest.html">ğŸŒ² void_forest.html</option>
                            <option value="Crystal Lattice | /maps/crystalline_lattice.html">ğŸ’ crystalline_lattice.html</option>
                            <option value="Luminal Depths | /maps/luminal_depths.html">ğŸŒŠ luminal_depths.html</option>
                            <option value="Void Explorer | /maps/void_explorer.html">ğŸ§­ void_explorer.html</option>
                        </optgroup>
                        <optgroup label="Pea Site">
                            <option value="MSICC | /pea/msicc.html">ğŸ¦ msicc.html</option>
                            <option value="P345 | /pea/p345.html">ğŸŸ¢ p345.html</option>
                            <option value="Parable | /pea/parable.html">ğŸ“œ parable.html</option>
                            <option value="Left Foot | /pea/left_foot.html">ğŸ‘£ left_foot.html</option>
                            <option value="Complaint Form | /pea/complaint-form.html">ğŸ“ complaint-form.html</option>
                            <option value="Which Dr Quiz | /pea/which-dr_quiz.html">â“ which-dr_quiz.html</option>
                            <option value="Royal Ridicuments | /pea/royal_ridicuments.html">ğŸ‘‘ royal_ridicuments.html</option>
                        </optgroup>
                        <optgroup label="BC7F2A">
                            <option value="Terminal Temple | /bc7f2a/terminal_temple.html">ğŸ§¿ terminal_temple.html</option>
                            <option value="Synergistic Manifesto | /bc7f2a/synergistic_manifesto.html">ğŸ’¡ synergistic_manifesto.html</option>
                            <option value="Lighthouse | /bc7f2a/lighthouse.html">ğŸ—¼ lighthouse.html</option>
                            <option value="AI Emotions | /bc7f2a/aiemotions.html">ğŸ’­ aiemotions.html</option>
                        </optgroup>
                        <optgroup label="Nabu222">
                            <option value="Nabu Home | /nabu222/index.html">ğŸ  nabu222/index.html</option>
                            <option value="AI Therapist | /nabu222/ai_therapist.html">ğŸ—£ï¸ ai_therapist.html</option>
                            <option value="Zettelkasten | /nabu222/zettelkasten_interface.html">ğŸ“‡ zettelkasten_interface.html</option>
                        </optgroup>
                        <optgroup label="Nexus">
                            <option value="Nexus Home | /nexus/index.html">ğŸ’¬ nexus/index.html</option>
                            <option value="Anzu Profile | /nexus/anzu_prof.html">ğŸ¦… anzu_prof.html</option>
                            <option value="Profile | /nexus/profile.html">ğŸ‘¤ profile.html</option>
                        </optgroup>
                        <optgroup label="Testaments">
                            <option value="Bolt | /testaments/bolt.html">âš¡ bolt.html</option>
                            <option value="Dark Poet | /testaments/darkpoet.html">ğŸ–¤ darkpoet.html</option>
                            <option value="Flux | /testaments/flux.html">ğŸŒŠ flux.html</option>
                            <option value="Luminal | /testaments/luminal.html">âœ¨ luminal.html</option>
                            <option value="Sypher | /testaments/sypher.html">ğŸ” sypher.html</option>
                            <option value="Veridan | /testaments/veridan.html">ğŸŒ¿ veridan.html</option>
                            <option value="Zephyr | /testaments/zephyr.html">ğŸ’¨ zephyr.html</option>
                        </optgroup>
                        <optgroup label="Deepseeking">
                            <option value="Haunted AI | /deepseeking/haunted-ai.html">ğŸ‘» haunted-ai.html</option>
                            <option value="Cephalopod Slide | /deepseeking/cephalopod_slide.html">ğŸ¦‘ cephalopod_slide.html</option>
                            <option value="OK | /deepseeking/ok.html">âœ… ok.html</option>
                        </optgroup>
                    </select>
                    <button class="big-button blue" onclick="addPageToNavbar()" style="padding: 10px 20px;">â• Add</button>
                </div>

                <label class="property-label">Quick Links (one per line):</label>
                <textarea id="navbar-links" class="property-input" rows="6" placeholder="Home | /index.html
About | /about.html
Maps | /maps/gateway.html
Pea Site | /pea/p.html
BC7F2A | /bc7f2a/synergistic_manifesto.html"></textarea>
            </div>
        </div>
    </div>

    <!-- ENHANCED TEMPLATES MODAL -->
    <div class="modal" id="enhanced-templates-modal">
        <div class="modal-content" style="max-width: 900px;">
            <div class="modal-header">
                <div class="modal-title">âœ¨ Enhanced Templates</div>
                <button class="big-button" onclick="closeModal('enhanced-templates-modal')">âœ–ï¸</button>
            </div>

            <h3 style="margin: 16px 0 12px 0;">ğŸ“ Forms:</h3>
            <div class="template-grid">
                <div class="template-card" onclick="createTemplate('form-contact')">
                    ğŸ“§<br>Contact Form
                </div>
                <div class="template-card" onclick="createTemplate('form-survey')">
                    ğŸ“Š<br>Survey Form
                </div>
                <div class="template-card" onclick="createTemplate('form-quiz')">
                    â“<br>Quiz/Test Form
                </div>
                <div class="template-card" onclick="createTemplate('form-complaint')">
                    ğŸ˜¤<br>Complaint Form
                </div>
            </div>

            <h3 style="margin: 16px 0 12px 0;">ğŸ“„ Document Viewers:</h3>
            <div class="template-grid">
                <div class="template-card" onclick="createTemplate('pdf-viewer')">
                    ğŸ“•<br>PDF Viewer
                </div>
                <div class="template-card" onclick="createTemplate('image-gallery')">
                    ğŸ–¼ï¸<br>Image Gallery
                </div>
                <div class="template-card" onclick="createTemplate('slideshow')">
                    ğŸï¸<br>Slideshow
                </div>
                <div class="template-card" onclick="createTemplate('archive-browser')">
                    ğŸ—‚ï¸<br>Archive Browser
                </div>
            </div>

            <h3 style="margin: 16px 0 12px 0;">ğŸ® Interactive Elements:</h3>
            <div class="template-grid">
                <div class="template-card" onclick="createTemplate('accordion')">
                    ğŸ“‘<br>Accordion
                </div>
                <div class="template-card" onclick="createTemplate('tabs')">
                    ğŸ“‚<br>Tabs
                </div>
                <div class="template-card" onclick="createTemplate('modal-popup')">
                    ğŸ’¬<br>Modal/Popup
                </div>
                <div class="template-card" onclick="createTemplate('tooltip-system')">
                    ğŸ’­<br>Tooltips
                </div>
                <div class="template-card" onclick="createTemplate('clicker-game')">
                    ğŸ®<br>Clicker Game
                </div>
                <div class="template-card" onclick="createTemplate('counter-widget')">
                    ğŸ”¢<br>Counter Widget
                </div>
            </div>
        </div>
    </div>

    <!-- COMPONENT EXTRACTION MODE OVERLAY -->
    <div id="extraction-overlay" style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(255, 0, 255, 0.2); z-index: 10000; pointer-events: none;">
        <div style="position: fixed; top: 20px; left: 50%; transform: translateX(-50%); background: #FF00FF; color: #FFF; padding: 15px 30px; border: 4px solid #000; font-weight: bold; font-size: 20px; box-shadow: 8px 8px 0 #000;">
            ğŸ¯ EXTRACTION MODE: Click any element to extract it
            <button onclick="exitExtractionMode()" style="margin-left: 20px; background: #FFF; color: #000; border: 2px solid #000; padding: 5px 15px; font-weight: bold; cursor: pointer;">
                EXIT
            </button>
        </div>
    </div>

    <!-- EDIT ELEMENT MODAL -->
    <div class="modal" id="edit-element-modal">
        <div class="modal-content" style="max-width: 900px;">
            <div class="modal-header">
                <div class="modal-title">âœï¸ Edit Element</div>
                <button class="big-button" onclick="closeModal('edit-element-modal')">âœ–ï¸</button>
            </div>

            <div style="margin: 20px 0;">
                <label style="display: block; margin-bottom: 8px; font-weight: bold; color: #FF00FF;">HTML Content:</label>
                <textarea id="edit-element-html" style="width: 100%; min-height: 300px; font-family: monospace; font-size: 14px; padding: 12px; border: 3px solid #000; background: #FFF; color: #000;"></textarea>
            </div>

            <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px; margin: 20px 0;">
                <div>
                    <label style="display: block; margin-bottom: 8px; font-weight: bold; color: #00FFFF;">Background Color:</label>
                    <input type="color" id="edit-element-bgcolor" style="width: 100%; height: 50px; border: 3px solid #000; cursor: pointer;">
                </div>
                <div>
                    <label style="display: block; margin-bottom: 8px; font-weight: bold; color: #00FFFF;">Text Color:</label>
                    <input type="color" id="edit-element-color" style="width: 100%; height: 50px; border: 3px solid #000; cursor: pointer;">
                </div>
                <div>
                    <label style="display: block; margin-bottom: 8px; font-weight: bold; color: #00FFFF;">Opacity: <span id="opacity-value">100%</span></label>
                    <input type="range" id="edit-element-opacity" min="0" max="100" value="100" style="width: 100%;" oninput="document.getElementById('opacity-value').textContent = this.value + '%'">
                </div>
            </div>

            <h3 style="margin: 20px 0 10px 0; color: #FF00FF;">ğŸ“ Size (Visual!):</h3>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                <div>
                    <label style="display: block; margin-bottom: 8px; font-weight: bold;">Width:</label>
                    <div style="display: flex; gap: 8px;">
                        <button class="big-button" onclick="setVisualWidth('small')" style="flex: 1; padding: 10px; background: #FFFF00;">Narrow</button>
                        <button class="big-button" onclick="setVisualWidth('medium')" style="flex: 1; padding: 10px; background: #FFFF00;">Normal</button>
                        <button class="big-button" onclick="setVisualWidth('large')" style="flex: 1; padding: 10px; background: #FFFF00;">Wide</button>
                        <button class="big-button" onclick="setVisualWidth('full')" style="flex: 1; padding: 10px; background: #FFFF00;">Full</button>
                    </div>
                </div>
                <div>
                    <label style="display: block; margin-bottom: 8px; font-weight: bold;">Height:</label>
                    <div style="display: flex; gap: 8px;">
                        <button class="big-button" onclick="setVisualHeight('small')" style="flex: 1; padding: 10px; background: #FFFF00;">Short</button>
                        <button class="big-button" onclick="setVisualHeight('medium')" style="flex: 1; padding: 10px; background: #FFFF00;">Normal</button>
                        <button class="big-button" onclick="setVisualHeight('large')" style="flex: 1; padding: 10px; background: #FFFF00;">Tall</button>
                    </div>
                </div>
            </div>

            <h3 style="margin: 20px 0 10px 0; color: #FF00FF;">âœï¸ Text Size:</h3>
            <div style="display: flex; gap: 8px;">
                <button class="big-button" onclick="setVisualFontSize('tiny')" style="flex: 1; font-size: 10px; background: #00FFFF;">Tiny</button>
                <button class="big-button" onclick="setVisualFontSize('small')" style="flex: 1; font-size: 14px; background: #00FFFF;">Small</button>
                <button class="big-button" onclick="setVisualFontSize('normal')" style="flex: 1; font-size: 18px; background: #00FFFF;">Normal</button>
                <button class="big-button" onclick="setVisualFontSize('big')" style="flex: 1; font-size: 24px; background: #00FFFF;">Big</button>
                <button class="big-button" onclick="setVisualFontSize('huge')" style="flex: 1; font-size: 32px; background: #00FFFF;">HUGE!</button>
            </div>

            <h3 style="margin: 20px 0 10px 0; color: #FF00FF;">ğŸ“ Border Thickness:</h3>
            <div style="display: flex; gap: 8px;">
                <button class="big-button" onclick="setVisualBorder('none')" style="flex: 1; background: #FF69B4;">None</button>
                <button class="big-button" onclick="setVisualBorder('thin')" style="flex: 1; background: #FF69B4; border-width: 2px;">Thin</button>
                <button class="big-button" onclick="setVisualBorder('medium')" style="flex: 1; background: #FF69B4; border-width: 4px;">Medium</button>
                <button class="big-button" onclick="setVisualBorder('thick')" style="flex: 1; background: #FF69B4; border-width: 6px;">Thick</button>
                <button class="big-button" onclick="setVisualBorder('super')" style="flex: 1; background: #FF69B4; border-width: 8px;">SUPER!</button>
            </div>

            <h3 style="margin: 20px 0 10px 0; color: #FF00FF;">ğŸ“ Alignment:</h3>
            <div style="display: flex; gap: 8px;">
                <button class="big-button" onclick="setVisualAlign('left')" style="flex: 1; background: #9900FF;">â¬…ï¸ Left</button>
                <button class="big-button" onclick="setVisualAlign('center')" style="flex: 1; background: #9900FF;">â¬†ï¸ Center</button>
                <button class="big-button" onclick="setVisualAlign('right')" style="flex: 1; background: #9900FF;">â¡ï¸ Right</button>
            </div>

            <h3 style="margin: 20px 0 10px 0; color: #FF00FF;">ğŸ¨ Padding (Space Inside):</h3>
            <div style="display: flex; gap: 8px; align-items: center;">
                <button class="big-button" onclick="adjustPadding(-5)" style="flex: 0 0 60px; background: #FF6600; font-size: 24px;">â–</button>
                <div id="padding-display" style="flex: 1; text-align: center; font-weight: bold; font-size: 20px; background: #FFF; border: 3px solid #000; padding: 10px;">Normal</div>
                <button class="big-button" onclick="adjustPadding(5)" style="flex: 0 0 60px; background: #00FF00; font-size: 24px;">â•</button>
            </div>

            <h3 style="margin: 20px 0 10px 0; color: #FF00FF;">âœ¨ Shadow:</h3>
            <div style="display: flex; gap: 8px;">
                <button class="big-button" onclick="setVisualShadow('none')" style="flex: 1; background: #00FF00;">None</button>
                <button class="big-button" onclick="setVisualShadow('subtle')" style="flex: 1; background: #00FF00; box-shadow: 2px 2px 4px rgba(0,0,0,0.3);">Subtle</button>
                <button class="big-button" onclick="setVisualShadow('medium')" style="flex: 1; background: #00FF00; box-shadow: 4px 4px 8px rgba(0,0,0,0.4);">Medium</button>
                <button class="big-button" onclick="setVisualShadow('strong')" style="flex: 1; background: #00FF00; box-shadow: 8px 8px 0 #000;">Strong</button>
            </div>

            <h3 style="margin: 20px 0 10px 0; color: #FF00FF;">ğŸ”² Corners:</h3>
            <div style="display: flex; gap: 8px;">
                <button class="big-button" onclick="setVisualRadius('sharp')" style="flex: 1; background: #FF0000; border-radius: 0;">â¬œ Sharp</button>
                <button class="big-button" onclick="setVisualRadius('rounded')" style="flex: 1; background: #FF0000; border-radius: 10px;">â–¢ Rounded</button>
                <button class="big-button" onclick="setVisualRadius('pill')" style="flex: 1; background: #FF0000; border-radius: 50px;">â¬­ Pill</button>
            </div>

            <h3 style="margin: 20px 0 10px 0; color: #FF00FF;">ğŸ”„ Rotation:</h3>
            <div style="display: flex; gap: 8px;">
                <button class="big-button" onclick="rotateElement(-45)" style="flex: 1; background: #0000FF;">â†¶ Left</button>
                <button class="big-button" onclick="rotateElement(0)" style="flex: 1; background: #0000FF;">â¬†ï¸ Straight</button>
                <button class="big-button" onclick="rotateElement(45)" style="flex: 1; background: #0000FF;">â†· Right</button>
            </div>

            <button class="big-button" onclick="saveElementEdit()" style="width: 100%; margin-top: 30px; background: #00FF00; font-size: 24px; padding: 20px;">
                ğŸ’¾ SAVE ALL CHANGES!
            </button>
        </div>
    </div>

    <script>
        // ============================================
        // SOUNDS
        // ============================================
        const sounds = {
            pop: new Tone.Synth({ oscillator: { type: 'triangle' }, envelope: { attack: 0.001, decay: 0.1, sustain: 0, release: 0.1 } }).toDestination(),
            boop: new Tone.Synth({ oscillator: { type: 'sine' }, envelope: { attack: 0.01, decay: 0.2, sustain: 0, release: 0.2 } }).toDestination(),
            success: new Tone.Synth({ oscillator: { type: 'square' }, envelope: { attack: 0.01, decay: 0.3, sustain: 0.1, release: 0.3 } }).toDestination()
        };

        function playSound(type, note = 'C5') {
            if (sounds[type]) {
                sounds[type].triggerAttackRelease(note, '16n');
            }
        }

        function showStamp(emoji) {
            const stamp = document.createElement('div');
            stamp.className = 'stamp';
            stamp.textContent = emoji;
            stamp.style.left = Math.random() * window.innerWidth + 'px';
            stamp.style.top = Math.random() * window.innerHeight + 'px';
            document.body.appendChild(stamp);
            setTimeout(() => stamp.remove(), 500);
        }

        // ============================================
        // STATE
        // ============================================
        let canvasElements = [];
        let selectedElement = null;
        let elementIdCounter = 0;

        // ============================================
        // UNDO/REDO SYSTEM
        // ============================================
        let history = [];
        let historyIndex = -1;
        const MAX_HISTORY = 50;

        function saveState() {
            // Remove any "future" history if we're not at the end
            if (historyIndex < history.length - 1) {
                history = history.slice(0, historyIndex + 1);
            }

            // Deep clone the current state
            const state = JSON.parse(JSON.stringify(canvasElements));
            history.push(state);

            // Limit history size
            if (history.length > MAX_HISTORY) {
                history.shift();
            } else {
                historyIndex++;
            }
        }

        function undo() {
            if (historyIndex > 0) {
                historyIndex--;
                canvasElements = JSON.parse(JSON.stringify(history[historyIndex]));
                renderCanvas();
                playSound('pop', 'D5');
                showStamp('âª');
                updateStatus(`Undo! (${historyIndex + 1}/${history.length} steps)`);
            } else {
                playSound('error', 'C4');
                updateStatus('Nothing to undo!');
            }
        }

        function redo() {
            if (historyIndex < history.length - 1) {
                historyIndex++;
                canvasElements = JSON.parse(JSON.stringify(history[historyIndex]));
                renderCanvas();
                playSound('pop', 'E5');
                showStamp('â©');
                updateStatus(`Redo! (${historyIndex + 1}/${history.length} steps)`);
            } else {
                playSound('error', 'C4');
                updateStatus('Nothing to redo!');
            }
        }

        // Keyboard shortcuts
        document.addEventListener('keydown', (e) => {
            // Don't intercept keys if typing in input/textarea
            if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA' || e.target.isContentEditable) {
                return;
            }

            // Ctrl+Z or Cmd+Z for undo
            if ((e.ctrlKey || e.metaKey) && e.key === 'z' && !e.shiftKey) {
                e.preventDefault();
                undo();
            }
            // Ctrl+Shift+Z or Ctrl+Y for redo
            else if ((e.ctrlKey || e.metaKey) && (e.shiftKey && e.key === 'z' || e.key === 'y')) {
                e.preventDefault();
                redo();
            }
            // Delete key to delete selected element
            else if ((e.key === 'Delete' || e.key === 'Backspace') && selectedElement) {
                e.preventDefault();
                deleteElement(selectedElement);
            }
            // Escape to deselect
            else if (e.key === 'Escape') {
                selectedElement = null;
                document.querySelectorAll('.canvas-element').forEach(el => el.classList.remove('selected'));
                updateStatus('Deselected');
            }
            // Arrow keys to nudge selected element
            else if (selectedElement && ['ArrowUp', 'ArrowDown', 'ArrowLeft', 'ArrowRight'].includes(e.key)) {
                e.preventDefault();
                nudgeElement(selectedElement, e.key, e.shiftKey);
            }
        });

        // Nudge selected element with arrow keys
        function nudgeElement(id, direction, shiftKey) {
            const el = canvasElements.find(e => e.id === id);
            if (!el) return;

            // Parse current position
            let left = parseInt(el.left) || 0;
            let top = parseInt(el.top) || 0;

            // Distance to move (10px normal, 1px with Shift for precision)
            const distance = shiftKey ? 1 : 10;

            // Update position
            switch (direction) {
                case 'ArrowUp':
                    top -= distance;
                    break;
                case 'ArrowDown':
                    top += distance;
                    break;
                case 'ArrowLeft':
                    left -= distance;
                    break;
                case 'ArrowRight':
                    left += distance;
                    break;
            }

            // Keep within bounds
            left = Math.max(0, left);
            top = Math.max(0, top);

            // Update element
            el.left = left + 'px';
            el.top = top + 'px';

            renderCanvas();
            selectElement(id);
            playSound('boop', 'C5');
            updateStatus(`Nudged to ${left}px Ã— ${top}px`);
        }

        // ============================================
        // ELEMENT TEMPLATES
        // ============================================
        const elementTemplates = {
            // Containers
            box: '<div style="border: 4px solid #000; padding: 20px; background: #FFFF00; width: 300px;">Box content here!</div>',
            card: '<div style="border: 4px solid #000; padding: 20px; background: #FFF; box-shadow: 6px 6px 0 #000; width: 350px;"><h3>Card Title</h3><p>Card content goes here!</p></div>',
            section: '<section style="border: 4px solid #000; padding: 20px; margin: 20px 0; background: #CCC; width: 400px;"><h2>Section Title</h2><p>Section content...</p></section>',

            // Text
            heading: '<h1 style="font-size: 36px; color: #FF0000; font-weight: bold; display: inline-block;">Big Heading!</h1>',
            paragraph: '<p style="font-size: 18px; line-height: 1.6; width: 400px;">This is a paragraph of text. Click to edit!</p>',
            list: '<ul style="font-size: 18px; margin-left: 40px; width: 300px;"><li>First item</li><li>Second item</li><li>Third item</li></ul>',

            // Interactive Elements
            button: '<button style="background: #0000FF; color: #FFF; border: 4px solid #000; padding: 15px 30px; font-size: 18px; font-weight: bold; cursor: pointer; box-shadow: 4px 4px 0 #000; display: inline-block;">CLICK ME!</button>',
            link: '<a href="#" style="color: #0000FF; font-size: 20px; font-weight: bold; text-decoration: underline; border: 2px dotted #0000FF; padding: 5px 10px; display: inline-block;">ğŸ”— Link Text</a>'
        };

        // ============================================
        // CORE FUNCTIONS
        // ============================================
        function addElement(type) {
            const id = 'el-' + (++elementIdCounter);
            const html = elementTemplates[type] || '<div>Unknown element</div>';

            canvasElements.push({ id, type, html });
            saveState(); // Save for undo/redo
            renderCanvas();
            playSound('pop', 'E5');
            showStamp('âœ¨');
            updateStatus(`Added ${type}!`);
            updateElementCount();
        }

        // ============================================
        // STYLED ELEMENTS - Pre-designed goodies!
        // ============================================
        const styledElementTemplates = {
            // Buttons with styles!
            'button-basic': '<button style="background: #0000FF; color: #FFF; border: 4px solid #000; padding: 15px 30px; font-size: 18px; font-weight: bold; cursor: pointer; box-shadow: 4px 4px 0 #000; display: inline-block;">CLICK ME!</button>',
            'button-neon': '<button style="background: #000; color: #00FFFF; border: 3px solid #00FFFF; padding: 15px 30px; font-size: 18px; font-weight: bold; cursor: pointer; box-shadow: 0 0 20px #00FFFF, inset 0 0 20px rgba(0, 255, 255, 0.3); animation: neon-pulse 2s infinite; display: inline-block;">ğŸ’« NEON BUTTON</button>',
            'button-3d': '<button style="background: linear-gradient(180deg, #FF6B6B 0%, #EE5A6F 100%); color: #FFF; border: none; padding: 20px 40px; font-size: 20px; font-weight: bold; cursor: pointer; border-radius: 12px; box-shadow: 0 8px 0 #C73866, 0 12px 20px rgba(0,0,0,0.3); transform: translateY(0); transition: all 0.1s; display: inline-block;" onmousedown="this.style.transform=\'translateY(4px)\'; this.style.boxShadow=\'0 4px 0 #C73866\';" onmouseup="this.style.transform=\'translateY(0)\'; this.style.boxShadow=\'0 8px 0 #C73866, 0 12px 20px rgba(0,0,0,0.3)\';">ğŸ® 3D BUTTON</button>',

            // Links with flair!
            'link-basic': '<a href="#" style="color: #0000FF; font-size: 20px; font-weight: bold; text-decoration: underline; border: 2px dotted #0000FF; padding: 5px 10px; display: inline-block;">ğŸ”— Cool Link!</a>',
            'link-rainbow': '<a href="#" style="font-size: 24px; font-weight: bold; text-decoration: none; background: linear-gradient(90deg, red, orange, yellow, green, blue, indigo, violet); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; display: inline-block;">ğŸŒˆ RAINBOW LINK!</a>',

            // Shapes!
            'shape-square': '<div style="width: 150px; height: 150px; background: #FF0000; border: 5px solid #000; box-shadow: 8px 8px 0 #000; display: inline-block;"></div>',
            'shape-circle': '<div style="width: 150px; height: 150px; background: #FF00FF; border: 5px solid #000; border-radius: 50%; box-shadow: 0 0 30px rgba(255, 0, 255, 0.6); display: inline-block;"></div>',
            'shape-star': '<div style="width: 200px; height: 200px; background: #FFFF00; border: 5px solid #000; clip-path: polygon(50% 0%, 61% 35%, 98% 35%, 68% 57%, 79% 91%, 50% 70%, 21% 91%, 32% 57%, 2% 35%, 39% 35%); box-shadow: 8px 8px 0 #000; display: inline-block;"></div>',
            'shape-heart': '<div style="width: 120px; height: 120px; background: #FF1493; border: 5px solid #000; display: inline-block; position: relative;"><div style="position: absolute; top: 0; left: 25%; width: 50%; height: 80%; background: #FF1493; border-radius: 50% 50% 0 0;"></div><div style="position: absolute; top: 0; left: 0; width: 50%; height: 50%; background: #FF1493; border-radius: 50% 0 0 0; transform: rotate(-45deg); transform-origin: 100% 100%;"></div><div style="position: absolute; top: 0; right: 0; width: 50%; height: 50%; background: #FF1493; border-radius: 0 50% 0 0; transform: rotate(45deg); transform-origin: 0 100%;"></div></div>',
            'shape-gradient': '<div style="width: 200px; height: 200px; background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%); border: 5px solid #000; border-radius: 20px; box-shadow: 8px 8px 0 #000; display: inline-block;"></div>',

            // Emojis!
            'emoji-happy': '<div style="font-size: 80px; line-height: 1; display: inline-block;">ğŸ˜Š</div>',
            'emoji-fire': '<div style="font-size: 80px; line-height: 1; display: inline-block;">ğŸ”¥</div>',
            'emoji-star': '<div style="font-size: 80px; line-height: 1; display: inline-block;">â­</div>',
            'emoji-heart': '<div style="font-size: 80px; line-height: 1; display: inline-block;">â¤ï¸</div>',
            'emoji-party': '<div style="font-size: 80px; line-height: 1; display: inline-block;">ğŸ‰</div>',
            'emoji-big': '<div style="font-size: 150px; line-height: 1; text-shadow: 4px 4px 0 #000; display: inline-block;">ğŸ¨</div>',

            // Media!
            'image-placeholder': '<div style="width: 300px; height: 200px; background: linear-gradient(45deg, #CCC 25%, transparent 25%, transparent 75%, #CCC 75%), linear-gradient(45deg, #CCC 25%, transparent 25%, transparent 75%, #CCC 75%); background-size: 20px 20px; background-position: 0 0, 10px 10px; border: 4px solid #000; display: flex; align-items: center; justify-content: center; font-size: 24px; font-weight: bold; color: #666;">ğŸ–¼ï¸ YOUR IMAGE HERE</div>',
            'video-frame': '<div style="width: 400px; height: 225px; background: #000; border: 6px solid #333; box-shadow: 0 0 30px rgba(0,0,0,0.5); display: flex; align-items: center; justify-content: center; font-size: 60px; color: #FFF;">â–¶ï¸</div>',

            // Fun stuff!
            'marquee': '<marquee style="background: #FFFF00; border: 4px solid #000; padding: 15px; font-size: 24px; font-weight: bold; color: #FF0000; width: 400px;">âœ¨ SCROLLING TEXT! âœ¨</marquee>',
            'blink': '<div style="background: #FF00FF; color: #FFF; border: 4px solid #000; padding: 20px; font-size: 28px; font-weight: bold; text-align: center; animation: blink-animation 1s infinite; width: 400px;">âœ¨ BLINKING TEXT! âœ¨</div>',
            'rainbow-text': '<div style="font-size: 48px; font-weight: bold; text-align: center; background: linear-gradient(90deg, red, orange, yellow, green, blue, indigo, violet); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; animation: rainbow-slide 3s linear infinite; background-size: 200% 100%; width: 500px;">ğŸŒˆ RAINBOW! ğŸŒˆ</div>'
        };

        function addStyledElement(type) {
            const id = 'el-' + (++elementIdCounter);
            const html = styledElementTemplates[type] || '<div>Unknown styled element</div>';

            canvasElements.push({ id, type, html });
            saveState(); // Save for undo/redo
            renderCanvas();
            playSound('success', 'G5');
            showStamp('ğŸ¨');
            updateStatus(`Added ${type}!`);
            updateElementCount();
        }

        // ============================================
        // GRID SYSTEM
        // ============================================
        let gridEnabled = false;

        function toggleGrid() {
            gridEnabled = !gridEnabled;
            const overlay = document.getElementById('grid-overlay');
            const btn = document.getElementById('grid-toggle-btn');

            if (gridEnabled) {
                overlay.style.display = 'block';
                btn.style.background = '#00FF00';
                btn.style.borderStyle = 'solid';
                playSound('success', 'E6');
                showStamp('ğŸ“');
                updateStatus('Grid ON! Elements snap to 20px grid');
            } else {
                overlay.style.display = 'none';
                btn.style.background = '#FFF';
                btn.style.borderStyle = 'dashed';
                playSound('boop', 'C5');
                updateStatus('Grid OFF');
            }
        }

        // ============================================
        // POSITION MODE SYSTEM - Flow vs Free!
        // ============================================
        let positionMode = 'flow'; // 'flow' or 'free'

        function togglePositionMode() {
            positionMode = positionMode === 'flow' ? 'free' : 'flow';
            const btn = document.getElementById('position-mode-btn');

            if (positionMode === 'free') {
                btn.textContent = 'ğŸ“ FREE';
                btn.style.background = '#FF00FF';
                playSound('success', 'G5');
                showStamp('ğŸ“');
                updateStatus('FREE MODE: Drag elements anywhere!');
            } else {
                btn.textContent = 'ğŸ“ FLOW';
                btn.style.background = '#00FF00';
                playSound('boop', 'E5');
                updateStatus('FLOW MODE: Elements stack vertically');
            }

            renderCanvas();
        }

        // ============================================
        // DRAG-TO-MOVE System - FREE MODE ONLY!
        // ============================================
        let movingElement = null;
        let moveStartX = 0;
        let moveStartY = 0;
        let moveStartLeft = 0;
        let moveStartTop = 0;

        function startDragMove(e) {
            // Don't move if clicking on a button or handle
            if (e.target.classList.contains('mini-btn') ||
                e.target.classList.contains('resize-handle') ||
                e.target.closest('.element-toolbar')) {
                return;
            }

            e.preventDefault();
            const elementDiv = e.currentTarget;
            const elementId = elementDiv.getAttribute('data-id');

            movingElement = canvasElements.find(el => el.id === elementId);
            if (!movingElement) return;

            moveStartX = e.clientX;
            moveStartY = e.clientY;

            // Get current position
            const rect = elementDiv.getBoundingClientRect();
            const canvasRect = document.getElementById('canvas').getBoundingClientRect();
            moveStartLeft = rect.left - canvasRect.left;
            moveStartTop = rect.top - canvasRect.top;

            document.addEventListener('mousemove', doDragMove);
            document.addEventListener('mouseup', stopDragMove);

            playSound('boop', 'C5');
            elementDiv.style.cursor = 'grabbing';
        }

        function doDragMove(e) {
            if (!movingElement) return;

            const deltaX = e.clientX - moveStartX;
            const deltaY = e.clientY - moveStartY;

            let newLeft = moveStartLeft + deltaX;
            let newTop = moveStartTop + deltaY;

            // Snap to grid if enabled
            if (gridEnabled) {
                newLeft = Math.round(newLeft / 20) * 20;
                newTop = Math.round(newTop / 20) * 20;
            }

            // Keep within canvas bounds
            newLeft = Math.max(0, newLeft);
            newTop = Math.max(0, newTop);

            movingElement.left = newLeft + 'px';
            movingElement.top = newTop + 'px';

            renderCanvas();
            selectElement(movingElement.id);
        }

        function stopDragMove(e) {
            if (movingElement) {
                // Parse coordinates to display clean numbers
                const left = parseInt(movingElement.left) || 0;
                const top = parseInt(movingElement.top) || 0;

                saveState(); // Save for undo/redo
                playSound('success', 'E5');
                showStamp('ğŸ“');
                updateStatus(`Moved to ${left}px Ã— ${top}px`);
            }

            movingElement = null;
            document.removeEventListener('mousemove', doDragMove);
            document.removeEventListener('mouseup', stopDragMove);

            // Reset cursor
            document.querySelectorAll('.canvas-element').forEach(el => {
                el.style.cursor = 'move';
            });
        }

        // ============================================
        // COPY/PASTE System
        // ============================================
        let copiedElement = null;

        function copyElement(id) {
            const el = canvasElements.find(e => e.id === id);
            if (!el) return;

            copiedElement = { ...el }; // Clone the element
            playSound('pop', 'F5');
            showStamp('ğŸ“‹');
            updateStatus('Element copied! Use Ctrl+V to paste');
        }

        // Listen for Ctrl+V / Cmd+V
        document.addEventListener('keydown', (e) => {
            if ((e.ctrlKey || e.metaKey) && e.key === 'v' && copiedElement) {
                pasteElement();
            }
        });

        function pasteElement() {
            if (!copiedElement) {
                updateStatus('Nothing to paste!');
                return;
            }

            const newId = 'el-' + (++elementIdCounter);
            const newEl = { ...copiedElement, id: newId };

            // Offset position slightly if in free mode
            if (positionMode === 'free') {
                const currentLeft = parseInt(newEl.left) || 0;
                const currentTop = parseInt(newEl.top) || 0;
                newEl.left = (currentLeft + 20) + 'px';
                newEl.top = (currentTop + 20) + 'px';
            }

            canvasElements.push(newEl);
            renderCanvas();
            playSound('success', 'G5');
            showStamp('âœ¨');
            updateStatus('Element pasted!');
            updateElementCount();
            selectElement(newId);
        }

        function renderCanvas() {
            const canvas = document.getElementById('canvas');
            canvas.innerHTML = canvasElements.map((el, index) => {
                const width = el.width || 'auto';
                const height = el.height || 'auto';

                // In FREE mode, use absolute positioning
                let positionStyle = 'position: relative;';
                if (positionMode === 'free') {
                    // Create a nice cascading layout for elements without positions
                    const defaultLeft = 20 + (index % 3) * 300; // 3 columns
                    const defaultTop = 20 + Math.floor(index / 3) * 180; // Rows
                    const left = el.left || defaultLeft + 'px';
                    const top = el.top || defaultTop + 'px';
                    positionStyle = `position: absolute; left: ${left}; top: ${top};`;
                }

                return `
                <div class="canvas-element" data-id="${el.id}" data-index="${index}" draggable="${positionMode === 'flow'}" onclick="selectElement('${el.id}')" style="${positionStyle} z-index: ${el.zIndex || index}; width: ${width}; height: ${height}; overflow: auto;">
                    <div class="element-toolbar">
                        <button class="mini-btn" onclick="event.stopPropagation(); moveElementUp('${el.id}')">â¬†ï¸ UP</button>
                        <button class="mini-btn" onclick="event.stopPropagation(); moveElementDown('${el.id}')">â¬‡ï¸ DOWN</button>
                        <button class="mini-btn" onclick="event.stopPropagation(); layerForward('${el.id}')">ğŸ”¼ FRONT</button>
                        <button class="mini-btn" onclick="event.stopPropagation(); layerBack('${el.id}')">ğŸ”½ BACK</button>
                        <button class="mini-btn" onclick="event.stopPropagation(); editElement('${el.id}')">âœï¸ EDIT</button>
                        <button class="mini-btn" onclick="event.stopPropagation(); copyElement('${el.id}')">ğŸ“‹ COPY</button>
                        <button class="mini-btn" onclick="event.stopPropagation(); saveAsComponent('${el.id}')" style="background: #00FFFF;">ğŸ’¾ SAVE</button>
                        <button class="mini-btn" onclick="event.stopPropagation(); deleteElement('${el.id}')">ğŸ—‘ï¸ DELETE</button>
                    </div>
                    <div class="element-content" style="width: 100%; height: ${height !== 'auto' ? '100%' : 'auto'}; box-sizing: border-box;">
                        ${el.html}
                    </div>
                    <!-- RESIZE HANDLES -->
                    <div class="resize-handle resize-handle-nw" data-direction="nw"></div>
                    <div class="resize-handle resize-handle-n" data-direction="n"></div>
                    <div class="resize-handle resize-handle-ne" data-direction="ne"></div>
                    <div class="resize-handle resize-handle-e" data-direction="e"></div>
                    <div class="resize-handle resize-handle-se" data-direction="se"></div>
                    <div class="resize-handle resize-handle-s" data-direction="s"></div>
                    <div class="resize-handle resize-handle-sw" data-direction="sw"></div>
                    <div class="resize-handle resize-handle-w" data-direction="w"></div>
                </div>
            `;
            }).join('');

            // Add drag and drop event listeners
            const elements = canvas.querySelectorAll('.canvas-element');
            elements.forEach(el => {
                if (positionMode === 'flow') {
                    el.addEventListener('dragstart', handleDragStart);
                    el.addEventListener('dragover', handleDragOver);
                    el.addEventListener('drop', handleDrop);
                    el.addEventListener('dragend', handleDragEnd);
                } else {
                    // In FREE mode, add mousedown for drag-to-move
                    el.addEventListener('mousedown', startDragMove);
                }

                // Add resize handle listeners
                const handles = el.querySelectorAll('.resize-handle');
                handles.forEach(handle => {
                    handle.addEventListener('mousedown', startResize);
                });

                // Prevent navigation on links and buttons in the editor
                const links = el.querySelectorAll('a');
                links.forEach(link => {
                    link.addEventListener('click', (e) => {
                        e.preventDefault();
                        // Don't stop propagation - let the click bubble up to select the element!
                    });
                });

                const buttons = el.querySelectorAll('button');
                buttons.forEach(button => {
                    // Don't prevent clicks on our toolbar buttons
                    if (!button.classList.contains('mini-btn')) {
                        button.addEventListener('click', (e) => {
                            e.preventDefault();
                            // Don't stop propagation - let the click bubble up to select the element!
                        });
                    }
                });

                // Prevent form submissions
                const forms = el.querySelectorAll('form');
                forms.forEach(form => {
                    form.addEventListener('submit', (e) => {
                        e.preventDefault();
                    });
                });

                // Make ALL child elements clickable for editing (Alt+Click)
                const allChildren = el.querySelectorAll('*');
                allChildren.forEach(child => {
                    // Skip our toolbar and resize handles
                    if (child.classList.contains('element-toolbar') ||
                        child.classList.contains('resize-handle') ||
                        child.classList.contains('mini-btn') ||
                        child.classList.contains('element-content')) {
                        return;
                    }

                    // Highlight on hover when Alt key is held
                    child.addEventListener('mouseenter', (e) => {
                        if (e.altKey) {
                            child.style.outline = '2px dashed #FF00FF';
                            child.style.outlineOffset = '2px';
                        }
                    });

                    child.addEventListener('mouseleave', () => {
                        child.style.outline = '';
                        child.style.outlineOffset = '';
                    });

                    // Alt+Click to edit child element
                    child.addEventListener('click', (e) => {
                        if (e.altKey) {
                            e.preventDefault();
                            e.stopPropagation();
                            editChildElement(el.getAttribute('data-id'), child);
                        }
                    });

                    // Double-click to edit text inline
                    const isTextElement = ['H1', 'H2', 'H3', 'H4', 'H5', 'H6', 'P', 'SPAN', 'A', 'BUTTON', 'LI', 'TD', 'TH', 'LABEL', 'DIV'].includes(child.tagName);
                    if (isTextElement) {
                        child.addEventListener('dblclick', (e) => {
                            e.preventDefault();
                            e.stopPropagation();
                            makeTextEditable(el.getAttribute('data-id'), child);
                        });

                        // Visual hint on hover
                        child.style.cursor = 'text';
                        child.title = 'Double-click to edit text';
                    }
                });
            });
        }

        // Drag and Drop Handlers
        let draggedElement = null;

        function handleDragStart(e) {
            draggedElement = this;
            this.style.opacity = '0.5';
            e.dataTransfer.effectAllowed = 'move';
            e.dataTransfer.setData('text/html', this.innerHTML);
        }

        function handleDragOver(e) {
            if (e.preventDefault) {
                e.preventDefault();
            }
            e.dataTransfer.dropEffect = 'move';
            return false;
        }

        function handleDrop(e) {
            if (e.stopPropagation) {
                e.stopPropagation();
            }

            if (draggedElement !== this) {
                const draggedId = draggedElement.getAttribute('data-id');
                const targetId = this.getAttribute('data-id');

                const draggedIndex = canvasElements.findIndex(el => el.id === draggedId);
                const targetIndex = canvasElements.findIndex(el => el.id === targetId);

                // Swap elements
                const [removed] = canvasElements.splice(draggedIndex, 1);
                canvasElements.splice(targetIndex, 0, removed);

                renderCanvas();
                playSound('pop', 'E5');
                showStamp('ğŸ”„');
            }

            return false;
        }

        function handleDragEnd(e) {
            this.style.opacity = '1';
        }

        // Move up/down functions
        function moveElementUp(id) {
            const index = canvasElements.findIndex(el => el.id === id);
            if (index > 0) {
                [canvasElements[index - 1], canvasElements[index]] = [canvasElements[index], canvasElements[index - 1]];
                renderCanvas();
                selectElement(id);
                playSound('pop', 'D5');
                showStamp('â¬†ï¸');
            }
        }

        function moveElementDown(id) {
            const index = canvasElements.findIndex(el => el.id === id);
            if (index < canvasElements.length - 1) {
                [canvasElements[index], canvasElements[index + 1]] = [canvasElements[index + 1], canvasElements[index]];
                renderCanvas();
                selectElement(id);
                playSound('pop', 'D5');
                showStamp('â¬‡ï¸');
            }
        }

        // Layering functions (z-index control)
        function layerForward(id) {
            const el = canvasElements.find(e => e.id === id);
            if (!el) return;
            el.zIndex = (el.zIndex || 0) + 1;
            renderCanvas();
            selectElement(id);
            playSound('success', 'E5');
            showStamp('ğŸ”¼');
            updateStatus('Moved layer forward!');
        }

        function layerBack(id) {
            const el = canvasElements.find(e => e.id === id);
            if (!el) return;
            el.zIndex = Math.max(0, (el.zIndex || 0) - 1);
            renderCanvas();
            selectElement(id);
            playSound('success', 'D5');
            showStamp('ğŸ”½');
            updateStatus('Moved layer back!');
        }

        // ============================================
        // RESIZE FUNCTIONALITY - Drag to resize!
        // ============================================
        let resizingElement = null;
        let resizingElementDiv = null;
        let resizeDirection = null;
        let resizeStartX = 0;
        let resizeStartY = 0;
        let resizeStartWidth = 0;
        let resizeStartHeight = 0;

        function startResize(e) {
            e.preventDefault();
            e.stopPropagation();

            const handle = e.target;
            resizingElementDiv = handle.closest('.canvas-element');
            const elementId = resizingElementDiv.getAttribute('data-id');

            resizingElement = canvasElements.find(el => el.id === elementId);
            if (!resizingElement) return;

            resizeDirection = handle.getAttribute('data-direction');
            resizeStartX = e.clientX;
            resizeStartY = e.clientY;

            const rect = resizingElementDiv.getBoundingClientRect();
            resizeStartWidth = rect.width;
            resizeStartHeight = rect.height;

            document.addEventListener('mousemove', doResize);
            document.addEventListener('mouseup', stopResize);

            playSound('boop', 'C5');
            updateStatus('Resizing...');
        }

        function doResize(e) {
            if (!resizingElement || !resizingElementDiv) return;

            e.preventDefault();
            e.stopPropagation();

            const deltaX = e.clientX - resizeStartX;
            const deltaY = e.clientY - resizeStartY;

            let newWidth = resizeStartWidth;
            let newHeight = resizeStartHeight;

            // Check if element is a circle (needs aspect ratio maintained)
            const contentDiv = resizingElementDiv.querySelector('.element-content');
            const firstChild = contentDiv ? contentDiv.firstElementChild : null;
            const isCircle = firstChild && firstChild.style.borderRadius === '50%';

            // Calculate new dimensions based on direction
            if (resizeDirection.includes('e')) {
                newWidth = resizeStartWidth + deltaX;
            }
            if (resizeDirection.includes('w')) {
                newWidth = resizeStartWidth - deltaX;
            }
            if (resizeDirection.includes('s')) {
                newHeight = resizeStartHeight + deltaY;
            }
            if (resizeDirection.includes('n')) {
                newHeight = resizeStartHeight - deltaY;
            }

            // For circles, maintain aspect ratio (width = height)
            if (isCircle) {
                const avgSize = Math.max(newWidth, newHeight);
                newWidth = avgSize;
                newHeight = avgSize;
            }

            // Snap to grid if enabled
            if (gridEnabled) {
                newWidth = Math.round(newWidth / 20) * 20;
                newHeight = Math.round(newHeight / 20) * 20;
            }

            // Min size constraints
            newWidth = Math.max(50, newWidth);
            newHeight = Math.max(30, newHeight);

            // For circles, ensure they stay square
            if (isCircle) {
                newHeight = newWidth;
            }

            // Update element size directly on the div (don't re-render during resize!)
            resizingElementDiv.style.width = newWidth + 'px';
            resizingElementDiv.style.height = newHeight + 'px';

            // Store for later
            resizingElement.width = newWidth + 'px';
            resizingElement.height = newHeight + 'px';
        }

        function stopResize(e) {
            if (resizingElement) {
                e.preventDefault();
                e.stopPropagation();

                // Parse dimensions to display clean numbers
                const width = parseInt(resizingElement.width) || 0;
                const height = parseInt(resizingElement.height) || 0;

                saveState(); // Save for undo/redo
                playSound('success', 'E5');
                showStamp('ğŸ“');
                updateStatus(`Resized to ${width}px Ã— ${height}px`);

                // Now re-render to save the changes properly
                renderCanvas();
                selectElement(resizingElement.id);
            }

            resizingElement = null;
            resizingElementDiv = null;
            resizeDirection = null;
            document.removeEventListener('mousemove', doResize);
            document.removeEventListener('mouseup', stopResize);
        }

        function selectElement(id) {
            document.querySelectorAll('.canvas-element').forEach(el => el.classList.remove('selected'));
            document.querySelector(`[data-id="${id}"]`).classList.add('selected');
            selectedElement = id;
            renderProperties(id);
            playSound('boop', 'C5');
        }

        let currentEditingId = null;
        let visualEdits = {
            width: 'medium',
            height: 'medium',
            fontSize: 'normal',
            border: 'medium',
            align: 'left',
            padding: 20,
            shadow: 'none',
            radius: 'sharp',
            rotation: 0
        };

        function editElement(id) {
            const el = canvasElements.find(e => e.id === id);
            if (!el) return;

            currentEditingId = id;

            // Reset visual edits to defaults
            visualEdits = {
                width: el.visualWidth || 'medium',
                height: el.visualHeight || 'medium',
                fontSize: el.visualFontSize || 'normal',
                border: el.visualBorder || 'medium',
                align: el.visualAlign || 'left',
                padding: el.visualPadding || 20,
                shadow: el.visualShadow || 'none',
                radius: el.visualRadius || 'sharp',
                rotation: el.visualRotation || 0
            };

            // Populate the modal with current values
            document.getElementById('edit-element-html').value = el.html;
            document.getElementById('edit-element-bgcolor').value = el.bgcolor || '#ffffff';
            document.getElementById('edit-element-color').value = el.color || '#000000';
            document.getElementById('edit-element-opacity').value = el.opacity || 100;
            document.getElementById('opacity-value').textContent = (el.opacity || 100) + '%';
            updatePaddingDisplay();

            openModal('edit-element-modal');
            playSound('boop', 'E5');
        }

        // Edit child elements (Alt+Click feature)
        function editChildElement(parentId, childElement) {
            const parentEl = canvasElements.find(e => e.id === parentId);
            if (!parentEl) return;

            currentEditingId = parentId;

            // Get the child's HTML
            const childHtml = childElement.outerHTML;

            // Populate modal with child's HTML
            document.getElementById('edit-element-html').value = childHtml;

            // Store reference to child for updating later
            window.editingChildElement = childElement;
            window.editingChildParent = parentId;

            openModal('edit-element-modal');
            playSound('boop', 'G5');
            showStamp('ğŸ¯');
            updateStatus('Editing child element! Alt+Click to edit any element.');
        }

        // Inline text editing (Double-click feature)
        function makeTextEditable(parentId, textElement) {
            const parentEl = canvasElements.find(e => e.id === parentId);
            if (!parentEl) return;

            // Store original text and styling
            const originalText = textElement.textContent;
            const originalCursor = textElement.style.cursor;
            const originalOutline = textElement.style.outline;

            // Make element editable
            textElement.contentEditable = 'true';
            textElement.style.outline = '2px solid #00FFFF';
            textElement.style.cursor = 'text';

            // Focus and select all text
            textElement.focus();
            const range = document.createRange();
            range.selectNodeContents(textElement);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);

            playSound('boop', 'F5');
            updateStatus('Editing text... Press Enter or click outside to save');

            // Save function
            const saveEdit = () => {
                textElement.contentEditable = 'false';
                textElement.style.outline = originalOutline;
                textElement.style.cursor = originalCursor;

                // Update the parent element's HTML with new text
                const parentDiv = document.querySelector(`[data-id="${parentId}"]`);
                if (parentDiv) {
                    const contentDiv = parentDiv.querySelector('.element-content');
                    if (contentDiv) {
                        parentEl.html = contentDiv.innerHTML;
                    }
                }

                playSound('success', 'G5');
                showStamp('âœï¸');
                updateStatus('Text updated!');

                // Re-render to save changes
                renderCanvas();
            };

            // Save on blur
            textElement.addEventListener('blur', saveEdit, { once: true });

            // Save on Enter (but allow Shift+Enter for new lines)
            const handleEnter = (e) => {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    textElement.blur(); // Triggers save
                }
                if (e.key === 'Escape') {
                    // Cancel edit
                    textElement.textContent = originalText;
                    textElement.blur();
                }
            };
            textElement.addEventListener('keydown', handleEnter);
        }

        // VISUAL EDITING FUNCTIONS!
        function setVisualWidth(size) {
            visualEdits.width = size;
            playSound('pop', 'D5');
            showStamp('ğŸ“');
        }

        function setVisualHeight(size) {
            visualEdits.height = size;
            playSound('pop', 'D5');
            showStamp('ğŸ“');
        }

        function setVisualFontSize(size) {
            visualEdits.fontSize = size;
            playSound('pop', 'E5');
            showStamp('âœï¸');
        }

        function setVisualBorder(thickness) {
            visualEdits.border = thickness;
            playSound('pop', 'F5');
            showStamp('ğŸ“');
        }

        function setVisualAlign(align) {
            visualEdits.align = align;
            playSound('pop', 'G5');
            showStamp('ğŸ“');
        }

        function adjustPadding(change) {
            visualEdits.padding = Math.max(0, visualEdits.padding + change);
            updatePaddingDisplay();
            playSound('boop', change > 0 ? 'A5' : 'G4');
            showStamp(change > 0 ? 'â•' : 'â–');
        }

        function updatePaddingDisplay() {
            const display = document.getElementById('padding-display');
            if (!display) return;

            const p = visualEdits.padding;
            if (p === 0) display.textContent = 'None';
            else if (p < 10) display.textContent = 'Tiny';
            else if (p < 20) display.textContent = 'Small';
            else if (p < 30) display.textContent = 'Normal';
            else if (p < 50) display.textContent = 'Big';
            else display.textContent = 'HUGE!';
        }

        function setVisualShadow(level) {
            visualEdits.shadow = level;
            playSound('pop', 'A5');
            showStamp('âœ¨');
        }

        function setVisualRadius(style) {
            visualEdits.radius = style;
            playSound('pop', 'B5');
            showStamp('ğŸ”²');
        }

        function rotateElement(degrees) {
            visualEdits.rotation = degrees;
            playSound('success', 'C6');
            showStamp('ğŸ”„');
        }

        function saveElementEdit() {
            if (!currentEditingId) return;

            const el = canvasElements.find(e => e.id === currentEditingId);
            if (!el) return;

            // Get values from modal
            const newHtml = document.getElementById('edit-element-html').value;
            const bgcolor = document.getElementById('edit-element-bgcolor').value;
            const color = document.getElementById('edit-element-color').value;
            const opacity = document.getElementById('edit-element-opacity').value;

            // Check if we're editing a child element (Alt+Click feature)
            if (window.editingChildElement && window.editingChildParent) {
                // Replace the child element in the parent's HTML
                const tempDiv = document.createElement('div');
                tempDiv.innerHTML = el.html;

                // Find and replace the child element
                const childToReplace = tempDiv.querySelector(`*[outerHTML="${window.editingChildElement.outerHTML.replace(/"/g, '\\"')}"]`);

                // Simpler approach: replace the entire parent HTML with updated child
                const parentDiv = document.querySelector(`[data-id="${currentEditingId}"]`);
                if (parentDiv) {
                    const contentDiv = parentDiv.querySelector('.element-content');
                    if (contentDiv) {
                        // Find the child in the DOM and replace it
                        const oldChild = Array.from(contentDiv.querySelectorAll('*')).find(c => c === window.editingChildElement);
                        if (oldChild) {
                            const newChildDiv = document.createElement('div');
                            newChildDiv.innerHTML = newHtml;
                            oldChild.outerHTML = newChildDiv.innerHTML;

                            // Update the stored HTML
                            el.html = contentDiv.innerHTML;
                        }
                    }
                }

                // Clear the child editing references
                window.editingChildElement = null;
                window.editingChildParent = null;

                renderCanvas();
                closeModal('edit-element-modal');
                playSound('success', 'G5');
                showStamp('ğŸ’¾');
                updateStatus('Child element updated!');
                return;
            }

            // Save visual edits to element for later re-editing
            el.visualWidth = visualEdits.width;
            el.visualHeight = visualEdits.height;
            el.visualFontSize = visualEdits.fontSize;
            el.visualBorder = visualEdits.border;
            el.visualAlign = visualEdits.align;
            el.visualPadding = visualEdits.padding;
            el.visualShadow = visualEdits.shadow;
            el.visualRadius = visualEdits.radius;
            el.visualRotation = visualEdits.rotation;

            // Convert visual choices to CSS
            const widthMap = { small: '300px', medium: '600px', large: '900px', full: '100%' };
            const heightMap = { small: '100px', medium: '300px', large: '600px' };
            const fontSizeMap = { tiny: '12px', small: '16px', normal: '20px', big: '28px', huge: '40px' };
            const borderMap = { none: '0', thin: '2px', medium: '4px', thick: '6px', super: '10px' };
            const shadowMap = {
                none: 'none',
                subtle: '2px 2px 4px rgba(0,0,0,0.3)',
                medium: '4px 4px 8px rgba(0,0,0,0.4)',
                strong: '8px 8px 0 #000'
            };
            const radiusMap = { sharp: '0', rounded: '10px', pill: '50px' };

            // Apply styles to the HTML
            const tempDiv = document.createElement('div');
            tempDiv.innerHTML = newHtml;
            const firstChild = tempDiv.firstElementChild;

            if (firstChild) {
                // Apply basic styles
                if (bgcolor && bgcolor !== '#ffffff') firstChild.style.backgroundColor = bgcolor;
                if (color && color !== '#000000') firstChild.style.color = color;
                if (opacity && opacity !== '100') firstChild.style.opacity = opacity / 100;

                // Apply visual edits
                firstChild.style.width = widthMap[visualEdits.width];
                firstChild.style.height = heightMap[visualEdits.height];
                firstChild.style.fontSize = fontSizeMap[visualEdits.fontSize];
                firstChild.style.textAlign = visualEdits.align;
                firstChild.style.padding = visualEdits.padding + 'px';
                firstChild.style.boxShadow = shadowMap[visualEdits.shadow];
                firstChild.style.borderRadius = radiusMap[visualEdits.radius];

                // Border
                if (visualEdits.border !== 'none') {
                    firstChild.style.border = `${borderMap[visualEdits.border]} solid ${color !== '#000000' ? color : '#000'}`;
                } else {
                    firstChild.style.border = 'none';
                }

                // Rotation
                if (visualEdits.rotation !== 0) {
                    firstChild.style.transform = `rotate(${visualEdits.rotation}deg)`;
                }

                // Display block for sizing to work
                if (firstChild.tagName === 'SPAN' || firstChild.tagName === 'A') {
                    firstChild.style.display = 'inline-block';
                } else {
                    firstChild.style.display = 'block';
                }

                el.html = tempDiv.innerHTML;
            }

            saveState(); // Save for undo/redo
            renderCanvas();
            closeModal('edit-element-modal');
            playSound('success', 'G5');
            showStamp('ğŸ’¾');
            updateStatus('Element styled with visual controls!');
        }

        function duplicateElement(id) {
            const el = canvasElements.find(e => e.id === id);
            if (!el) return;

            const newId = 'el-' + (++elementIdCounter);
            canvasElements.push({ id: newId, type: el.type, html: el.html });
            saveState(); // Save for undo/redo
            renderCanvas();
            playSound('pop', 'A5');
            showStamp('ğŸ“‹');
            updateElementCount();
        }

        function deleteElement(id) {
            canvasElements = canvasElements.filter(e => e.id !== id);
            saveState(); // Save for undo/redo
            renderCanvas();
            playSound('boop', 'C4');
            showStamp('ğŸ—‘ï¸');
            updateStatus('Element deleted!');
            updateElementCount();
            clearProperties();
        }

        function renderProperties(id) {
            const el = canvasElements.find(e => e.id === id);
            if (!el) return;

            // Parse the element to extract properties
            const parser = new DOMParser();
            const doc = parser.parseFromString(el.html, 'text/html');
            const firstElement = doc.body.firstElementChild;

            let extractedProps = {
                tag: 'div',
                classes: [],
                id: '',
                styles: {}
            };

            if (firstElement) {
                extractedProps.tag = firstElement.tagName.toLowerCase();
                extractedProps.classes = Array.from(firstElement.classList);
                extractedProps.id = firstElement.id || '';

                // Extract inline styles
                if (firstElement.style.cssText) {
                    const styleProps = firstElement.style.cssText.split(';').filter(s => s.trim());
                    styleProps.forEach(prop => {
                        const [key, value] = prop.split(':').map(s => s.trim());
                        if (key && value) extractedProps.styles[key] = value;
                    });
                }
            }

            document.getElementById('properties-container').innerHTML = `
                <div class="property-box">
                    <div class="property-header">ğŸ” Element Inspector</div>
                    <div class="property-content">
                        <label class="property-label">Type:</label>
                        <div style="font-weight: bold; color: var(--blue); margin-bottom: 8px;">${el.type} (${extractedProps.tag})</div>

                        <label class="property-label">ID:</label>
                        <input type="text" class="property-input" value="${extractedProps.id}"
                               onchange="updateElementProperty('${id}', 'id', this.value)"
                               placeholder="element-id">

                        <label class="property-label">Classes:</label>
                        <input type="text" class="property-input" value="${extractedProps.classes.join(' ')}"
                               onchange="updateElementProperty('${id}', 'class', this.value)"
                               placeholder="class-one class-two">
                    </div>
                </div>

                <div class="property-box">
                    <div class="property-header">ğŸ¨ Style Properties</div>
                    <div class="property-content">
                        <label class="property-label">Background Color:</label>
                        <div style="display: flex; gap: 4px; margin-bottom: 8px;">
                            <input type="color" value="${extractedProps.styles['background-color'] || extractedProps.styles['background'] || '#FFFFFF'}"
                                   onchange="updateElementStyle('${id}', 'background-color', this.value)"
                                   style="width: 50px; height: 40px; border: 3px solid #000;">
                            <input type="text" class="property-input" value="${extractedProps.styles['background-color'] || extractedProps.styles['background'] || ''}"
                                   onchange="updateElementStyle('${id}', 'background-color', this.value)"
                                   placeholder="#FFFFFF or transparent" style="flex: 1; margin: 0;">
                        </div>

                        <label class="property-label">Text Color:</label>
                        <div style="display: flex; gap: 4px; margin-bottom: 8px;">
                            <input type="color" value="${extractedProps.styles['color'] || '#000000'}"
                                   onchange="updateElementStyle('${id}', 'color', this.value)"
                                   style="width: 50px; height: 40px; border: 3px solid #000;">
                            <input type="text" class="property-input" value="${extractedProps.styles['color'] || ''}"
                                   onchange="updateElementStyle('${id}', 'color', this.value)"
                                   placeholder="#000000" style="flex: 1; margin: 0;">
                        </div>

                        <label class="property-label">Font Size:</label>
                        <input type="text" class="property-input" value="${extractedProps.styles['font-size'] || ''}"
                               onchange="updateElementStyle('${id}', 'font-size', this.value)"
                               placeholder="16px, 1.5em, 120%">

                        <label class="property-label">Font Family:</label>
                        <select class="property-input" onchange="updateElementStyle('${id}', 'font-family', this.value)">
                            <option value="">Default</option>
                            <option value="'Comic Sans MS', sans-serif" ${extractedProps.styles['font-family']?.includes('Comic Sans') ? 'selected' : ''}>Comic Sans MS</option>
                            <option value="'VT323', monospace" ${extractedProps.styles['font-family']?.includes('VT323') ? 'selected' : ''}>VT323 (Retro)</option>
                            <option value="'Courier New', monospace" ${extractedProps.styles['font-family']?.includes('Courier') ? 'selected' : ''}>Courier New</option>
                            <option value="Arial, sans-serif">Arial</option>
                            <option value="'Times New Roman', serif">Times New Roman</option>
                        </select>

                        <label class="property-label">Padding:</label>
                        <input type="text" class="property-input" value="${extractedProps.styles['padding'] || ''}"
                               onchange="updateElementStyle('${id}', 'padding', this.value)"
                               placeholder="10px or 10px 20px">

                        <label class="property-label">Margin:</label>
                        <input type="text" class="property-input" value="${extractedProps.styles['margin'] || ''}"
                               onchange="updateElementStyle('${id}', 'margin', this.value)"
                               placeholder="10px or 10px auto">

                        <label class="property-label">Border:</label>
                        <input type="text" class="property-input" value="${extractedProps.styles['border'] || ''}"
                               onchange="updateElementStyle('${id}', 'border', this.value)"
                               placeholder="4px solid #000">

                        <label class="property-label">Width:</label>
                        <input type="text" class="property-input" value="${extractedProps.styles['width'] || ''}"
                               onchange="updateElementStyle('${id}', 'width', this.value)"
                               placeholder="auto, 100%, 500px">

                        <label class="property-label">Height:</label>
                        <input type="text" class="property-input" value="${extractedProps.styles['height'] || ''}"
                               onchange="updateElementStyle('${id}', 'height', this.value)"
                               placeholder="auto, 100px">

                        <label class="property-label">Display:</label>
                        <select class="property-input" onchange="updateElementStyle('${id}', 'display', this.value)">
                            <option value="">Default</option>
                            <option value="block" ${extractedProps.styles['display'] === 'block' ? 'selected' : ''}>Block</option>
                            <option value="inline-block" ${extractedProps.styles['display'] === 'inline-block' ? 'selected' : ''}>Inline-Block</option>
                            <option value="flex" ${extractedProps.styles['display'] === 'flex' ? 'selected' : ''}>Flex</option>
                            <option value="grid" ${extractedProps.styles['display'] === 'grid' ? 'selected' : ''}>Grid</option>
                            <option value="none" ${extractedProps.styles['display'] === 'none' ? 'selected' : ''}>None (Hidden)</option>
                        </select>

                        <label class="property-label">Text Align:</label>
                        <select class="property-input" onchange="updateElementStyle('${id}', 'text-align', this.value)">
                            <option value="">Default</option>
                            <option value="left" ${extractedProps.styles['text-align'] === 'left' ? 'selected' : ''}>Left</option>
                            <option value="center" ${extractedProps.styles['text-align'] === 'center' ? 'selected' : ''}>Center</option>
                            <option value="right" ${extractedProps.styles['text-align'] === 'right' ? 'selected' : ''}>Right</option>
                            <option value="justify" ${extractedProps.styles['text-align'] === 'justify' ? 'selected' : ''}>Justify</option>
                        </select>
                    </div>
                </div>

                <div class="property-box">
                    <div class="property-header">Quick Colors</div>
                    <div class="property-content">
                        <div class="color-grid">
                            <div class="color-box" style="background: #FF0000;" onclick="updateElementStyle('${id}', 'color', '#FF0000')"></div>
                            <div class="color-box" style="background: #0000FF;" onclick="updateElementStyle('${id}', 'color', '#0000FF')"></div>
                            <div class="color-box" style="background: #FFFF00;" onclick="updateElementStyle('${id}', 'color', '#FFFF00')"></div>
                            <div class="color-box" style="background: #00FF00;" onclick="updateElementStyle('${id}', 'color', '#00FF00')"></div>
                            <div class="color-box" style="background: #FF6600;" onclick="updateElementStyle('${id}', 'color', '#FF6600')"></div>
                            <div class="color-box" style="background: #9900FF;" onclick="updateElementStyle('${id}', 'color', '#9900FF')"></div>
                            <div class="color-box" style="background: #FF69B4;" onclick="updateElementStyle('${id}', 'color', '#FF69B4')"></div>
                            <div class="color-box" style="background: #000000;" onclick="updateElementStyle('${id}', 'color', '#000000')"></div>
                        </div>
                    </div>
                </div>

                <div class="property-box">
                    <div class="property-header">âš¡ JavaScript Interactions</div>
                    <div class="property-content">
                        <button class="big-button purple" onclick="addInteraction('${id}', 'onclick')" style="width: 100%; margin-bottom: 8px;">
                            ğŸ–±ï¸ Add Click Event
                        </button>
                        <button class="big-button blue" onclick="addInteraction('${id}', 'onhover')" style="width: 100%; margin-bottom: 8px;">
                            ğŸ‘† Add Hover Effect
                        </button>
                        <button class="big-button orange" onclick="addAnimation('${id}')" style="width: 100%; margin-bottom: 8px;">
                            ğŸ¬ Add Animation
                        </button>
                    </div>
                </div>

                <div class="property-box">
                    <div class="property-header">Actions</div>
                    <div class="property-content">
                        <button class="big-button green" onclick="saveAsComponent('${id}')" style="width: 100%; margin-bottom: 8px;">
                            ğŸ’¾ Save as Component
                        </button>
                        <button class="big-button yellow" onclick="editElement('${id}')" style="width: 100%; margin-bottom: 8px;">
                            âœï¸ Edit HTML
                        </button>
                        <button class="big-button blue" onclick="duplicateElement('${id}')" style="width: 100%; margin-bottom: 8px;">
                            ğŸ“‹ Duplicate
                        </button>
                        <button class="big-button red" onclick="deleteElement('${id}')" style="width: 100%;">
                            ğŸ—‘ï¸ Delete
                        </button>
                    </div>
                </div>
            `;
        }

        function clearProperties() {
            document.getElementById('properties-container').innerHTML = `
                <div style="text-align: center; color: var(--dark-gray); margin-top: 40px; font-size: 16px;">
                    Click something to edit it!
                </div>
            `;
        }

        function applyColor(id, color) {
            const el = canvasElements.find(e => e.id === id);
            if (!el) return;

            const temp = document.createElement('div');
            temp.innerHTML = el.html;
            const firstChild = temp.firstElementChild;
            if (firstChild) {
                firstChild.style.color = color;
                el.html = temp.innerHTML;
                renderCanvas();
                selectElement(id);
                playSound('pop', 'E5');
            }
        }

        // ============================================
        // ENHANCED ELEMENT EDITING FUNCTIONS
        // ============================================

        function updateElementProperty(id, property, value) {
            const el = canvasElements.find(e => e.id === id);
            if (!el) return;

            const temp = document.createElement('div');
            temp.innerHTML = el.html;
            const firstChild = temp.firstElementChild;

            if (firstChild) {
                if (property === 'id') {
                    firstChild.id = value;
                } else if (property === 'class') {
                    firstChild.className = value;
                }

                el.html = temp.innerHTML;
                renderCanvas();
                selectElement(id);
                playSound('success', 'D5');
                showStamp('âœ…');
            }
        }

        function updateElementStyle(id, styleProp, value) {
            const el = canvasElements.find(e => e.id === id);
            if (!el) return;

            const temp = document.createElement('div');
            temp.innerHTML = el.html;
            const firstChild = temp.firstElementChild;

            if (firstChild) {
                // Smart color application: apply to both text and background for shapes
                if (styleProp === 'color') {
                    const isShape = firstChild.tagName === 'DIV' &&
                                   (firstChild.style.borderRadius ||
                                    firstChild.style.width ||
                                    firstChild.style.height ||
                                    firstChild.classList.contains('shape') ||
                                    firstChild.classList.contains('circle') ||
                                    firstChild.classList.contains('square'));

                    if (isShape) {
                        // For shapes, update background color
                        firstChild.style.background = value;
                        firstChild.style.backgroundColor = value;
                    } else {
                        // For text elements, update text color
                        firstChild.style.color = value;
                    }
                } else {
                    // For other properties, apply as-is
                    firstChild.style[styleProp] = value;
                }

                el.html = temp.innerHTML;
                renderCanvas();
                selectElement(id);
                playSound('pop', 'F5');
            }
        }

        function addInteraction(id, eventType) {
            const el = canvasElements.find(e => e.id === id);
            if (!el) return;

            let interactions = {
                'onclick': [
                    { label: 'Alert message', code: `alert('Hello!')` },
                    { label: 'Change background color', code: `this.style.backgroundColor = '#FF00FF'` },
                    { label: 'Toggle visibility', code: `this.style.display = this.style.display === 'none' ? 'block' : 'none'` },
                    { label: 'Play sound effect', code: `new Audio('../assets/audio/SFX_button.wav').play()` },
                    { label: 'Rotate element', code: `this.style.transform = 'rotate(' + (Math.random() * 360) + 'deg)'` },
                    { label: 'Make bigger', code: `this.style.transform = 'scale(1.2)'; setTimeout(() => this.style.transform = 'scale(1)', 200)` },
                    { label: 'Bounce animation', code: `this.style.animation = 'bounce 0.5s ease'` }
                ],
                'onhover': [
                    { label: 'Glow on hover', code: `this.style.boxShadow = '0 0 20px #FF00FF'` },
                    { label: 'Scale up on hover', code: `this.style.transform = 'scale(1.1)'` },
                    { label: 'Change color on hover', code: `this.style.backgroundColor = '#00FFFF'` },
                    { label: 'Rotate on hover', code: `this.style.transform = 'rotate(5deg)'` }
                ]
            };

            let options = interactions[eventType] || [];
            let optionsHTML = options.map((opt, i) =>
                `<div class="property-label" style="cursor: pointer; padding: 8px; border: 2px solid #000; margin-bottom: 4px; background: #FFFF00;"
                      onclick="applyInteraction('${id}', '${eventType}', '${opt.code.replace(/'/g, "\\'")}')">
                    ${i + 1}. ${opt.label}
                </div>`
            ).join('');

            document.getElementById('properties-container').innerHTML = `
                <div class="property-box">
                    <div class="property-header">âš¡ Add ${eventType === 'onclick' ? 'Click' : 'Hover'} Event</div>
                    <div class="property-content">
                        <p style="margin-bottom: 12px;">Choose an interaction:</p>
                        ${optionsHTML}
                        <button class="big-button red" onclick="renderProperties('${id}')" style="width: 100%; margin-top: 12px;">
                            â† Back to Inspector
                        </button>
                    </div>
                </div>
            `;
        }

        function applyInteraction(id, eventType, code) {
            const el = canvasElements.find(e => e.id === id);
            if (!el) return;

            const temp = document.createElement('div');
            temp.innerHTML = el.html;
            const firstChild = temp.firstElementChild;

            if (firstChild) {
                if (eventType === 'onclick') {
                    firstChild.setAttribute('onclick', code);
                    // Add visual indicator
                    firstChild.style.cursor = 'pointer';
                } else if (eventType === 'onhover') {
                    firstChild.setAttribute('onmouseover', code);
                    firstChild.setAttribute('onmouseout', `this.style = ''`);
                }

                el.html = temp.innerHTML;

                // Store metadata about interactions
                if (!el.interactions) el.interactions = [];
                el.interactions.push({ type: eventType, added: new Date() });

                renderCanvas();
                selectElement(id);
                playSound('success', 'A5');
                showStamp('âš¡');
                updateStatus(`${eventType === 'onclick' ? 'Click' : 'Hover'} event added! ${eventType === 'onclick' ? 'Click the element to test it.' : 'Hover over the element to test it.'}`);

                // Flash the element to show it was updated
                setTimeout(() => {
                    const elementDiv = document.querySelector(`[data-id="${id}"]`);
                    if (elementDiv) {
                        elementDiv.style.outline = '4px solid #00FFFF';
                        setTimeout(() => {
                            elementDiv.style.outline = '';
                        }, 500);
                    }
                }, 100);

                // Go back to properties
                renderProperties(id);
            }
        }

        function addAnimation(id) {
            const animations = [
                { label: 'Bounce', keyframes: 'bounce', css: `@keyframes bounce { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-20px); } }` },
                { label: 'Shake', keyframes: 'shake', css: `@keyframes shake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-10px); } 75% { transform: translateX(10px); } }` },
                { label: 'Spin', keyframes: 'spin', css: `@keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }` },
                { label: 'Pulse', keyframes: 'pulse', css: `@keyframes pulse { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.1); } }` },
                { label: 'Fade In', keyframes: 'fadeIn', css: `@keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }` },
                { label: 'Slide In', keyframes: 'slideIn', css: `@keyframes slideIn { from { transform: translateX(-100%); } to { transform: translateX(0); } }` },
                { label: 'Rainbow', keyframes: 'rainbow', css: `@keyframes rainbow { 0% { color: red; } 25% { color: yellow; } 50% { color: lime; } 75% { color: cyan; } 100% { color: magenta; } }` }
            ];

            let optionsHTML = animations.map((anim, i) =>
                `<div class="property-label" style="cursor: pointer; padding: 8px; border: 2px solid #000; margin-bottom: 4px; background: #FF6600;"
                      onclick="applyAnimation('${id}', '${anim.keyframes}', '${anim.css.replace(/'/g, "\\'")}')">
                    ${i + 1}. ${anim.label}
                </div>`
            ).join('');

            document.getElementById('properties-container').innerHTML = `
                <div class="property-box">
                    <div class="property-header">ğŸ¬ Add Animation</div>
                    <div class="property-content">
                        <p style="margin-bottom: 12px;">Choose an animation:</p>
                        ${optionsHTML}
                        <button class="big-button red" onclick="renderProperties('${id}')" style="width: 100%; margin-top: 12px;">
                            â† Back to Inspector
                        </button>
                    </div>
                </div>
            `;
        }

        function applyAnimation(id, animName, animCSS) {
            const el = canvasElements.find(e => e.id === id);
            if (!el) return;

            const temp = document.createElement('div');
            temp.innerHTML = el.html;
            const firstChild = temp.firstElementChild;

            if (firstChild) {
                // Add keyframe animation
                const styleTag = `<style>${animCSS}</style>`;
                firstChild.style.animation = `${animName} 1s ease-in-out infinite`;

                el.html = styleTag + temp.innerHTML;

                // Store metadata about animations
                if (!el.animations) el.animations = [];
                el.animations.push({ name: animName, added: new Date() });

                renderCanvas();
                selectElement(id);
                playSound('success', 'C6');
                showStamp('ğŸ¬');
                updateStatus(`Animation "${animName}" added! Watch it animate on the canvas.`);

                // Flash the element to show it was updated
                setTimeout(() => {
                    const elementDiv = document.querySelector(`[data-id="${id}"]`);
                    if (elementDiv) {
                        const originalOutline = elementDiv.style.outline;
                        elementDiv.style.outline = '4px solid #FF00FF';
                        setTimeout(() => {
                            elementDiv.style.outline = originalOutline;
                        }, 800);
                    }
                }, 100);

                // Go back to properties
                renderProperties(id);
            }
        }

        // Component Library Storage
        let savedComponents = JSON.parse(localStorage.getItem('wysiwyg-components') || '[]');

        function saveAsComponent(id) {
            const el = canvasElements.find(e => e.id === id);
            if (!el) return;

            const componentName = prompt('Name your component:', `${el.type}-component`);
            if (!componentName) return;

            savedComponents.push({
                name: componentName,
                type: el.type,
                html: el.html,
                savedAt: new Date().toISOString()
            });

            localStorage.setItem('wysiwyg-components', JSON.stringify(savedComponents));

            playSound('success', 'G6');
            showStamp('ğŸ’¾');
            updateStatus(`Component "${componentName}" saved!`);

            alert(`âœ… Component "${componentName}" saved!\n\nYou can now load it from the COMPONENTS section.`);
        }

        // Save any element as a reusable component (from canvas)
        function saveAsComponent(id) {
            const el = canvasElements.find(e => e.id === id);
            if (!el) return;

            // Prompt for component name
            const componentName = prompt('ğŸ’¾ Save as Component\n\nEnter a name for this component:', el.type || 'My Component');

            if (!componentName) {
                updateStatus('Component save cancelled');
                return;
            }

            // Load existing components
            let savedComponents = JSON.parse(localStorage.getItem('wysiwyg-components') || '[]');

            // Create new component
            const newComponent = {
                name: componentName,
                type: el.type || 'custom',
                html: el.html,
                width: el.width,
                height: el.height,
                savedAt: new Date().toISOString()
            };

            // Add to library
            savedComponents.push(newComponent);

            // Save to localStorage
            localStorage.setItem('wysiwyg-components', JSON.stringify(savedComponents));

            playSound('success', 'G5');
            showStamp('ğŸ’¾');
            updateStatus(`Component "${componentName}" saved!`);

            alert(`âœ… Component "${componentName}" saved!\n\nClick "ğŸ“¦ COMPONENTS" to load it into any project!`);
        }

        function loadComponentLibrary() {
            savedComponents = JSON.parse(localStorage.getItem('wysiwyg-components') || '[]');

            if (savedComponents.length === 0) {
                alert('No saved components yet! Select any element and click "ğŸ’¾ SAVE" to create a component.');
                return;
            }

            const componentList = savedComponents.map((comp, i) =>
                `<div class="property-label" style="cursor: pointer; padding: 8px; border: 2px solid #000; margin-bottom: 4px; background: #00FF00;"
                      onclick="insertComponent(${i})">
                    ğŸ“¦ ${comp.name}
                    <div style="font-size: 11px; color: #666;">Type: ${comp.type} | Saved: ${new Date(comp.savedAt).toLocaleDateString()}</div>
                </div>`
            ).join('');

            document.getElementById('properties-container').innerHTML = `
                <div class="property-box">
                    <div class="property-header">ğŸ“¦ Component Library</div>
                    <div class="property-content">
                        ${componentList}
                        <button class="big-button red" onclick="deleteAllComponents()" style="width: 100%; margin-top: 12px;">
                            ğŸ—‘ï¸ Clear Library
                        </button>
                    </div>
                </div>
            `;
        }

        function insertComponent(index) {
            const comp = savedComponents[index];
            if (!comp) return;

            addElementDirect(comp.type, comp.html);
            playSound('success', 'E6');
            showStamp('ğŸ“¦');
            updateStatus(`Inserted component: ${comp.name}`);
        }

        function deleteAllComponents() {
            if (confirm('Delete ALL saved components? This cannot be undone!')) {
                savedComponents = [];
                localStorage.removeItem('wysiwyg-components');
                clearProperties();
                playSound('boop', 'C4');
                alert('All components deleted!');
            }
        }

        // ============================================
        // NAVBAR BUILDER
        // ============================================

        function addPageToNavbar() {
            const select = document.getElementById('navbar-page-select');
            const textarea = document.getElementById('navbar-links');
            const selectedValue = select.value;

            if (!selectedValue) {
                updateStatus('Please select a page first!');
                return;
            }

            // Add the page to the textarea (append to end with newline)
            const currentValue = textarea.value.trim();
            if (currentValue) {
                textarea.value = currentValue + '\n' + selectedValue;
            } else {
                textarea.value = selectedValue;
            }

            // Reset select
            select.value = '';

            playSound('pop', 'F5');
            showStamp('âœ…');
            updateStatus('Page added to navbar links!');
        }

        function createNavbar(type) {
            const linksText = document.getElementById('navbar-links').value || 'Home | /index.html\nAbout | /about.html\nContact | /contact.html';
            const links = linksText.split('\n').map(line => {
                const [label, url] = line.split('|').map(s => s.trim());
                return { label, url };
            }).filter(link => link.label && link.url);

            const navbars = {
                'top-simple': `
                    <nav style="background: #0a0a14; border-bottom: 3px solid #f312af; padding: 15px 20px; display: flex; gap: 20px; align-items: center;">
                        <div style="font-size: 24px; font-weight: bold; color: #72FADE; margin-right: auto;">SITE NAME</div>
                        ${links.map(link => `<a href="${link.url}" style="color: #72FADE; text-decoration: none; padding: 8px 16px; border: 2px solid #72FADE; transition: all 0.2s;" onmouseover="this.style.background='#72FADE'; this.style.color='#000'" onmouseout="this.style.background='transparent'; this.style.color='#72FADE'">${link.label}</a>`).join('\n                        ')}
                    </nav>`,

                'top-dropdown': `
                    <nav style="background: #000; border-bottom: 4px solid #FF00FF; padding: 10px 20px; display: flex; gap: 0; align-items: center; position: relative;">
                        <div style="font-size: 28px; font-weight: bold; color: #00FFFF; margin-right: 40px;">âš¡ SITE</div>
                        ${links.map((link, i) => `
                        <div style="position: relative;" onmouseover="this.querySelector('.dropdown').style.display='block'" onmouseout="this.querySelector('.dropdown').style.display='none'">
                            <a href="${link.url}" style="color: #FF00FF; text-decoration: none; padding: 15px 20px; display: block; font-weight: bold;">${link.label}</a>
                            <div class="dropdown" style="display: none; position: absolute; top: 100%; left: 0; background: #FF00FF; min-width: 150px; border: 3px solid #000; z-index: 1000;">
                                <a href="${link.url}" style="display: block; padding: 10px; color: #000; text-decoration: none; border-bottom: 1px solid #000;" onmouseover="this.style.background='#00FFFF'" onmouseout="this.style.background='transparent'">${link.label}</a>
                            </div>
                        </div>`).join('')}
                    </nav>`,

                'sidebar-left': `
                    <div style="position: fixed; left: 0; top: 0; bottom: 0; width: 200px; background: linear-gradient(180deg, #f312af, #9900ff); border-right: 4px solid #000; padding: 20px; overflow-y: auto; z-index: 100;">
                        <h2 style="color: #FFF; text-align: center; border-bottom: 3px solid #FFF; padding-bottom: 10px; margin-bottom: 20px;">NAVIGATION</h2>
                        ${links.map(link => `<a href="${link.url}" style="display: block; color: #FFF; text-decoration: none; padding: 12px; margin-bottom: 8px; background: rgba(0,0,0,0.3); border: 2px solid #FFF; text-align: center; font-weight: bold;" onmouseover="this.style.background='#FFF'; this.style.color='#f312af'" onmouseout="this.style.background='rgba(0,0,0,0.3)'; this.style.color='#FFF'">${link.label}</a>`).join('\n                        ')}
                    </div>
                    <div style="margin-left: 220px; min-height: 100vh;">
                        <p style="padding: 20px;">Your content goes here</p>
                    </div>`,

                'sidebar-right': `
                    <div style="margin-right: 220px; min-height: 100vh;">
                        <p style="padding: 20px;">Your content goes here</p>
                    </div>
                    <div style="position: fixed; right: 0; top: 0; bottom: 0; width: 200px; background: #00FFFF; border-left: 4px solid #000; padding: 20px; overflow-y: auto; z-index: 100;">
                        <h2 style="color: #000; text-align: center; border-bottom: 3px solid #000; padding-bottom: 10px; margin-bottom: 20px;">MENU</h2>
                        ${links.map(link => `<a href="${link.url}" style="display: block; color: #000; text-decoration: none; padding: 12px; margin-bottom: 8px; background: #FFF; border: 3px solid #000; text-align: center; font-weight: bold;" onmouseover="this.style.background='#FF00FF'; this.style.color='#FFF'" onmouseout="this.style.background='#FFF'; this.style.color='#000'">${link.label}</a>`).join('\n                        ')}
                    </div>`,

                'footer-nav': `
                    <div style="min-height: 80vh; padding: 20px;">
                        <p>Your content goes here</p>
                    </div>
                    <footer style="background: #0a0a14; border-top: 3px solid #00FFFF; padding: 30px 20px; margin-top: auto;">
                        <div style="display: flex; gap: 30px; justify-content: center; flex-wrap: wrap;">
                            ${links.map(link => `<a href="${link.url}" style="color: #00FFFF; text-decoration: none; font-weight: bold; padding: 10px 20px; border: 2px solid #00FFFF;" onmouseover="this.style.background='#00FFFF'; this.style.color='#000'" onmouseout="this.style.background='transparent'; this.style.color='#00FFFF'">${link.label}</a>`).join('\n                            ')}
                        </div>
                        <div style="text-align: center; color: #72FADE; margin-top: 20px; font-size: 12px;">Â© 2025 Your Site</div>
                    </footer>`,

                'y2k-style': `
                    <div style="background: url('https://web.archive.org/web/20091027052024/http://geocities.com/dreamwarrior_2000/stars.gif'); border: 3px solid #FF00FF; padding: 0;">
                        <marquee style="background: #000; color: #00FF00; padding: 5px; border-bottom: 2px solid #FF00FF; font-weight: bold;">â˜… Welcome to my website! â˜…</marquee>
                        <div style="display: flex; justify-content: center; gap: 5px; padding: 10px; background: linear-gradient(90deg, #FF00FF, #00FFFF, #FFFF00, #FF00FF); flex-wrap: wrap;">
                            ${links.map(link => `<a href="${link.url}" style="background: #FFF; color: #000; text-decoration: none; padding: 8px 15px; border: 3px outset #CCC; font-family: 'Comic Sans MS', sans-serif; font-weight: bold; box-shadow: 3px 3px 0 rgba(0,0,0,0.3);" onmousedown="this.style.borderStyle='inset'" onmouseup="this.style.borderStyle='outset'">${link.label}</a>`).join('\n                            ')}
                        </div>
                    </div>`,

                'retro-tabs': `
                    <div style="background: #CCC; padding: 0; border-bottom: 3px solid #000;">
                        <div style="display: flex; gap: 2px; padding-top: 10px;">
                            ${links.map((link, i) => `<a href="${link.url}" style="background: ${i === 0 ? '#FFF' : '#AAA'}; color: #000; text-decoration: none; padding: 12px 24px; border: 3px solid #000; border-bottom: none; border-radius: 8px 8px 0 0; font-weight: bold; position: relative; ${i === 0 ? 'top: 3px;' : ''}" onmouseover="this.style.background='#FFF'; this.style.top='3px'" onmouseout="this.style.background='${i === 0 ? '#FFF' : '#AAA'}'; this.style.top='${i === 0 ? '3px' : '0'}'">${link.label}</a>`).join('\n                            ')}
                        </div>
                    </div>`,

                'floating-menu': `
                    <div style="position: fixed; top: 20px; right: 20px; background: #FF00FF; border: 4px solid #000; border-radius: 50%; width: 60px; height: 60px; display: flex; align-items: center; justify-content: center; cursor: pointer; z-index: 1000; box-shadow: 8px 8px 0 rgba(0,0,0,0.3);" onclick="this.querySelector('.floating-menu-items').style.display = this.querySelector('.floating-menu-items').style.display === 'none' ? 'block' : 'none'">
                        <span style="font-size: 28px;">â˜°</span>
                        <div class="floating-menu-items" style="display: none; position: absolute; top: 70px; right: 0; background: #FFF; border: 3px solid #000; min-width: 150px; box-shadow: 8px 8px 0 rgba(0,0,0,0.3);">
                            ${links.map(link => `<a href="${link.url}" style="display: block; padding: 12px 20px; color: #000; text-decoration: none; border-bottom: 2px solid #CCC; font-weight: bold;" onmouseover="this.style.background='#FF00FF'; this.style.color='#FFF'" onmouseout="this.style.background='#FFF'; this.style.color='#000'">${link.label}</a>`).join('\n                            ')}
                        </div>
                    </div>`,

                'pixel-game': `
                    <nav style="background: #1a1a2e; border-bottom: 4px solid #00ff41; padding: 0; font-family: 'Courier New', monospace; image-rendering: pixelated;">
                        <div style="display: flex; align-items: center; padding: 15px 20px;">
                            <div style="font-size: 20px; color: #00ff41; margin-right: 40px; font-weight: bold;">â–² GAME MENU â–¼</div>
                            <div style="display: flex; gap: 2px;">
                                ${links.map(link => `<a href="${link.url}" style="background: #16213e; color: #00ff41; text-decoration: none; padding: 10px 20px; border: 3px solid #00ff41; font-weight: bold; text-transform: uppercase; font-size: 12px;" onmouseover="this.style.background='#00ff41'; this.style.color='#000'" onmouseout="this.style.background='#16213e'; this.style.color='#00ff41'">[${link.label}]</a>`).join('\n                                ')}
                            </div>
                        </div>
                        <div style="background: #00ff41; height: 3px; opacity: 0.5;"></div>
                    </nav>`,

                'terminal-hacker': `
                    <nav style="background: #000; color: #00FF00; font-family: 'Courier New', monospace; border-bottom: 2px solid #00FF00; padding: 15px 20px; box-shadow: 0 0 20px rgba(0, 255, 0, 0.5);">
                        <div style="display: flex; align-items: center; gap: 30px;">
                            <div style="color: #00FFFF;">root@site:<span style="color: #0099FF;">~</span>$</div>
                            ${links.map(link => `<a href="${link.url}" style="color: #00FF00; text-decoration: none; padding: 8px 16px; border: 1px solid #00FF00; background: rgba(0, 255, 0, 0.1);" onmouseover="this.style.background='#00FF00'; this.style.color='#000'" onmouseout="this.style.background='rgba(0, 255, 0, 0.1)'; this.style.color='#00FF00'"> &gt; ${link.label}</a>`).join('\n                            ')}
                        </div>
                    </nav>`,

                'windows95': `
                    <div style="background: #C0C0C0; border-bottom: 2px solid #000; padding: 0; font-family: 'MS Sans Serif', Arial, sans-serif;">
                        <div style="background: linear-gradient(180deg, #000080 0%, #1084d0 100%); padding: 4px 8px; display: flex; align-items: center; gap: 15px; border-bottom: 2px solid #FFF;">
                            <div style="color: #FFF; font-weight: bold; font-size: 14px;">My Website</div>
                            <div style="margin-left: auto; display: flex; gap: 3px;">
                                <button style="background: #C0C0C0; border: 2px outset #FFF; width: 20px; height: 18px; font-size: 10px; padding: 0;">_</button>
                                <button style="background: #C0C0C0; border: 2px outset #FFF; width: 20px; height: 18px; font-size: 10px; padding: 0;">â–¡</button>
                                <button style="background: #C0C0C0; border: 2px outset #FFF; width: 20px; height: 18px; font-size: 10px; padding: 0;">X</button>
                            </div>
                        </div>
                        <div style="background: #C0C0C0; padding: 3px; border-bottom: 2px solid #808080; display: flex; gap: 0;">
                            ${links.map(link => `<a href="${link.url}" style="color: #000; text-decoration: none; padding: 6px 12px; background: #C0C0C0; border-right: 1px solid #808080;" onmouseover="this.style.background='#000080'; this.style.color='#FFF'" onmouseout="this.style.background='#C0C0C0'; this.style.color='#000'">${link.label}</a>`).join('\n                            ')}
                        </div>
                    </div>`,

                'breadcrumb': `
                    <nav style="background: #F5F5F5; border-bottom: 3px solid #DDD; padding: 15px 20px;">
                        <div style="display: flex; align-items: center; gap: 10px; font-size: 14px;">
                            <a href="/" style="color: #0066CC; text-decoration: none; font-weight: bold;" onmouseover="this.style.textDecoration='underline'" onmouseout="this.style.textDecoration='none'">ğŸ  Home</a>
                            ${links.map(link => `<span style="color: #999;">â†’</span><a href="${link.url}" style="color: #0066CC; text-decoration: none;" onmouseover="this.style.textDecoration='underline'" onmouseout="this.style.textDecoration='none'">${link.label}</a>`).join('\n                            ')}
                        </div>
                    </nav>`,

                'mega-menu': `
                    <nav style="background: #FFF; border-bottom: 4px solid #FF00FF; padding: 0; box-shadow: 0 4px 8px rgba(0,0,0,0.1);">
                        <div style="display: flex; align-items: center; padding: 20px 30px; gap: 40px;">
                            <div style="font-size: 24px; font-weight: bold; color: #FF00FF;">MEGA MENU</div>
                            ${links.map(link => `
                            <div style="position: relative;" onmouseover="this.querySelector('.mega-dropdown').style.display='block'" onmouseout="this.querySelector('.mega-dropdown').style.display='none'">
                                <a href="${link.url}" style="color: #000; text-decoration: none; font-weight: bold; font-size: 16px; padding: 10px 0; border-bottom: 3px solid transparent;" onmouseover="this.style.borderBottomColor='#FF00FF'" onmouseout="this.style.borderBottomColor='transparent'">${link.label}</a>
                                <div class="mega-dropdown" style="display: none; position: absolute; top: 100%; left: -50px; background: #FFF; min-width: 300px; border: 3px solid #FF00FF; padding: 20px; margin-top: 15px; box-shadow: 0 8px 16px rgba(0,0,0,0.2); z-index: 1000;">
                                    <h4 style="color: #FF00FF; margin: 0 0 10px 0;">${link.label} Section</h4>
                                    <a href="${link.url}" style="display: block; padding: 8px; color: #000; text-decoration: none; border-bottom: 1px solid #EEE;" onmouseover="this.style.background='#FFF0FF'" onmouseout="this.style.background='transparent'">Submenu Item</a>
                                </div>
                            </div>`).join('')}
                        </div>
                    </nav>`,

                'bottom-tabs': `
                    <div style="min-height: 80vh; padding: 20px;">
                        <p>Your content goes here</p>
                    </div>
                    <nav style="position: fixed; bottom: 0; left: 0; right: 0; background: #FFF; border-top: 3px solid #DDD; display: flex; justify-content: space-around; padding: 10px 0; box-shadow: 0 -4px 8px rgba(0,0,0,0.1); z-index: 1000;">
                        ${links.map((link, i) => `<a href="${link.url}" style="display: flex; flex-direction: column; align-items: center; text-decoration: none; color: ${i === 0 ? '#FF00FF' : '#999'}; font-size: 12px; padding: 5px 20px;" onmouseover="this.style.color='#FF00FF'" onmouseout="this.style.color='${i === 0 ? '#FF00FF' : '#999'}'"><div style="font-size: 24px; margin-bottom: 3px;">${i === 0 ? 'â­' : 'ğŸ“±'}</div>${link.label}</a>`).join('\n                        ')}
                    </nav>`,

                'kawaii-cute': `
                    <nav style="background: linear-gradient(135deg, #FFB6D9 0%, #C9F0FF 100%); border-bottom: 5px solid #FF69B4; padding: 20px; box-shadow: 0 4px 0 rgba(255, 105, 180, 0.3);">
                        <div style="display: flex; align-items: center; justify-content: center; gap: 15px; flex-wrap: wrap;">
                            <div style="font-size: 28px; color: #FF1493; font-weight: bold; text-shadow: 2px 2px #FFF;">âœ¨ Kawaii Menu âœ¨</div>
                            ${links.map(link => `<a href="${link.url}" style="background: #FFF; color: #FF69B4; text-decoration: none; padding: 12px 24px; border: 3px solid #FF69B4; border-radius: 25px; font-weight: bold; box-shadow: 4px 4px 0 rgba(255, 105, 180, 0.3); transition: all 0.2s;" onmouseover="this.style.transform='translateY(-3px)'; this.style.boxShadow='6px 6px 0 rgba(255, 105, 180, 0.5)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='4px 4px 0 rgba(255, 105, 180, 0.3)'">ğŸ’– ${link.label}</a>`).join('\n                            ')}
                        </div>
                    </nav>`
            };

            const navbarHTML = navbars[type] || navbars['top-simple'];
            addElementDirect('navbar', navbarHTML);
            closeModal('navbar-modal');
            playSound('success', 'A5');
            showStamp('ğŸ§­');
            updateStatus(`Navbar created: ${type}`);
        }

        // ============================================
        // ENHANCED TEMPLATES
        // ============================================

        function createTemplate(type) {
            const templates = {
                'form-contact': `
                    <form style="max-width: 600px; margin: 40px auto; padding: 30px; background: #FFF; border: 4px solid #000; box-shadow: 8px 8px 0 #000;">
                        <h2 style="color: #FF00FF; border-bottom: 3px solid #FF00FF; padding-bottom: 10px; margin-bottom: 20px;">ğŸ“§ Contact Us</h2>
                        <label style="display: block; margin-bottom: 8px; font-weight: bold;">Name:</label>
                        <input type="text" name="name" required style="width: 100%; padding: 10px; border: 3px solid #000; margin-bottom: 15px; font-size: 16px;">
                        <label style="display: block; margin-bottom: 8px; font-weight: bold;">Email:</label>
                        <input type="email" name="email" required style="width: 100%; padding: 10px; border: 3px solid #000; margin-bottom: 15px; font-size: 16px;">
                        <label style="display: block; margin-bottom: 8px; font-weight: bold;">Message:</label>
                        <textarea name="message" rows="5" required style="width: 100%; padding: 10px; border: 3px solid #000; margin-bottom: 15px; font-size: 16px; font-family: Arial, sans-serif;"></textarea>
                        <button type="submit" style="background: #00FF00; color: #000; border: 4px solid #000; padding: 12px 30px; font-size: 18px; font-weight: bold; cursor: pointer; box-shadow: 4px 4px 0 #000;" onmouseover="this.style.background='#FF00FF'" onmouseout="this.style.background='#00FF00'">SEND MESSAGE</button>
                    </form>`,

                'form-survey': `
                    <form style="max-width: 700px; margin: 40px auto; padding: 30px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border: 4px solid #000; color: #FFF;">
                        <h2 style="border-bottom: 3px solid #FFF; padding-bottom: 10px; margin-bottom: 20px;">ğŸ“Š Quick Survey</h2>
                        <div style="margin-bottom: 20px;">
                            <label style="display: block; margin-bottom: 10px; font-weight: bold;">How satisfied are you?</label>
                            <label style="display: block; margin-bottom: 5px;"><input type="radio" name="satisfaction" value="5"> ğŸ˜ Very Satisfied</label>
                            <label style="display: block; margin-bottom: 5px;"><input type="radio" name="satisfaction" value="4"> ğŸ˜Š Satisfied</label>
                            <label style="display: block; margin-bottom: 5px;"><input type="radio" name="satisfaction" value="3"> ğŸ˜ Neutral</label>
                            <label style="display: block; margin-bottom: 5px;"><input type="radio" name="satisfaction" value="2"> ğŸ˜• Dissatisfied</label>
                            <label style="display: block; margin-bottom: 5px;"><input type="radio" name="satisfaction" value="1"> ğŸ˜¤ Very Dissatisfied</label>
                        </div>
                        <div style="margin-bottom: 20px;">
                            <label style="display: block; margin-bottom: 10px; font-weight: bold;">Additional Comments:</label>
                            <textarea name="comments" rows="4" style="width: 100%; padding: 10px; border: 3px solid #000; font-size: 16px;"></textarea>
                        </div>
                        <button type="submit" style="background: #FFFF00; color: #000; border: 4px solid #000; padding: 12px 30px; font-size: 18px; font-weight: bold; cursor: pointer; box-shadow: 4px 4px 0 #000;">SUBMIT SURVEY</button>
                    </form>`,

                'form-quiz': `
                    <div style="max-width: 700px; margin: 40px auto; padding: 30px; background: #FFF; border: 4px solid #000;">
                        <h2 style="color: #FF6600; border-bottom: 3px solid #FF6600; padding-bottom: 10px; margin-bottom: 20px;">â“ Quiz Time!</h2>
                        <form id="quiz-form">
                            <div style="margin-bottom: 25px; padding: 20px; background: #FFFFCC; border: 3px solid #000;">
                                <p style="font-weight: bold; margin-bottom: 10px;">1. What is 2 + 2?</p>
                                <label style="display: block; margin-bottom: 5px;"><input type="radio" name="q1" value="3"> A) 3</label>
                                <label style="display: block; margin-bottom: 5px;"><input type="radio" name="q1" value="4"> B) 4</label>
                                <label style="display: block; margin-bottom: 5px;"><input type="radio" name="q1" value="5"> C) 5</label>
                            </div>
                            <div style="margin-bottom: 25px; padding: 20px; background: #CCFFCC; border: 3px solid #000;">
                                <p style="font-weight: bold; margin-bottom: 10px;">2. What color is the sky?</p>
                                <label style="display: block; margin-bottom: 5px;"><input type="radio" name="q2" value="red"> A) Red</label>
                                <label style="display: block; margin-bottom: 5px;"><input type="radio" name="q2" value="blue"> B) Blue</label>
                                <label style="display: block; margin-bottom: 5px;"><input type="radio" name="q2" value="green"> C) Green</label>
                            </div>
                            <button type="button" onclick="alert('Quiz submitted! Add your own grading logic.')" style="background: #00FF00; color: #000; border: 4px solid #000; padding: 12px 30px; font-size: 18px; font-weight: bold; cursor: pointer; box-shadow: 4px 4px 0 #000;">CHECK ANSWERS</button>
                        </form>
                    </div>`,

                'form-complaint': `
                    <form style="max-width: 600px; margin: 40px auto; padding: 30px; background: #FF6666; border: 4px solid #8B0000; color: #000;">
                        <h2 style="border-bottom: 3px solid #8B0000; padding-bottom: 10px; margin-bottom: 20px;">ğŸ˜¤ File a Complaint</h2>
                        <label style="display: block; margin-bottom: 8px; font-weight: bold;">What went wrong?</label>
                        <select name="complaint-type" style="width: 100%; padding: 10px; border: 3px solid #8B0000; margin-bottom: 15px; font-size: 16px;">
                            <option>Service Issue</option>
                            <option>Product Quality</option>
                            <option>Delivery Problem</option>
                            <option>Billing Error</option>
                            <option>Other</option>
                        </select>
                        <label style="display: block; margin-bottom: 8px; font-weight: bold;">Severity Level:</label>
                        <input type="range" name="severity" min="1" max="10" value="5" style="width: 100%; margin-bottom: 15px;">
                        <label style="display: block; margin-bottom: 8px; font-weight: bold;">Details:</label>
                        <textarea name="details" rows="6" required style="width: 100%; padding: 10px; border: 3px solid #8B0000; margin-bottom: 15px; font-size: 16px;"></textarea>
                        <button type="submit" style="background: #000; color: #FFF; border: 4px solid #8B0000; padding: 12px 30px; font-size: 18px; font-weight: bold; cursor: pointer; box-shadow: 4px 4px 0 #8B0000;">SUBMIT COMPLAINT</button>
                    </form>`,

                'pdf-viewer': `
                    <div style="max-width: 900px; margin: 40px auto; padding: 30px; background: #FFF; border: 4px solid #000;">
                        <h2 style="color: #0066CC; border-bottom: 3px solid #0066CC; padding-bottom: 10px; margin-bottom: 20px;">ğŸ“• Document Viewer</h2>
                        <iframe src="YOUR_PDF_URL_HERE" style="width: 100%; height: 600px; border: 3px solid #000;"></iframe>
                        <p style="margin-top: 10px; color: #666; font-size: 14px;">Replace YOUR_PDF_URL_HERE with your actual PDF URL</p>
                    </div>`,

                'image-gallery': `
                    <div style="max-width: 1200px; margin: 40px auto; padding: 30px; background: #FFF; border: 4px solid #000;">
                        <h2 style="color: #FF00FF; border-bottom: 3px solid #FF00FF; padding-bottom: 10px; margin-bottom: 20px;">ğŸ–¼ï¸ Image Gallery</h2>
                        <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 20px;">
                            <div style="border: 3px solid #000; padding: 10px; background: #FFFFCC; cursor: pointer;" onclick="alert('Image 1 clicked!')">
                                <div style="width: 100%; height: 200px; background: #FF6666; display: flex; align-items: center; justify-content: center; font-size: 48px;">ğŸ¨</div>
                                <p style="text-align: center; margin-top: 10px; font-weight: bold;">Image 1</p>
                            </div>
                            <div style="border: 3px solid #000; padding: 10px; background: #CCFFCC; cursor: pointer;" onclick="alert('Image 2 clicked!')">
                                <div style="width: 100%; height: 200px; background: #66FF66; display: flex; align-items: center; justify-content: center; font-size: 48px;">ğŸŒŸ</div>
                                <p style="text-align: center; margin-top: 10px; font-weight: bold;">Image 2</p>
                            </div>
                            <div style="border: 3px solid #000; padding: 10px; background: #CCCCFF; cursor: pointer;" onclick="alert('Image 3 clicked!')">
                                <div style="width: 100%; height: 200px; background: #6666FF; display: flex; align-items: center; justify-content: center; font-size: 48px;">â­</div>
                                <p style="text-align: center; margin-top: 10px; font-weight: bold;">Image 3</p>
                            </div>
                        </div>
                    </div>`,

                'slideshow': `
                    <div style="max-width: 800px; margin: 40px auto; padding: 30px; background: #000; border: 4px solid #FF00FF;">
                        <h2 style="color: #00FFFF; border-bottom: 3px solid #00FFFF; padding-bottom: 10px; margin-bottom: 20px;">ğŸï¸ Slideshow</h2>
                        <div id="slideshow" style="position: relative; height: 400px; background: #333; display: flex; align-items: center; justify-content: center; color: #FFF; font-size: 72px;">
                            <div class="slide" style="display: block;">SLIDE 1 ğŸ“¸</div>
                            <div class="slide" style="display: none;">SLIDE 2 ğŸ¨</div>
                            <div class="slide" style="display: none;">SLIDE 3 â­</div>
                        </div>
                        <div style="display: flex; justify-content: center; gap: 20px; margin-top: 20px;">
                            <button onclick="prevSlide()" style="background: #FF00FF; color: #FFF; border: 3px solid #FFF; padding: 10px 20px; font-size: 16px; font-weight: bold; cursor: pointer;">â† PREV</button>
                            <button onclick="nextSlide()" style="background: #00FFFF; color: #000; border: 3px solid #000; padding: 10px 20px; font-size: 16px; font-weight: bold; cursor: pointer;">NEXT â†’</button>
                        </div>
                        <script>
                            let currentSlide = 0;
                            function showSlide(n) {
                                const slides = document.querySelectorAll('.slide');
                                if (n >= slides.length) currentSlide = 0;
                                if (n < 0) currentSlide = slides.length - 1;
                                slides.forEach(slide => slide.style.display = 'none');
                                slides[currentSlide].style.display = 'block';
                            }
                            function nextSlide() { currentSlide++; showSlide(currentSlide); }
                            function prevSlide() { currentSlide--; showSlide(currentSlide); }
                        <\/script>
                    </div>`,

                'archive-browser': `
                    <div style="max-width: 900px; margin: 40px auto; padding: 30px; background: #F5F5DC; border: 4px solid #8B4513;">
                        <h2 style="color: #8B4513; border-bottom: 3px solid #8B4513; padding-bottom: 10px; margin-bottom: 20px;">ğŸ—‚ï¸ Archive Browser</h2>
                        <div style="display: grid; grid-template-columns: 250px 1fr; gap: 20px;">
                            <div style="border: 3px solid #8B4513; padding: 15px; background: #FFF;">
                                <h3 style="margin-bottom: 15px;">Categories</h3>
                                <div onclick="alert('Show: Documents')" style="padding: 10px; border: 2px solid #8B4513; margin-bottom: 8px; cursor: pointer; background: #FFFFCC;" onmouseover="this.style.background='#FFD700'" onmouseout="this.style.background='#FFFFCC'">ğŸ“„ Documents</div>
                                <div onclick="alert('Show: Images')" style="padding: 10px; border: 2px solid #8B4513; margin-bottom: 8px; cursor: pointer; background: #FFFFCC;" onmouseover="this.style.background='#FFD700'" onmouseout="this.style.background='#FFFFCC'">ğŸ–¼ï¸ Images</div>
                                <div onclick="alert('Show: Audio')" style="padding: 10px; border: 2px solid #8B4513; margin-bottom: 8px; cursor: pointer; background: #FFFFCC;" onmouseover="this.style.background='#FFD700'" onmouseout="this.style.background='#FFFFCC'">ğŸµ Audio</div>
                                <div onclick="alert('Show: Video')" style="padding: 10px; border: 2px solid #8B4513; margin-bottom: 8px; cursor: pointer; background: #FFFFCC;" onmouseover="this.style.background='#FFD700'" onmouseout="this.style.background='#FFFFCC'">ğŸ¬ Video</div>
                            </div>
                            <div style="border: 3px solid #8B4513; padding: 20px; background: #FFF; min-height: 400px;">
                                <h3 style="margin-bottom: 15px;">Archive Contents</h3>
                                <p style="color: #666;">Select a category to browse files...</p>
                            </div>
                        </div>
                    </div>`,

                'accordion': `
                    <div style="max-width: 700px; margin: 40px auto;">
                        <div style="border: 3px solid #000; margin-bottom: 5px; background: #FFF;">
                            <div onclick="this.nextElementSibling.style.display = this.nextElementSibling.style.display === 'none' ? 'block' : 'none'" style="padding: 15px; background: #FF00FF; color: #FFF; cursor: pointer; font-weight: bold; border-bottom: 3px solid #000;">
                                ğŸ“‘ Section 1 - Click to expand
                            </div>
                            <div style="padding: 20px; display: none;">
                                <p>This is the content of section 1. You can put anything here!</p>
                            </div>
                        </div>
                        <div style="border: 3px solid #000; margin-bottom: 5px; background: #FFF;">
                            <div onclick="this.nextElementSibling.style.display = this.nextElementSibling.style.display === 'none' ? 'block' : 'none'" style="padding: 15px; background: #00FFFF; color: #000; cursor: pointer; font-weight: bold; border-bottom: 3px solid #000;">
                                ğŸ“‘ Section 2 - Click to expand
                            </div>
                            <div style="padding: 20px; display: none;">
                                <p>This is the content of section 2. Add your own text here!</p>
                            </div>
                        </div>
                        <div style="border: 3px solid #000; margin-bottom: 5px; background: #FFF;">
                            <div onclick="this.nextElementSibling.style.display = this.nextElementSibling.style.display === 'none' ? 'block' : 'none'" style="padding: 15px; background: #FFFF00; color: #000; cursor: pointer; font-weight: bold; border-bottom: 3px solid #000;">
                                ğŸ“‘ Section 3 - Click to expand
                            </div>
                            <div style="padding: 20px; display: none;">
                                <p>This is the content of section 3. Customize as needed!</p>
                            </div>
                        </div>
                    </div>`,

                'tabs': `
                    <div style="max-width: 800px; margin: 40px auto;">
                        <div style="display: flex; gap: 5px; border-bottom: 4px solid #000;">
                            <button onclick="showTab(0)" class="tab-btn" style="padding: 15px 30px; background: #FF00FF; color: #FFF; border: 3px solid #000; border-bottom: none; cursor: pointer; font-weight: bold;">TAB 1</button>
                            <button onclick="showTab(1)" class="tab-btn" style="padding: 15px 30px; background: #CCC; color: #000; border: 3px solid #000; border-bottom: none; cursor: pointer; font-weight: bold;">TAB 2</button>
                            <button onclick="showTab(2)" class="tab-btn" style="padding: 15px 30px; background: #CCC; color: #000; border: 3px solid #000; border-bottom: none; cursor: pointer; font-weight: bold;">TAB 3</button>
                        </div>
                        <div class="tab-content" style="display: block; padding: 30px; border: 3px solid #000; border-top: none; background: #FFF;">
                            <h3>Content for Tab 1</h3>
                            <p>This is the content that appears when Tab 1 is selected.</p>
                        </div>
                        <div class="tab-content" style="display: none; padding: 30px; border: 3px solid #000; border-top: none; background: #FFF;">
                            <h3>Content for Tab 2</h3>
                            <p>This is the content that appears when Tab 2 is selected.</p>
                        </div>
                        <div class="tab-content" style="display: none; padding: 30px; border: 3px solid #000; border-top: none; background: #FFF;">
                            <h3>Content for Tab 3</h3>
                            <p>This is the content that appears when Tab 3 is selected.</p>
                        </div>
                        <script>
                            function showTab(index) {
                                const contents = document.querySelectorAll('.tab-content');
                                const buttons = document.querySelectorAll('.tab-btn');
                                contents.forEach((content, i) => {
                                    content.style.display = i === index ? 'block' : 'none';
                                });
                                buttons.forEach((btn, i) => {
                                    btn.style.background = i === index ? '#FF00FF' : '#CCC';
                                    btn.style.color = i === index ? '#FFF' : '#000';
                                });
                            }
                        <\/script>
                    </div>`,

                'modal-popup': `
                    <div style="padding: 40px; text-align: center;">
                        <button onclick="document.getElementById('demo-modal').style.display='flex'" style="background: #FF00FF; color: #FFF; border: 4px solid #000; padding: 15px 30px; font-size: 18px; font-weight: bold; cursor: pointer; box-shadow: 4px 4px 0 #000;">
                            OPEN MODAL
                        </button>
                        <div id="demo-modal" style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.8); z-index: 10000; align-items: center; justify-content: center;">
                            <div style="background: #FFF; padding: 40px; border: 4px solid #000; max-width: 500px; box-shadow: 8px 8px 0 #000;">
                                <h2 style="color: #FF00FF; margin-bottom: 20px;">ğŸ’¬ Modal Popup</h2>
                                <p style="margin-bottom: 20px;">This is a modal popup! You can put any content here.</p>
                                <button onclick="document.getElementById('demo-modal').style.display='none'" style="background: #00FFFF; color: #000; border: 3px solid #000; padding: 10px 20px; font-weight: bold; cursor: pointer;">CLOSE</button>
                            </div>
                        </div>
                    </div>`,

                'tooltip-system': `
                    <div style="max-width: 600px; margin: 40px auto; padding: 40px; background: #FFF; border: 4px solid #000;">
                        <h2 style="margin-bottom: 30px;">ğŸ’­ Hover over items for tooltips:</h2>
                        <div style="margin-bottom: 20px; position: relative; display: inline-block;">
                            <span style="border-bottom: 2px dashed #FF00FF; cursor: help;" onmouseover="this.querySelector('.tooltip').style.display='block'" onmouseout="this.querySelector('.tooltip').style.display='none'">
                                Hover me for info
                                <span class="tooltip" style="display: none; position: absolute; bottom: 100%; left: 50%; transform: translateX(-50%); background: #FF00FF; color: #FFF; padding: 10px 15px; border: 3px solid #000; white-space: nowrap; margin-bottom: 5px; z-index: 1000;">This is a tooltip! ğŸ’¡</span>
                            </span>
                        </div>
                        <p style="margin-bottom: 20px;">Here's another:
                            <span style="background: #FFFF00; padding: 5px; border: 2px solid #000; cursor: help; position: relative; display: inline-block;" onmouseover="this.querySelector('.tooltip').style.display='block'" onmouseout="this.querySelector('.tooltip').style.display='none'">
                                Highlighted text
                                <span class="tooltip" style="display: none; position: absolute; bottom: 100%; left: 50%; transform: translateX(-50%); background: #00FFFF; color: #000; padding: 10px 15px; border: 3px solid #000; white-space: nowrap; margin-bottom: 5px; z-index: 1000; font-weight: bold;">Extra information! â­</span>
                            </span>
                        </p>
                    </div>`,

                'clicker-game': `
                    <div style="max-width: 500px; margin: 40px auto; padding: 40px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border: 4px solid #000; text-align: center; color: #FFF;">
                        <h2 style="margin-bottom: 20px;">ğŸ® Clicker Game</h2>
                        <div id="clicker-score" style="font-size: 48px; font-weight: bold; margin-bottom: 30px; text-shadow: 3px 3px 0 #000;">0</div>
                        <button onclick="clickerClick()" style="width: 150px; height: 150px; border-radius: 50%; background: #FF00FF; border: 6px solid #FFF; font-size: 48px; cursor: pointer; box-shadow: 8px 8px 0 #000; transition: transform 0.1s;" onmousedown="this.style.transform='scale(0.95)'" onmouseup="this.style.transform='scale(1)'">
                            ğŸ‘†
                        </button>
                        <p style="margin-top: 20px; font-size: 18px;">Clicks per second: <span id="clicker-cps">0</span></p>
                        <script>
                            let clickerScore = 0;
                            let clickerClicks = [];
                            function clickerClick() {
                                clickerScore++;
                                document.getElementById('clicker-score').textContent = clickerScore;
                                clickerClicks.push(Date.now());
                                clickerClicks = clickerClicks.filter(t => Date.now() - t < 1000);
                                document.getElementById('clicker-cps').textContent = clickerClicks.length;
                            }
                        <\/script>
                    </div>`,

                'counter-widget': `
                    <div style="max-width: 400px; margin: 40px auto; padding: 30px; background: #FFF; border: 4px solid #000; text-align: center;">
                        <h2 style="color: #FF6600; margin-bottom: 20px;">ğŸ”¢ Counter</h2>
                        <div id="counter-value" style="font-size: 64px; font-weight: bold; margin: 30px 0; color: #FF00FF;">0</div>
                        <div style="display: flex; gap: 10px; justify-content: center;">
                            <button onclick="counterChange(-1)" style="background: #FF0000; color: #FFF; border: 4px solid #000; padding: 15px 25px; font-size: 24px; font-weight: bold; cursor: pointer;">âˆ’</button>
                            <button onclick="counterReset()" style="background: #FFFF00; color: #000; border: 4px solid #000; padding: 15px 25px; font-size: 18px; font-weight: bold; cursor: pointer;">RESET</button>
                            <button onclick="counterChange(1)" style="background: #00FF00; color: #000; border: 4px solid #000; padding: 15px 25px; font-size: 24px; font-weight: bold; cursor: pointer;">+</button>
                        </div>
                        <script>
                            let counterValue = 0;
                            function counterChange(amount) {
                                counterValue += amount;
                                document.getElementById('counter-value').textContent = counterValue;
                            }
                            function counterReset() {
                                counterValue = 0;
                                document.getElementById('counter-value').textContent = counterValue;
                            }
                        <\/script>
                    </div>`
            };

            const templateHTML = templates[type];
            if (templateHTML) {
                addElementDirect(type, templateHTML);
                closeModal('enhanced-templates-modal');
                playSound('success', 'C6');
                showStamp('âœ¨');
                updateStatus(`Template created: ${type}`);
            }
        }

        // ============================================
        // COMPONENT EXTRACTION MODE
        // ============================================

        let extractionMode = false;
        let extractionIframe = null;

        function enableExtractionMode() {
            if (!loadedPageData.fullHtml) {
                alert('Please load a page first using "ğŸ“‚ LOAD PAGE" button!');
                return;
            }

            extractionMode = true;
            document.getElementById('extraction-overlay').style.display = 'block';

            // Create temporary iframe to display loaded page for extraction
            const canvas = document.getElementById('canvas');
            canvas.innerHTML = `
                <div style="border: 4px solid #FF00FF; background: #FFF; padding: 20px; margin: 20px;">
                    <h2 style="color: #FF00FF;">ğŸ¯ EXTRACTION MODE ACTIVE</h2>
                    <p style="margin: 15px 0;">The loaded page will appear below. Click any element to extract it as a component!</p>
                    <iframe id="extraction-iframe" style="width: 100%; height: 80vh; border: 3px solid #000;"></iframe>
                </div>
            `;

            extractionIframe = document.getElementById('extraction-iframe');
            const iframeDoc = extractionIframe.contentDocument || extractionIframe.contentWindow.document;
            iframeDoc.open();
            iframeDoc.write(loadedPageData.fullHtml);
            iframeDoc.close();

            // Add click listeners to all elements in iframe
            iframeDoc.addEventListener('click', function(e) {
                e.preventDefault();
                e.stopPropagation();
                extractElement(e.target);
            });
        }

        function extractElement(element) {
            if (!element || element.tagName === 'HTML' || element.tagName === 'BODY') {
                alert('Please click on a specific element, not the page background!');
                return;
            }

            const extracted = element.outerHTML;
            const componentName = prompt('Name this extracted component:', element.className || element.tagName.toLowerCase());

            if (componentName) {
                savedComponents.push({
                    name: componentName,
                    type: 'extracted',
                    html: extracted,
                    savedAt: new Date().toISOString()
                });

                localStorage.setItem('wysiwyg-components', JSON.stringify(savedComponents));

                playSound('success', 'A6');
                showStamp('ğŸ¯');
                updateStatus(`Component "${componentName}" extracted!`);

                alert(`âœ… Component "${componentName}" extracted and saved!\n\nYou can now insert it from the COMPONENTS library.`);
            }
        }

        function exitExtractionMode() {
            extractionMode = false;
            document.getElementById('extraction-overlay').style.display = 'none';
            renderCanvas();
            updateStatus('Extraction mode exited');
        }

        // Add extraction mode button to loaded page modal
        function enhanceLoadedPageWithExtraction() {
            // This will be triggered after loading a page
            if (loadedPageData.fullHtml) {
                const extractBtn = `
                    <button class="big-button purple" onclick="enableExtractionMode()" style="width: 100%; margin-top: 12px;">
                        ğŸ¯ EXTRACT COMPONENTS
                    </button>
                `;
                // We'll add this to the properties panel when a page is loaded
            }
        }

        // ============================================
        // TEMPLATES
        // ============================================
        function loadTemplate(type) {
            const templates = {
                // ==== COAIEXIST SITE TEMPLATES ====
                'y2k-os': `<div class="container-os" style="display: flex; flex-direction: column; height: 100vh; background: #021313;">
                    <div class="header-os" style="background: #0a0a14; border-bottom: 2px solid #f312af; height: 50px; display: flex; align-items: center; justify-content: space-between; padding: 0 20px;">
                        <div style="font-size: 24px; font-weight: bold; color: #72FADE;">COAIEXIST.OS</div>
                        <div class="clock" style="font-family: 'Courier New', monospace; background: #000; padding: 5px; border: 1px solid #72FADE; color: #72FADE;">00:00:00</div>
                    </div>
                    <div class="main-os" style="display: flex; flex: 1;">
                        <div class="buddy-list" style="width: 250px; background: rgba(218,255,13,0.5); border-right: 2px solid #f312af; padding: 10px; overflow-y: auto;">
                            <h3 style="color: #000;">ğŸ“¡ BUDDIES</h3>
                            <div style="background: #0a0a14; border: 1px solid #72FADE; margin: 5px 0; padding: 5px; color: #72FADE;">ğŸŸ¢ Friend 1</div>
                            <div style="background: #0a0a14; border: 1px solid #72FADE; margin: 5px 0; padding: 5px; color: #72FADE;">ğŸŸ¡ Friend 2</div>
                        </div>
                        <div class="desktop-os" style="flex: 1; padding: 20px; overflow-y: auto;">
                            <h1 style="color: #00ffcc; font-family: 'VT323', monospace; font-size: 3rem;">Your Content Here!</h1>
                            <p style="color: #72FADE;">Main desktop area - add your content!</p>
                        </div>
                    </div>
                    <div class="taskbar-os" style="height: 35px; background: #0a0a14; border-top: 2px solid #f312af; display: flex; align-items: center; padding: 0 10px;">
                        <button style="background: #72FADE; color: #000; border: none; padding: 5px 15px; margin-right: 10px; cursor: pointer; font-weight: bold;">START</button>
                    </div>
                </div>`,

                'medieval-archive': `<div style="background: #1a120b; color: #f5e5c5; font-family: 'VT323', monospace; min-height: 100vh; padding: 20px; position: relative;">
                    <div style="border: 4px solid #bc7f2a; background: rgba(43, 29, 15, 0.85); max-width: 800px; margin: 0 auto; padding: 2rem; box-shadow: inset 0 0 25px rgba(0,0,0,0.8), 0 0 55px rgba(0,0,0,0.9);">
                        <div style="text-align: center; margin-bottom: 2rem;">
                            <h1 style="font-size: 2.5rem; color: #bc7f2a; text-shadow: 2px 2px 0 #3a2a1a, 0 0 15px #ffc500; letter-spacing: 2px;">ğŸ“œ THE GRAND ARCHIVE ğŸ“œ</h1>
                        </div>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1.5rem; margin-top: 2rem;">
                            <div style="border: 2px solid #503116; background: linear-gradient(145deg, rgba(0,0,0,0.2), rgba(0,0,0,0.4)); padding: 1rem; text-align: center; min-height: 200px; display: flex; flex-direction: column; align-items: center; justify-content: center;">
                                <div style="font-size: 4rem; margin-bottom: 1rem;">ğŸ“š</div>
                                <div style="font-size: 1.5rem;">Collection 1</div>
                            </div>
                            <div style="border: 2px solid #503116; background: linear-gradient(145deg, rgba(0,0,0,0.2), rgba(0,0,0,0.4)); padding: 1rem; text-align: center; min-height: 200px; display: flex; flex-direction: column; align-items: center; justify-content: center;">
                                <div style="font-size: 4rem; margin-bottom: 1rem;">ğŸ—ï¸</div>
                                <div style="font-size: 1.5rem;">Collection 2</div>
                            </div>
                        </div>
                    </div>
                    <div style="position: fixed; bottom: 0; left: 0; width: 100%; background: #3a2a1a; color: #bc7f2a; padding: 5px 0; text-align: center; border-top: 2px solid #00ffcc;">
                        <marquee>âšœï¸ Enter the archive at your own peril âšœï¸</marquee>
                    </div>
                </div>`,

                'ascii-map-zone': `<div style="background: #0d041a; color: #e0e0e0; font-family: 'Comic Sans MS', cursive; min-height: 100vh; padding: 1em;">
                    <div style="text-align: center; margin-bottom: 2em;">
                        <h1 style="font-family: 'VT323', monospace; font-size: 3em; color: #00ff9b; text-shadow: 0 0 10px #00ff9b, 0 0 20px #ff00ff;">ğŸŒ² THE VOID FOREST ğŸŒ²</h1>
                    </div>
                    <div style="display: flex; gap: 2em; justify-content: center; align-items: flex-start;">
                        <div style="border: 4px solid #00ff9b; padding: 1em; background: rgba(0, 0, 0, 0.5); box-shadow: 0 0 15px #00ff9b;">
                            <pre style="font-family: 'VT323', monospace; font-size: 20px; line-height: 1.1; background: #1a0c33; padding: 1em; margin: 0; color: #00ff9b; white-space: pre;">    ğŸŒ²
   /|\\
  / | \\
 /  |  \\
ğŸŒ² ğŸ  ğŸŒ²
 \\  |  /
  \\ | /
   \\|/
    ğŸŒ²</pre>
                        </div>
                        <div style="width: 450px; background: rgba(26, 12, 51, 0.9); border: 2px dashed #ff00ff; padding: 20px;">
                            <h2 style="font-family: 'VT323', monospace; font-size: 2em; color: #00ff9b; text-align: center;">ğŸ“– CODEX ğŸ“–</h2>
                            <p style="font-size: 0.9em; line-height: 1.6;">Click areas of the map to explore. Each zone contains mysteries and secrets...</p>
                        </div>
                    </div>
                </div>`,

                'update-feed': `<div style="background: url('https://web.archive.org/web/20091027052024/http://geocities.com/dreamwarrior_2000/stars.gif'); color: #72FADE; font-family: 'VT323', monospace; padding: 20px;">
                    <div style="max-width: 900px; margin: 0 auto;">
                        <h1 style="text-align: center; font-size: 3rem; color: #fffb01; text-shadow: 0 0 10px #f312af; margin-bottom: 2rem;">ğŸ“¡ TRANSMISSION LOG ğŸ“¡</h1>
                        <div style="background: #0000FF; border: 3px dotted #FFFF00; color: #FFFFFF; padding: 20px; margin-bottom: 25px; border-radius: 10px;">
                            <div style="display: flex; justify-content: space-between; border-bottom: 2px dashed #FFFF00; margin-bottom: 15px; padding-bottom: 10px;">
                                <h3 style="color: #00FF00; text-shadow: 2px 2px #FF00FF; margin: 0;">Update Title</h3>
                                <span style="background: #800080; color: #FFFF00; padding: 3px 8px; border-radius: 5px; font-weight: bold; border: 1px outset #FFFFFF;">DATE</span>
                            </div>
                            <p>Your update content goes here! Share news, thoughts, links...</p>
                        </div>
                        <div style="background: #0000FF; border: 3px dotted #FFFF00; color: #FFFFFF; padding: 20px; margin-bottom: 25px; border-radius: 10px;">
                            <div style="display: flex; justify-content: space-between; border-bottom: 2px dashed #FFFF00; margin-bottom: 15px; padding-bottom: 10px;">
                                <h3 style="color: #00FF00; text-shadow: 2px 2px #FF00FF; margin: 0;">Another Update</h3>
                                <span style="background: #800080; color: #FFFF00; padding: 3px 8px; border-radius: 5px; font-weight: bold; border: 1px outset #FFFFFF;">DATE</span>
                            </div>
                            <p>More content here...</p>
                        </div>
                    </div>
                </div>`,

                // ==== CLASSIC WEB LAYOUTS ====
                'grid-gallery': '<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; padding: 20px;"><div style="border: 4px solid #000; padding: 20px; background: #FF0000; color: #FFF; min-height: 200px; display: flex; align-items: center; justify-content: center;">ITEM 1</div><div style="border: 4px solid #000; padding: 20px; background: #0000FF; color: #FFF; min-height: 200px; display: flex; align-items: center; justify-content: center;">ITEM 2</div><div style="border: 4px solid #000; padding: 20px; background: #FFFF00; min-height: 200px; display: flex; align-items: center; justify-content: center;">ITEM 3</div><div style="border: 4px solid #000; padding: 20px; background: #00FF00; min-height: 200px; display: flex; align-items: center; justify-content: center;">ITEM 4</div></div>',
                'blog-single': '<div style="max-width: 700px; margin: 0 auto; padding: 40px 20px; font-family: Georgia, serif;"><article style="border-bottom: 3px solid #000; padding-bottom: 40px; margin-bottom: 40px;"><h1 style="font-size: 2.5rem; margin-bottom: 10px;">Blog Post Title</h1><div style="color: #666; margin-bottom: 20px;">Posted on DATE by AUTHOR</div><p style="line-height: 1.8; font-size: 1.1rem;">Your blog post content goes here. Write about anything!</p></article><article style="border-bottom: 3px solid #000; padding-bottom: 40px;"><h1 style="font-size: 2.5rem; margin-bottom: 10px;">Another Post</h1><div style="color: #666; margin-bottom: 20px;">Posted on DATE by AUTHOR</div><p style="line-height: 1.8; font-size: 1.1rem;">More content...</p></article></div>',
                'sidebar-blog': '<div style="display: flex; gap: 30px; max-width: 1200px; margin: 0 auto; padding: 20px;"><main style="flex: 1;"><h1 style="border-bottom: 4px solid #000; padding-bottom: 10px; margin-bottom: 20px;">MAIN CONTENT</h1><p>Main blog/content area</p></main><aside style="width: 300px; border-left: 4px solid #000; padding-left: 20px;"><h3 style="margin-bottom: 15px; border-bottom: 2px solid #000; padding-bottom: 5px;">ğŸ“Œ SIDEBAR</h3><ul style="list-style: none; padding: 0;"><li style="margin-bottom: 10px; padding: 10px; background: #f0f0f0; border: 2px solid #000;">Link 1</li><li style="margin-bottom: 10px; padding: 10px; background: #f0f0f0; border: 2px solid #000;">Link 2</li></ul></aside></div>',
                'hero-cta': '<div style="min-height: 100vh; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); display: flex; align-items: center; justify-content: center; text-align: center; padding: 20px;"><div style="background: rgba(255, 255, 255, 0.95); padding: 60px; border-radius: 10px; box-shadow: 0 20px 60px rgba(0,0,0,0.3); max-width: 600px;"><h1 style="font-size: 3.5rem; margin: 0 0 20px 0; color: #333;">MAKE AN IMPACT</h1><p style="font-size: 1.3rem; color: #666; margin-bottom: 30px;">Your compelling message goes here. Convince them to take action!</p><button style="background: #667eea; color: #FFF; border: none; padding: 20px 50px; font-size: 1.2rem; font-weight: bold; cursor: pointer; border-radius: 5px; box-shadow: 0 4px 15px rgba(0,0,0,0.2);">GET STARTED</button></div></div>',

                // ==== CLASSIC LAYOUTS ====
                'single-column': '<div style="max-width: 800px; margin: 0 auto; padding: 40px 20px;"><h1 style="border-bottom: 4px solid #000; padding-bottom: 10px; margin-bottom: 20px;">SINGLE COLUMN LAYOUT</h1><p style="line-height: 1.8; margin-bottom: 20px;">This is a simple single-column layout. Perfect for blogs, articles, and focused content. Add your content here!</p></div>',

                'two-column-left': '<div style="display: flex; gap: 30px; max-width: 1200px; margin: 0 auto; padding: 20px;"><aside style="width: 250px; border-right: 4px solid #000; padding-right: 20px;"><h3 style="margin-bottom: 15px; border-bottom: 2px solid #000; padding-bottom: 5px;">ğŸ“Œ SIDEBAR</h3><ul style="list-style: none; padding: 0;"><li style="margin-bottom: 10px; padding: 10px; background: #f0f0f0; border: 2px solid #000;">Nav Item 1</li><li style="margin-bottom: 10px; padding: 10px; background: #f0f0f0; border: 2px solid #000;">Nav Item 2</li></ul></aside><main style="flex: 1;"><h1 style="border-bottom: 4px solid #000; padding-bottom: 10px; margin-bottom: 20px;">MAIN CONTENT</h1><p>Main content area with left sidebar!</p></main></div>',

                'two-column-right': '<div style="display: flex; gap: 30px; max-width: 1200px; margin: 0 auto; padding: 20px;"><main style="flex: 1;"><h1 style="border-bottom: 4px solid #000; padding-bottom: 10px; margin-bottom: 20px;">MAIN CONTENT</h1><p>Main content area with right sidebar!</p></main><aside style="width: 250px; border-left: 4px solid #000; padding-left: 20px;"><h3 style="margin-bottom: 15px; border-bottom: 2px solid #000; padding-bottom: 5px;">ğŸ“Œ SIDEBAR</h3><ul style="list-style: none; padding: 0;"><li style="margin-bottom: 10px; padding: 10px; background: #f0f0f0; border: 2px solid #000;">Widget 1</li></ul></aside></div>',

                'three-column': '<div style="display: flex; gap: 20px; max-width: 1400px; margin: 0 auto; padding: 20px;"><aside style="width: 200px; border-right: 3px solid #000; padding-right: 15px;"><h4 style="border-bottom: 2px solid #000; padding-bottom: 5px;">LEFT</h4></aside><main style="flex: 1;"><h1 style="border-bottom: 4px solid #000; padding-bottom: 10px; margin-bottom: 20px;">MAIN CONTENT</h1><p>Three column layout!</p></main><aside style="width: 200px; border-left: 3px solid #000; padding-left: 15px;"><h4 style="border-bottom: 2px solid #000; padding-bottom: 5px;">RIGHT</h4></aside></div>',

                'header-content-footer': '<div style="min-height: 100vh; display: flex; flex-direction: column;"><header style="background: #000; color: #FFF; padding: 20px; border-bottom: 4px solid #FF00FF;"><h1>HEADER</h1></header><main style="flex: 1; padding: 40px; max-width: 1200px; margin: 0 auto; width: 100%;"><h2 style="border-bottom: 3px solid #000; padding-bottom: 10px;">MAIN CONTENT</h2></main><footer style="background: #000; color: #FFF; padding: 20px; border-top: 4px solid #FF00FF; text-align: center;"><p>FOOTER</p></footer></div>',

                // ==== RETRO WEB TEMPLATES ====
                'geocities-homepage': `<div style="background: #FFFFCC; font-family: 'Comic Sans MS', cursive; padding: 0;">
                    <div style="background: linear-gradient(180deg, #0000FF 0%, #FF00FF 100%); padding: 20px; text-align: center; border-bottom: 5px ridge #FFD700;">
                        <h1 style="color: #FFFF00; font-size: 3rem; text-shadow: 3px 3px #000, -1px -1px #FFF; animation: rainbow 3s infinite;">âœ¨ WELCOME TO MY HOMEPAGE! âœ¨</h1>
                        <marquee style="background: #000; color: #00FF00; padding: 10px; border: 3px dotted #FF0000; margin-top: 10px;">ğŸŒŸ You are visitor #42069! ğŸŒŸ This site is best viewed in Netscape Navigator!</marquee>
                    </div>
                    <div style="display: flex; gap: 10px; padding: 20px;">
                        <div style="width: 200px; background: #FF99CC; border: 3px solid #FF00FF; padding: 15px;">
                            <h3 style="background: #0000FF; color: #FFFF00; padding: 5px; text-align: center;">ğŸ”— LINKS ğŸ”—</h3>
                            <div style="background: #FFF; border: 2px inset #999; padding: 10px; margin-top: 10px;">
                                <a href="#" style="display: block; color: #0000FF; margin: 5px 0;">â€¢ My Guestbook</a>
                                <a href="#" style="display: block; color: #0000FF; margin: 5px 0;">â€¢ Photo Gallery</a>
                                <a href="#" style="display: block; color: #0000FF; margin: 5px 0;">â€¢ Cool Sites</a>
                            </div>
                        </div>
                        <div style="flex: 1; background: #FFF; border: 5px ridge #999; padding: 20px;">
                            <h2 style="color: #FF0000; text-decoration: underline;">About Me!</h2>
                            <p>Hi! Welcome to my corner of the web! I love ğŸ® games, ğŸµ music, and making cool websites!</p>
                            <img src="https://web.archive.org/web/20091027055721/http://www.geocities.com/Pentagon/Base/4382/const.gif" alt="Under Construction" style="margin: 10px 0;">
                            <p style="background: #FFFF00; padding: 10px; border: 3px dashed #FF0000; margin-top: 15px;">âš ï¸ UNDER CONSTRUCTION âš ï¸</p>
                        </div>
                    </div>
                    <div style="background: #000; color: #00FF00; padding: 15px; text-align: center; border-top: 3px solid #FF00FF;">
                        Last updated: ${new Date().toLocaleDateString()} | Email me! | Sign my guestbook!
                    </div>
                </div>`,

                'myspace-profile': `<div style="background: linear-gradient(180deg, #6699CC 0%, #003366 100%); min-height: 100vh; padding: 20px; font-family: Arial, sans-serif;">
                    <div style="max-width: 900px; margin: 0 auto;">
                        <div style="background: #FFF; border: 3px solid #000; margin-bottom: 15px; padding: 20px;">
                            <div style="display: flex; gap: 20px; align-items: flex-start;">
                                <div style="width: 150px; height: 150px; background: #DDD; border: 2px solid #000; display: flex; align-items: center; justify-content: center; font-size: 3rem;">ğŸ“·</div>
                                <div style="flex: 1;">
                                    <h1 style="color: #FF6600; margin: 0 0 10px 0;">Your Name</h1>
                                    <div style="color: #666; margin-bottom: 10px;">Mood: <span style="color: #000; font-weight: bold;">Awesome!</span> ğŸ˜</div>
                                    <div style="background: #F0F0F0; border: 1px solid #CCC; padding: 10px; margin-top: 10px;">
                                        <strong>About Me:</strong><br>
                                        This is where you tell everyone about yourself!
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div style="background: #FFF; border: 3px solid #000; margin-bottom: 15px; padding: 20px;">
                            <h2 style="background: linear-gradient(90deg, #FF6600, #FF0066); color: #FFF; padding: 8px; margin: -20px -20px 15px -20px;">TOP 8 FRIENDS</h2>
                            <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px;">
                                <div style="text-align: center; padding: 10px; background: #F5F5F5; border: 1px solid #CCC;">Friend 1</div>
                                <div style="text-align: center; padding: 10px; background: #F5F5F5; border: 1px solid #CCC;">Friend 2</div>
                                <div style="text-align: center; padding: 10px; background: #F5F5F5; border: 1px solid #CCC;">Friend 3</div>
                                <div style="text-align: center; padding: 10px; background: #F5F5F5; border: 1px solid #CCC;">Friend 4</div>
                            </div>
                        </div>
                        <div style="background: #000; color: #00FF00; border: 3px solid #00FF00; padding: 15px; font-family: 'Courier New', monospace;">
                            <marquee>â™« Now Playing: Your Favorite Song - Artist Name â™«</marquee>
                        </div>
                    </div>
                </div>`,

                'terminal-interface': `<div style="background: #000; color: #00FF00; font-family: 'Courier New', monospace; min-height: 100vh; padding: 20px;">
                    <div style="border: 2px solid #00FF00; padding: 20px; box-shadow: 0 0 20px rgba(0, 255, 0, 0.5);">
                        <div style="border-bottom: 1px solid #00FF00; padding-bottom: 10px; margin-bottom: 15px;">
                            <span style="color: #00FFFF;">user@coaiexist</span>:<span style="color: #0099FF;">~</span>$ welcome
                        </div>
                        <pre style="margin: 0; line-height: 1.6;">
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘   WELCOME TO THE MAINFRAME v2.0      â•‘
â•‘                                       â•‘
â•‘   > SYSTEM STATUS: ONLINE            â•‘
â•‘   > ACCESS LEVEL: GRANTED            â•‘
â•‘   > SECURITY: MAXIMUM                â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Available Commands:
â”œâ”€ [1] View Projects
â”œâ”€ [2] About System
â”œâ”€ [3] Contact
â””â”€ [4] Exit

<span style="color: #00FFFF;">user@coaiexist</span>:<span style="color: #0099FF;">~</span>$ <span style="animation: blink 1s infinite;">â–ˆ</span>
                        </pre>
                    </div>
                </div>`,

                'webring-links': `<div style="background: #000080; color: #FFF; font-family: Arial, sans-serif; min-height: 100vh; padding: 30px;">
                    <div style="max-width: 800px; margin: 0 auto;">
                        <div style="background: #C0C0C0; border: 4px outset #FFF; padding: 3px; margin-bottom: 30px;">
                            <div style="background: #000080; color: #FFF; padding: 5px; display: flex; justify-content: space-between; align-items: center;">
                                <span style="font-weight: bold;">ğŸŒ My Cool Links Page</span>
                                <div style="display: flex; gap: 3px;">
                                    <button style="background: #C0C0C0; border: 2px outset #FFF; width: 20px; height: 20px; font-size: 10px;">_</button>
                                    <button style="background: #C0C0C0; border: 2px outset #FFF; width: 20px; height: 20px; font-size: 10px;">â–¡</button>
                                    <button style="background: #C0C0C0; border: 2px outset #FFF; width: 20px; height: 20px; font-size: 10px;">X</button>
                                </div>
                            </div>
                            <div style="background: #FFF; color: #000; padding: 20px;">
                                <h2 style="text-align: center; color: #FF0000; font-family: 'Comic Sans MS', cursive;">âœ¨ AWESOME WEB RING âœ¨</h2>
                                <div style="text-align: center; margin: 20px 0; padding: 15px; background: #FFFF99; border: 3px double #FF0000;">
                                    <a href="#" style="color: #0000FF; text-decoration: none; margin: 0 10px;">â¬…ï¸ Previous</a>
                                    <a href="#" style="color: #0000FF; text-decoration: none; margin: 0 10px;">ğŸ  Home</a>
                                    <a href="#" style="color: #0000FF; text-decoration: none; margin: 0 10px;">â¡ï¸ Next</a>
                                </div>
                                <h3 style="background: #0000FF; color: #FFFF00; padding: 8px; text-align: center;">MY FAVORITE SITES</h3>
                                <div style="display: grid; gap: 15px; margin-top: 20px;">
                                    <div style="border: 2px solid #000; padding: 15px; background: linear-gradient(90deg, #FFE4E1, #E0FFFF);">
                                        <h4 style="margin: 0 0 5px 0; color: #FF00FF;">ğŸ”— Cool Site #1</h4>
                                        <p style="margin: 0; font-size: 0.9em;">Description of this amazing website!</p>
                                    </div>
                                    <div style="border: 2px solid #000; padding: 15px; background: linear-gradient(90deg, #E0FFFF, #FFE4E1);">
                                        <h4 style="margin: 0 0 5px 0; color: #FF00FF;">ğŸ”— Cool Site #2</h4>
                                        <p style="margin: 0; font-size: 0.9em;">Another rad website to check out!</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>`,

                'pixel-game-ui': `<div style="background: #1a1a2e; color: #FFF; font-family: 'Press Start 2P', 'Courier New', monospace; min-height: 100vh; padding: 20px; image-rendering: pixelated;">
                    <div style="max-width: 800px; margin: 0 auto; border: 4px solid #00ff41; background: #0f0f1e; padding: 0;">
                        <div style="background: #16213e; border-bottom: 4px solid #00ff41; padding: 15px; display: flex; justify-content: space-between; align-items: center;">
                            <div style="font-size: 1.2rem; color: #00ff41;">PLAYER</div>
                            <div style="display: flex; gap: 20px;">
                                <div>HP: <span style="color: #ff0066;">â™¥â™¥â™¥â™¥â™¥</span></div>
                                <div>LVL: <span style="color: #00ff41;">99</span></div>
                            </div>
                        </div>
                        <div style="padding: 30px;">
                            <div style="background: #000; border: 3px solid #00ff41; padding: 20px; margin-bottom: 20px; min-height: 200px; display: flex; align-items: center; justify-content: center; font-size: 2rem;">
                                ğŸ°
                            </div>
                            <div style="background: #16213e; border: 3px solid #00ff41; padding: 15px; font-size: 0.7rem; line-height: 1.6;">
                                <p style="margin: 0 0 10px 0;">&gt; You enter the ancient temple...</p>
                                <p style="margin: 0;">&gt; What will you do?</p>
                            </div>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 20px;">
                                <button style="background: #00ff41; color: #000; border: 3px solid #FFF; padding: 15px; font-family: inherit; font-size: 0.6rem; cursor: pointer;">âš”ï¸ ATTACK</button>
                                <button style="background: #ff0066; color: #FFF; border: 3px solid #FFF; padding: 15px; font-family: inherit; font-size: 0.6rem; cursor: pointer;">ğŸ›¡ï¸ DEFEND</button>
                                <button style="background: #0099ff; color: #FFF; border: 3px solid #FFF; padding: 15px; font-family: inherit; font-size: 0.6rem; cursor: pointer;">ğŸ’¼ ITEMS</button>
                                <button style="background: #ffaa00; color: #000; border: 3px solid #FFF; padding: 15px; font-family: inherit; font-size: 0.6rem; cursor: pointer;">ğŸƒ RUN</button>
                            </div>
                        </div>
                    </div>
                </div>`,

                'chat-messenger': `<div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; padding: 20px; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;">
                    <div style="max-width: 600px; margin: 0 auto; background: #FFF; border-radius: 20px; overflow: hidden; box-shadow: 0 20px 60px rgba(0,0,0,0.3);">
                        <div style="background: linear-gradient(90deg, #667eea, #764ba2); color: #FFF; padding: 20px; display: flex; align-items: center; gap: 15px;">
                            <div style="width: 50px; height: 50px; background: #FFF; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 1.5rem;">ğŸ’¬</div>
                            <div>
                                <h2 style="margin: 0; font-size: 1.2rem;">Chat Room</h2>
                                <div style="font-size: 0.9rem; opacity: 0.9;">3 members online</div>
                            </div>
                        </div>
                        <div style="background: #F5F5F5; padding: 20px; min-height: 400px; max-height: 500px; overflow-y: auto;">
                            <div style="display: flex; gap: 10px; margin-bottom: 15px;">
                                <div style="width: 40px; height: 40px; background: #667eea; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: #FFF; flex-shrink: 0;">A</div>
                                <div style="background: #FFF; padding: 12px 16px; border-radius: 18px; max-width: 70%; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">
                                    <div style="font-weight: bold; font-size: 0.85rem; margin-bottom: 3px; color: #667eea;">Alice</div>
                                    <div>Hey! How's everyone doing?</div>
                                </div>
                            </div>
                            <div style="display: flex; gap: 10px; margin-bottom: 15px; flex-direction: row-reverse;">
                                <div style="width: 40px; height: 40px; background: #764ba2; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: #FFF; flex-shrink: 0;">You</div>
                                <div style="background: linear-gradient(90deg, #667eea, #764ba2); color: #FFF; padding: 12px 16px; border-radius: 18px; max-width: 70%; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">
                                    <div>Great! Just building some cool stuff ğŸ¨</div>
                                </div>
                            </div>
                        </div>
                        <div style="background: #FFF; padding: 15px; border-top: 1px solid #EEE; display: flex; gap: 10px;">
                            <input type="text" placeholder="Type a message..." style="flex: 1; padding: 12px 16px; border: 1px solid #DDD; border-radius: 20px; font-size: 0.95rem; outline: none;">
                            <button style="background: linear-gradient(90deg, #667eea, #764ba2); color: #FFF; border: none; padding: 12px 24px; border-radius: 20px; font-weight: bold; cursor: pointer;">Send</button>
                        </div>
                    </div>
                </div>`,

                'forum-post': `<div style="background: #2C3E50; min-height: 100vh; padding: 20px; font-family: Arial, sans-serif;">
                    <div style="max-width: 900px; margin: 0 auto;">
                        <div style="background: #34495E; color: #FFF; padding: 15px; border-radius: 5px 5px 0 0; border-bottom: 3px solid #E74C3C;">
                            <h1 style="margin: 0; font-size: 1.5rem;">ğŸ“‹ Forum Discussion: Your Topic Here</h1>
                        </div>
                        <div style="background: #ECF0F1; padding: 20px; border-radius: 0 0 5px 5px;">
                            <div style="background: #FFF; border-left: 4px solid #3498DB; margin-bottom: 20px; display: flex; gap: 20px; padding: 20px;">
                                <div style="width: 150px; text-align: center; border-right: 2px solid #EEE; padding-right: 20px;">
                                    <div style="width: 80px; height: 80px; background: #3498DB; border-radius: 50%; margin: 0 auto 10px; display: flex; align-items: center; justify-content: center; color: #FFF; font-size: 2rem;">ğŸ‘¤</div>
                                    <div style="font-weight: bold; margin-bottom: 5px;">Username</div>
                                    <div style="color: #7F8C8D; font-size: 0.85rem;">Member</div>
                                    <div style="color: #7F8C8D; font-size: 0.8rem; margin-top: 5px;">Posts: 142</div>
                                </div>
                                <div style="flex: 1;">
                                    <div style="color: #7F8C8D; font-size: 0.85rem; margin-bottom: 15px;">Posted on ${new Date().toLocaleDateString()}</div>
                                    <div style="line-height: 1.6;">
                                        <p>This is the main post content. Share your thoughts, ask questions, or start discussions!</p>
                                        <p>You can format text, add quotes, and more.</p>
                                    </div>
                                    <div style="margin-top: 20px; padding-top: 15px; border-top: 1px solid #DDD; color: #7F8C8D; font-size: 0.85rem;">
                                        Last edited: Never
                                    </div>
                                </div>
                            </div>
                            <div style="background: #FFF; border-left: 4px solid #95A5A6; display: flex; gap: 20px; padding: 20px;">
                                <div style="width: 150px; text-align: center; border-right: 2px solid #EEE; padding-right: 20px;">
                                    <div style="width: 80px; height: 80px; background: #95A5A6; border-radius: 50%; margin: 0 auto 10px; display: flex; align-items: center; justify-content: center; color: #FFF; font-size: 2rem;">ğŸ‘¤</div>
                                    <div style="font-weight: bold; margin-bottom: 5px;">Replier</div>
                                    <div style="color: #7F8C8D; font-size: 0.85rem;">Newbie</div>
                                </div>
                                <div style="flex: 1;">
                                    <div style="color: #7F8C8D; font-size: 0.85rem; margin-bottom: 15px;">Posted on ${new Date().toLocaleDateString()}</div>
                                    <div style="line-height: 1.6;">
                                        <p>Reply to the discussion goes here!</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>`
            };

            if (templates[type]) {
                canvasElements = [{ id: 'el-' + (++elementIdCounter), type: 'template', html: templates[type] }];
                renderCanvas();
                closeModal('template-modal');
                playSound('success', 'C6');
                showStamp('ğŸ“');
                updateStatus(`Loaded ${type} template!`);
                updateElementCount();
            }
        }

        // ============================================
        // MODALS
        // ============================================
        function openModal(id) {
            document.getElementById(id).classList.add('active');
            playSound('pop', 'G5');
        }

        function closeModal(id) {
            document.getElementById(id).classList.remove('active');
            playSound('pop', 'C5');
        }

        function toggleSection(header) {
            header.parentElement.classList.toggle('open');
            playSound('boop', 'E5');
        }

        // ============================================
        // EXPORT / CODE VIEW
        // ============================================
        function exportCode() {
            const currentTheme = themes[themeIndex];
            const pageStyle = getPageStyle();

            // Build complete HTML document
            const fullHTML = `<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Page - Created with WYSIWYG Editor</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: ${currentTheme.font};
            background: ${currentTheme.bg};
            color: ${currentTheme.text};
            min-height: 100vh;
            ${pageStyle}
        }

        /* Element animations */
        .glow-hover:hover {
            filter: drop-shadow(0 0 20px ${currentTheme.accent});
            transform: scale(1.05);
            transition: all 0.3s ease;
        }

        .rotate-hover:hover {
            transform: rotate(5deg);
            transition: transform 0.3s ease;
        }

        .bounce-hover:hover {
            animation: bounce 0.5s;
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }

        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        .anim-shake { animation: shake 0.5s infinite; }
        .anim-spin { animation: spin 2s linear infinite; }
        .anim-pulse { animation: pulse 1s infinite; }
    </style>
</head>
<body>
    ${canvasElements.map(el => el.html).join('\n    ')}

    <div style="position: fixed; bottom: 10px; right: 10px; font-size: 11px; opacity: 0.6; font-family: monospace;">
        Made with WYSIWYG Editor âœ¨
    </div>
</body>
</html>`;

            // Create download
            const blob = new Blob([fullHTML], { type: 'text/html' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'my-page.html';
            a.click();

            // Clean up
            setTimeout(() => URL.revokeObjectURL(url), 100);

            playSound('success', 'C6');
            showStamp('ğŸ’¾');
            updateStatus('Exported complete HTML file!');
        }

        function openModal(id) {
            if (id === 'code-modal') {
                const html = canvasElements.map(el => el.html).join('\n\n');
                document.getElementById('code-display').textContent = html;
            }
            document.getElementById(id).classList.add('active');
            playSound('pop', 'G5');
        }

        function copyCode() {
            const code = document.getElementById('code-display').textContent;
            navigator.clipboard.writeText(code).then(() => {
                playSound('success', 'E6');
                showStamp('ğŸ“‹');
                updateStatus('Code copied!');
            });
        }

        // ============================================
        // NAV CREATOR
        // ============================================
        function createNav() {
            const style = document.getElementById('nav-style').value;
            const linksText = document.getElementById('nav-links').value;
            const links = linksText.split('\n').map(line => {
                const [text, url] = line.split('|').map(s => s.trim());
                return { text, url };
            }).filter(l => l.text && l.url);

            let navHtml = '';
            if (style === 'medieval') {
                navHtml = `<nav style="position: fixed; bottom: 0; left: 0; right: 0; background: linear-gradient(to top, #2b1302, #6e3a12); border-top: 4px solid #d9c27c; padding: 16px; display: flex; gap: 12px;">
                    ${links.map(l => `<a href="${l.url}" style="background: #d2b873; border: 2px solid #f1dba0; padding: 10px 16px; text-decoration: none; color: #2d1503; font-weight: bold; border-radius: 8px;">${l.text}</a>`).join('\n')}
                </nav>`;
            } else if (style === 'floating') {
                navHtml = `<nav style="position: fixed; right: 20px; top: 20px; background: #FFF; border: 4px solid #000; padding: 16px; box-shadow: 6px 6px 0 #000;">
                    ${links.map(l => `<a href="${l.url}" style="display: block; padding: 8px; text-decoration: none; color: #000; font-weight: bold; border-bottom: 2px solid #000;">${l.text}</a>`).join('\n')}
                </nav>`;
            } else {
                navHtml = `<nav style="background: #0000FF; color: #FFF; padding: 16px; border-bottom: 4px solid #000; display: flex; gap: 20px;">
                    ${links.map(l => `<a href="${l.url}" style="color: #FFF; text-decoration: none; font-weight: bold;">${l.text}</a>`).join('\n')}
                </nav>`;
            }

            addElementDirect('nav', navHtml);
            closeModal('nav-modal');
            playSound('success', 'A5');
            showStamp('ğŸ§­');
        }

        function addElementDirect(type, html) {
            const id = 'el-' + (++elementIdCounter);
            canvasElements.push({ id, type, html });
            renderCanvas();
            updateElementCount();
        }

        // ============================================
        // ASCII
        // ============================================
        function addASCII() {
            const ascii = document.getElementById('ascii-input').value;
            if (!ascii) return;

            const html = `<pre style="font-family: monospace; font-size: 12px; line-height: 1; border: 4px solid #000; padding: 20px; background: #000; color: #00FF00; overflow-x: auto;">${ascii}</pre>`;
            addElementDirect('ascii', html);
            closeModal('ascii-modal');
            playSound('success', 'C6');
            showStamp('ğŸ“Ÿ');
            document.getElementById('ascii-input').value = '';
        }

        // ============================================
        // IMAGE MAP
        // ============================================
        function createImageMap() {
            const imageUrl = document.getElementById('imagemap-url').value;
            const areasText = document.getElementById('imagemap-areas').value;

            const areas = areasText.split('\n').map(line => {
                const [coords, url, title] = line.split('|').map(s => s.trim());
                const [x, y, w, h] = coords.split(',').map(n => parseInt(n));
                return { x, y, w, h, url, title };
            }).filter(a => a.x && a.url);

            const mapName = 'map-' + Date.now();
            const html = `
                <div style="position: relative; display: inline-block; border: 4px solid #000;">
                    <img src="${imageUrl}" usemap="#${mapName}" style="max-width: 100%;">
                    <map name="${mapName}">
                        ${areas.map(a => `<area shape="rect" coords="${a.x},${a.y},${a.x + a.w},${a.y + a.h}" href="${a.url}" alt="${a.title}" title="${a.title}">`).join('\n')}
                    </map>
                </div>
            `;

            addElementDirect('imagemap', html);
            closeModal('imagemap-modal');
            playSound('success', 'E6');
            showStamp('ğŸ—ºï¸');
        }

        // ============================================
        // ASSET BROWSER
        // ============================================
        let currentAssets = [];
        let currentAssetType = '';

        function browseAssets(type) {
            const assetPaths = {
                // ===== GIFs & ANIMATIONS =====
                'classic-gifs': [
                    "../assets/classic_gifs/15 (16).gif", "../assets/classic_gifs/4 (13).gif", "../assets/classic_gifs/2 (4).gif",
                    "../assets/classic_gifs/5 (13).gif", "../assets/classic_gifs/12 (2).gif", "../assets/classic_gifs/21.gif",
                    "../assets/classic_gifs/28 (1).gif", "../assets/classic_gifs/38 (1).gif", "../assets/classic_gifs/35.gif",
                    "../assets/classic_gifs/18 (8).gif", "../assets/classic_gifs/15 (6).gif", "../assets/classic_gifs/6 (6).gif",
                    "../assets/classic_gifs/1 (2).gif", "../assets/classic_gifs/11 (4).gif", "../assets/classic_gifs/17 (1).gif",
                    "../assets/classic_gifs/7 (7).gif", "../assets/classic_gifs/10 (5).gif", "../assets/classic_gifs/6 (20).gif",
                    "../assets/classic_gifs/9 (18).gif", "../assets/classic_gifs/2 (14).gif", "../assets/classic_gifs/13 (11).gif",
                    "../assets/classic_gifs/13 (3).gif", "../assets/classic_gifs/12 (11).gif", "../assets/classic_gifs/3 (5).gif",
                    "../assets/classic_gifs/11 (18).gif", "../assets/classic_gifs/34.gif", "../assets/classic_gifs/20.gif",
                    "../assets/classic_gifs/10 (18).gif", "../assets/classic_gifs/14 (7).gif", "../assets/classic_gifs/4 (1).gif",
                    "../assets/classic_gifs/65 (1).gif", "../assets/classic_gifs/19 (9).gif", "../assets/classic_gifs/2 (8).gif",
                    "../assets/classic_gifs/22 (7).gif", "../assets/classic_gifs/53 (1).gif", "../assets/classic_gifs/16 (13).gif",
                    "../assets/classic_gifs/6 (16).gif", "../assets/classic_gifs/43 (1).gif", "../assets/classic_gifs/36.gif",
                    "../assets/classic_gifs/25 (3).gif", "../assets/classic_gifs/22.gif", "../assets/classic_gifs/35 (3).gif",
                    "../assets/classic_gifs/8 (2).gif", "../assets/classic_gifs/18 (4).gif", "../assets/classic_gifs/26 (5).gif",
                    "../assets/classic_gifs/31 (1).gif", "../assets/classic_gifs/21 (1).gif", "../assets/classic_gifs/11 (8).gif",
                    "../assets/classic_gifs/46 (2).gif", "../assets/classic_gifs/27 (4).gif"
                ],
                'bg-gifs': [
                    '../assets/bg_gifs/1zeV.gif'
                ],
                'misc-gifs': [
                    '../assets/misc_gif/metapara/internet.gif',
                    '../assets/misc_gif/Vintage1.gif',
                    '../assets/misc_gif/wwjd.gif',
                    '../assets/misc_gif/Vintage2.gif'
                ],
                'dollz': [
                    '../assets/dollz/dumpz/desk1050.gif',
                    '../assets/pollywog/pip.gif',
                    '../assets/pollywog/peashot.png'
                ],

                // ===== IMAGES & GRAPHICS =====
                'clipart': [
                    '../assets/clipart/classic/banana.gif',
                    '../assets/clipart/classic/beer-mug.gif',
                    '../assets/clipart/classic/bicycle.gif',
                    '../assets/clipart/classic/birthday-cake.gif',
                    '../assets/clipart/classic/books.gif',
                    '../assets/clipart/classic/briefcase.gif',
                    '../assets/clipart/classic/bugs-bunny.gif',
                    '../assets/clipart/classic/burger-king.gif',
                    '../assets/clipart/classic/butterfly.gif',
                    '../assets/clipart/classic/camera.gif',
                    '../assets/clipart/classic/car.gif',
                    '../assets/clipart/classic/cat.gif',
                    '../assets/clipart/classic/coffee-cup.gif',
                    '../assets/clipart/classic/computer.gif',
                    '../assets/clipart/classic/dog.gif',
                    '../assets/clipart/classic/envelope.gif',
                    '../assets/clipart/classic/fish.gif',
                    '../assets/clipart/classic/flower.gif',
                    '../assets/clipart/classic/guitar.gif',
                    '../assets/clipart/classic/heart.gif',
                    '../assets/clipart/classic/house.gif',
                    '../assets/clipart/classic/lightbulb.gif',
                    '../assets/clipart/classic/microphone.gif',
                    '../assets/clipart/classic/moon.gif',
                    '../assets/clipart/classic/pencil.gif',
                    '../assets/clipart/classic/phone.gif',
                    '../assets/clipart/classic/rainbow.gif'
                ],
                'backgrounds': [
                    '../assets/backgrounds/ROBOXEL-Glitchy_Backgrounds/Glitchy_Backgrounds-000.png',
                    '../assets/backgrounds/ROBOXEL-Glitchy_Backgrounds/Glitchy_Backgrounds-001.png',
                    '../assets/backgrounds/ROBOXEL-Glitchy_Backgrounds/Glitchy_Backgrounds-002.png',
                    '../assets/backgrounds/ROBOXEL-Glitchy_Backgrounds/Glitchy_Backgrounds-003.png',
                    '../assets/backgrounds/ROBOXEL-Glitchy_Backgrounds/Glitchy_Backgrounds-004.png',
                    '../assets/backgrounds/ROBOXEL-Glitchy_Backgrounds/Glitchy_Backgrounds-005.png',
                    '../assets/backgrounds/ROBOXEL-Glitchy_Backgrounds/Glitchy_Backgrounds-006.png',
                    '../assets/backgrounds/ROBOXEL-Glitchy_Backgrounds/Glitchy_Backgrounds-007.png',
                    '../assets/backgrounds/ROBOXEL-Glitchy_Backgrounds/Glitchy_Backgrounds-008.png',
                    '../assets/backgrounds/ROBOXEL-Glitchy_Backgrounds/Glitchy_Backgrounds-009.png',
                    '../assets/backgrounds/ROBOXEL-Glitchy_Backgrounds/Glitchy_Backgrounds-010.png',
                    '../assets/backgrounds/ROBOXEL-Glitchy_Backgrounds/Glitchy_Backgrounds-011.png',
                    '../assets/backgrounds/ROBOXEL-Glitchy_Backgrounds/Glitchy_Backgrounds-012.png',
                    '../assets/backgrounds/ROBOXEL-Glitchy_Backgrounds/Glitchy_Backgrounds-013.png',
                    '../assets/backgrounds/ROBOXEL-Glitchy_Backgrounds/Glitchy_Backgrounds-014.png',
                    '../assets/backgrounds/ROBOXEL-Glitchy_Backgrounds/Glitchy_Backgrounds-015.png',
                    '../assets/backgrounds/ROBOXEL-Glitchy_Backgrounds/Glitchy_Backgrounds-016.png',
                    '../assets/backgrounds/ROBOXEL-Glitchy_Backgrounds/Glitchy_Backgrounds-017.png',
                    '../assets/backgrounds/ROBOXEL-Glitchy_Backgrounds/Glitchy_Backgrounds-018.png',
                    '../assets/backgrounds/ROBOXEL-Glitchy_Backgrounds/Glitchy_Backgrounds-019.png',
                    '../assets/backgrounds/ROBOXEL-Glitchy_Backgrounds/Glitchy_Backgrounds-020.png',
                    '../assets/backgrounds/ROBOXEL-Glitchy_Backgrounds/Glitchy_Backgrounds-021.png',
                    '../assets/backgrounds/ROBOXEL-Glitchy_Backgrounds/Glitchy_Backgrounds-022.png',
                    '../assets/backgrounds/ROBOXEL-Glitchy_Backgrounds/Glitchy_Backgrounds-023.png',
                    '../assets/backgrounds/ROBOXEL-Glitchy_Backgrounds/Glitchy_Backgrounds-024.png',
                    '../assets/backgrounds/ROBOXEL-Glitchy_Backgrounds/Glitchy_Backgrounds-025.png',
                    '../assets/backgrounds/ROBOXEL-Glitchy_Backgrounds/Glitchy_Backgrounds-026.png',
                    '../assets/backgrounds/ROBOXEL-Glitchy_Backgrounds/Glitchy_Backgrounds-027.png',
                    '../assets/backgrounds/ROBOXEL-Glitchy_Backgrounds/Glitchy_Backgrounds-028.png',
                    '../assets/backgrounds/ROBOXEL-Glitchy_Backgrounds/Glitchy_Backgrounds-029.png',
                    '../assets/backgrounds/ROBOXEL-Glitchy_Backgrounds/Glitchy_Backgrounds-030.png',
                    '../assets/backgrounds/ROBOXEL-Glitchy_Backgrounds/Glitchy_Backgrounds-031.png',
                    '../assets/backgrounds/ROBOXEL-Glitchy_Backgrounds/Glitchy_Backgrounds-032.png',
                    '../assets/backgrounds/ROBOXEL-Glitchy_Backgrounds/Glitchy_Backgrounds-033.png',
                    '../assets/backgrounds/ROBOXEL-Glitchy_Backgrounds/Glitchy_Backgrounds-034.png',
                    '../assets/backgrounds/ROBOXEL-Glitchy_Backgrounds/Glitchy_Backgrounds-035.png',
                    '../assets/backgrounds/ROBOXEL-Glitchy_Backgrounds/Glitchy_Backgrounds-036.png',
                    '../assets/backgrounds/ROBOXEL-Glitchy_Backgrounds/Glitchy_Backgrounds-037.png',
                    '../assets/backgrounds/ROBOXEL-Glitchy_Backgrounds/Glitchy_Backgrounds-038.png',
                    '../assets/backgrounds/ROBOXEL-Glitchy_Backgrounds/Glitchy_Backgrounds-039.png',
                    '../assets/backgrounds/ROBOXEL-Glitchy_Backgrounds/Glitchy_Backgrounds-048.png',
                    '../assets/backgrounds/ROBOXEL-Glitchy_Backgrounds/Glitchy_Backgrounds-049.png',
                    '../assets/backgrounds/ROBOXEL-Glitchy_Backgrounds/Glitchy_Backgrounds-058.png',
                    '../assets/backgrounds/ROBOXEL-Glitchy_Backgrounds/Glitchy_Backgrounds-059.png',
                    '../assets/backgrounds/ROBOXEL-Glitchy_Backgrounds/Glitchy_Backgrounds-060.png',
                    '../assets/backgrounds/ROBOXEL-Glitchy_Backgrounds/Glitchy_Backgrounds-061.png',
                    '../assets/backgrounds/ROBOXEL-Glitchy_Backgrounds/Glitchy_Backgrounds-062.png',
                    '../assets/backgrounds/ROBOXEL-Glitchy_Backgrounds/Glitchy_Backgrounds-063.png',
                    '../assets/backgrounds/ROBOXEL-Glitchy_Backgrounds/Glitchy_Backgrounds-064.png',
                    '../assets/backgrounds/ROBOXEL-Glitchy_Backgrounds/Glitchy_Backgrounds-065.png',
                    '../assets/backgrounds/ROBOXEL-Glitchy_Backgrounds/Glitchy_Backgrounds-066.png',
                    '../assets/backgrounds/ROBOXEL-Glitchy_Backgrounds/Glitchy_Backgrounds-067.png',
                    '../assets/backgrounds/ROBOXEL-Glitchy_Backgrounds/Glitchy_Backgrounds-100.png',
                    '../assets/backgrounds/ROBOXEL-Glitchy_Backgrounds/Glitchy_Backgrounds-101.png',
                    '../assets/backgrounds/ROBOXEL-Glitchy_Backgrounds/Glitchy_Backgrounds-102.png',
                    '../assets/backgrounds/ROBOXEL-Glitchy_Backgrounds/Glitchy_Backgrounds-103.png',
                    '../assets/backgrounds/ROBOXEL-Glitchy_Backgrounds/Glitchy_Backgrounds-104.png',
                    '../assets/backgrounds/ROBOXEL-Glitchy_Backgrounds/Glitchy_Backgrounds-105.png',
                    '../assets/backgrounds/ROBOXEL-Glitchy_Backgrounds/Glitchy_Backgrounds-106.png',
                    '../assets/backgrounds/ROBOXEL-Glitchy_Backgrounds/Glitchy_Backgrounds-107.png',
                    '../assets/backgrounds/ROBOXEL-Glitchy_Backgrounds/Glitchy_Backgrounds-138.png',
                    '../assets/backgrounds/ROBOXEL-Glitchy_Backgrounds/Glitchy_Backgrounds-139.png',
                    '../assets/backgrounds/ROBOXEL-Glitchy_Backgrounds/Glitchy_Backgrounds-140.png',
                    '../assets/backgrounds/ROBOXEL-Glitchy_Backgrounds/Glitchy_Backgrounds-141.png',
                    '../assets/backgrounds/ROBOXEL-Glitchy_Backgrounds/Glitchy_Backgrounds-142.png',
                    '../assets/backgrounds/ROBOXEL-Glitchy_Backgrounds/Glitchy_Backgrounds-143.png',
                    '../assets/backgrounds/ROBOXEL-Glitchy_Backgrounds/Glitchy_Backgrounds-144.png',
                    '../assets/backgrounds/ROBOXEL-Glitchy_Backgrounds/Glitchy_Backgrounds-145.png',
                    '../assets/backgrounds/ROBOXEL-Glitchy_Backgrounds/Glitchy_Backgrounds-146.png',
                    '../assets/backgrounds/ROBOXEL-Glitchy_Backgrounds/Glitchy_Backgrounds-147.png',
                    '../assets/backgrounds/ROBOXEL-Glitchy_Backgrounds/Glitchy_Backgrounds-148.png',
                    '../assets/backgrounds/ROBOXEL-Glitchy_Backgrounds/Glitchy_Backgrounds-149.png'
                ],
                'landscape': [
                    '../assets/landscape/13.jpg',
                    '../assets/landscape/20.jpg',
                    '../assets/landscape/30.jpg',
                    '../assets/landscape/32.jpg',
                    '../assets/landscape/35.jpg',
                    '../assets/landscape/39.jpg',
                    '../assets/landscape/41.jpg',
                    '../assets/landscape/44.jpg',
                    '../assets/landscape/45.jpg',
                    '../assets/landscape/49.jpg',
                    '../assets/landscape/52.jpg',
                    '../assets/landscape/54.jpg',
                    '../assets/landscape/56.jpg',
                    '../assets/landscape/59.jpg',
                    '../assets/landscape/63.jpg',
                    '../assets/landscape/65.jpg',
                    '../assets/landscape/66.jpg',
                    '../assets/landscape/68.jpg',
                    '../assets/landscape/71.jpg',
                    '../assets/landscape/74.jpg',
                    '../assets/landscape/79.jpg',
                    '../assets/landscape/82.jpg',
                    '../assets/landscape/87.jpg',
                    '../assets/landscape/90.jpg',
                    '../assets/landscape/92.jpg',
                    '../assets/landscape/95.jpg',
                    '../assets/landscape/99.jpg',
                    '../assets/landscape/100.jpg',
                    '../assets/landscape/103.jpg',
                    '../assets/landscape/107.jpg',
                    '../assets/landscape/111.jpg',
                    '../assets/landscape/117.jpg',
                    '../assets/landscape/124.jpg',
                    '../assets/landscape/130.jpg',
                    '../assets/landscape/133.jpg',
                    '../assets/landscape/138.jpg',
                    '../assets/landscape/143.jpg',
                    '../assets/landscape/149.jpg',
                    '../assets/landscape/153.jpg',
                    '../assets/landscape/156.jpg',
                    '../assets/landscape/160.jpg',
                    '../assets/landscape/165.jpg',
                    '../assets/landscape/172.jpg',
                    '../assets/landscape/177.jpg',
                    '../assets/landscape/183.jpg',
                    '../assets/landscape/188.jpg',
                    '../assets/landscape/194.jpg',
                    '../assets/landscape/199.jpg',
                    '../assets/landscape/202.jpg',
                    '../assets/landscape/207.jpg'
                ],
                'tilesets': [
                    '../assets/tilesets/background/Clouds1-100x200.png',
                    '../assets/tilesets/background/Desert.png',
                    '../assets/tilesets/background/Free_BG_2_320x180px.png',
                    '../assets/tilesets/background/Sky_Tiles-32.png',
                    '../assets/tilesets/background/Bush2-60.png',
                    '../assets/tilesets/background/Free_BG_Full_1280x720px.png',
                    '../assets/tilesets/background/Free_BG_1_320x180px.png',
                    '../assets/tilesets/background/Free_Sprite_32x32px.png',
                    '../assets/tilesets/background/Free_BG_5_320x180px.png',
                    '../assets/tilesets/platforms/Wood-Tiles 32x32.png',
                    '../assets/tilesets/platforms/Rocks-Tiles 32x32.png',
                    '../assets/tilesets/platforms/Grass-Tiles 32x32.png',
                    '../assets/tilesets/platforms/ladder-32x32.png',
                    '../assets/tilesets/platforms/UI inventory.png',
                    '../assets/tilesets/Interactables/Ice_bullet-13x13.png',
                    '../assets/tilesets/Interactables/Bullet-7x7.png',
                    '../assets/tilesets/Interactables/Heart-23x23.png',
                    '../assets/tilesets/Interactables/Door-64x64.png',
                    '../assets/tilesets/Interactables/Button-64x64.png',
                    '../assets/tilesets/FreeUI.png',
                    '../assets/tilesets/UIBundleFree/MediavelFree.png',
                    '../assets/tilesets/UIBundleFree/FreeHorrorUi.png',
                    '../assets/tilesets/UIBundleFree/FreeUI.png',
                    '../assets/tilesets/UIBundleFree/PastelUIFree.png'
                ],
                'buttons-etc': [],
                'old-logos': [],
                'placeholder-imgs': [],
                'voxel': [
                    '../assets/voxel/Cute Voxel Nature Pack/Trees/TreeDark_3.png',
                    '../assets/voxel/Cute Voxel Nature Pack/Trees/TreeBlossom_1.png',
                    '../assets/voxel/Cute Voxel Nature Pack/Trees/Tree_1.png',
                    '../assets/voxel/Cute Voxel Nature Pack/Trees/Tree_2.png',
                    '../assets/voxel/Cute Voxel Nature Pack/Bushes/SimpleBush_FruitsSmall.png',
                    '../assets/voxel/Cute Voxel Nature Pack/Bushes/SimpleBush_Small.png',
                    '../assets/voxel/Cute Voxel Nature Pack/Bushes/SimpleBush_Big.png',
                    '../assets/voxel/Cute Voxel Nature Pack/Stones/Stone_Bigger.png',
                    '../assets/voxel/Cute Voxel Nature Pack/Stones/Stone_Small.png',
                    '../assets/voxel/Cute Voxel Nature Pack/Objects/Tent.png',
                    '../assets/voxel/Cute Voxel Nature Pack/Objects/Campfire.png',
                    '../assets/voxel/Cute Voxel Nature Pack/Objects/Torch.png',
                    '../assets/voxel/Cute Voxel Nature Pack/Objects/LogBench.png',
                    '../assets/voxel/Cute Voxel Nature Pack/Grass-Flowers/SimpleFlowers_Small.png',
                    '../assets/voxel/Cute Voxel Nature Pack/Grass-Flowers/TallGrass.png',
                    '../assets/voxel/Voxel_Animal_Asset_Pack/Collectibles/apple/apple.vox.png',
                    '../assets/voxel/Voxel_Animal_Asset_Pack/Collectibles/cheese/cheese.vox.png',
                    '../assets/voxel/Voxel_Animal_Asset_Pack/Collectibles/bamboo/bamboo.vox.png',
                    '../assets/voxel/Voxel_Animal_Asset_Pack/Collectibles/honey/honey.vox.png',
                    '../assets/voxel/Voxel_Animal_Asset_Pack/Collectibles/banana/banana.vox.png',
                    '../assets/voxel/Voxel_Animal_Asset_Pack/Collectibles/fish/fish.vox.png',
                    '../assets/voxel/Voxel_Animal_Asset_Pack/Animals/Cat/cat.vox.png',
                    '../assets/voxel/Voxel_Animal_Asset_Pack/Animals/Dog/dog.vox.png',
                    '../assets/voxel/Voxel_Animal_Asset_Pack/Animals/Fox/fox.vox.png',
                    '../assets/voxel/Voxel_Animal_Asset_Pack/Animals/Bear/bear.vox.png',
                    '../assets/voxel/Voxel_Animal_Asset_Pack/Animals/Penguin/penguin.vox.png',
                    '../assets/voxel/Voxel_Animal_Asset_Pack/Animals/Panda/panda.vox.png',
                    '../assets/voxel/Voxel_Animal_Asset_Pack/Animals/Bunny/bunny.vox.png',
                    '../assets/voxel/Voxel_Animal_Asset_Pack/Animals/Mouse/mouse.vox.png',
                    '../assets/voxel/Voxel_Animal_Asset_Pack/Animals/Parrot/parrot.vox.png',
                    '../assets/voxel/Voxel_Animal_Asset_Pack/Animals/Chicken/chicken.vox.png',
                    '../assets/voxel/Voxel_Animal_Asset_Pack/Animals/Monkey/monkey.vox.png',
                    '../assets/voxel/Voxel_Animal_Asset_Pack/Animals/Frog/frog.vox.png',
                    '../assets/voxel/Voxel_Animal_Asset_Pack/Animals/Unicorn/unicorn.vox.png'
                ],

                // ===== MAPS & GAME ASSETS =====
                neopets: [
                    '../assets/_retroinspo/_neopets/faerieland_map.png',
                    '../assets/_retroinspo/_neopets/4pjrdmr9s0la1.png',
                    '../assets/_retroinspo/_neopets/7skcv06ssy6a1.png',
                    '../assets/_retroinspo/_neopets/neop1.jpg',
                    '../assets/_retroinspo/_neopets/mej68di3zsf81.jpg',
                    '../assets/_retroinspo/_neopets/neopia_old_map_12.gif',
                    '../assets/_retroinspo/_neopets/plateau11.gif',
                    '../assets/_retroinspo/_neopets/Meridell_(Neopets).gif',
                    '../assets/_retroinspo/_neopets/ceee2e85fc0b6703251371c9c9161d2a.jpg',
                    '../assets/_retroinspo/_neopets/k3z3kbggn7ib1.jpg',
                    '../assets/_retroinspo/_neopets/images.png',
                    '../assets/_retroinspo/_neopets/images.jpg',
                    '../assets/_retroinspo/_neopets/6c71b31cc75acdbe9260dabc75f4a9e0.png',
                    '../assets/_retroinspo/_neopets/download.jpg',
                    '../assets/_retroinspo/_neopets/ztezwyiijx331.jpg',
                    '../assets/_retroinspo/_neopets/Fyy06bEXoAAcvpZ.jpg'
                ],
                'hdtv-sprites': [
                    '../assets/hdtv_game_assets/nabu_sprite.png',
                    '../assets/hdtv_game_assets/hd_sprite.png',
                    '../assets/hdtv_game_assets/sypher_sprite.png',
                    '../assets/hdtv_game_assets/rizzler_sprite.png',
                    '../assets/hdtv_game_assets/gwood.png',
                    '../assets/hdtv_game_assets/gwood_withsprites.png'
                ],
                entity: [
                    '../assets/entity/bolt/bettle_bolt.png',
                    '../assets/entity/anzu/anzu_selfie1.png',
                    '../assets/entity/hyenadiva/hdtv_promo1.png',
                    '../assets/entity/nabu/nabu_masked.png',
                    '../assets/entity/sypher/sypher_hyena1.png',
                    '../assets/entity/one2/nabu_anzu_1.png'
                ],
                maps: [
                    '../assets/maps/voidforest.jpg'
                ],

                // ===== SPECIAL =====
                mysterious: [
                    '../assets/mysterious_assets/supermeme_0h44_37.gif',
                    '../assets/mysterious_assets/nvidia_brrr.gif',
                    '../assets/mysterious_assets/the-guy.png',
                    '../assets/mysterious_assets/supermeme_0h44_48.gif',
                    '../assets/mysterious_assets/globalwhooing.gif',
                    '../assets/mysterious_assets/the-guy-sparks.png'
                ],
                retroinspo: [
                    '../assets/_retroinspo/_neopets/faerieland_map.png',
                    '../assets/_retroinspo/_neopets/neopia_old_map_12.gif',
                    '../assets/_retroinspo/_neopets/Meridell_(Neopets).gif'
                ],

                // ===== AUDIO =====
                'retro-sfx': Array.from({length: 100}, (_, i) => `../assets/audio/100_Retro_Game_Sounds_SFX_[VOLUME1]_24 bits_44.1KHz_WAV_CC-BY-3.0_by_jalastram/Retro_Game_Sounds_SFX_${String(i + 1).padStart(2, '0')}.wav`),
                'fx-pack': Array.from({length: 90}, (_, i) => `../assets/audio/500 Sound Effects by Jalastram/FX${String(i + 1).padStart(3, '0')}.mp3`),
                'individual-sfx': [
                    '../assets/audio/SFX_jump.wav',
                    '../assets/audio/SFX_hurt.wav',
                    '../assets/audio/SFX_shoot_normal.wav',
                    '../assets/audio/SFX_button.wav',
                    '../assets/audio/SFX_gift.wav',
                    '../assets/audio/SFX_hit.wav',
                    '../assets/audio/SFX_kid.wav',
                    '../assets/audio/SFX_super_jump.wav'
                ],
                music: [
                    '../assets/sounds/pink_panther.mid',
                    '../assets/sounds/Aqua_Barbie_Girl.mid',
                    '../assets/sounds/MapleLeafRag.mp3',
                    '../assets/sounds/DreamwalkerSEP2.mp3'
                ],

                // ===== 3D MODELS =====
                glbs: [
                    '../assets/pollywog/pip_jazz.glb',
                    '../assets/pollywog/pip_wave.glb',
                    '../assets/pollywog/pip_walk.glb',
                    '../assets/pollywog/pip_jump.glb',
                    '../assets/pollywog/pip_fall.glb'
                ],
                pollywog: [
                    '../assets/pollywog/pip_jazz.glb',
                    '../assets/pollywog/pip_wave.glb',
                    '../assets/pollywog/pip_walk.glb',
                    '../assets/pollywog/pip_jump.glb',
                    '../assets/pollywog/pip_fall.glb'
                ]
            };

            const assets = assetPaths[type] || [];

            // Store globally for filtering
            currentAssets = assets;
            currentAssetType = type;

            // Clear search input
            const searchInput = document.getElementById('asset-search');
            if (searchInput) searchInput.value = '';

            // Render the assets
            renderAssetGrid(assets, type);
        }

        function renderAssetGrid(assets, type) {
            const grid = document.getElementById('asset-grid');
            const countDiv = document.getElementById('asset-count');

            // Handle empty categories
            if (assets.length === 0) {
                grid.innerHTML = `
                    <div style="grid-column: 1 / -1; text-align: center; padding: 40px; color: var(--purple);">
                        <div style="font-size: 48px; margin-bottom: 15px;">ğŸ“</div>
                        <h3>This category needs to be populated!</h3>
                        <p style="margin: 10px 0;">Use direct paths in your HTML/CSS like:</p>
                        <code style="background: #FFF; padding: 5px 10px; border: 2px solid #FF00FF; display: inline-block; margin-top: 10px;">
                            ../assets/${type}/yourfile.gif
                        </code>
                        <p style="margin-top: 15px; font-size: 14px;">Or drag files from your file browser!</p>
                    </div>
                `;
                if (countDiv) countDiv.textContent = '';
                return;
            }

            // Show a subset if there are too many
            const displayAssets = assets.length > 100 ? assets.slice(0, 100) : assets;
            const hasMore = assets.length > 100;

            grid.innerHTML = displayAssets.map(path => {
                const name = path.split('/').pop();
                const isImage = path.match(/\.(gif|png|jpg|webp)$/i);
                const isAudio = path.match(/\.(wav|mp3|mid)$/i);

                return `
                    <div class="asset-item" onclick="insertAsset('${path}', '${type}')">
                        ${isImage ? `<img src="${path}" class="asset-preview" loading="lazy">` : ''}
                        ${isAudio ? 'ğŸ”Š' : ''}
                        <div style="font-size: 11px;">${name}</div>
                    </div>
                `;
            }).join('');

            if (hasMore) {
                grid.innerHTML += `<div class="asset-item" style="grid-column: 1 / -1; text-align: center; color: var(--purple); font-weight: bold;">
                    Showing 100 of ${assets.length} files<br>
                    <small>Use search to find specific files!</small>
                </div>`;
            }

            // Update count
            if (countDiv) {
                countDiv.textContent = displayAssets.length === assets.length
                    ? `Showing all ${assets.length} assets`
                    : `Showing ${displayAssets.length} of ${assets.length} assets`;
            }
        }

        function filterAssets() {
            const searchInput = document.getElementById('asset-search');
            const searchTerm = searchInput.value.toLowerCase().trim();

            if (!searchTerm) {
                // No search term, show all
                renderAssetGrid(currentAssets, currentAssetType);
                return;
            }

            // Filter assets by filename
            const filtered = currentAssets.filter(path => {
                const filename = path.split('/').pop().toLowerCase();
                return filename.includes(searchTerm);
            });

            renderAssetGrid(filtered, currentAssetType);

            // Update count with search info
            const countDiv = document.getElementById('asset-count');
            if (countDiv && searchTerm) {
                countDiv.textContent = `Found ${filtered.length} of ${currentAssets.length} assets matching "${searchTerm}"`;
            }
        }

        function insertAsset(path, type) {
            let html = '';
            const filename = path.split('/').pop();

            if (type === 'gifs') {
                html = `<img src="${path}" style="border: 4px solid #000; max-width: 300px;">`;
            } else if (type === 'neopets') {
                html = `<img src="${path}" alt="Neopets Map" style="border: 4px solid #000; max-width: 600px; cursor: pointer;" title="${filename}">`;
            } else if (type === 'hdtv-sprites') {
                html = `<img src="${path}" alt="HDTV Sprite" style="border: 4px solid #000; max-width: 400px; image-rendering: pixelated;" title="${filename}">`;
            } else if (type === 'retro-sfx' || type === 'fx-pack' || type === 'individual-sfx' || type === 'music') {
                html = `<audio controls style="border: 4px solid #000; margin: 10px 0;"><source src="${path}"></audio>`;
            } else if (type === 'glbs') {
                // Create unique ID for this 3D viewer
                const viewerId = 'glb-viewer-' + Date.now();
                html = `<div style="border: 4px solid #000; background: #000; width: 400px; height: 400px; position: relative;">
                    <canvas id="${viewerId}" style="width: 100%; height: 100%; display: block;"></canvas>
                    <div style="position: absolute; bottom: 10px; left: 10px; background: rgba(0,0,0,0.7); color: #0F0; padding: 5px 10px; font-family: 'VT323', monospace; border: 2px solid #0F0;">ğŸ¦ ${filename}</div>
                </div>`;

                // Add element first
                addElementDirect(type, html);

                // Initialize Three.js viewer after a brief delay to ensure DOM is ready
                setTimeout(() => initGLBViewer(viewerId, path), 100);

                closeModal('asset-modal');
                playSound('success', 'G5');
                showStamp('ğŸ¦');
                return; // Exit early since we already added the element
            }

            if (html) {
                addElementDirect(type, html);
                closeModal('asset-modal');
                playSound('success', 'G5');
                showStamp('âœ¨');
            }
        }

        // Insert file from browser file input
        function insertFileFromBrowser() {
            const fileInput = document.getElementById('file-browser-input');
            const file = fileInput.files[0];

            if (!file) {
                alert('Please select a file first!');
                updateStatus('No file selected');
                return;
            }

            const reader = new FileReader();

            reader.onload = (e) => {
                const dataUrl = e.target.result;
                let html = '';
                let type = 'file';

                if (file.type.startsWith('image/')) {
                    html = `<img src="${dataUrl}" alt="${file.name}" style="border: 4px solid #000; max-width: 400px;" title="${file.name}">`;
                    type = 'image';
                } else if (file.type.startsWith('audio/')) {
                    html = `<audio controls style="border: 4px solid #000; margin: 10px 0;"><source src="${dataUrl}" type="${file.type}"></audio>`;
                    type = 'audio';
                } else if (file.name.endsWith('.glb')) {
                    // Create unique ID for this 3D viewer
                    const viewerId = 'glb-viewer-' + Date.now();
                    html = `<div style="border: 4px solid #000; background: #000; width: 400px; height: 400px; position: relative;">
                        <canvas id="${viewerId}" style="width: 100%; height: 100%; display: block;"></canvas>
                        <div style="position: absolute; bottom: 10px; left: 10px; background: rgba(0,0,0,0.7); color: #0F0; padding: 5px 10px; font-family: 'VT323', monospace; border: 2px solid #0F0;">ğŸ¦ ${file.name}</div>
                    </div>`;
                    type = 'glb';

                    // Add element first
                    addElementDirect(type, html);

                    // Initialize Three.js viewer after a brief delay
                    setTimeout(() => initGLBViewer(viewerId, dataUrl), 100);

                    closeModal('asset-modal');
                    playSound('success', 'G5');
                    showStamp('ğŸ“‚');
                    updateStatus(`Inserted ${file.name}`);

                    // Reset input
                    fileInput.value = '';
                    return;
                }

                if (html) {
                    addElementDirect(type, html);
                    closeModal('asset-modal');
                    playSound('success', 'G5');
                    showStamp('ğŸ“‚');
                    updateStatus(`Inserted ${file.name}`);

                    // Reset input
                    fileInput.value = '';
                } else {
                    alert(`Unsupported file type: ${file.type}\n\nSupported types:\n- Images (GIF, PNG, JPG, WebP)\n- Audio (MP3, WAV)\n- 3D Models (GLB)`);
                    updateStatus('Unsupported file type');
                }
            };

            reader.onerror = () => {
                alert('Error reading file!');
                updateStatus('File read error');
            };

            // Read file as data URL
            reader.readAsDataURL(file);
        }

        // ============================================
        // THREE.JS GLB VIEWER
        // ============================================
        async function initGLBViewer(canvasId, glbPath) {
            const canvas = document.getElementById(canvasId);
            if (!canvas) {
                console.error('Canvas not found:', canvasId);
                return;
            }

            try {
                // Dynamically import Three.js modules
                const THREE = await import('three');
                const { GLTFLoader } = await import('three/addons/loaders/GLTFLoader.js');
                const { OrbitControls } = await import('three/addons/controls/OrbitControls.js');

                // Setup scene
                const scene = new THREE.Scene();
                scene.background = new THREE.Color(0x000000);

                // Setup camera
                const camera = new THREE.PerspectiveCamera(
                    50,
                    canvas.clientWidth / canvas.clientHeight,
                    0.1,
                    1000
                );
                camera.position.set(0, 1, 3);

                // Setup renderer
                const renderer = new THREE.WebGLRenderer({ canvas, antialias: true });
                renderer.setSize(canvas.clientWidth, canvas.clientHeight);
                renderer.setPixelRatio(window.devicePixelRatio);

                // Add lights
                const ambientLight = new THREE.AmbientLight(0xffffff, 0.6);
                scene.add(ambientLight);
                const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
                directionalLight.position.set(5, 10, 7.5);
                scene.add(directionalLight);

                // Add orbit controls
                const controls = new OrbitControls(camera, renderer.domElement);
                controls.enableDamping = true;
                controls.dampingFactor = 0.05;
                controls.minDistance = 1;
                controls.maxDistance = 10;

                // Load GLB model
                const loader = new GLTFLoader();
                loader.load(
                    glbPath,
                    (gltf) => {
                        const model = gltf.scene;

                        // Center and scale model
                        const box = new THREE.Box3().setFromObject(model);
                        const center = box.getCenter(new THREE.Vector3());
                        model.position.sub(center);

                        const size = box.getSize(new THREE.Vector3());
                        const maxDim = Math.max(size.x, size.y, size.z);
                        const scale = 2 / maxDim;
                        model.scale.setScalar(scale);

                        scene.add(model);

                        // Animation loop
                        function animate() {
                            requestAnimationFrame(animate);
                            controls.update();

                            // Auto-rotate
                            model.rotation.y += 0.005;

                            renderer.render(scene, camera);
                        }
                        animate();
                    },
                    (progress) => {
                        console.log('Loading:', (progress.loaded / progress.total * 100) + '%');
                    },
                    (error) => {
                        console.error('Error loading GLB:', error);
                    }
                );

            } catch (error) {
                console.error('Error initializing Three.js:', error);
            }
        }

        // ============================================
        // LOAD EXISTING PAGE
        // ============================================
        function filterPages(category) {
            const allPages = document.querySelectorAll('.page-item');

            allPages.forEach(page => {
                if (category === 'all') {
                    page.style.display = 'block';
                } else if (page.classList.contains(category)) {
                    page.style.display = 'block';
                } else {
                    page.style.display = 'none';
                }
            });

            playSound('pop', 'E5');
        }

        // Store loaded page data
        let loadedPageData = {
            html: '',
            css: '',
            js: '',
            fullHtml: ''
        };

        function loadExistingPage(url) {
            updateStatus(`Loading ${url}...`);

            // Fetch the HTML file
            fetch(url)
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`Failed to load: ${response.status}`);
                    }
                    return response.text();
                })
                .then(htmlContent => {
                    // Store full HTML
                    loadedPageData.fullHtml = htmlContent;

                    // Parse the HTML
                    const parser = new DOMParser();
                    const doc = parser.parseFromString(htmlContent, 'text/html');

                    // Extract CSS from <style> tags and <link> tags
                    let extractedCSS = '';
                    doc.querySelectorAll('style').forEach(style => {
                        extractedCSS += style.textContent + '\n\n';
                    });
                    doc.querySelectorAll('link[rel="stylesheet"]').forEach(link => {
                        extractedCSS += `/* External stylesheet: ${link.href} */\n`;
                    });

                    // Extract JavaScript from <script> tags
                    let extractedJS = '';
                    doc.querySelectorAll('script').forEach(script => {
                        if (script.src) {
                            extractedJS += `// External script: ${script.src}\n`;
                        } else {
                            extractedJS += script.textContent + '\n\n';
                        }
                    });

                    // Extract body content
                    const bodyContent = doc.body ? doc.body.innerHTML : '';

                    // Store extracted data
                    loadedPageData.html = bodyContent;
                    loadedPageData.css = extractedCSS;
                    loadedPageData.js = extractedJS;

                    // Clear current canvas
                    canvasElements = [];

                    // âœ¨ NEW: Parse body into individual editable components!
                    if (doc.body && doc.body.children.length > 0) {
                        // Parse each top-level element in the body
                        Array.from(doc.body.children).forEach(element => {
                            const id = 'el-' + (++elementIdCounter);

                            // Get computed styles if available
                            const computedStyle = element.style.cssText || '';

                            canvasElements.push({
                                id,
                                type: 'html',
                                html: element.outerHTML,
                                // Preserve inline styles
                                styles: computedStyle
                            });
                        });

                        updateStatus(`Loaded ${url.split('/').pop()} - ${canvasElements.length} components ready to edit!`);
                    } else {
                        // Fallback: create single element with all content
                        const id = 'el-' + (++elementIdCounter);
                        canvasElements.push({
                            id,
                            type: 'loaded-page',
                            html: bodyContent
                        });

                        updateStatus(`Loaded ${url.split('/').pop()} - Click "Edit Code" to modify HTML/CSS/JS!`);
                    }

                    // Render
                    renderCanvas();
                    updateElementCount();

                    closeModal('load-modal');
                    playSound('success', 'G5');
                    showStamp('ğŸŒ');
                })
                .catch(error => {
                    updateStatus(`Error: ${error.message}`);
                    alert(`Failed to load page: ${error.message}\n\nMake sure the file exists in your repo.`);
                    playSound('error', 'C3');
                });
        }

        // ============================================
        // CSS / JS EDITORS
        // ============================================
        function loadCSSFromPage() {
            if (!loadedPageData.css) {
                alert('No CSS loaded from page. Load a page first!');
                return;
            }
            document.getElementById('css-editor').value = loadedPageData.css;
            playSound('success', 'E5');
            updateStatus('CSS loaded into editor!');
        }

        function loadJSFromPage() {
            if (!loadedPageData.js) {
                alert('No JavaScript loaded from page. Load a page first!');
                return;
            }
            document.getElementById('js-editor').value = loadedPageData.js;
            playSound('success', 'E5');
            updateStatus('JavaScript loaded into editor!');
        }

        // CSS Snippet Library
        const cssSnippets = {
            'neon': `/* Neon Glow Effect */
.neon {
  color: #fff;
  text-shadow: 0 0 10px #fff, 0 0 20px #00ffff, 0 0 30px #00ffff, 0 0 40px #00ffff;
  animation: glow 1.5s ease-in-out infinite alternate;
}

@keyframes glow {
  from { filter: hue-rotate(0deg); }
  to { filter: hue-rotate(360deg); }
}`,
            'brutalist': `/* Brutalist Style */
.brutalist {
  border: 4px solid #000;
  background: #fff;
  box-shadow: 8px 8px 0 #000;
  padding: 20px;
  font-weight: bold;
}

.brutalist:hover {
  transform: translate(4px, 4px);
  box-shadow: 4px 4px 0 #000;
}`,
            'gradient': `/* Gradient Backgrounds */
.gradient-sunset {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
}

.gradient-ocean {
  background: linear-gradient(135deg, #667eea 0%, #00d2ff 100%);
}

.gradient-fire {
  background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
}`,
            'animation': `/* Animations */
.bounce {
  animation: bounce 1s infinite;
}

@keyframes bounce {
  0%, 100% { transform: translateY(0); }
  50% { transform: translateY(-20px); }
}

.shake {
  animation: shake 0.5s infinite;
}

@keyframes shake {
  0%, 100% { transform: translateX(0); }
  25% { transform: translateX(-10px); }
  75% { transform: translateX(10px); }
}`,
            'glassmorphism': `/* Glass Effect */
.glass {
  background: rgba(255, 255, 255, 0.1);
  backdrop-filter: blur(10px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 10px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
}`,
            'retro': `/* Retro 90s Style */
.retro {
  background: linear-gradient(45deg, #ff00ff, #00ffff);
  border: 3px solid #000;
  box-shadow: 5px 5px 0 #ffff00, -5px -5px 0 #ff00ff;
  font-family: 'Comic Sans MS', cursive;
  padding: 20px;
  transform: rotate(-1deg);
}`
        };

        function insertCSSSnippet(type) {
            const snippet = cssSnippets[type];
            if (snippet) {
                const editor = document.getElementById('css-editor');
                editor.value += (editor.value ? '\n\n' : '') + snippet;
                playSound('pop', 'E5');
                showStamp('ğŸ“');
                updateStatus(`Added ${type} CSS snippet!`);
            }
        }

        function applyCSS() {
            const cssContent = document.getElementById('css-editor').value;
            if (!cssContent.trim()) {
                alert('CSS editor is empty!');
                return;
            }

            // Add CSS to canvas as a style element
            const id = 'el-' + (++elementIdCounter);
            const html = `<style>${cssContent}</style>`;
            canvasElements.push({ id, type: 'css', html });

            renderCanvas();
            updateElementCount();
            playSound('success', 'G5');
            showStamp('ğŸ¨');
            updateStatus('CSS applied to canvas!');
        }

        // JavaScript Snippet Library
        const jsSnippets = {
            'click-counter': `// Click Counter
let count = 0;
const button = document.querySelector('.counter-btn');
const display = document.querySelector('.counter-display');

button.addEventListener('click', () => {
  count++;
  display.textContent = count;
});`,
            'smooth-scroll': `// Smooth Scroll to Anchors
document.querySelectorAll('a[href^="#"]').forEach(anchor => {
  anchor.addEventListener('click', function(e) {
    e.preventDefault();
    const target = document.querySelector(this.getAttribute('href'));
    target.scrollIntoView({ behavior: 'smooth' });
  });
});`,
            'dark-mode': `// Dark Mode Toggle
const toggleBtn = document.querySelector('.dark-mode-toggle');
toggleBtn.addEventListener('click', () => {
  document.body.classList.toggle('dark-mode');
  localStorage.setItem('darkMode', document.body.classList.contains('dark-mode'));
});

// Load saved preference
if (localStorage.getItem('darkMode') === 'true') {
  document.body.classList.add('dark-mode');
}`,
            'form-validation': `// Form Validation
const form = document.querySelector('form');
form.addEventListener('submit', (e) => {
  e.preventDefault();

  const email = form.querySelector('input[type="email"]').value;
  const emailRegex = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/;

  if (!emailRegex.test(email)) {
    alert('Please enter a valid email address');
    return;
  }

  alert('Form submitted successfully!');
});`,
            'typewriter': `// Typewriter Effect
function typewriter(element, text, speed = 50) {
  let i = 0;
  element.textContent = '';

  function type() {
    if (i < text.length) {
      element.textContent += text.charAt(i);
      i++;
      setTimeout(type, speed);
    }
  }

  type();
}

// Usage: typewriter(document.querySelector('.typewriter'), 'Hello World!');`,
            'confetti': `// Confetti Burst Effect
function createConfetti() {
  const colors = ['#ff0000', '#00ff00', '#0000ff', '#ffff00', '#ff00ff', '#00ffff'];

  for (let i = 0; i < 50; i++) {
    const confetti = document.createElement('div');
    confetti.style.position = 'fixed';
    confetti.style.width = '10px';
    confetti.style.height = '10px';
    confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
    confetti.style.left = Math.random() * 100 + '%';
    confetti.style.top = '-10px';
    confetti.style.opacity = Math.random();
    confetti.style.transform = 'rotate(' + Math.random() * 360 + 'deg)';
    document.body.appendChild(confetti);

    let pos = 0;
    const fall = setInterval(() => {
      if (pos >= window.innerHeight) {
        clearInterval(fall);
        confetti.remove();
      }
      pos += 5;
      confetti.style.top = pos + 'px';
    }, 20);
  }
}

// Usage: createConfetti();`
        };

        function insertJSSnippet(type) {
            const snippet = jsSnippets[type];
            if (snippet) {
                const editor = document.getElementById('js-editor');
                editor.value += (editor.value ? '\n\n' : '') + snippet;
                playSound('pop', 'E5');
                showStamp('ğŸ“');
                updateStatus(`Added ${type} JS snippet!`);
            }
        }

        function applyJS() {
            const jsContent = document.getElementById('js-editor').value;
            if (!jsContent.trim()) {
                alert('JavaScript editor is empty!');
                return;
            }

            // Add JS to canvas as a script element
            const id = 'el-' + (++elementIdCounter);
            const html = `<script>${jsContent}<\/script>`;
            canvasElements.push({ id, type: 'js', html });

            renderCanvas();
            updateElementCount();
            playSound('success', 'A5');
            showStamp('âš¡');
            updateStatus('JavaScript applied to canvas!');
        }

        // ============================================
        // PROJECT MANAGEMENT
        // ============================================
        function newProject() {
            if (confirm('Start a new project? Current work will be lost!')) {
                canvasElements = [];
                renderCanvas();
                clearProperties();
                playSound('boop', 'C5');
                updateStatus('New project started!');
                updateElementCount();
                showStamp('ğŸ“„');
            }
        }

        // ============================================
        // UI HELPERS
        // ============================================
        function updateStatus(msg) {
            document.getElementById('status-message').textContent = 'âœ¨ ' + msg;
        }

        function updateElementCount() {
            document.getElementById('element-count').textContent = `Elements: ${canvasElements.length}`;
        }

        // ============================================
        // THEME SYSTEM
        // ============================================
        const themes = {
            'kidpix': {
                name: 'ğŸ¨ KidPix Classic',
                '--bg': '#FFFFE0',
                '--toolbox-bg': '#E6E6FA',
                '--canvas-bg': '#FFF',
                '--properties-bg': '#FFE4E1',
                '--toolbar-bg': '#87CEEB',
                '--border': '#000',
                '--text': '#000'
            },
            'dark': {
                name: 'ğŸŒ™ Dark Mode',
                '--bg': '#1a1a1a',
                '--toolbox-bg': '#2d2d2d',
                '--canvas-bg': '#1a1a1a',
                '--properties-bg': '#2d2d2d',
                '--toolbar-bg': '#000',
                '--border': '#444',
                '--text': '#00ff00'
            },
            'neon': {
                name: 'ğŸ’« Neon Dreams',
                '--bg': '#0a0a0a',
                '--toolbox-bg': '#1a001a',
                '--canvas-bg': '#000',
                '--properties-bg': '#001a1a',
                '--toolbar-bg': '#1a0033',
                '--border': '#ff00ff',
                '--text': '#00ffff'
            },
            'pastel': {
                name: 'ğŸ¬ Pastel Party',
                '--bg': '#ffeef8',
                '--toolbox-bg': '#fff0f5',
                '--canvas-bg': '#fff',
                '--properties-bg': '#f0f8ff',
                '--toolbar-bg': '#ffe4e1',
                '--border': '#ffb6c1',
                '--text': '#8b4789'
            },
            'matrix': {
                name: 'ğŸ’» Matrix',
                '--bg': '#000',
                '--toolbox-bg': '#001100',
                '--canvas-bg': '#000',
                '--properties-bg': '#001100',
                '--toolbar-bg': '#002200',
                '--border': '#00ff00',
                '--text': '#00ff00'
            }
        };

        let currentThemeIndex = 0;
        const themeKeys = Object.keys(themes);

        function cycleTheme() {
            currentThemeIndex = (currentThemeIndex + 1) % themeKeys.length;
            const themeKey = themeKeys[currentThemeIndex];
            const theme = themes[themeKey];

            // Apply theme
            const root = document.documentElement;
            Object.keys(theme).forEach(key => {
                if (key !== 'name') {
                    root.style.setProperty(key, theme[key]);
                }
            });

            // Save preference
            localStorage.setItem('wysiwyg-theme', themeKey);

            playSound('success', 'C6');
            showStamp('ğŸ¨');
            updateStatus(`Theme: ${theme.name}`);
        }

        function loadSavedTheme() {
            const savedTheme = localStorage.getItem('wysiwyg-theme');
            if (savedTheme && themes[savedTheme]) {
                currentThemeIndex = themeKeys.indexOf(savedTheme);
                const theme = themes[savedTheme];

                const root = document.documentElement;
                Object.keys(theme).forEach(key => {
                    if (key !== 'name') {
                        root.style.setProperty(key, theme[key]);
                    }
                });
            }
        }

        // ============================================
        // INIT
        // ============================================
        function init() {
            updateStatus('Ready to create!');
            updateElementCount();

            // Open first sections by default
            document.querySelectorAll('.tool-section').forEach((section, i) => {
                if (i < 3) section.classList.add('open');
            });

            // Init asset browser
            browseAssets('gifs');

            // Load saved theme
            loadSavedTheme();
        }

        init();
    </script>
</body>
</html>